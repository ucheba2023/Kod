"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[72709],{904443:(_,e,o)=>{o.d(e,{VKWebAppCustomMessage:()=>i.VKWebAppCustomMessage,getStore:()=>t.getStore});var i=o(30757),t=o(684762)},684762:(_,e,o)=>{o.d(e,{getStore:()=>d});var i=o(798116),t=o(367431);function a(){return{onOrdData:(0,i.createDomain)("APPS_CONNECT/VKWebAppCustomMessage").createEvent()}}function d(){return(0,t.makeSharedState)("static/js/modules/shared/apps_connect/handlers/VKWebAppCustomMessage/store.ts",a,{version:0})()}},471234:(_,e,o)=>{function i(_,e){const o=new IntersectionObserver(((_,o)=>{_.some((_=>_.isIntersecting))&&(e(),o.disconnect())}),{threshold:0});return o.observe(_),()=>o.disconnect()}o.d(e,{runOnceInViewport:()=>i})},653902:(_,e,o)=>{o.d(e,{CLIP_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>s,SHORT_VIDEO_UPLOAD_EXTS:()=>t,SHORT_VIDEO_UPLOAD_INPUT_ACCEPT:()=>d,VIDEO_UPLOAD_CHUNK_MAX_RETRY_NUMBER:()=>E,VIDEO_UPLOAD_CHUNK_SIZE:()=>r,VIDEO_UPLOAD_EXTS:()=>a,VIDEO_UPLOAD_FILE_THREAD_NUMBER:()=>c,VIDEO_UPLOAD_INPUT_ACCEPT:()=>l,VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>n,VIDEO_UPLOAD_SUBTITLES_DISABLED:()=>p,VIDEO_UPLOAD_SUBTITLES_USER_LANG:()=>u});const i=_=>["video/*",..._.map((_=>`.${_}`))].join(","),t="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),a=[...t,"torrent"],d=i(t),l=i(a),n=5,s=8,r=4194304,c=4,E=10,p=-1,u=-2},313702:(_,e,o)=>{o.d(e,{getUploadErrorText:()=>d,getVideoDuration:()=>a});var i,t=o(29271);o(653902);function a(_){return new Promise((e=>{try{const o=document.createElement("video");o.preload="metadata",o.onloadedmetadata=()=>e(Math.round(o.duration)),o.onerror=()=>e(null),o.src=window.URL.createObjectURL(_)}catch(_){e(null)}}))}function d(_){return _?100===_?t.getLang("video_upload_encode_error_too_short"):101===_?t.getLang("video_upload_encode_error_too_long"):void 0:t.getLang("video_upload_encode_error")}!function(_){_[_.SHORT_VIDEO_TOO_SHORT=100]="SHORT_VIDEO_TOO_SHORT",_[_.SHORT_VIDEO_TOO_LONG=101]="SHORT_VIDEO_TOO_LONG"}(i||(i={}))},313892:(_,e,o)=>{o.d(e,{getLangsForMonth:()=>t});var i=o(29271);function t(_){switch(_){case 1:return[i.getLang("Month1"),i.getLang("Month1_of"),i.getLang("month1_of")];case 2:return[i.getLang("Month2"),i.getLang("Month2_of"),i.getLang("month2_of")];case 3:return[i.getLang("Month3"),i.getLang("Month3_of"),i.getLang("month3_of")];case 4:return[i.getLang("Month4"),i.getLang("Month4_of"),i.getLang("month4_of")];case 5:return[i.getLang("Month5"),i.getLang("Month5_of"),i.getLang("month5_of")];case 6:return[i.getLang("Month6"),i.getLang("Month6_of"),i.getLang("month6_of")];case 7:return[i.getLang("Month7"),i.getLang("Month7_of"),i.getLang("month7_of")];case 8:return[i.getLang("Month8"),i.getLang("Month8_of"),i.getLang("month8_of")];case 9:return[i.getLang("Month9"),i.getLang("Month9_of"),i.getLang("month9_of")];case 10:return[i.getLang("Month10"),i.getLang("Month10_of"),i.getLang("month10_of")];case 11:return[i.getLang("Month11"),i.getLang("Month11_of"),i.getLang("month11_of")];case 12:return[i.getLang("Month12"),i.getLang("Month12_of"),i.getLang("month12_of")]}}},89580:(_,e,o)=>{o.r(e);var i,t,a,d=o(922571),l=o(725296),n=o(223072),s=o(250783),r=o(283452),c=o(320422),E=o(827502),p=o(504867),u=o(839470);(null==(t=window.vk)||null==(i=t.pe)?void 0:i.static_manager_dynamic_imports)&&(null==(a=window.vk)?void 0:a.stDomain)&&(o.p=window.vk.stDomain+"/dist/"),window.VideoUpload=d.VideoUpload,window.VideoUploadSubtitles=n.VideoUploadSubtitles,window.VideoInlineUpload=s.default;try{window.stManager.done(window.jsc("web/video_upload.js"))}catch(_){}function b(_,e){const o=_.payload.target;o&&!o.classList.contains("disabled")&&((0,l.checkbox)(o),(0,u.partConfigEnabled)("video_upload_page_click_logger")&&(0,p.statlogsValueEvent)("video_upload_page","",e,o.classList.contains("on")?"on":"off"))}(0,r.tq)().setInteractiveHandler("VideoUpload/pick_from_my_videos",(_=>{var e;const{groupId:o,playlistId:i="0"}=null!=(e=_.payload.dataAttrs)?e:{};d.VideoUpload.toGroupVideoSelect(o,parseInt(i,10))})),(0,r.tq)().setInteractiveHandler("VideoUpload/improve_quality",(_=>{b(_,"onUpgradeQuality")})),(0,r.tq)().setInteractiveHandler("VideoUpload/hide_auto_subs",(_=>{b(_,"onHideAutosub")})),(0,r.tq)().setInteractiveHandler("VideoUpload/publish_on_wall",(_=>{b(_,"onPublishOnWall")})),(0,r.tq)().setInteractiveHandler("VideoUpload/upload_custom_cover",(_=>{if(_.payload.target){var e;null==(e=_.payload.target.nextSibling)||e.click(),(0,u.partConfigEnabled)("video_upload_page_click_logger")&&(0,p.statlogsValueEvent)("video_upload_page","","onLoadThumbnail")}})),(0,r.tq)().setInteractiveHandler("VideoUpload/show_improve_quality_tooltip",(_=>{var e;const o=null==(e=_.payload.target)?void 0:e.closest(".video_improve_quality.disabled:not(.cant-improve)");if(o){var i;const{text:e}=null!=(i=_.payload.dataAttrs)?i:{};(0,c.showTooltip)(o,{text:e,dir:"top",shift:[22,10]})}})),(0,r.tq)().setInteractiveHandler("VideoUpload/hide_tooltip",(_=>{var e;const o=null==(e=_.payload.target)?void 0:e.closest(".video_improve_quality.disabled:not(.cant-improve)");var i;o&&(null==(i=window.tooltips)||i.hide(o))})),(0,r.tq)().setInteractiveHandler("VideoUpload/show_thumb_remove_tooltip",(({payload:_})=>{const{dataAttrs:e,target:o}=_,{text:i}=e||{},t=o;t&&(0,c.showTooltip)(t,{text:i,dir:"bottom",center:!0,typeClass:"tt_black",className:"VideoWebcastFormHint",shift:[-20,-12],appendEl:document.querySelector(".VideoWebcastForm__aside")||void 0})})),(0,r.tq)().setInteractiveHandler("VideoUpload/remove_uploaded_thumb",(({payload:_})=>{const{target:e,event:o}=_;d.VideoUpload.removeUploadedThumb(e,o)})),(0,r.tq)().setInteractiveHandler("VideoUploadEdit/show_ord_app",(()=>{const _={edit:!1,options:{noLocChange:1,skipBoxesHide:1,noClickHide:1,onLoaded:()=>{const _=document.querySelector(".MiniAppControlClose");_&&(_.style.display="none"),window.wkcur.onFail=d.VideoUpload.changeModalVisibility,window.cur.onExternalAppDone=()=>{var _;null==(_=window)||_.WkView.hide(!1,!0),d.VideoUpload.changeModalVisibility(),window.cur.onExternalAppDone=null,window.wkcur.onFail=null},d.VideoUpload.changeModalVisibility(!1)},onFail:()=>d.VideoUpload.changeModalVisibility()},isSnackbar:!1};(0,E.handleOrdMiniappOpen)(d.VideoUpload.ordData,d.VideoUpload.setOrdData,_)}))},222325:(_,e,o)=>{o.d(e,{hideSnackbar:()=>U,showSnackbar:()=>L,showSnackbarUnsafe:()=>h});var i=o(11010),t=o(434788),a=o(820224),d=o(667294),l=o(973935),n=o(659397),s=o(800325),r=o(228042),c=o(417873),E=o(773693),p=o(667465),u=o(584356),b=o(786858);const m={top:"notifier_snackbar_align_top",center:"notifier_snackbar_align_center",bottom:"notifier_snackbar_align_bottom"},D={ok:(0,s.getIcon24CheckCircleOutline)().icon,warning:(0,r.getIcon24WarningTriangleOutline)().icon,error:(0,c.getIcon24ErrorCircleOutline)().icon,ok28:(0,E.getIcon28CheckCircleOutline)().icon,loudspeaker28:(0,p.getIcon28LoudspeakerSlashOutline)().icon},O={ok:"notifier_snackbar_type_ok",warning:"notifier_snackbar_type_warning",error:"notifier_snackbar_type_error",ok28:"notifier_snackbar_type_ok",loudspeaker28:"notifier_snackbar_type_loudspeaker"};function h(_){return P.apply(this,arguments)}function P(){return(P=(0,i._)((function*({id:_,type:e,text:o,subtitle:i,action:t,before:a,after:d,link:l,timeout:n,align:s,onClick:r,onClose:c}){var E,p,h;let P;const w={id:_,link:l,timeout:n,onClick:r?()=>((0,b.assertNotNull)(P),r(P)):void 0,onHide:c},v={author_link:null==(p=a)||null==(E=p.avatar)?void 0:E.link,add_photo:null==(h=d)?void 0:h.url,tooltipHandler:_=>{var o,i,l,n,r,c,E,p,u,h;_.classList.add("notifier_snackbar"),e&&D[e]?(_.classList.add("notifier_snackbar_with_custom_before"),_.classList.add(O[e])):(null==(i=a)||null==(o=i.avatar)?void 0:o.url)||(null==(n=a)||null==(l=n.avatar)?void 0:l.content)?a.avatar.fill&&_.classList.add("notifier_snackbar_with_filled_avatar"):!(null==(c=a)||null==(r=c.avatar)?void 0:r.content)&&(null==(E=a)?void 0:E.content)&&_.classList.add("notifier_snackbar_with_custom_before"),(null==(h=null==(p=d)?void 0:p.rounded)||h)&&_.classList.add("notifier_snackbar_with_rounded_after");const w=s?m[s]:void 0;if(w&&_.classList.add(w),null==(u=t)?void 0:u.onClick){var v;null==(v=_.querySelector(".notifier_snackbar_action"))||v.addEventListener("click",(_=>{var e,o;(0,b.assertNotNull)(P),null==(e=(o=t).onClick)||e.call(o,_,P)}))}}};if(e&&D[e])v.avatar_custom_content=D[e];else if(a){var M,g,C,L,U;v.author_link=null==(M=a.avatar)?void 0:M.link,(null==(g=a.avatar)?void 0:g.url)?v.author_photo=a.avatar.url:(null==(C=a.avatar)?void 0:C.content)?v.avatar_custom_content=a.avatar.content:a.content&&(v.avatar_custom_content=a.content),(null==(L=a.icon)?void 0:L.type)?v.icon_type=a.icon.type:(null==(U=a.icon)?void 0:U.url)&&(v.icon_custom={image_url:a.icon.url})}const T=[`<div class="notifier_snackbar_text">${o}</div>`,i&&`<div class="notifier_snackbar_subtitle">${i}</div>`,t&&`<div><a class="notifier_snackbar_action" ${t.href?`href="${t.href}"`:""}>${t.label}</a></div>`].filter(Boolean).join("");return P=yield(0,u.showDoneBoxAsync)(T,w,v),P}))).apply(this,arguments)}const w=_=>{var{label:e,href:o}=_,i=(0,a._)(_,["label","href"]);return(0,t._)({label:T(e),href:o&&(0,n.escape)(o)},i)},v=_=>{var{link:e,url:o,content:i}=_,d=(0,a._)(_,["link","url","content"]);return(0,t._)({link:e&&(0,n.escape)(e),url:o&&(0,n.escape)(o),content:i?T(i):void 0},d)},M=_=>{var{url:e}=_,o=(0,a._)(_,["url"]);return(0,t._)({url:e&&(0,n.escape)(e)},o)},g=({avatar:_,content:e,icon:o})=>({avatar:_&&v(_),content:e?T(e):void 0,icon:o&&M(o)}),C=_=>{var{url:e}=_,o=(0,a._)(_,["url"]);return(0,t._)({url:e&&(0,n.escape)(e)},o)};function L(_){var{text:e,subtitle:o,action:i,before:d,after:l,link:s}=_,r=(0,a._)(_,["text","subtitle","action","before","after","link"]);return h((0,t._)({text:T(e),subtitle:o?T(o):void 0,action:i&&w(i),before:d&&g(d),after:l&&C(l),link:s&&(0,n.escape)(s)},r))}function U(_){var e;null==(e=window.Notifier)||e.hideEvent(_)}function T(_){const e=document.createElement("div");return(0,l.render)((0,d.createElement)(d.Fragment,null,_),e),e.innerHTML}},827502:(_,e,o)=>{o.d(e,{handleOrdMiniappOpen:()=>n});var i=o(96824),t=o(120718),a=o(29271),d=o(904443),l=o(222325);const n=(_,e,o)=>{var n,s,r,c,E;const p=_?(0,i.objectToQuerystring)(_,"#"):"";null==(c=(E=window).showWiki)||c.call(E,{w:`app${t.ORD_APP_ID}${p}`},null==(n=o)?void 0:n.edit,null==(s=o)?void 0:s.ev,null==(r=o)?void 0:r.options);const u=(0,d.getStore)().onOrdData.watch((i=>{var t,d,n,s,r;(null==(t=o)?void 0:t.isSnackbar)&&((null==(d=i)?void 0:d.is_ad)&&!(null==(n=_)?void 0:n.is_ad)?(0,l.showSnackbar)({text:a.getLang("global_ads_wall_post_ord_mark_as_ads_added"),timeout:3e3,type:"ok28"}):!(null==(s=i)?void 0:s.is_ad)&&(null==(r=_)?void 0:r.is_ad)&&(0,l.showSnackbar)({text:a.getLang("global_ads_wall_post_ord_mark_as_ads_removed"),timeout:3e3,type:"loudspeaker28"}));e(i),u()}))}},488500:(_,e,o)=>{function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.25 1a.75.75 0 0 1 .75.75v.26L8.32 2H13v-.25a.75.75 0 0 1 1.5 0v.36c.43.06.82.17 1.18.35a4.25 4.25 0 0 1 1.86 1.86c.25.5.36 1.04.41 1.67.05.61.05 1.37.05 2.33v3.36c0 .96 0 1.72-.05 2.33a4.39 4.39 0 0 1-.41 1.67 4.25 4.25 0 0 1-1.86 1.86c-.5.25-1.04.36-1.67.41-.61.05-1.38.05-2.33.05H8.32c-.96 0-1.72 0-2.33-.05a4.39 4.39 0 0 1-1.67-.41 4.25 4.25 0 0 1-1.86-1.86 4.39 4.39 0 0 1-.41-1.67C2 13.4 2 12.63 2 11.68V8.32c0-.96 0-1.72.05-2.33.05-.63.16-1.17.41-1.67a4.25 4.25 0 0 1 1.86-1.86 3.8 3.8 0 0 1 1.18-.35v-.36A.75.75 0 0 1 6.25 1ZM5.5 3.63a2 2 0 0 0-.5.17A2.75 2.75 0 0 0 3.8 5c-.13.25-.21.57-.26 1.11-.02.26-.03.54-.03.88h12.98a14.08 14.08 0 0 0-.03-.88 2.9 2.9 0 0 0-.26-1.1A2.75 2.75 0 0 0 15 3.8a2.02 2.02 0 0 0-.5-.17v.12a.75.75 0 0 1-1.5 0v-.24a80.42 80.42 0 0 0-1.35-.01H7v.25a.75.75 0 0 1-1.5 0v-.12Zm11 4.86h-13v3.16c0 1 0 1.7.04 2.24.05.53.13.86.26 1.1A2.75 2.75 0 0 0 5 16.2c.25.13.57.21 1.11.26.55.04 1.25.04 2.24.04h3.3c1 0 1.7 0 2.24-.04a2.9 2.9 0 0 0 1.1-.26A2.75 2.75 0 0 0 16.2 15c.13-.25.21-.57.26-1.11.04-.55.04-1.25.04-2.24V8.5Z" clip-rule="evenodd"/></svg>',name:"calendar_outline_20"}}o.d(e,{getIcon20CalendarOutline:()=>i})},75075:(_,e,o)=>{function i(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 4.22a.75.75 0 0 1 0 1.06L7.8 10l4.72 4.72a.75.75 0 1 1-1.06 1.06l-5.25-5.25a.75.75 0 0 1 0-1.06l5.25-5.25a.75.75 0 0 1 1.05 0z" fill="currentColor"/></svg>',name:"chevron_left_outline_20"}}o.d(e,{getIcon20ChevronLeftOutline:()=>i})},876286:(_,e,o)=>{function i(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.47 4.22a.75.75 0 0 0 0 1.06L12.19 10l-4.72 4.72a.75.75 0 1 0 1.06 1.06l5.25-5.25a.75.75 0 0 0 0-1.06L8.53 4.22a.75.75 0 0 0-1.06 0z" fill="currentColor"/></svg>',name:"chevron_right_outline_20"}}o.d(e,{getIcon20ChevronRightOutline:()=>i})},800325:(_,e,o)=>{function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M14.96 9.26a.9.9 0 0 1 1.28 1.28l-4.6 4.6a.9.9 0 0 1-1.28 0l-2.6-2.6a.9.9 0 0 1 1.28-1.28L11 13.23l3.96-3.97Z"/><path fill-rule="evenodd" d="M12 2.1a9.9 9.9 0 1 1 0 19.8 9.9 9.9 0 0 1 0-19.8Zm0 1.8A8.1 8.1 0 0 0 3.9 12a8.1 8.1 0 0 0 8.1 8.1 8.1 8.1 0 0 0 8.1-8.1A8.1 8.1 0 0 0 12 3.9Z" clip-rule="evenodd"/></svg>',name:"check_circle_outline_24"}}o.d(e,{getIcon24CheckCircleOutline:()=>i})},417873:(_,e,o)=>{function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M4.93 4.93A9.97 9.97 0 0 1 12 2a9.97 9.97 0 0 1 7.07 2.93A9.97 9.97 0 0 1 22 12a9.97 9.97 0 0 1-2.93 7.07A9.97 9.97 0 0 1 12 22a9.97 9.97 0 0 1-7.07-2.93A9.97 9.97 0 0 1 2 12a9.97 9.97 0 0 1 2.93-7.07ZM12 3.8a8.17 8.17 0 0 0-5.8 2.4A8.17 8.17 0 0 0 3.8 12a8.17 8.17 0 0 0 2.4 5.8 8.17 8.17 0 0 0 5.8 2.4 8.17 8.17 0 0 0 5.8-2.4 8.17 8.17 0 0 0 2.4-5.8 8.17 8.17 0 0 0-2.4-5.8A8.17 8.17 0 0 0 12 3.8ZM13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-1-9a.9.9 0 0 1 .9.9v5.2a.9.9 0 0 1-1.8 0V7.9A.9.9 0 0 1 12 7Z" clip-rule="evenodd"/></svg>',name:"error_circle_outline_24"}}o.d(e,{getIcon24ErrorCircleOutline:()=>i})},228042:(_,e,o)=>{function i(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path clip-rule="evenodd" d="M9.49 4.55a2.9 2.9 0 0 1 5.02 0l6.93 12a2.9 2.9 0 0 1-2.51 4.35H5.07a2.9 2.9 0 0 1-2.51-4.35zm3.46.9a1.1 1.1 0 0 0-1.9 0l-6.93 12c-.42.73.1 1.65.95 1.65h13.86c.85 0 1.37-.92.95-1.65z" fill-rule="evenodd"/><path clip-rule="evenodd" d="M12 8c.5 0 .9.37.9.84v4.82c0 .47-.4.84-.9.84s-.9-.37-.9-.84V8.84c0-.47.4-.84.9-.84z" fill-rule="evenodd"/><path d="M13 16.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></g></svg>',name:"warning_triangle_outline_24"}}o.d(e,{getIcon24WarningTriangleOutline:()=>i})},773693:(_,e,o)=>{function i(){return{icon:'<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="check_circle_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="check_circle_outline_28__check_circle_outline_28" fill-rule="nonzero"><path d="M0 0h28v28H0z"/><path d="M14 2a12 12 0 1 1 0 24 12 12 0 0 1 0-24Zm0 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm4.29 6.29a1 1 0 0 1 1.42 0 1 1 0 0 1 0 1.42l-7 7a1 1 0 0 1-1.42 0l-3.5-3.5a1 1 0 0 1 1.42-1.42L12 16.6Z" id="check_circle_outline_28__Icon-Color" fill="currentColor"/></g></g></svg>',name:"check_circle_outline_28"}}o.d(e,{getIcon28CheckCircleOutline:()=>i})},667465:(_,e,o)=>{function i(){return{icon:'<svg fill="none" height="28" viewBox="0 0 28 28" width="28" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M21.46 7.16a1 1 0 0 1 1.38.3A1 1 0 0 1 23 8v12.35a1 1 0 1 0 2 0V8a3 3 0 0 0-4.61-2.53L16.42 8h-3.77a1 1 0 1 0 0 2H15v2.34a1 1 0 1 0 2 0V10z"/><path clip-rule="evenodd" d="M16.75 17.34a1.01 1.01 0 0 0-.09-.1L4.71 5.3A1 1 0 0 0 3.3 6.7L5.48 8.9c-.18.12-.34.25-.5.37a5.52 5.52 0 0 0-.37 8.12 5.49 5.49 0 0 0 2.98 1.53l.45 2.6a3 3 0 1 0 5.91-1.04L13.7 19h1.9l6.7 6.71a1 1 0 0 0 1.42-1.41zm-9.82-7a7.37 7.37 0 0 0-.9.68 3.49 3.49 0 0 0 0 4.95c.63.64 1.5 1.03 2.47 1.03h5.08zM10 21.17 9.63 19h2.03l.32 1.82a1 1 0 0 1-.8 1.16 1 1 0 0 1-1.17-.8z" fill-rule="evenodd"/></g></svg>',name:"loudspeaker_slash_outline_28"}}o.d(e,{getIcon28LoudspeakerSlashOutline:()=>i})},120718:(_,e,o)=>{o.d(e,{API_VERSION:()=>i,CLOSE_STATUS:()=>c,ERROR_CODES:()=>l,ERROR_REASONS:()=>n,ERROR_TYPES:()=>s,GROUP_STATUS:()=>E,NFT_APP_ID:()=>m,ORD_APP_ID:()=>b,PERMISSION_TYPES:()=>r,PLATFORM:()=>d,PMC_PART_CONFIG_KEY_LONG_ID:()=>h,TEXTLIVE_APPS:()=>u,THROTTLE_SCROLL_TIME:()=>t,VKPAY_APPS:()=>p,VKPAY_TRANSACTION_EVENT:()=>a,VK_CONNECT_EVENTS:()=>D,VK_CONNECT_SUPERAPPKIT_EVENT_TYPE:()=>O});const i="5.95",t=200,a="VKWebAppActionDone",d={WEB:"web",MOBILE_WEB:"mobile-web"},l={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,UNSUPPORTED_PLATFORM:6,REQUESTS_LIMIT_REACHED:10,ACCESS_DENIED:11,CUSTOM:13},n={ACCESS_DENIED:"Access denied",UNSUPPORTED_PLATFORM:"Unsupported platform",UNSUPPORTED_ACTION:"Unsupported action",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device",USER_NOT_A_PRIVATE_GROUP_MEMBER:"User is not a member of the given private group",UNKNOWN_ERROR:"Unknown error",CONNECTION_LOST:"Connection lost",NETWORK_ERROR:"Network error",USER_DENIED:"User denied",INVALID_PARAMS:"Invalid params",NO_ADS:"No ads",ADS_ALREADY_PLAYED:"Ads already played",VK_PAY_DISABLED:"This app can't use VK Pay",SCROLL_SUBSCRIBER_ALREADY_EXIST:"Scroll subscriber already exist",SUBSCRIPTION_IS_ALREADY_CANCELLED:"Subscription is in invalid status: subscription is already cancelled",SURVEY_INIT_IN_PROGRESS:"Survey init in progress",SURVEY_ALREADY_INIT:"Survey already init",SURVEY_NO_MATCH:"Survey no match",SURVEY_USER_CANCEL:"Survey user cancel",ALREADY_IN_PROGRESS:"Already in progress",USER_IS_NOT_GROUP_ADMIN:"Only group admins have access to group tokens",DEVICE_CANT_GET_GEODATA:"Device can't get geodata",USER_DIDNT_ALLOWED_ACTION:"User didn't allowed"},s={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},r={DENIED:"denied",PROMPT:"prompt",GRANTED:"granted"},c=["success","failed"],E={OPEN:0,CLOSED:1,PRIVATE:2},p=[6217559,7131443],u=[7512376],b=51707812,m=51459963,D={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppAddToMenu:"add_to_menu",VKWebAppAddToMenuPreload:"is_in_left_menu",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_preload_settings",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppAllowNotificationsPreload:"are_notifications_allowed",VKWebAppAllowNotifications:"allow_notifications",VKWebAppDenyNotifications:"deny_notifications",VKWebAppAllowMessagesFromGroup:"allow_messages_from_group",VKWebAppAllowMessagesFromGroupPreload:"can_send_messages_from_group",VKWebAppJoinGroup:"join_group",VKWebAppJoinGroupPreload:"is_group_member",VKWebAppLeaveGroup:"leave_group",VKWebAppLeaveGroupPreload:"is_group_member",VKWebAppOpenApp:"open_app",VKWebAppSendPayload:"send_payload",VKWebAppSendToClient:"send_to_client",VKWebAppSendToClientPreload:"get_open_in_native_permission",VKWebAppShowOrderBox:"order",VKWebAppShowSubscriptionBox:"subscription",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowStoryBox:"story_box",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppStorageGetKeys:"storage_get_keys",VKWebAppStorageSet:"storage_set",VKWebAppStorageGet:"storage_get",VKWebAppOpenArticleEditor:"open_article_edit",VKWebAppSubscribeStoryApp:"subscribe_story_app",VKWebAppClose:"close",VKWebAppGetSilentToken:"get_silent_token",VKWebAppCheckAllowedScopes:"check_allowed_scopes",VKWebAppOpenPayForm:"open_pay_form",VKWebAppCheckSurvey:"check_survey",VKWebAppShowSurvey:"show_survey",VKWebAppAddToChat:"add_to_chat",VKWebAppTrackEvent:"track_event",VKWebAppCallStart:"call_start",VKWebAppCallJoin:"call_join",VKWebAppCallLeft:"call_left",VKWebAppCallFinished:"call_finished",VKWebAppCallGetStatus:"call_get_status"},O="vk-sak-sdk",h="mini_apps_long_id"},176518:(_,e,o)=>{o.d(e,{Handler:()=>E});var i=o(434788),t=o(611374),a=o(953151),d=o(574021),l=o(120718),n=o(404145),s=o(664988),r=o(193452),c=o(602033);class E{get successDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Result`}get errorDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Failed`}get previousCallsCount(){var _,e;return(null==(e=this.app)||null==(_=e.context)?void 0:_.getHandlerCallsCount(this.params.handlerName))-1||0}shouldLogStat(){return!0}getEventHash(_=!1){return cur.app.options[`${l.VK_CONNECT_EVENTS[`${this.params.handlerName}${_?"Preload":""}`]}_hash`]}getEventHashes(_=!1){return cur.app.options[`${l.VK_CONNECT_EVENTS[`${this.params.handlerName}${_?"Preload":""}`]}_hashes`]}getEventName(_=!1){return l.VK_CONNECT_EVENTS[`${this.params.handlerName}${_?"Preload":""}`]}sendNetworkError(){this.errorHandler({code:l.ERROR_CODES.UNKNOWN,error_type:l.ERROR_TYPES.CLIENT,reason:l.ERROR_REASONS.UNKNOWN_ERROR})}sendConnectionLostError(){this.errorHandler({code:l.ERROR_CODES.CONNECTION_LOST,error_type:l.ERROR_TYPES.CLIENT,reason:l.ERROR_REASONS.CONNECTION_LOST})}sendUserDeniedError(){this.errorHandler({code:l.ERROR_CODES.USER_DENIED,error_type:l.ERROR_TYPES.CLIENT,reason:l.ERROR_REASONS.USER_DENIED})}handleApiError(_){var e,o,i;const t=null==(e=_)?void 0:e.error,a=null==(o=t)?void 0:o.error_msg,d=null==(i=t)?void 0:i.error_code;if(d)switch(d){case c.API_ERROR_ACCESS:this.errorHandler({code:l.ERROR_CODES.ACCESS_DENIED,error_type:l.ERROR_TYPES.CLIENT,reason:a});break;case c.API_ERROR_PARAM:this.errorHandler({code:l.ERROR_CODES.INVALID_PARAMS,error_type:l.ERROR_TYPES.CLIENT,reason:a});break;default:this.errorHandler({code:l.ERROR_CODES.CUSTOM,error_type:l.ERROR_TYPES.CLIENT,reason:a||l.ERROR_REASONS.UNKNOWN_ERROR})}else this.errorHandler({code:l.ERROR_CODES.CONNECTION_LOST,error_type:l.ERROR_TYPES.CLIENT,reason:a||l.ERROR_REASONS.UNKNOWN_ERROR})}sendCustomError(_){this.errorHandler({code:l.ERROR_CODES.CUSTOM,reason:_||l.ERROR_REASONS.UNKNOWN_ERROR})}checkParams(_,e){for(let o=0;o<e.length;o++){const{param:i,type:t,isRequired:a,extraChecks:d}=e[o];if(!_.hasOwnProperty(i)&&a)return this.errorHandler({code:l.ERROR_CODES.MISSING_PARAM,reason:`Missing required param "${i}"`}),!1;if(_.hasOwnProperty(i)&&typeof _[i]!==t)return this.errorHandler({code:l.ERROR_CODES.INVALID_PARAMS,reason:`Param "${i}" should be ${t}`},this.callback),!1;if(_.hasOwnProperty(i)&&d&&d.length>0)for(let e=0;e<d.length;e++)if(!d[e].check(_[i]))return this.errorHandler({code:l.ERROR_CODES.INVALID_PARAMS,reason:d[e].error(i)},this.callback),!1}return!0}actionHandler(_){return this.callApi?ajax.post("apps.php",(0,i._)({act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},_),{onDone:e=>{this.handleResponse(e,_,this.checkResponse)},onFail:_=>(this.errorHandler(_),!0)}):{}}checkResponse(_){1===_||0===_?this.successHandler(Boolean(_)):this.successHandler(_)}scopeStringToArray(_){return _?_.replace(/ /g,"").split(","):[]}denyUIAction(){this.errorHandler({error_type:"client_error",code:l.ERROR_CODES.USER_DENIED},null),t.default.pop(this.modal)}allowUIAction(_){this.actionHandler(_),t.default.pop(this.modal)}createDenyUIAction(_){this.params.modal.cancelAction=void 0!==_?()=>this.denyUIAction(_):this.denyUIAction}createAllowUIAction(_){this.params.modal.allowAction=void 0!==_?()=>this.allowUIAction(_):this.allowUIAction}launchUI(_){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new d.UIAction((0,i._)({},this.params.modal,_)),t.default.push(this.modal)}_enhanceBtnsWithActions(){this.params.modal.buttons&&this.params.modal.buttons.forEach(((_,e)=>{"deny"===_.type?this.params.modal.buttons[e].action=this.params.modal.cancelAction:this.params.modal.buttons[e].action=this.params.modal.allowAction}))}setData(_,e,o=null){o&&(this.callback=o),_.request_id&&(this.params.request_id=_.request_id),this.params.modal||(this.params.modal={}),_.containerId&&(this.params.modal.containerId=_.containerId),_.pic&&(this.params.modal.pic=_.pic),this.app=e}handleResponse(_,e,o,i){try{const i=JSON.parse(_);i.hasOwnProperty("error")?this.errorHandler(i.error):o(i,e)}catch(_){i?i(_):this.errorHandler(_)}}handler(_,e,o){if(this.setData(_,e),this.callback=o,this.isWebOnly&&(0,n.isMvk)()||this.isMobileWebOnly&&!(0,n.isMvk)())return this.errorHandler({code:l.ERROR_CODES.UNSUPPORTED_PLATFORM,error_type:l.ERROR_TYPES.CLIENT,reason:l.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.useUI?this.launchUI(_):this.useUI||this.actionHandler(_)}getAppWebviewUrl(){return cur.app.frame.src}successHandler(_,e=void 0){e&&e(),(0,s.isObject)(_)||(_={result:_}),this.params.request_id&&_&&(_.request_id=this.params.request_id),this.callback({type:this.successDescriptor,data:_},this.params.handlerName),(0,n.isMvk)()&&cur.app.frame.focus(),this.shouldLogStat()&&r.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!0})}errorHandler(_,e,o){"string"==typeof _&&(_={reason:_}),this.params.request_id&&(_.request_id=this.params.request_id);const i=new a.default(this.errorDescriptor,_,o);e&&e(),this.callback(i.selectErrorType()),(0,n.isMvk)()&&cur.app.frame.focus(),this.shouldLogStat()&&r.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!1},{error_type:i.type||l.ERROR_TYPES.CLIENT,error_code:i.data.code||l.ERROR_CODES.UNKNOWN})}constructor(_={}){this.params=(0,i._)({handlerName:"handler",method:"method"},_),this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.isWebOnly=!1,this.isMobileWebOnly=!1,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),cur.vkAppSuccessHandler=this.successHandler,cur.vkAppErrorHandler=this.errorHandler,this.checkResponse=this.checkResponse.bind(this)}}},30757:(_,e,o)=>{o.d(e,{VKWebAppCustomMessage:()=>l});var i=o(176518),t=o(404145),a=o(120718),d=o(684762);class l extends i.Handler{actionHandler(_){if(_.action&&_.payload){if(this.app.isTextliveApp){var e;const o=null==(e=window.Textlives)?void 0:e.onBridgeEvent(_);return void(o&&o.then(this.successHandler).catch(this.errorHandler))}if(this.app.appId===a.NFT_APP_ID)return this.handleSetNftAvatar(_),void this.successHandler({result:!0});if(this.app.appId===a.ORD_APP_ID)return this.handleSetOrdData(_),void this.successHandler({result:!0})}this.errorHandler("unknown error")}handleSetNftAvatar({action:_,payload:e}){var o;"VKWebAppSetNFTAvatar"===_&&((0,t.isMvk)()?window.OwnerPhotoUpload2.setNftAvatar(e):window.ajax.post("al_page.php",{act:"owner_avatar_upload",oid:null==(o=e)?void 0:o.oid},{onDone:(_,o)=>{window.handleVKBridgeSetNftAvatar(e,_,o)}}))}handleSetOrdData({action:_,payload:e}){"ord_data"===_&&e&&(0,d.getStore)().onOrdData({is_ad:e.isAd||!1,ord_pred_id:e.predId||"",erid:e.erId||""})}constructor(_){super(_),this.params.handlerName="VKWebAppCustomMessage"}}},611374:(_,e,o)=>{o.d(e,{default:()=>i});const i=new class{push(_){_.init(),this.checkStack(),0===cur.vkMiniAppsStack.length&&_.show(),cur.vkMiniAppsStack.push(_)}clearLayerPopups(){this.checkStack(),cur.vkMiniAppsStack.length>0&&(cur.vkMiniAppsStack=cur.vkMiniAppsStack.filter((_=>!~_.appNode.id.indexOf("container_layer"))))}pop(_){const e=cur.vkMiniAppsStack.indexOf(_);~e&&(cur.vkMiniAppsStack.splice(e,1),this.checkForNext())}shift(){cur.vkMiniAppsStack=cur.vkMiniAppsStack.slice(1),this.checkForNext()}checkForNext(){cur.vkMiniAppsStack.length>0&&cur.vkMiniAppsStack[0].show()}constructor(){this.checkStack=()=>{cur.vkMiniAppsStack||(cur.vkMiniAppsStack=[])},this.checkStack(),cur.clearVKMiniAppsLayerPopups=this.clearLayerPopups.bind(this)}}},574021:(_,e,o)=>{o.d(e,{CLOSE_BUTTON_MODES:()=>u,UIAction:()=>h,renderCounter:()=>D,setCounter:()=>O});var i=o(11010),t=o(434788),a=o(820224),d=o(404145),l=o(278534),n=o(662273),s=o(698250),r=o(827916),c=o(783905),E=o(676324),p=o(839470);const u={INNER:0,OUTER:1},b="deny",m="extra",D=_=>{const e=document.createElement("span");return e.classList.add("VkAppModal__buttonCounter"),e.innerText=_,e},O=(_,e)=>{const o=_.find((_=>_.hasCounter));o&&o.counterElement&&(o.counterElement.innerText=e)};class h{addScroll(){(0,l.addPopupScroll)(this.modal.children[0],this.modalParentLayer)}init(){this.containerNode&&this.containerNode.appendChild(this.modal),this.modalParentLayer=this.modal.closest(".layer_wrap"),this.modalParentLayer?this.modalParentLayer.addEventListener("scroll",this.addScroll):window.addEventListener("scroll",this.addScroll)}show(){(0,d.isMvk)()&&document.body.classList.add("vk_app_fixed"),this.props.withoutAnimation?this.modal.classList.add("show"):setTimeout((()=>this.modal.classList.add("show")),300),this.initMvkCloseActions(),this.addScroll()}initMvkCloseActions(){(0,d.isMvk)()&&(window.DirectGames&&cur.app.isDirectGame&&window.DirectGames.onBoxOpen(this),this.props.onlyButtonHide||(this.modal.onclick=_=>{_.target===this.modal&&this.onAction(this.props.cancelAction)}))}close(){this.props.onlyButtonHide||this.onAction(this.props.cancelAction)}destroy(){window.removeEventListener("scroll",this.addScroll),this.modalParentLayer&&this.modalParentLayer.removeEventListener("scroll",this.addScroll),this._destroyed||((0,d.isMvk)()&&(document.body.classList.remove("vk_app_fixed"),window.DirectGames&&cur.app.isDirectGame&&(window.DirectGames.onBoxClose(this),cur.app.frame.focus())),this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback(),this._destroyed=!0)}_disableButton(_,e=!0){_.disabled=e,_.element.disabled=e}_lockButton(_,e=!0){const o=(0,d.isMvk)()?(0,s.getIcon24Spinner)().icon:(0,r.getIcon16Spinner)().icon,i=`\n    <span class="vk_app_modal_btn__content">${_.title}</span>\n    <span class="vk_app_modal_btn__spinner">${o}</span>\n    `;_.loading=e,_.element.innerHTML=e?i:_.title,_.element.classList.toggle("vk_app_modal_btn--loading",e)}onAction(_){var e=this;return(0,i._)((function*(){yield _(),e.destroy()}))()}lockButtons(_=!0){const e={success:this._lockButton,[b]:this._disableButton,[m]:this._disableButton};this.props.buttons.forEach((o=>e[o.type](o,_)))}_setCounter(_){O(this.props.buttons,_)}_renderBtn(_){const e=document.createElement("button");if(e.setAttribute("type","button"),e.classList.add("vk_app_modal_btn"),e.classList.add(`vk_app_modal_btn--${_.type}`),e.innerText=_.title,e.addEventListener("click",(()=>_.type===m?_.action():this.onAction(_.action))),_.hasCounter){const o=D(0);e.appendChild(o),_.counterElement=o}return _.element=e,_.disabled&&this._disableButton(_),_.loading&&this._lockButton(_),e}_renderBtns(_){const e=_.querySelector(".vk_app_modal_btns"),{buttons:o}=this.props;if(e){o.forEach((_=>e.appendChild(this._renderBtn(_))));const _=o.find((_=>_.type===m));1===o.length&&e.classList.add("vk_app_modal_btns--single-btn"),_&&e.classList.add("vk_app_modal_btns--hasExtraButton")}}_renderCloseBtn(_){const e=document.createElement("button");e.setAttribute("type","button"),e.classList.add("vk_app_modal_close_btn"),(0,d.isMvk)()||this.props.closeButtonMode!==u.OUTER?e.innerHTML=(0,E.getIcon24Cancel)().icon:(e.classList.add("vk_app_modal_close_btn--outer"),e.innerHTML=(0,c.getIcon20Cancel)().icon),e.addEventListener("click",(()=>this.onAction(this.props.cancelAction))),_.children[0].appendChild(e)}_renderCheckboxFields(_,e){const o=document.createElement("div");o.classList.add("MiniAppsCheckbox__fields");const i=document.createElement("h5");if(i.classList.add("MiniAppsCheckbox__fields-title"),i.innerHTML=_,o.appendChild(i),e){const _=document.createElement("h6");_.classList.add("MiniAppsCheckbox__fields-description"),_.innerHTML=e,o.appendChild(_)}return o}_renderCheckbox(_){const{title:e,description:o}=_,i=(0,a._)(_,["title","description"]),t=document.createElement("label");t.classList.add("MiniAppsCheckbox");const d=document.createElement("input");d.type="checkbox",d.classList.add("MiniAppsCheckbox__checkbox"),d.addEventListener("change",(e=>_.checked=e.target.checked)),t.appendChild(d),Object.entries(i).forEach((([_,e])=>{d[_]=e}));const l=document.createElement("div");l.classList.add("MiniAppsCheckbox__fake_checkbox"),t.appendChild(l);const n=this._renderCheckboxFields(e,o);return t.appendChild(n),t}_renderCheckboxWrap(_){const e=_.querySelector(".MiniAppsModalCheckbox");e&&this.props.checkbox.map((_=>e.appendChild(this._renderCheckbox(_))))}_renderOuter(){const _=document.createElement("div");return _.classList.add("vk_app_modal_outer"),_}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach(((_,e)=>{_.type===b?this.props.buttons[e].action=this.props.cancelAction:_.type===m?this.props.buttons[e].action=this.props.extraAction:this.props.buttons[e].action=this.props.allowAction}))}_renderScopes(_){return _.map(((_,e)=>{const o=getLang(`vkapps_scope_${_}`);return 0===e?o:o.toLowerCase()})).join(", ")}prepareScopes(_){return 0===_.length?["general"]:_}prepareExtraBtn(){const _=document.createElement("button");return _.setAttribute("type","button"),_.classList.add("vk_app_modal_btn","VkAppModal__button--extra","vk_app_modal_btn--transparent"),_.innerHTML=getLang("apps_connect_modal_messages_scopes_edit"),_.addEventListener("click",this.props.extraAction),_}getThumb(){if(this.props.svgIcon)return this.props.svgIcon;const _=this.props.picClass?this.props.picClass:"";return this.props.pic?`<img src="${this.props.pic}" class="vk_app_modal_container__pic MiniAppModalContainer__pic ${_}" alt aria-label="product">`:""}isHorizontalLayoutSupported(){return(0,d.isMvk)()&&(0,p.partConfigEnabled)("vk_bridge_modals_horizontal_layout")}renderModal(){this.props.containerClass=this.props.containerClass||"",this.props.buttonsClass=this.props.buttonsClass||"",this.props.isGradientModal&&(0,d.isMvk)()&&(this.props.containerClass+=" MiniAppsGradientModal"),this.props.isNoWrapButtons&&(0,d.isMvk)()&&(this.props.buttonsClass+=" MiniAppsNoWrapButtons");const _=this.props.scopes&&this.props.scopes.length&&this.props.extraAction;this.isHorizontalLayoutSupported()&&(this.props.containerClass+=" VkAppModal__Container--horizontalSupport",_&&(this.props.containerClass+=" VkAppModal__Container--withExtraButton"));let e=`\n    <div class="vk_app_modal_container vk_app_modal_container--flex ${this.props.containerClass||""}">\n      <div class="vk_app_modal_content">\n        ${this.getThumb()}\n        <h2 class="vk_app_modal_container__heading">${this.props.title}</h2>\n        ${this._renderSubheading()}\n        ${this._renderTextSeparator()}\n        ${this._renderText(this.props.text)}\n      `;this.props.scopes&&(e+=`\n          <p class="vk_app_modal_container__text">${getLang("apps_connect_modal_messages_scopes_text")}</p>\n          <p class="vk_app_modal_container__list">${this._renderScopes(this.prepareScopes(this.props.scopes))}.</p>`),e+=`\n          </div>\n          ${this.props.checkbox?'<div class="MiniAppsModalCheckbox"></div>':""}\n          <div class="vk_app_modal_btns ${this.props.buttonsClass}"></div>\n      </div>`,this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=e,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),_&&this.modal.getElementsByClassName("vk_app_modal_content")[0].appendChild(this.prepareExtraBtn()),this._renderBtns(this.modal),this.props.checkbox&&this._renderCheckboxWrap(this.modal),this.props.scopes&&this._setCounter(this.props.scopes.length)}_renderText(_){if(!_)return"";return(Array.isArray(_)?_:[_]).map((_=>`<p class="vk_app_modal_container__text">${_}</p>`)).join("")}_renderSubheading(){return this.props.subheading?`<h3 class="vk_app_modal_container__subheading">${this.props.subheading}</h3>`:""}_renderTextSeparator(){return this.props.isTextSeparated?'<div class="vk_app_modal_container__text_separator"></div>':""}constructor(_,e){this.props=(0,t._)({},_),e&&(this.callback=e),this.props.buttons=this.props.buttons||[],this.containerNode=document.getElementById(this.props.containerId),this.modal=null,this.modalParentLayer=null,this.onAction=this.onAction.bind(this),this.addScroll=(0,n.throttle)(this.addScroll.bind(this),l.THROTTLE_TIME),this.renderModal(),this._destroyed=!1}}},278534:(_,e,o)=>{o.d(e,{THROTTLE_TIME:()=>t,addPopupScroll:()=>a});var i=o(404145);const t=300,a=(_,e)=>{const o=e?e.scrollTop:window.pageYOffset,t=window.cur.app;if(t&&!(0,i.isMvk)()){const e=t.frame.clientHeight-360,i=Math.max(103,Math.min(o,e)+102);requestAnimationFrame((function(){_.style.transform=`translateX(-50%) translateY(${i}px)`}))}}},953151:(_,e,o)=>{o.d(e,{default:()=>t});var i=o(120718);const t=class{_errorStrucuture(_,e){let o={type:this.method,data:{error_type:this.type,error_data:{error_code:_}}};return this.type===i.ERROR_TYPES.API?(o.data.error_data.error_msg=e,this.data.request_params&&(o.data.error_data.request_params=this.data.request_params)):o.data.error_data.error_reason=e,this.data.request_id&&(o.data.request_id=this.data.request_id),this.data.description&&(o.data.error_data.error_description=this.data.description),o}selectErrorType(){if(!this.data.hasOwnProperty("code"))return this.data.hasOwnProperty("error_code")?this._errorStrucuture(this.data.error_code,this.data.error_msg||i.ERROR_REASONS.UNKNOWN_ERROR):this.data.error_msg&&"operation denied by user"===this.data.error_msg.toLowerCase()?this._errorStrucuture(i.ERROR_CODES.USER_DENIED,"User denied"):this._errorStrucuture(i.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||i.ERROR_REASONS.UNKNOWN_ERROR);switch(this.data.code){case i.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(i.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case i.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(i.ERROR_CODES.CONNECTION_LOST,this.data.reason||i.ERROR_REASONS.CONNECTION_LOST);case i.ERROR_CODES.USER_DENIED:return this._errorStrucuture(i.ERROR_CODES.USER_DENIED,this.data.reason||i.ERROR_REASONS.USER_DENIED);case i.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(i.ERROR_CODES.INVALID_PARAMS,this.data.reason||i.ERROR_REASONS.INVALID_PARAMS);case i.ERROR_CODES.ACCESS_DENIED:return this._errorStrucuture(i.ERROR_CODES.ACCESS_DENIED,this.data.reason||i.ERROR_REASONS.ACCESS_DENIED);case i.ERROR_CODES.CUSTOM:return this._errorStrucuture(i.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);case i.ERROR_CODES.REQUESTS_LIMIT_REACHED:return this._errorStrucuture(i.ERROR_CODES.REQUESTS_LIMIT_REACHED,"Requests limit reached");case i.ERROR_CODES.UNKNOWN:return this._errorStrucuture(i.ERROR_CODES.UNKNOWN,i.ERROR_REASONS.UNKNOWN_ERROR);default:return this._errorStrucuture(this.data.code?this.data.code:i.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||i.ERROR_REASONS.UNKNOWN_ERROR)}}constructor(_,e,o=i.ERROR_TYPES.CLIENT){this.data=e||{},this.method=_,this.type=o}}},96824:(_,e,o)=>{o.d(e,{destroyOpenedApp:()=>d,filterPostMessageOrigin:()=>n,getHostName:()=>a,isAllowedPostMessageOriginHost:()=>s,isVKPayApp:()=>l,objectToQuerystring:()=>t});var i=o(120718);const t=(_,e="?")=>Object.keys(_).reduce(((o,i,t)=>[o,0===t?e:"&",encodeURIComponent(i),"=",encodeURIComponent(_[i])].join("")),""),a=_=>{const e=_.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=e&&e.length>2&&"string"==typeof e[2]&&e[2].length>0?e[2].toLowerCase():null},d=_=>{if(cur.vkAppQueue){const e=Object.keys(cur.vkAppQueue).filter((e=>~e.indexOf(_)));if(e.length>0){const _=e[0];cur.vkAppQueue[_].destroyView(),delete cur.vkAppQueue[_]}}},l=_=>i.VKPAY_APPS.includes(_);function n(_,e){const o=a(e),i=_.vkApp?_.vk_app_url:_.src,t=a(i);if(o!==t&&!s(_,o))throw Error(`Insecure method call from ${o}. Call must be from ${t}`);return!0}function s(_,e){if(!_.allowed_origin_regexp)return!1;return new RegExp(_.allowed_origin_regexp).test(e)}},662273:(_,e,o)=>{function i(_,e){let o,i,t=!1;return function a(){if(t)return o=arguments,void(i=this);_.apply(this,arguments),t=!0,setTimeout((function(){t=!1,o&&(a.apply(i,o),o=i=null)}),e)}}o.d(e,{throttle:()=>i})},976125:(_,e,o)=>{o.d(e,{DateCalendar:()=>L,Datepicker:()=>T,Daypicker:()=>I,Timepicker:()=>U,dateFormat:()=>g,getMonths:()=>A,monthFormat:()=>C});var i=o(434788),t=o(795558),a=o(953908),d=o(29271),l=o(664988),n=o(82161),s=o(672948),r=o(893106),c=o(301230),E=o(438221),p=o(682615),u=o(876286),b=o(75075),m=o(488500),D=o(970978),O=o(313892);const h={mn:[],mnOf:[],mnOfSm:[],days:["mon","tue","wed","thu","fri","sat","sun"]};let P=d.getLang("larr");"larr"===P&&(P="&larr;");let w=d.getLang("rarr");"rarr"===w&&(w="&rarr;");const v=["d","w","m"];for(let _=1;_<13;_++){const e=(0,O.getLangsForMonth)(_);h.mn.push(e[0]),h.mnOf.push(e[1]),h.mnOfSm.push(e[2])}for(let _=0;_<7;_++){let e;switch(_){case 0:e=d.getLang("events_mon");break;case 1:e=d.getLang("events_tue");break;case 2:e=d.getLang("events_wed");break;case 3:e=d.getLang("events_thu");break;case 4:e=d.getLang("events_fri");break;case 5:e=d.getLang("events_sat");break;case 6:e=d.getLang("events_sun")}e&&!e.startsWith("events")&&(h.days[_]=e)}const M=[31,0,31,30,31,30,31,31,30,31,30,31];window.cals||(window.cals={list:{},getMonth:function(_,e,o,i){return window.cals.list[_]&&window.cals.list[_].getMonth(e,o,!1,i),!1},getDay:function(_,e,o,i){return window.cals.list[_]&&window.cals.list[_].getDay(e,o,i),!1}});const g=()=>{let _=d.getLang("datepicker_date_format");return"date format"===_&&(_="{day} {month} {year}"),_},C=()=>{let _=d.getLang("datepicker_month_format");return"month format"===_&&(_="{month} {year}"),_};class L{constructor(_){let e=_.container,o=Math.round(1e6*Math.random());if(!e)return;let i=null,a=null;if(_.time&&_.inlineTime){let o=(0,t.ge)(_.time,e);i=o?(0,t.domPN)(o):(0,t.ge)(_.time),a=_.inlineTimeContainerIdx}else a=window._ui.reg(this);window.cals.list[a]=this,e.innerHTML="<div></div>",e=e.firstElementChild;let d=(v[_.mode]||_.mode||"d").toString().replace(/(this|next|prev)/,""),l=_.hideAnotherMonth&&!0,n=this.parseDay=function(_){return _=_.toString(),{y:parseInt(_.substr(0,4),10),m:parseInt(_.substr(4,2),10),d:parseInt(_.substr(6,2),10)}},E=_.day||{d:-1,m:-1,y:-1};E.m||(E=n(E));let m=_.addRows||"",D=_.addRowsM||m;this.setDay=(_,e,o)=>{E=e?{d:_,m:e,y:o}:n(_),this.getMonth(E.m,E.y)},this.setMode=_=>{d=(v[_]||_||"d").replace(/(this|next|prev)/,""),this.getMonth(E.m,E.y,!0)},this.getDay=_.getDay||function(_,e,o){},this.getMonth=function(n,O,P,w){let v=h.mn,g=new Date(O,n-1,1),L=new Date(O,n,0),U=new Date(O,n-1,0);g.od=g.getDay(),0==g.od&&(g.od=7);let T="-1"==d,I=!1,A=T?new Date(3e3,1,1):new Date;A=new Date(A.getFullYear(),A.getMonth(),"m"===d?1:A.getDate());let B=new Date,R=0;_.activePeriod&&(_.pastActive?(B=new Date(_.activePeriodStart-_.activePeriod),R=new Date(_.activePeriodStart)):(B=new Date(_.activePeriodStart),R=new Date(_.activePeriodStart+_.activePeriod)),B=new Date(B.getFullYear(),B.getMonth(),"m"===d?1:B.getDate()),R=new Date(R.getFullYear(),R.getMonth(),"m"===d?1:R.getDate())),M[1]=(0,s.isLeapYear)(g.getFullYear())?29:28;let W,y,K=[],f=[],k=[],S='<table class="%cls%" cols="%cols%" cellpadding="0" border="0" cellspacing="0">%rows%</table>';if("m"===d){let i=O==E.y?E.m:0,d=O+1,l=O-1;const{icon:n}=(0,u.getIcon20ChevronRightOutline)(),{icon:s}=(0,b.getIcon20ChevronLeftOutline)();W='<tr><td align="center" class="month">'+O+'</td><td class="month_arr"><a class="arr left" onclick="return cals.getMonth('+a+",1,"+l+');">'+s+'</a></td><td class="month_arr"><a class="arr right" onclick="return cals.getMonth('+a+",1,"+d+');">'+n+"</a></td></tr>",K.push('<tr><td colspan="2">'),K.push((0,t.rs)(S,{cls:"cal_table_head",cols:"3",rows:W})),K.push("</td></tr>"),f.push("<tr>");for(let e=1;e<=12;e++){let t="";e%2==1&&(e>1&&f.push("</tr><tr>"),t=" day_left");let d=e==i?"day sel":"day",l=new Date(O,e-1,1);(!_.pastActive&&l<A||_.pastActive&&l>A||_.pastActive&&l<_.startDate)&&(d+=" inactive_day"),_.activePeriod&&(l>R||l<B)&&(d+=" inactive_day"),l.getTime()===A.getTime()&&(d+=" today"),f.push('<td class="'+d+t+'" id="day'+e+"_"+o+'" onclick="return cals.getDay('+a+", 1, "+e+", "+O+');">'+v[e-1]+"</td>")}f.push("</tr>"),k.push((0,t.rs)(S,{cls:"cal_table",cols:"2",rows:"<thead>"+K.join("")+'</thead><tbody class="month_selector">'+f.join("")+"</tbody>"})),P||(e.style.height=e.offsetHeight+"px"),(0,t.val)(e,k.join(""))}else{let i,s,P,V,x=!1,N=O==E.y&&n==E.m?E.d:0;N>0&&(x=!0),12==n?(i=1,s=O+1):(i=n+1,s=O),1==n?(P=12,V=O-1):(P=n-1,V=O),i==E.m&&(N=E.d+L.getDate(),x=!0),P==E.m&&(N=E.d-U.getDate(),x=!0);let j=C().replace("{month}",v[n-1]).replace("{year}",'<span class="year">'+O+"</span>"),F=(0,p.classNames)("cal_table",{disabled:T,unshown:w});const{icon:H}=(0,u.getIcon20ChevronRightOutline)(),{icon:q}=(0,b.getIcon20ChevronLeftOutline)();W='<tr><td class="month"><a class="cal_month_sel" onclick="return cals.getMonth('+a+","+n+","+O+',1);">'+j+'</a></td><td class="month_arr"><a class="arr left" onclick="return cals.getMonth('+a+","+P+","+V+');">'+q+'</a></td><td class="month_arr"><a class="arr right" onclick="return cals.getMonth('+a+","+i+","+s+');">'+H+"</a></td></tr>",y='<tr><td class="month">'+j+'</td><td class="month_arr"><span class="arr left">'+q+'</span></td><td class="month_arr"><span class="arr right">'+H+"</span></td></tr>",K.push('<tr><td colspan="7">'),K.push((0,t.rs)(S,{cls:"cal_table_head",cols:"3",rows:T?y:W})),K.push("</td></tr><tr>");for(let _=0;_<7;_++)K.push('<td class="daysofweek">'+h.days[_]+"</td>");K.push("</tr>"),f.push("<tr>");let $=[];for(let e=1;e<=42;e++){let i,t=e%7==1?" day_left":"",s=e-g.od>=0&&e-g.od<M[n-1]?e-g.od+1:0,r=new Date(O,n-1,e-g.od+1),c=s,E=1;"w"===d&&(c=e-g.od-e%7+2,e%7==0&&(c-=7),N&&(E=8-(N+g.od-1)%7,8==E&&(E=1)));let p=t;if(p+=N>0&&s>=N&&s<N+E?" day sel":" day",(!_.pastActive&&r<A||_.pastActive&&r>A)&&(p+=" inactive_day"),_.activePeriod&&(r>R||r<B)&&(p+=" inactive_day"),r.getTime()==A.getTime()&&(p+=" today"),s>0)$[e]=c,f.push('<td id="day'+s+"_"+o+'" class="'+p+'" onclick="return cals.getDay('+a+", "+c+", "+n+", "+O+');">'+s+"</td>");else if(36!=e){if(!I)if("w"===d&&($[e]=c),l)i="&nbsp",f.push('<td class="day no_month_day'+t+'">'+i+"</td>");else{$[e]=c,i=r.getDate();let _=e<=7;_?(p+=" prev_month_day",p+=x&&U.getDate()+N===i?" sel":""):(p+=" next_month_day",p+=x&&N-L.getDate()===i?" sel":"");let t=_?n-1:n+1,d=O;t<1&&(t=12+t,d=O-1),t>12&&(t-=12,d=O+1),f.push(`<td id="day${s}_${o}" class="${p}" onclick="return cals.getDay(${a}, ${i}, ${t}, ${d});" >${i}</td>`)}}else I=!0;e%7==0&&e<36&&f.push("</tr><tr>")}f.push("</tr>"+m),f=f.join("").replace("<tr></tr>",""),k.push((0,t.rs)(S,{cls:F,cols:"7",rows:"<thead>"+K.join("")+"</thead><tbody>"+f+"</tbody>"})),K=[],f=[],A=new Date(A.getFullYear(),A.getMonth(),1),N=O==E.y?E.m:0,F="cal_table"+(T?" disabled":"")+(w?"":" unshown"),W='<tr><td class="month"><a class="cal_month_sel" onclick="return cals.getMonth('+a+","+n+","+O+');">'+O+'</a></td><td class="month_arr"><a class="arr left" onclick="return cals.getMonth('+a+","+n+","+(O-1)+',1);">'+q+'</a></td><td class="month_arr"><a class="arr right" onclick="return cals.getMonth('+a+","+n+","+(O+1)+',1);">'+H+"</a></td></tr>",y='<tr><td class="month">'+O+'</td><td class="month_arr"><span class="arr left">'+q+'</span></td><td class="month_arr"><span class="arr right">'+H+"</span></td></tr>",K.push('<tr><td colspan="2">'),K.push((0,t.rs)(S,{cls:"cal_table_head",cols:"3",rows:T?y:W})),K.push("</td></tr>"),f.push("<tr>");for(let e=1;e<=12;e++){let i="";e%2==1&&(e>1&&f.push("</tr><tr>"),i=" day_left");let t="day ",d=new Date(O,e-1,1);(!_.pastActive&&d<A||_.pastActive&&d>A)&&(t+=" inactive_day"),_.activePeriod&&(d.getMonth()>R.getMonth()||d.getMonth()<B.getMonth())&&(t+=" inactive_day"),d.getTime()==A.getTime()&&(t+=" today"),f.push('<td class="'+t+i+'" id="day'+e+"_"+o+'" onclick="return cals.getMonth('+a+", "+e+", "+O+');">'+v[e-1]+"</td>")}f.push("</tr>"+D),k.push((0,t.rs)(S,{cls:F,cols:"2",rows:"<thead>"+K.join("")+'</thead><tbody class="month_selector">'+f.join("")+"</tbody>"})),(0,t.val)(e,k.join("")),c.browser.opera&&!c.browser.mobile&&(0,r.animate)(e,{opacity:.99},20,r.animate.pbind(e,{opacity:1},20))}if(_.onMonthSelect&&_.onMonthSelect(),_.time&&_.inlineTime){(0,t.ge)(_.inlineTimeContainerId).appendChild(i)}},this.getMonth(E.m,E.y)}}class U{constructor(_,e={}){if(!(_=(0,t.ge)(_)))return;let o=_.id,a=_.name||"",d=_.value||"",l=(0,i._)({},{onUpdate:function(_,e){},time:0,hour:0,min:0,minStep:5,resfmt:"ts",format:'{hour}<div class="timepicker_dots"> : </div>{min}'},e),n=_.parentNode;d&&(l.time=d),l.time&&(l.hour=Math.floor(l.time/3600),l.min=Math.floor((l.time-3600*l.hour)/60));let r=l.hour||0,c=l.min||0,E=l.resfmt;c-=c%l.minStep;const p=l.format.replace("{hour}",`<div class="fl_l datepicker_item"><input type="hidden" id="${o}_hour_input" value="${r}"/></div>`).replace("{min}",`<div class="fl_l datepicker_item"><input type="hidden" id="${o}_min_input" value="${c}"/></div>`);let u=(0,t.ce)("div",{id:o+"_timepicker_container",className:"timepicker_container",innerHTML:`\n      <input type="hidden" name="${a}" id="${o}" value="${d}"/>\n      ${p}\n      <div class="results_container">\n        <div class="result_list" style="display:none;"></div>\n        <div class="result_list_shadow">\n            <div class="shadow1"></div>\n            <div class="shadow2"></div>\n         </div>\n       </div>\n    `.trim()});n.replaceChild(u,_);const b=()=>{let _=this.hourDD.val(),e=this.minDD.val();"plain"===E?(0,t.ge)(o).value=_+":"+e:"ts"===E&&((0,t.ge)(o).value=3600*_+60*e),l.onUpdate(_,e)};let m=[],D=[];for(let _=0;_<24;_++)m.push([_,_]);for(let _=0;_<60;_+=l.minStep)D.push([_,(0,s.leadingZero)(_)]);this.hourDD=new window.Dropdown((0,t.ge)(o+"_hour_input"),m,{width:60,dark:1,multiselect:!1,onChange:b}),this.minDD=new window.Dropdown((0,t.ge)(o+"_min_input"),D,{width:60,dark:1,multiselect:!1,onChange:b})}}class T{constructor(_,e={}){if(!(_=(0,t.ge)(_)))return;let o,d,s,r={},p=this,u=!1,b=0,D=0,O=_.id,P=O+"_date_input",w=_.name||O,v=_.parentNode,M=O+"_cal_box",T=O+"_cal_div",I=O+"_cal_frame",A=!1,B={mode:"d",resfmt:"ts",width:145,addRows:"",noFuture:!1,noPast:!1,activePeriod:!1,activePeriodStart:Date.now(),pastActive:!1,onUpdate:function(_,e){},onMonthSelect:function(){},hideAnotherMonth:!1,updateCalendarOnPastDateSet:!1},R=(e=(0,i._)({},B,e)).mode,W=e.onUpdate,y=e.width,K=e.resfmt,f=e.addRows,k=e.addRowsM||f,S=_=>("h"===R||(u?this.hide():o(),(0,t.ge)(P).blur()),!1),V=function(){let _=(0,t.ge)(T),o=(0,t.ge)(M),i=(0,t.ge)(P),a=!1,d=(0,t.getSize)("page_header_cont")[1],n=e.sideTopOffset;if(!_||!o||!i)return;let s=(0,t.getSize)(_);(0,t.setStyle)(o,{marginTop:0}),a=e.sideTop?s[1]+n<(0,t.getXY)(_)[1]-(0,E.scrollGetY)()-d-3*n:(0,t.getXY)(_)[1]+s[1]>(0,E.scrollGetY)()+window.lastWindowHeight;let r=a?-s[1]-30-2*(0,l.intval)((0,t.getStyle)(o,"paddingTop")):0;(0,t.setStyle)(o,{marginTop:r}),e.onMonthSelect()};o=()=>{if(u)return;u=!0,e.inlineTime||window._ui.sel(this.guid),(0,t.show)(M);let _=new L({container:(0,t.ge)(T),day:r,mode:R,addRows:f,addRowsM:k,hideAnotherMonth:e.hideAnotherMonth,pastActive:e.pastActive,activePeriod:e.activePeriod,activePeriodStart:e.activePeriodStart,time:e.time,inlineTime:e.inlineTime,inlineTimeContainerId:e.inlineTimeContainerId,onMonthSelect:V,getDay:function(o,i,t){let a={d:o,m:i,y:t};if(d(a,R),e.inlineTime){if(!e.updateCalendarOnPastDateSet&&new Date(a.y,a.m-1,a.d,23,59)<new Date)return;_.setDay(o,i,t)}}}),o=(0,t.getSize)((0,t.ge)(T));(0,t.setStyle)((0,t.ge)(I),{width:o[0],height:o[1]}),V(),(0,t.ge)(P).focus()},d=function(_,o,i,a){if(!i&&e.noPast&&new Date(_.y,_.m-1,_.d,23,59)<new Date)return;if(!i&&e.noFuture&&new Date(_.y,_.m-1,_.d,0,0)>new Date)return;if(!i&&e.activePeriod){const i=new Date(_.y,_.m-1,_.d,0,0);let t,a;if(e.pastActive?(t=new Date(e.activePeriodStart-e.activePeriod),a=new Date(e.activePeriodStart)):(t=new Date(e.activePeriodStart),a=new Date(e.activePeriodStart+e.activePeriod)),t=new Date(t.getFullYear(),t.getMonth(),"m"===o?1:t.getDate()),a=new Date(a.getFullYear(),a.getMonth(),"m"===o?1:a.getDate()),i>a||i<t)return}r=_;let d=(0,t.geByClass1)("datepicker_control",s);if("h"===o)(0,t.addClass)(d,"disabled");else if((0,t.removeClass)(d,"disabled"),a){let _=(0,t.ge)(P);_&&(_.value="",e.placeholder&&(_.placeholder=e.placeholder))}else(0,t.ge)(P).value="m"===o?C().replace("{month}",(0,n.winToUtf)(h.mn[_.m-1])).replace("{year}",_.y):g().replace("{day}",_.d).replace("{month}",(0,n.winToUtf)(h.mnOf[_.m-1])).replace("{year}",_.y);e.inlineTime||p.hide(),a||("plain"===K?(0,t.ge)(O).value=_.d+"."+_.m+"."+_.y+(e.time?" "+b+":"+D:""):"ts"===K&&((0,t.ge)(O).value=Math.floor(new Date(_.y,_.m-1,_.d,b,D).getTime()/1e3)-(60*(new Date).getTimezoneOffset()+(0,l.intval)(vk.tz))-(0,l.intval)(vk.dt))),i||W(_,o)},this.hide=function(_){u&&(u=!1,e.inlineTime&&!_||(window._ui.sel(!1),(0,t.hide)(M)))},this.setMode=function(_){R=_,d(r,R)},this.destroy=()=>{e.inlineTime||(window._ui._uids[this.guid]={}),(0,a.removeEvent)((0,t.geByClass1)("datepicker_control",s),"mousedown",S)},this.setDate=function(_,o,i,t,a,l){let n=!1;if(_||o||i)"m"!==R&&(r.d=i),r.m=o,r.y=_;else{let _=new Date;"m"!==R&&(r.d=_.getDate()),r.m=_.getMonth()+1,r.y=_.getFullYear(),n=!0}void 0!==a&&void 0!==l&&(b=a,D=l),d(r,R,t,n&&e.allowEmpty)},this.toogle=S,this.setActivePeriodStart=function(_){e.activePeriodStart=_};let x,N=0;if(e.day||e.month||e.year)"m"!==R&&(r.d=e.day),r.m=e.month,r.y=e.year,e.time&&(b=e.hour||0,D=e.min||0);else if(x=(_.value||"").match(/(\d+)\.(\d+)(?:\.(\d+))?(?:\s+(\d+)\:(\d+))?/))"m"!==R&&(r.d=(0,l.intval)(x[3].length?x[1]:0)),r.m=(0,l.intval)(x[3].length?x[2]:x[1]),r.y=(0,l.intval)(x[3].length?x[3]:x[2]),e.time&&(b=x[4]||0,D=x[5]||0);else if(parseInt(_.value)){const e=parseInt(_.value)+(60*(new Date).getTimezoneOffset()+(0,l.intval)(vk.tz))+(0,l.intval)(vk.dt);N=new Date(1e3*e)}else if(e.date){const _=(0,l.intval)(e.date)+(60*(new Date).getTimezoneOffset()+(0,l.intval)(vk.tz))+(0,l.intval)(vk.dt);N=new Date(1e3*_)}else N=new Date,A=!0;N&&(r.d=N.getDate(),r.m=N.getMonth()+1,r.y=N.getFullYear(),b=N.getHours(),D=N.getMinutes());const{icon:j}=(0,m.getIcon20CalendarOutline)();if(s=(0,t.ce)("div",{id:O+"_datepicker_container",className:"datepicker_container",innerHTML:`\n      <input type="hidden" name="${w}" id="${O}"/>\n      <div class="datepicker_control">\n        <input readonly="1" type="text" class="datepicker_text" id="${P}"/>\n        <span class="datepicker_control_icon">${j}</span>\n      </div>\n      <div id="${M}" class="cal_box">\n        <iframe id="${I}" class="cal_frame"></iframe>\n        <div id="${T}" class="cal_div"></div>\n      </div>\n    `.trim()},{width:y}),v.replaceChild(s,_),(0,a.addEvent)((0,t.geByClass1)("datepicker_control",s),"mousedown",S),d(r,R,!0,A&&e.allowEmpty),e.inlineTime||(this.guid=window._ui.reg({container:s,onEvent:_=>{if("mousedown"===_.type){let e=!0,o=_.target;for(;o&&o!==o.parentNode;){if(o===s){e=!1;break}o=o.parentNode}e&&this.hide()}},_blur:()=>{this.hide()}})),e.time){let _=(0,t.ge)(e.time);this.timePicker=new U(_,{onUpdate:function(_,e){b=_,D=e,d(r,R)},resfmt:K,hour:b,min:D,minStep:e.minStep||5})}c.browser.mozilla&&(0,t.hide)(I)}}class I{constructor(_,e={}){if(!(_=(0,t.ge)(_)))return;let o=_.id,a=_.name||"",l=_.value||"";const n="padding:0 3px;width:4px;";let s,r,c,E={onUpdate:function(_,e,o){},date:0,year:0,month:0,day:0,format:`{day}<div class="fl_l datepicker_item" style="${n}">&nbsp;</div>{month}<div class="fl_l datepicker_item" style="${n}">&nbsp;</div>{year}`,width:0},p=(0,i._)({},E,e),u=_.parentNode;if(l&&(p.date=l),p.date)if(p.date<3e7)p.year=Math.floor(p.date/1e4),p.month=Math.floor((p.date-1e4*p.year)/100),p.day=p.date-1e4*p.year-100*p.month;else{let _=new Date(1e3*p.date);p.year=_.getFullYear(),p.month=_.getMonth(),p.day=_.getDate()}const b=p.format.replace("{year}",`<div class="fl_l datepicker_item"><input type="hidden" id="${o}_year_input" value="${p.year}"/></div>`).replace("{month}",`<div class="fl_l datepicker_item"><input type="hidden" id="${o}_month_input" value="${p.month}"/></div>`).replace("{day}",`<div class="fl_l datepicker_item"><input type="hidden" id="${o}_day_input" value="${p.day}"/></div>`);let m=`<div class="fl_l datepicker_item"><input type="hidden" name="${a}" id="${o}" value="${l}"/>${b}</div>`,D=(0,t.ce)("div",{id:o+"_daypicker_container",className:"daypicker_container clear_fix",innerHTML:m});u.replaceChild(D,_);let O=function(_,e){let o=new Date(e||2004,_,0).getDate(),i=[[0,d.getLang("global_day_label")]];for(let _=1;_<=o;_++)i.push([_,_]);return i},P=function(){let _=parseInt(c.val()),e=parseInt(r.val()),i=parseInt(s.val());(0,t.ge)(o).value=1e4*_+100*e+i,s.setData(O(e,_)),p.onUpdate(_,e,i)};const w=new Date;let v=[[0,d.getLang("global_year_label")]],M=[[0,d.getLang("global_month_label")]];for(let _=w.getFullYear();_>=(p.startYear||1800);_--)v.push([_,_]);for(let _=0;_<12;_++)M.push([_+1,h.mnOf[_]]);if(s=new window.Dropdown((0,t.ge)(o+"_day_input"),O(p.month,p.year),{width:80,dark:1,zeroPlaceholder:p.zeroPlaceholder,onChange:P}),r=new window.Dropdown((0,t.ge)(o+"_month_input"),M,{width:120,dark:1,zeroPlaceholder:p.zeroPlaceholder,onChange:P}),c=new window.Dropdown((0,t.ge)(o+"_year_input"),v,{width:75,dark:1,zeroPlaceholder:p.zeroPlaceholder,onChange:P}),p.width){let _=(0,t.getSize)(D.firstElementChild)[0],e=p.width-_,o=(0,t.getSize)(r.container)[0];[r.container,r.resultList].forEach((_=>{(0,t.setStyle)(_,{width:parseInt(o+e)})}))}}}function A(_){const e=[0,1,2];e.includes(_)||((0,D.logError)(new Error(`getMonths should have format in ${e.join(",")}`)),_=0);const o=["null"];for(let e=1;e<=12;e++)o.push((0,O.getLangsForMonth)(e)[_]);return o}},250783:(_,e,o)=>{o.d(e,{default:()=>m,getUploadModule:()=>h,getUploadVideoExtMasks:()=>D,onVideoUploaded:()=>P});var i=o(514986),t=o(664988),a=o(29271),d=o(254667),l=o(504867),n=o(265865),s=o(82161),r=o(584356),c=o(953908),E=o(438221),p=o(795558),u=o(653902),b=o(313702);const m={getUploadModule:(_,e,o,i,t)=>h(_,e,o,i,t),initModalVideoUploader(_){const e=cur.videoUploadParams,o=(0,p.ge)("choose_video_upload");if(!o)return!1;this.initDragEvents();const i={};switch(_){case"article":i.onUploadProgress=()=>{},i.onUploadStartDone=_=>{var e,o;null==(e=(o=window.cur).onMediaUploadStarted)||e.call(o,_)},i.onUploadError=_=>{var e,o;null==(e=(o=window.cur).onMediaUploadFail)||e.call(o,_)};break;case"market":i.onUploadStart=({file:_})=>{var e,o;null==(e=(o=window.cur).onMediaUploadStarted)||e.call(o,_)}}return h(o,boxLayerWrap,e,null,i)},initDragEvents(){var _;const e=_=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);const e=(0,p.ge)("video_choose_upload_area_wrap");if((0,p.hasClass)(e,"video_choose_upload_area_enter"))return;(0,p.addClass)(e,"video_choose_upload_area_enter");const o=(0,p.ge)("video_choose_wrap"),i=(0,p.getXY)(o)[1],t=(0,p.getSize)(e)[1];return(0,p.hide)("video_choose_wrap"),(0,p.setStyle)(e,"height",(0,E.scrollGetY)()+(0,p.clientHeight)()-i+t),(0,c.cancelEvent)(_)},o=_=>(window.cur.dragTimeout&&(clearTimeout(window.cur.dragTimeout),delete window.cur.dragTimeout),window.cur.dragTimeout=setTimeout((()=>{const _=document.getElementById("video_choose_upload_area_wrap");_&&(_.classList.remove("video_choose_upload_area_enter"),_.style.height="auto",(0,p.show)("video_choose_wrap"))}),100),(0,c.cancelEvent)(_)),i=_=>{o();if(_.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,_.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,_.dataTransfer.files),(0,c.cancelEvent)(_)},t=()=>{(0,c.addEvent)(boxLayerWrap,"dragenter dragover",e),(0,c.addEvent)(boxLayerWrap,"dragleave",o),(0,c.addEvent)(boxLayerWrap,"drop",i)};t();const a=null==(_=(0,r.curBox)().getOptions())?void 0:_.onHide;setTimeout((0,r.curBox)().setOptions.pbind({onHide:()=>{if((0,c.removeEvent)(boxLayerWrap,"dragenter dragover",e),(0,c.removeEvent)(boxLayerWrap,"dragleave",o),(0,c.removeEvent)(boxLayerWrap,"drop",i),"function"==typeof a)return a()},onShow:()=>{Video.initChooseBox(),t()}}),0)}};function D(_){return"types"===_?[...u.VIDEO_UPLOAD_EXTS,...u.VIDEO_UPLOAD_EXTS.map((_=>_.toUpperCase()))].map((_=>`*.${_}`)).join(";"):"accept"===_?u.VIDEO_UPLOAD_INPUT_ACCEPT:""}function O(_){if(cur.leaving)return;const e=a.getLang("video_upload_changed");let o=!1;if((0,s.each)(window.cur.videoUploaders,((_,e)=>{Upload.isSomethingUploading(e)&&(o=!0)})),1===_){if(!o)return!0;const _=(0,i.showFastBox)({title:a.getLang("global_warning")},e,a.getLang("global_continue"),(function(){cur.leaving=!0,_.hide(),cur.onContinueCb&&cur.onContinueCb()}),a.getLang("global_cancel"),(function(){_.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return o?(0,t.winToUtf)(e.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}function h(_,e,o,t,r){if(!o)return;t=t||cur,(r=r||{}).onUploadStart||(r.onUploadStart=_=>{var e,o;boxQueue.hideLast(),cur.nav.push((function(_,e,o){if(!1===O(1))return cur.onContinueCb=nav.go.pbind(o),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=O,r.onUploadProgress(_,0,0),null==(o=window.Wall)||null==(e=o.showEditPost)||e.call(o),r.onUploadStartDone&&r.onUploadStartDone(_)}),r.onUploadComplete||(r.onUploadComplete=(_,e)=>{let o=(0,n.parseJSON)(e);if(o.video_id)P(_,o,t);else{"string"==typeof e&&e.indexOf("TERMINATED")>-1||Upload.onUploadError(_)}r.onUploadCompleteDone&&r.onUploadCompleteDone(),setTimeout((()=>{r.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(_.ind)&&r.onUploadAllCompleteDone()}))}),r.onUploadProgress||(r.onUploadProgress=(_,e,o)=>{let i=void 0!==_.ind?_.ind:_;(0,p.show)("_im_media_preview"),t.showMediaProgress&&t.showMediaProgress("video",i,function(_,e,o){return{loaded:e,total:o,fileName:_.fileName?_.fileName.replace(/[&<>"']/g,""):void 0}}(_,e,o))}),r.onUploadError||(r.onUploadError=(_,e)=>{(0,l.statlogsValueEvent)("upload_video_fails",1,o.options.server,e),function(_){let e=void 0!==_.ind?_.ind:_,o=_.fileName?e+"_"+_.fileName:_;if((0,p.re)("upload"+o+"_progress_wrap"),!(0,p.geByClass1)("popup_box_container")){let _=a.getLang("video_upload_error");setTimeout((0,i.showFastBox)({title:a.getLang("global_error")},_).hide,2e3)}(0,d.topError)("Upload failed",{dt:-1,type:102,url:((0,p.ge)("file_uploader_form"+e)||{}).action}),Upload.embed(e)}(_)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;const c=cur.maxFiles-(cur.savedVideos||[]).length;o.lang&&(cur.lang=(0,s.extend)(cur.lang||{},o.lang));const E={accept:D("accept"),file_input:null,file_name:"video_file",file_size_limit:1024*(o.options.file_size_limit_in_GB||u.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:D("types"),chooseBox:1,chunked:1,chunkSize:u.VIDEO_UPLOAD_CHUNK_SIZE,clear:1,dragEl:e===boxLayerWrap?boxLayerWrap:document.body,dropbox:e,from:o.vars.from,lang:o.lang,max_attempts:3,max_files:c,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!o.options.hasOwnProperty("visible_dropbox")||o.options.visible_dropbox},b=Upload.init(_,"",{},Object.assign(E,r));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(b),b}function P(_,e,o,t){o=o||cur;const d=void 0!==_.ind?_.ind:_,l=(_.fileName||_.filename||"").replace(/[&<>"']/g,""),n=l?d+"_"+l:_,r=e.owner_id+"_"+e.video_id,c=cur.isSnippetVideoSelection&&cur.chooseSnippetVideo;let E=(0,p.ge)("upload"+n+"_progress_wrap");E&&(0,p.hide)((0,p.geByClass1)("progress_x",E)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:r},{onDone:_=>{c||o.chooseMedia("video",r,(0,s.extend)(_[r],{upload_ind:n,upload_new:!0}));const d=e.owner_id,l=e.video_id,E=e.video_hash;let u=0;const m=()=>{ajax.post("al_video.php?act=encode_progress",{owner_id:d,vid:l,hash:E,need_thumb:1},{onDone:e=>{let E=!0;if(e){if(e.error)return u=(0,b.getUploadErrorText)(e.error_details),void setTimeout((0,i.showFastBox)({title:a.getLang("global_error")},u).hide,2e3);e.thumb&&100===parseInt(e.percents,10)&&(E=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:d,vid:l},{onDone:e=>{if(cur.isSnippetVideoSelection&&cur.chooseSnippetVideo)return cur.chooseSnippetVideo(r,e),void(0,p.re)("upload"+n+"_progress_wrap");o.hasChosenMedia("video",r)?o.updateChosenMedia("video",r,(0,s.extend)(e,{upload_ind:n,upload_new:!0})):t&&t(_,r)}}))}var u;E&&(c||o.hasChosenMedia("video",r))&&setTimeout(m,1e3)},onFail:()=>{u++,u<3&&setTimeout(m,2e3*u)}})};m()}})}},922571:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{VideoUpload:()=>VideoUpload});var _web_lib_dom__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(795558),_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(849222),_web_lib_video__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(652027),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(643897),_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(664988),_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(96756),_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(893106),_web_lib_date__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(672948),_shared_lib_parse__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(265865),_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(10645),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(584356),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(953908),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(82161),_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(725296),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(514986),_shared_lib_convert__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(962983),_shared_video_upload_constants__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(653902),_shared_video_upload_utils__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(313702),_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(184014),_shared_lib_debounce__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(936134),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(29271),_web_index__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(490093),_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(705758),_icons_desktop__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(211138),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(854099),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(839470),_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(504867),_shared_lib_nav_helpers__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(321850),_web_datepicker_getLangsForMonth__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(313892),_shared_ranges__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(931917),_web_datepicker_datepicker__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(976125),_shared_dom_runOnceInViewport__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(471234);const HOUR_IN_S=3600,HOUR_IN_MS=1e3*HOUR_IN_S,DAY_IN_MS=24*HOUR_IN_MS,MONTH_IN_MS=30*DAY_IN_MS,YEAR_IN_MS=12*MONTH_IN_MS,DEFAULT_TIMER_GAP=4*HOUR_IN_MS,DEFAULT_THUMB_ID="0_0",GROUP_UPLOAD_VIEW_BY_LINK_PRIVACY=3,USER_UPLOAD_VIEW_BY_LINK_PRIVACY=8,CSS_CLASS_ERROR_MESSAGE="VideoUploadItem__postpone_error_message-show",VideoUpload={FILE_TYPES:"",UPLOAD_ACCEPT:"",uploadNum:0,ordData:null,showBox:function(_={}){var e;return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(_.oid)||(_.oid=cur.oid||vk.id),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(_.oid)?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)("video_upload_box_placeholder"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_block")||4!=vk.al?((e=_=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(_,{ocl:cur.ocl?1:0})).ref||(e.ref=this.getCreationEntryPoint(cur.module)),cur.uploadVideoBox=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)("al_video.php?act=upload_box",_,{stat:["video_edit.css","privacy.css",window.jsc("web/privacy.js")],params:{containerClass:"video_upload_box",onHide:window.VideoUpload.onHideUploadPanel,onDestroy:window.VideoUpload.onDestroyUploadBox,onShow:window.VideoUpload.onShowUploadPanel,width:450},onDone:()=>{cur.uploadVideoBox.removeButtons(),cur.uploadVideoBoxContainer=cur.uploadVideoBox.bodyNode.closest(".popup_box_container"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domNS)(cur.uploadVideoBox.bodyNode)),cur.uploadVideoBox.titleWrap.classList.toggle("OwnerChooseWrapper",cur.is_showcase),cur.chosenOwnerId=cur.oid,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.inArray)(_.from,["article","board","post","comment","message"])&&window.VideoUpload.toExternalAdd(_.from)}}),!1):nav.go("videos"+cur.oid+"?z=upload_video")):((0,_web_index__WEBPACK_IMPORTED_MODULE_20__.showQuickLoginBox)(),!1)},buildExtMasks:function(_){const e=_?_shared_video_upload_constants__WEBPACK_IMPORTED_MODULE_16__.SHORT_VIDEO_UPLOAD_EXTS:_shared_video_upload_constants__WEBPACK_IMPORTED_MODULE_16__.VIDEO_UPLOAD_EXTS;window.VideoUpload.UPLOAD_ACCEPT=_?_shared_video_upload_constants__WEBPACK_IMPORTED_MODULE_16__.SHORT_VIDEO_UPLOAD_INPUT_ACCEPT:_shared_video_upload_constants__WEBPACK_IMPORTED_MODULE_16__.VIDEO_UPLOAD_INPUT_ACCEPT;const o=e.length;for(let _=0;_<o;++_)e.push(e[_].toUpperCase());window.VideoUpload.FILE_TYPES="*."+e.join(";*.")},onHideUploadPanel:function(){},onDestroyUploadBox:function(){delete window.cur.uploadVideoBox},onShowUploadPanel:function(){},checkResize:function(){},resizeWebStreamingElements:function(){var _;const e=window.VideoUpload._liveCategoryDropdown,o=window.VideoUpload._gameCategoryDropdown,i=null==(_=document.querySelector(".VideoWebcastForm__main"))?void 0:_.clientWidth;i&&(e&&e.setOptions({width:i}),o&&o.setOptions({width:i}))},resizeElements:function(){const _=window.VideoUpload._uploadAlbumChooser;if(_){var e;const o=null==(e=document.querySelector(".VideoUploadItem__main"))?void 0:e.clientWidth;if(!o)return;for(const e in _)if(_.hasOwnProperty(e)){_[e].setOptions({width:o});const i=window.VideoUploadSubtitles[e];if(i){const _=i.elems.tracksLangDropdown;for(const e in _)_.hasOwnProperty(e)&&_[e].setOptions({width:o/2});i.elems.defaultLangDropdown.setOptions({width:o/2})}}}},destroyTab:function(){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_block");if(!_)return;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-video_upload",_);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(e,(_=>{const o=e[_];(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.cleanElems)(o)})),cur.resizeWebStreamingElementsHandler&&(cur.resizeWebStreamingElementsHandler=!1,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.removeEvent)(window,"resize",window.VideoUpload.resizeWebStreamingElements)),cur.resizeElementsHandler&&(cur.resizeElementsHandler=!1,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.removeEvent)(window,"resize",window.VideoUpload.resizeElements)),Video.uploadNum=0},doResize:function(){},onPrivacyChangedStats:function(_,e="clips_uploader"){let o="";switch(_){case"0":o="all";break;case"1":o="friends";break;case"2":o="friends_of_friends";break;case"3":o="only_me";break;case"4":o="some_friends";break;case"5":o="some_friends_list";break;case"-1":o="advanced_settings"}(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)(e,1,"privacy",o)},onThumbClick(_,e){const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("js-video_upload",_),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"video"),t={autoplay:1,module:"upload",onLoaded:()=>{const _=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_edit_repeat",o));Videoview.getPlayerObject().toggleLoop(_)}};return(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("video_upload_page_click_logger")&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onPlayPreview"),(0,_web_lib_video__WEBPACK_IMPORTED_MODULE_2__.showInlineVideo)(i,"",t,e,_),!1},onRepeatChanged(_){window.VideoUpload.updatePlayer((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("js-video_upload",_)),(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("video_upload_page_click_logger")&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onCyclePlay",_.classList.contains("on")?"on":"off")},changeModalVisibility:function(_=!0){const e=_?"visible":"hidden",o=_?"1":"0",i=document.getElementById("box_layer_bg"),t=document.getElementById("box_layer_wrap");t&&(t.style.visibility=e,i.style.visibility=e,t.style.opacity=o)},setOrdData:function(_){window.VideoUpload.ordData=_,window.VideoUpload.changeOrdSubtext(_.is_ad),window.VideoUpload.changeModalVisibility(),document.querySelector(".VideoUploadItem__ordLink")&&(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("video_upload_page_click_logger")&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onAddAdvertisement")},changeOrdSubtext(_){const e=document.querySelector(".VideoUploadItem__adsInfo")||document.querySelector(".VideoUploadItem__ordLink");e&&(e.textContent=_?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_clip_ads_from_author_added"):_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_clip_ads_from_author_empty"))},getFormattedOrdData:function(){return window.VideoUpload.ordData?{is_ads:window.VideoUpload.ordData.is_ad,advertisers:[{ord_pred_id:window.VideoUpload.ordData.ord_pred_id,er_id:window.VideoUpload.ordData.erid}]}:null},initUpload:function(uploadOptions,subtitleUploadOptions,itemTemplate,isShort){uploadOptions=uploadOptions.replace(/[\r\n]+/g,""),uploadOptions=JSON.parse(uploadOptions),cur.lang=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.lang||{},uploadOptions.lang);const hashs={},tag=uploadOptions.vars.tag,ownerId=uploadOptions.vars.oid,options=uploadOptions.options,isUvUpload=options.isUvUpload;hashs[tag]=options.update_db_hash,cur.videoHashs=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.videoHashs||{},hashs);const boxTab=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_box_tab");if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_dropbox")&&boxTab){const _=boxTab.parentNode.parentNode.parentNode,e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)(`<div id="video_dropbox" class="dropbox choose">\n          <div class="dropbox_wrap">\n            <div class="dropbox_area">\n              <div class="dropbox_label">${uploadOptions.lang.drop_files_here}</div>\n            </div>\n          </div>\n        </div>`);_.appendChild(e)}window.VideoUpload.onShowUploadPanel();const placeholder=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_box_placeholder");if(placeholder){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)('<div id="video_upload_box'+tag+'" class="noselect"></div>');placeholder.innerHTML="",placeholder.appendChild(_)}const initButton=function(){const uploadErrorInfo=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_fail_info");uploadErrorInfo&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(uploadErrorInfo),Upload.init("video_upload_box"+tag,options.url,uploadOptions.vars,{file_name:"video_file",file_size_limit:1024*(options.file_size_limit_in_GB||_shared_video_upload_constants__WEBPACK_IMPORTED_MODULE_16__.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,clips_size_max_limit:1024*_shared_video_upload_constants__WEBPACK_IMPORTED_MODULE_16__.CLIP_UPLOAD_MAX_FILE_SIZE_IN_GB*1024*1024,clips_duration_min_limit:3,clips_duration_max_limit:options.clips_duration_limit,file_types_description:"Video files",file_types:window.VideoUpload.FILE_TYPES,lang:uploadOptions.lang,flat_button:1,filesize_hide_last:1,chunked:1,multiple:!isShort,multi_progress:1,chunkSize:_shared_video_upload_constants__WEBPACK_IMPORTED_MODULE_16__.VIDEO_UPLOAD_CHUNK_SIZE,isUvUpload,isShort,uploaderConfig:options.uploader_config,extraUploadOptions:JSON.stringify(uploadOptions.extraUploadOptions),withoutAutoUpload:!document.getElementById("video_upload_block"),onFilesSelected:function(_,e){var o;const i=cur.privacy,t=cur.videoHashs,a=cur.videoThumbUploadOpts,d=cur.videoUploadThumbBtnTpl,l=cur.videoPlaylists,n=Object.assign({},window.Upload.options),s=Object.assign({},window.Upload.vars),r=cur.chosenOwnerId;null==(o=(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)())||o.hide();let c=options.owner_videos_page||"videos"+ownerId;isShort?c="clips/upload"+ownerId:_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isGroupId(ownerId)&&(c=options.owner_videos_page),nav.go(c,!1,{onDone:function(){window.Upload.options=n,window.Upload.vars=s,cur.lang=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.lang||{},uploadOptions.lang),cur.privacy=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.privacy||{},i),cur.videoHashs=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.videoHashs||{},t),cur.videoThumbUploadOpts=a,cur.videoUploadThumbBtnTpl=d,cur.videoPlaylists=l,cur.chosenOwnerId=r,Upload.uploadFiles(_,e,e.length)}})},onUploadStart:function(_,e){uploadOptions.onUploadStart&&cur[uploadOptions.onUploadStart]();const o=void 0!==_.ind?_.ind:_,i=window.VideoUpload.getUniqueUploadItemId(o,_.fileName);window.VideoUpload.uploadNum++,delete window.VideoUpload.videoUploadCallback,uploadOptions.vars.save_hashes||isShort||(nav.objLoc.section="upload",nav.setLoc(nav.objLoc));const t=document.querySelector("#video_main_block"),a=document.querySelector("#video_search_input_wrapper");t&&(t.style.display="none"),a&&(a.style.display="none");const d=document.querySelector(".VideoShowcaseCommunityHeader");d&&(d.style.display="none");const l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(itemTemplate,{id:i}));window.VideoUpload.initBeforeUnload(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_empty_placeholder_short");const n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_block");n&&cur.newVideoUploadBlock&&(n.innerHTML="",n.insertAdjacentHTML("beforeend",cur.newVideoUploadBlock),cur.newVideoUploadBlock="");const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload",n));if(s){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("page_block_h2",s).cloneNode(!0),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_header_inner",_),o=s.cloneNode(!0);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(o,""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e,`${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_adding_video_title")} ${window.VideoUpload.uploadNum}`),o.appendChild(_),o.appendChild(l),n.appendChild(o),window.scrollTo(0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getXY)(o)[1]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)(e)[1])}else{window.VideoUpload.uploadNum=1;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("page_block",n).appendChild(l)}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)("video_upload_no_video"),uploadOptions.vars.save_hashes&&_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(cur.oid)&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_edit_repeat"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_upload_publish")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_upload__tabs").innerHTML=`<div class="video_ocl_warn">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_ocl_privacy")}</div>`),_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(ownerId)&&(cur.privacy["video"+i]||(cur.privacy["video"+i]=cur.privacy.video,cur.privacy["videocomm"+i]=cur.privacy.video),Privacy.update("video"+i),Privacy.update("videocomm"+i),!cur.privacy["video"+i+"_types"]&&cur.privacy.video_types&&(cur.privacy["video"+i+"_types"]=cur.privacy.video_types,Privacy.update("video"+i+"_types")),options.playlist_privacy&&options.playlist_privacy[0]>0&&Privacy.setValue("video"+i,options.playlist_privacy),cur.tag2ElMap=cur.tag2ElMap||{},cur.tag2ElMap[i]=l),window.VideoUpload.initPrivacyControls(ownerId,cur.privacy,i),window.VideoUpload.initActionLink(),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)()&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().hide(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_main_block"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_search_input_wrapper"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(n),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(l);const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+i);if(_.fileName){let e,o=_.fileName;const i=window.VideoUpload.FILE_TYPES.split(";");(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(i,(function(_,i){if(e=o.indexOf(i.substr(1)),e===o.length-i.length+1)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(r,"extension",i.substr(2)),o=o.substr(0,e),!1}));const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__title",r);t&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(t,o),t.select());const a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload_file_name",r);a&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(a,o)}if(window.VideoUpload.videoUploadCallback&&(window.VideoUpload.videoUploadCallback(),delete window.VideoUpload.videoUploadCallback),cur.videoThumbUploadOpts&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.isObject)(cur.videoThumbUploadOpts)&&!isShort&&window.VideoUpload.initThumbUpload(cur.videoThumbUploadOpts,l),window.VideoUpload._uploadAlbumChooser=window.VideoUpload._uploadAlbumChooser||{},cur.videoPlaylists&&cur.videoPlaylists.length&&!isShort){var c;const _=0,e=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_choose_playlist_placeholder");window.VideoUpload._uploadAlbumChooser[i]=new Dropdown((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload_album_chooser_input",l),[[_,e]].concat(cur.videoPlaylists),{autocomplete:!0,big:!0,width:null==(c=document.querySelector(".VideoUploadItem__main"))?void 0:c.clientWidth,selectedItems:[options.aid||_],onChange:e=>{""===e&&window.VideoUpload._uploadAlbumChooser[i].val(_)},onShow:()=>{(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("video_upload_page_click_logger")&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onChoosePlaylist")}}),cur.resizeElementsHandler||(cur.resizeElementsHandler=!0,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.addEvent)(window,"resize",window.VideoUpload.resizeElements))}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video-upload-album-chooser",l));const E=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("page_block_header",s),p=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("flat_button",E);p&&(p.innerHTML=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_another_one"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(p,"secondary")),isShort&&(cur.videoUploadAddMedia=new window.MediaSelector((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("page_add_media"),"media_preview",[["audio",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_clip_add_music")]],{editable:1,from:"video",limit:1,tooltip:!1,promotedAudios:options.promoted_audios,audioSectionId:options.audio_section_id}),cur.lang=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.lang||{},{dont_attach:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_clip_dont_attach")}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ms_item_audio").setAttribute("data-title","")),window.VideoUpload.initPostponePicker(r),window.VideoUpload.isPublishCheckboxTooltipEnabled(r)&&window.VideoUpload.initPublishCheckboxTooltip(r,{ownerId}),uploadOptions.vars.save_hashes||isShort||(window.VideoUploadSubtitles||(window.VideoUploadSubtitles={}),window.VideoUploadSubtitles[i]={elems:{blockEl:r},options:subtitleUploadOptions,ownerId},window.VideoUploadSubtitles.init(i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_upload__tabs",r)&&window.VideoUpload.showTab(r)),(0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_9__.autosizeSetup)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__description",r),{minHeight:80,maxHeight:600}),window.VideoUpload.checkNeedShowStickyPanel()},onUploadedVideoIdReceived:function(_,e){const o=window.VideoUpload.getUniqueUploadItemId(_.ind,_.fileName);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+o),"video_id",e)},onUploadComplete:function(i,res){let obj;if(!res)return;try{obj=eval("("+res+")")}catch(_){obj=(0,_shared_lib_convert__WEBPACK_IMPORTED_MODULE_15__.fromQueryString)(res)}if(obj.code||obj.error)return void Upload.onUploadError(i,obj);uploadOptions.onUploadComplete&&cur[uploadOptions.onUploadComplete](obj);const videoId=obj.video_id,viewHash=obj.video_hash,uploadItemId=window.VideoUpload.getUniqueUploadItemId(i.ind||i,i.fileName),item=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+uploadItemId),callback=function(){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+uploadItemId);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"video_id",videoId),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"uploaded",1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"owner_id",ownerId),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"view_hash",viewHash),ajax.post("al_video.php?act=get_edit_hash",{video_id:videoId,owner_id:ownerId,hash:viewHash},{onDone:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"edit_hash",e)}}),window.VideoUploadSubtitles[uploadItemId]&&window.VideoUploadSubtitles.onVideoUploaded(uploadItemId,videoId),window.VideoUpload.updateVideoLink(uploadItemId);const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload_link",_);if(e){const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"href-tpl"),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(i,{video_id:videoId});var o;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e,t),e.removeAttribute("placeholder"),e.classList.contains("VideoUploadItem__videoLinkUrl"))e.href=t,null==(o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoUploadItem__videoLink",_))||o.classList.add("VideoUploadItem__videoLink--ready");const a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-subtitles-upload-item",_);a.length&&a.forEach((_=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"selected")&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"uploaded")&&window.VideoUploadSubtitles.startUpload(_,cur.oid,videoId)}));const d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__copy_video_link",_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(d),d.onclick=()=>{(0,_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_18__.copyToClipboard)(t),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.showDoneBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_link_copied"),{out:1500}),e.focus()};const l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_upload_ready_name",_);if(l){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ce)("a",{innerHTML:l.innerHTML,className:l.className,href:t.href});(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(l).insertBefore(_,l),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(l)}}window.VideoUpload.ordData=null,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"saved")&&window.VideoUpload.saveParams((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__ready_button",_),!0),window.VideoUpload.setProgressValue(100,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_waiting"),_);const i=_.querySelector(".VideoUploadItem__thumbStubText");i&&(i.textContent=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_encoding")),window.VideoUpload.runVideoProgressUpdate(uploadItemId,ownerId,videoId,viewHash,1,-1,0,0,isShort)};item?callback():window.VideoUpload.videoUploadCallback=callback},onUploadProgress:function(_,e,o){const i=void 0!==_.ind?_.ind:_;let t=window.VideoUpload.getUniqueUploadItemId(i,_.fileName);const a=Math.min(e/o*100,100),d=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(a);uploadOptions.onUploadProgress&&cur[uploadOptions.onUploadProgress](d);const l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+t);if(!l)return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(l,"progress")>d&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(l,"max_size_error",!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(l,"progress",d);const n=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_uploaded_percent").replace("{percent}",d);window.VideoUpload.setProgressValue(a,n,l)},onUploadError:function(i,err){let debug;if(uploadOptions.onUploadError&&cur[uploadOptions.onUploadError](err),err&&(err.code||err.error)){try{debug=eval("("+err.debug+")")}catch(_){debug=(0,_shared_lib_convert__WEBPACK_IMPORTED_MODULE_15__.fromQueryString)(debug)}err=err.code||err.error}else debug=!1;const logErrorData={oid:ownerId,mid:uploadOptions.vars.mid,tag,srv:options.server,extra:err};window.VideoUpload._logUploadStatus("fail",logErrorData),cur.videoLastError=!0;const index=void 0!==i.ind?i.ind:i;let uploadItemId=i.uploadItemId||window.VideoUpload.getUniqueUploadItemId(index,i.fileName);const item=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+uploadItemId),callback=function(){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+uploadItemId);if(_){let e;-3==err?e=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_error_file"):-4==err?e=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_error_audio").replace("{link}",'<a href="/audio">').replace("{/link}","</a>"):-5==err?(e=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_claimed_not_uploaded"),debug&&debug.claim_id&&(e+=" ["+debug.claim_id+"]")):e=-12==err?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_flood_control"):_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_error_common"),window.VideoUpload.showError(_,e)}};item?callback():window.VideoUpload.videoUploadCallback=callback,(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_3__.debugLog)(err)},onConnectionLost:function(_){uploadOptions.onConnectionLost&&cur[uploadOptions.onConnectionLost]();const e=void 0!==_.ind?_.ind:_;let o=window.VideoUpload.getUniqueUploadItemId(e,_.fileName);const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+o);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(i,"upload_index",o),window.VideoUpload.showError(i,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_connection_lost"),!0)},onDragEnter:()=>{},onDragOut:()=>{},onDrop:()=>{},clear:1,type:"video",max_attempts:3,server:options.server,error:options.error,error_hash:options.error_hash,dropbox:"video_dropbox",custom_hash:options.custom_hash,check_hash:options.check_hash,check_rhash:options.check_rhash,check_url:options.check_url,accept:window.VideoUpload.UPLOAD_ACCEPT}))};initButton()},_logUploadStatus:function(_,e){try{e.act="upload_stats",e.stage=_,ajax.post("al_video.php",e)}catch(_){}},removeUploadedThumb:function(_,e){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.cancelEvent)(e);const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(o,{backgroundImage:""}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(o);const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("js-video_tc_uploader",_),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_tc_upload_btn",i),a=window.VideoUpload.getPlaceholderEl(_);if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(i,"thumb-id",DEFAULT_THUMB_ID),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(i,"thumb-hash",""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(i,"thumb-url",""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(t),a){let _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(a,"main-thumb");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(a,"thumb-url",_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(a,"thumb-id",DEFAULT_THUMB_ID);const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("js-video_upload",i);return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__player",e))&&window.VideoUpload.updatePlayerThumb(e),!1}return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(a,"thumb-id",null),!1},initThumbUpload:function(_,e){if(!_||!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.isObject)(_))return;let o,i,t;const a=(_=!0)=>{var o;const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("popup_save_button"),t=null==(o=e)?void 0:o.querySelector(".js-video_upload__ready_button"),a=i||t,d=document.querySelector(".VideoLayout__stickyPanelButton");a&&(_?(_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.unlock(a),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.unlock(d)):(_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.lock(a),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.lock(d)))},d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_tc_uploader",e),l={file_name:"photo",file_size_limit:1024*(_.file_size_limit_in_MB||50)*1024,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF;*.bmp;*.BMP",onUploadStart:function(_,l){o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_tc_upload_progress_wrap",e),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_tc_upload_progress_bar",e),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_tc_upload_btn",d),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,"width","0%"),a(!1)},onUploadComplete:function(e,l){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,"width","0%"),a(),!l)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(t),void(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__.showErrorBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_thumb_load_error"));const n=(0,_shared_lib_parse__WEBPACK_IMPORTED_MODULE_8__.parseJSON)(l);if(n.error)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(t),void(_.for_playlist?(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("notifications_video_playlist_thumb_deleted_header"),n.error):(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("notifications_video_thumb_deleted_header"),n.error));if(!n.photo_id)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(t),void(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__.showErrorBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_thumb_load_error"));const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_tc_upload_image",d);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(s),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(s,{backgroundImage:"url("+n.thumb.l+")"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(d,"thumb-url",n.thumb.l),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(d,"thumb-id",n.photo_id+"_"+n.photo_owner_id),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(d,"thumb-hash",n.photo_hash),window.VideoUpload.selectThumb(d)},onUploadProgress:function(_,e,o){let t=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(e/o*100);t=Math.min(t,100),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,"width",t+"%")},onUploadError:function(_,e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,"width","0%"),(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__.showErrorBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_thumb_load_error")),a()},clear:1,type:"photo",max_attempts:3,server:_.server,error:_.default_error,error_hash:_.error_hash,noCheck:!0,chooseBox:!0,label:_.specialLabel||cur.videoUploadThumbBtnTpl,uploadButton:!0,buttonClass:"js-video_tc_upload_btn",accept:".jpg,.jpeg,.png",filesize_hide_last:!0,lang:{filesize_error:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_thumb_size_error")}};Upload.init(d,_.url,_.vars,l)},initLiveTransTimePicker:function(_={},e=!1){if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime--startTime")||!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime--endTime"))return!1;if(t("startTimePicker","start-time","VideoLiveTransTime__startTimePickerPopup",1e3*_.start_time_limit,window.VideoUpload.updateStarTime),t("endTimePicker","end-time","VideoLiveTransTime__endTimePickerPopup",1e3*_.end_time_limit,window.VideoUpload.updateEndTime),window.VideoUpload.updateStarTime(),window.VideoUpload.updateEndTime(),e&&window.VideoUpload.makeLiveEndDateOptional(),_.start_time){const e=1e3*_.start_time<Date.now();window.VideoUpload.showSavedLiveTimeSettings(e),0===_.end_time&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoLiveTransTime__optionalEnding")&&window.VideoUpload.makeLiveEndDateOptional()}function o(_,e){const o=e.start_time,i=e.end_time,t=Math.round(Date.now()/1e3);return"start-time"===_?o||t:i||t+DEFAULT_TIMER_GAP}function i(_){return"start-time"===_?YEAR_IN_MS:DAY_IN_MS}function t(e,t,a,d,l){const n="time-input_"+t,s=`datepicker-inline-container_${t}`,r=`\n          <td class="cal_clear" colspan="7">\n              <div class="VideoLiveTransTime__calendarFooter">\n                  <div id="${s}"></div>\n              </div>\n          </td>`,c=new Datepicker("date-input_"+t,{width:155,mode:"ts",onUpdate:l,noPast:!0,noFuture:!1,pastActive:!1,activePeriod:null!=d?d:i(t),date:o(t,_),time:n,inlineTime:!0,inlineTimeContainerId:s,inlineTimeContainerIdx:t,addRows:r});return window.VideoUpload[e]=c,new ElementTooltip((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__"+e),{defaultSide:"top",autoShow:!1,cls:"VideoLiveTransTime__tooltip",noOverflow:!1,centerShift:0,noBorder:!0,content:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(a),noHideOnClick:!0,align:ElementTooltip.ALIGN_LEFT,onHide:()=>{setTimeout((()=>{c&&c.hide(!0)}),ElementTooltip.FADE_SPEED)}}),c}},showStartTimePicker:function(_){window.VideoUpload.startTimePicker.toogle(_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTimeEnabled"),"on"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__startTimePicker"),"VideoLiveTransTime__timePicker--hasTime"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ResetVideoLiveTransTime"),"ResetVideoLiveTransTime--hidden"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime--endTime"),"VideoLiveTransTime--hidden")},showSavedLiveTimeSettings:function(_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTimeEnabled"),"on");const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__startTimePicker");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(e,"VideoLiveTransTime__timePicker--hasTime"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(e,"VideoLiveTransTime__timePicker--disabled",_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__endTimePicker"),"VideoLiveTransTime__timePicker--hasTime"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ResetVideoLiveTransTime"),"ResetVideoLiveTransTime--hidden",_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime--endTime"),"VideoLiveTransTime--hidden")},showEndTimePicker:function(_){window.VideoUpload.endTimePicker.toogle(_)},resetTimePickers:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__startTimePicker"),"VideoLiveTransTime__timePicker--hasTime"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime--endTime"),"VideoLiveTransTime--hidden"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ResetVideoLiveTransTime"),"ResetVideoLiveTransTime--hidden"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTimeEnabled"),"on");const _=new Date(Date.now());window.VideoUpload.setDatePickerDate(window.VideoUpload.startTimePicker,_,!0),window.VideoUpload.updateStarTime();const e=new Date(Date.now()+DEFAULT_TIMER_GAP);window.VideoUpload.setDatePickerDate(window.VideoUpload.endTimePicker,e,!0),window.VideoUpload.updateEndTime(),window.VideoUpload.resetLiveEndDateOptional()},updateStarTime:function(){let _=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("date-input_start-time")));_=window.VideoUpload.validateSelectedTime(VideoUpload.startTimePicker,_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__startTimePickerFormatTime"),VideoUpload.formatDate(_)),window.VideoUpload.endTimePicker.setActivePeriodStart(_),window.VideoUpload.updateEndTime()},updateEndTime:function(){let _=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("date-input_end-time")));_=window.VideoUpload.validateSelectedTime(window.VideoUpload.endTimePicker,_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__endTimePickerFormatTime"),window.VideoUpload.formatDate(_))},formatDate:function(_){_=(_=~~(_/1e3))+(60*(new Date).getTimezoneOffset()+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(vk.tz))+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(vk.dt);const e=new Date(1e3*_),o=e.getDate(),i=e.getMonth()+1,t=e.getFullYear();return(0,_web_datepicker_datepicker__WEBPACK_IMPORTED_MODULE_27__.dateFormat)().replace("{day}",o).replace("{month}",(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.winToUtf)((0,_web_datepicker_getLangsForMonth__WEBPACK_IMPORTED_MODULE_25__.getLangsForMonth)(i)[1])).replace("{year}",t)+` ${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("profile_wall_postpone_at")} `+`${e.getHours()}:${("0"+e.getMinutes()).slice(-2)}`},validateSelectedTime:function(_,e){const o=new Date(1e3*e),i=new Date,t=1e3*(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("date-input_start-time"))),a=1e3*(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("date-input_end-time")));if(window.VideoUpload.startTimePicker===_)if(o.getTime()>a){const _=new Date(o.getTime()+DEFAULT_TIMER_GAP);window.VideoUpload.setDatePickerDate(window.VideoUpload.endTimePicker,_,!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__endTimePickerFormatTime"),VideoUpload.formatDate(_.getTime()))}else if(o.getTime()+DAY_IN_MS<a){const _=new Date(o.getTime()+DEFAULT_TIMER_GAP);window.VideoUpload.setDatePickerDate(window.VideoUpload.endTimePicker,_,!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__endTimePickerFormatTime"),VideoUpload.formatDate(_.getTime()))}if(window.VideoUpload.endTimePicker===_){if(o.getTime()<t){const e=new Date(t+DEFAULT_TIMER_GAP);return window.VideoUpload.setDatePickerDate(_,e,!0),e.getTime()}if(o.getTime()>t+DAY_IN_MS){const _=new Date(t+DAY_IN_MS);return window.VideoUpload.setDatePickerDate(window.VideoUpload.endTimePicker,_,!0),_.getTime()}}return o.getTime()<i.getTime()?(window.VideoUpload.setDatePickerDate(_,i,!0),i.getTime()):o.getTime()},setDatePickerDate:function(_,e,o){_.setDate(e.getFullYear(),e.getMonth()+1,e.getDate(),!0,e.getHours(),e.getMinutes()),o&&(_.timePicker.hourDD.val(e.getHours()),_.timePicker.minDD.val(e.getMinutes()))},makeLiveEndDateOptional:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoLiveTransTime__optionalEnding"),"VideoLiveTransTime__optionalEnding--active"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__endTimePicker"),"VideoLiveTransTime__timePicker--invisible")},resetLiveEndDateOptional:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoLiveTransTime__optionalEnding"),"VideoLiveTransTime__optionalEnding--active"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTime__endTimePicker"),"VideoLiveTransTime__timePicker--invisible")},selectThumb:function(_){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"thumb-url"),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"thumb-id"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"thumb-hash");if(!o)return;const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(_);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-video_tc_item",t),(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(this,_.classList.contains("ThumbChooser__item")?"ThumbChooser__item--selected":"video_tc_item_selected",this==_)}));const a=window.VideoUpload.getPlaceholderEl(_);if(a){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(a,"thumb-id",o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(a,"thumb-hash",i||""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(a,"thumb-url",e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(a,{backgroundImage:"url("+e+")"});const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("js-video_upload",_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__player",t))&&window.VideoUpload.updatePlayerThumb(t)}},getPlaceholderEl:function(_){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(_,"js-video_upload")?_:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("js-video_upload",_);return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("video_edit",e)?null:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__thumb",e)},initTC:function(_,e,o,i){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__thumb_chooser_info",o);if(e)return void(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(t.innerHTML,e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(t),_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)(_);let a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video-upload-thumb-chooser",o);if(cur.is_showcase||i){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ThumbChooser",o);_&&(a=_)}a&&a.appendChild(_);const d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_tc_uploader",o);if(d){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_tc_slider_cont",o);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domInsertBefore)(d,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domFC)(_))}},runVideoProgressUpdate:function(_,e,o,i,t,a,d,l,n){ajax.post("al_video.php?act=encode_progress",{owner_id:e,vid:o,hash:i,need_thumb:t,need_tc:a,is_showcase:cur.is_showcase,is_short_video:+n},{onDone:function(s){const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+_);if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(r))return;let c=!0,E=-1;if(s){if(s.error)return void window.VideoUpload.showError(r,(0,_shared_video_upload_utils__WEBPACK_IMPORTED_MODULE_17__.getUploadErrorText)(s.error_details));if(t&&s.thumb){const _=window.VideoUpload.getPlaceholderEl(r);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"main-thumb",s.thumb),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"thumb-id")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(_,{backgroundImage:"url('"+s.thumb+"')"}),t=""}if(a&&(s.tc||s.tc_msg)&&(window.VideoUpload.initTC(s.tc,s.tc_msg,r,n),a=0,n)){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__progress",r);_.classList.add("VideoUploadItem__progress--success");const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__progress_text",_);return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"lang-success")),void _web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setDisabled((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__ready_button",r),!1)}const i=s.duration;if(E=s.percents,s.is_claimed)return void Upload.onUploadError({ind:_.split("_")[1],uploadItemId:_},{code:"-5"});if(void 0!==i||s.is_uv_upload&&E>=0){if(void 0!==i&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(r,"duration",i),E>=100){if(d<100){window.VideoUpload.updatePlayer(r),s.published&&window.VideoUpload.setPublished(r);const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__progress",r);if(_.classList.add("VideoUploadItem__progress--success"),s.can_improve){const _=r.querySelector(".video_improve_quality");_&&(_.classList.remove("cant-improve"),_.classList.remove("disabled"))}const i=r.querySelector(".VideoUploadItem__neuroHdInfo");i&&(s.improve_text?i.textContent=s.improve_text:i.remove());const d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__progress_text",_);if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(d,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(d,"lang-success")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(r.querySelector(".VideoUploadItem__thumbStub")),t||a){let _=t?2:0;_+=a?1:0,window.VideoUpload._logUploadStatus("no_thumb",{status:_,vid:e+"_"+o})}}}else{const _=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_encode_percent").replace("{percent}",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(E));window.VideoUpload.setProgressValue(E,_,r,!0)}E>=100&&!t&&!a&&(c=!1)}else E=-1}c&&setTimeout(window.VideoUpload.runVideoProgressUpdate.pbind(_,e,o,i,t,a,E,l,n),1e3)},onFail:function(){l||(l=1),setTimeout(window.VideoUpload.runVideoProgressUpdate.pbind(_,e,o,i,t,a,d,l+1,n),2e3*l)}})},updatePlayer:function(_){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("video_edit",_))return;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"owner_id"),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"video_id");if(!e||!o)return;const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"duration"),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__player",_),a=`${e}_${o}`;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(t,"video",a),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.attr)(t,"href",`/video${e}_${o}`),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.attr)(t,"onclick","return window.VideoUpload.onThumbClick(this, event);"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(t),i&&parseInt(i,10)&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video-duration-label",t),(0,_web_lib_date__WEBPACK_IMPORTED_MODULE_7__.formatTime)(i)),window.VideoUpload.updatePlayerThumb(_)},updatePlayerThumb:function(_){const e=window.VideoUpload.getPlaceholderEl(_),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"thumb-url");(0,_web_lib_video__WEBPACK_IMPORTED_MODULE_2__.revertLastInlineVideo)();const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__player",_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,{backgroundImage:"url("+o+")"})},showError:function(_,e,o){const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__progress",_),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__progress_text",i);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"error",1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(i,i.classList.contains("VideoUploadItem__progress")?"VideoUploadItem__progress--error":"_error"),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.disableButton)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__ready_button",_),!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(t,e)},setPublished:function(_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"published",1);const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_upload_publish",_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(e,"disabled")||(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.disable)(e)},setProgressValue:function(_,e,o,i){if(!o)return;const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__progress_bar",o),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__progress_text",o),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__progress",o);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(d,"VideoUploadItem__progress--processing",!!i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,{width:_+"%"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(a,e)},saveParams:function(_,e=!1,o=!1,i=!1){const t=window.VideoUpload.getUploadItem(_);if(t.dataset.saved&&!e&&!o)return window.VideoUpload.deleteParams(_,e),void window.VideoUpload.checkNeedShowStickyPanel();const a=i?window.VideoUpload.getShortParams(t):window.VideoUpload.getParams(t);if(!a)return;if(!a.title||a.title.length>cur.videoTitleLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)(t.querySelector(".js-video_upload__title"));if(a.desc.length>cur.videoDescriptionLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)(t.querySelector(".js-video_upload__description"));_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setDisabled(_,!0),a.vid=t.dataset.video_id,a.oid=t.dataset.owner_id||cur.chosenOwnerId;const d=t.dataset.tag;a.tag=d,a.hash=cur.videoHashs[d],a.ext=t.dataset.extension,nav.objLoc.ocl&&(a.ocl=1),window.VideoUpload.ordData&&window.VideoUpload.ordData.is_ad&&(a.ord_info=JSON.stringify(window.VideoUpload.getFormattedOrdData())),!(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("video_upload_page_click_logger")||i||e||(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onSaveVideo"),ajax.post("al_video.php?act=save_video_params",a,{onDone:function(i){var d,l,n,s;(_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setDisabled(_,!1),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setAppearance(_,_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButtonAppearance.SECONDARY),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setLabel(_,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_back_to_editing")),null==(d=t.querySelector(".js-video_upload__title"))||d.setAttribute("readonly","readonly"),null==(l=t.querySelector(".js-video_upload__description"))||l.setAttribute("readonly","readonly"),null==(n=t.querySelectorAll(".VideoUploadItem__warn"))||n.forEach((_=>{_.style.visibility="hidden",_.style.height=0,_.style.marginTop=0})),t.dataset.saved="1",a.improve)&&(null==(s=t.querySelector(".video_improve_quality"))||s.classList.add("disabled"));if("published"===i&&window.VideoUpload.setPublished(t),!e){const _=[".video_upload__tabs",".js-video-upload-thumb-chooser",".video_upload__secondary_info"];cur.is_showcase&&(t.classList.add("VideoUploadItem--collapsed"),_.push(".VideoUploadItem__asideInfo",".js-video-upload-album-chooser",".js-video-upload-checkboxes",".js-video-upload-postpone",".js-video-upload-ord")),_.forEach((_=>{const e=t.querySelector(_);e&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.slideUp)(e,{duration:150,transition:_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.Fx.Transitions.swiftOut})}))}o||window.VideoUpload.checkNeedShowStickyPanel()}})},saveShortVideoParams:function(_){var e;const o=window.VideoUpload.getUploadItem(_)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload"),i=(null==(e=window.VideoUpload.options)?void 0:e[0])||{},t=window.VideoUpload.getShortParams(o);if(!t)return;if(t.desc.length>cur.videoDescriptionLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)(o.querySelector(".js-video_upload__description"));_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setDisabled(_,!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(o.querySelector(".js-video_upload__cancel")),t.vid=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(o,"video_id")||i.videoId,t.oid=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(o,"owner_id")||i.ownerId||cur.chosenOwnerId;const a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(o,"tag");t.hash=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(o,"edit_hash"),t.tag=a,t.ext=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(o,"extension");const d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(o,"creation_entry_point"),l=_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isGroupId(t.oid)?"/club"+Math.abs(+t.oid):"";nav.objLoc.ocl&&(t.ocl=1),window.VideoUpload.ordData&&window.VideoUpload.ordData.is_ad&&(t.ord_info=JSON.stringify(window.VideoUpload.getFormattedOrdData()));const n=(_=!1,e="")=>{if((0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)())return(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().hide(),window.Videoview&&window.Videoview.updateVideo(t.oid,t.vid,"",(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.clean)(t.desc),"",!!e,"",_?"published":""),cur.videoEditItem&&!e&&_?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(cur.videoEditItem.querySelector(".ShortVideoGridItem__unpublished")):e&&(cur.videoEditItem.querySelector(".ShortVideoGridItem__unpublishedText").innerHTML=e),void(i.publishAt>Math.trunc(Date.now()/1e3)&&!e&&!_&&nav.go(`/clips${l||t.oid}`));(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(o,"saved",1),_&&(t.publish_at?nav.go(`/clips/postponed${l}`):nav.go(`/clips${l||t.oid}`))};ajax.post("al_video.php?act=do_edit_box",t,{onDone:function(){const _=arguments[7];!!arguments[6]||_?n(!1,_):((0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"publish",_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserIdTransitional(t.oid)?"by_user":"by_group"),t.audio_id&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"adding_tracks",t.audio_id),(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"clip_publish_checkbox",(!!t.wallpost).toString()),(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"clip_allow_duets_checkbox",(!!t.can_make_duet).toString()),_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(+t.oid)&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"clip_allow_comments_checkbox",(!t.privacy_videocomm).toString()),t.privacy_video&&window.VideoUpload.onPrivacyChangedStats(t.privacy_video),ajax.post("al_video.php?act=publish_clip",{owner_id:t.oid,video_id:t.vid,wallpost:t.wallpost,hash:t.hash,publish_at:t.publish_at,ref:d,license_agree:1},{onDone:()=>n(!0)}))},onFail:function(){_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setDisabled(_,!1),_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setAppearance(_,_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButtonAppearance.PRIMARY),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(o.querySelector(".js-video_upload__cancel"))}})},deleteParams:function(_,e){const o=window.VideoUpload.getUploadItem(_),i=window.VideoUpload.getParams(o),t=function(){var e,t,a;o.dataset.saved="",_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setAppearance(_,_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButtonAppearance.PRIMARY),i.publish_at||_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setLabel(_,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_end_editing")),null==(e=o.querySelector(".js-video_upload__title"))||e.removeAttribute("readonly"),null==(t=o.querySelector(".js-video_upload__description"))||t.removeAttribute("readonly"),null==(a=o.querySelectorAll(".VideoUploadItem__warn"))||a.forEach((_=>{_.style.visibility="visible",_.style.height="auto",_.style.marginTop="6px"}));const d=[".video_upload__tabs",".js-video-upload-thumb-chooser",".video_upload__secondary_info"];cur.is_showcase&&(o.classList.remove("VideoUploadItem--collapsed"),d.push(".VideoUploadItem__asideInfo",".js-video-upload-album-chooser",".js-video-upload-checkboxes",".js-video-upload-ord"),i.publish_at&&d.push(".js-video-upload-postpone")),d.forEach((_=>{const e=o.querySelector(_);e&&(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.slideDown)(e,{duration:150,transition:_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.Fx.Transitions.swiftOut})}))};o.dataset.published&&!e?t():(_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setDisabled(_,!0),i.vid=o.dataset.video_id,i.oid=o.dataset.owner_id||cur.chosenOwnerId,i.tag=o.dataset.tag,ajax.post("al_video.php?act=delete_video_params",i,{onDone:function(){_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setDisabled(_,!1),e||t()},onError:function(){_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setDisabled(_,!1)}}))},getParams:function(_){var e,o,i,t;const a=window.VideoUpload.checkPostponeDate(_);if(a<0)return;const d=_.id.substr(18),l=parseInt(_.dataset.ownerId,10)||cur.chosenOwnerId,n=_.querySelector(".video_upload_publish"),s=_.querySelector(".video_upload_monetized"),r=_.querySelector(".js-video_upload__title"),c=_.querySelector(".js-video_upload__description"),E=_.querySelector(".video_edit_repeat"),p=_.querySelector(".video_improve_quality"),u=_.querySelector(".video_hide_auto_subs"),b=_.querySelector(".js-action-link-input");let m=0;window.VideoUpload._uploadAlbumChooser[d]&&(m=window.VideoUpload._uploadAlbumChooser[d].selectedItems()[0]);const D=window.VideoUpload.getPlaceholderEl(_),O=D.dataset.thumbId,h=D.dataset.thumbHash,P={action_link:(null==(e=b)?void 0:e.value)||"",status_export:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(n),monetized:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(s),title:(null==(o=r)?void 0:o.value)||"",desc:(null==(i=c)?void 0:i.value)||"",repeat:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(E),improve:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(p),hide_auto_subs:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(u),album_id:(null==(t=m)?void 0:t[0])||"",thumb_id:O,thumb_hash:h,publish_at:a};if(_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(l))P.privacy_video=Privacy.getValue("video"+d),P.privacy_videocomm=Privacy.getValue("videocomm"+d);else if(Object.keys(cur.privacy).length){var w,v;const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(cur.privacy.view.key,{id:d}),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(cur.privacy.comment.key,{id:d});P.privacy_video=(null==(w=document.querySelector(`#${_}_input`))?void 0:w.value)||"",P.privacy_videocomm=(null==(v=document.querySelector(`#${e}_input`))?void 0:v.value)||""}return window.VideoUpload.ordData&&window.VideoUpload.ordData.is_ad&&(P.ord_info=JSON.stringify(window.VideoUpload.getFormattedOrdData())),P},getShortParams:function(_){var e,o,i,t,a;const d=window.VideoUpload.checkPostponeDate(_);if(d<0)return;const l=_.id.substr(18),n=_.querySelector(".video_upload_publish"),s=_.querySelector(".js-video_upload__description"),r=_.querySelector(".audio_row"),c=_.querySelector(".clip_publish"),E=_.querySelector(".clip_allow_duets"),p=_.querySelector(".clip_allow_comments"),u=window.VideoUpload.getPlaceholderEl(_),b=null==(o=u)||null==(e=o.dataset)?void 0:e.thumbId,m=null==(t=u)||null==(i=t.dataset)?void 0:i.thumbHash,D={status_export:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(n),desc:(null==(a=s)?void 0:a.value)||"",wallpost:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(c)?1:0,can_make_duet:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(E)?1:0,privacy_videocomm:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(p)?0:3,thumb_id:b,thumb_hash:m,privacy_video:Privacy.getValue("video"+l),publish_at:d};return r&&(D.audio_id=r.dataset.fullId),window.VideoUpload.ordData&&window.VideoUpload.ordData.is_ad&&(D.ord_info=JSON.stringify(window.VideoUpload.getFormattedOrdData())),D},checkPostponeDate:function(_,e=0){var o,i;if(!_)return 0;const t=null==(i=cur.videoUploadPostponePicker)||null==(o=i[_.id])?void 0:o.lnkId,a=_.querySelector(`#postpone_date${t}`),d=_.querySelector("#postpone_picker_error_message"),l=_.querySelector(".video_upload_publish"),n=_.querySelector(".js-video_upload__ready_button");if(a){const o=e||+a.value,i=Math.trunc(Date.now()/1e3);if(n&&_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setLabel(n,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_schedule_post")),l){const e=(new Date).getFullYear()===new Date(1e3*o).getFullYear()?_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_publish_checkbox_tooltip"):_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_publish_checkbox_full_tooltip"),i=langDate(1e3*o,e,0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("months_of"));l.classList.add("disabled"),l.classList.remove("on"),window.VideoUpload.isPublishCheckboxTooltipEnabled(_)&&window.VideoUpload.destroyPublishCheckboxTooltip(_),l.setAttribute("onmouseover",`showTooltip(this, {text: '${i}', dir: 'auto', noZIndex: 1, shift: [22, 10], force: true});`)}var s,r,c,E;return o<i?(null==(r=d)||null==(s=r.classList)||s.add(CSS_CLASS_ERROR_MESSAGE),-1):(null==(E=d)||null==(c=E.classList)||c.remove(CSS_CLASS_ERROR_MESSAGE),o)}return e&&d&&d.classList.remove(CSS_CLASS_ERROR_MESSAGE),l&&(l.classList.remove("disabled"),l.removeAttribute("onmouseover"),window.VideoUpload.isPublishCheckboxTooltipEnabled(_)&&(window.VideoUpload.destroyPublishCheckboxTooltip(_),window.VideoUpload.initPublishCheckboxTooltip(_,{withoutShowOnTimeout:!0}))),n&&_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setLabel(n,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_end_editing")),0},getUploadItem:function(_){return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("js-video_upload",_)},retryUpload:function(_){const e=_.split("_")[1];Upload.retryUpload(e);const o=document.getElementById("video_upload_item_"+_);if(o){const _=o.querySelector(".js-video_upload__progress");_&&_.classList.remove("VideoUploadItem__progress--error");const e=document.querySelector(".js-video_upload__ready_button");e&&_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.setDisabled(e,!1)}},stopUpload:function(_){const e=_.split("_")[1],o=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({width:430,title:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_stop_title"),bodyStyle:"padding: 20px;"},_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_stop_text"),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_stop_button"),(function(){o.hide(),Upload.terminateUpload(e);const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+_),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(i,"video_id");if(t){const _=Upload.vars[e];ajax.post("al_video.php?act=delete_video",{vid:t,oid:_.oid,sure:1})}window.VideoUpload.deleteItem((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+_),!0),window.VideoUpload.checkNeedShowStickyPanel()}))},deleteItem:function(_,e){const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("page_block",_),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("page_block_header",o),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("ui_crumb",i),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-video_upload").map((_=>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("page_block",_)));if(1===a.length)if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(_),"clips_upload"===cur.module)(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoEmptyStub"));else{const _=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_no_video_upload_title");o.insertAdjacentHTML("beforeend",`<div id="video_upload_no_video">${_}</div>`),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(t[t.length-1],_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_adding_video_title"))}else if(o===a[0]){const _=a[1],e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("page_block_header",_),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_header_inner",_));(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(t[t.length-1],d),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domReplaceEl)(e,i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(o)}else e?(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.slideUp)(o,{duration:150,transition:_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.Fx.Transitions.swiftOut,onComplete:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(o)}}):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.cleanElems)(o)},initBeforeUnload:function(){cur.nav.push((function(_,e,o,i){if(!1===window.VideoUpload.checkChanges(1))return cur.onContinueCb=nav.go.pbind(o),!1})),window.onbeforeunload=window.VideoUpload.checkChanges,cur.destroy.push((()=>{window.onbeforeunload=!1,window.VideoUpload.destroyTab()}))},checkChanges:function(_){if(cur.leaving)return;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_block");if(!e)return!1;let o="",i="";const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-video_upload",e);let a=t.length,d=0,l=0;const n="clips_upload"===cur.module;for(let _=0;_<t.length;_++){const e=t[_];(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"error")?a--:((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"uploaded")&&d++,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"saved")&&l++)}if(d!==a)o=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_changed");else if(l!==a)if(n)i=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_clip_upload_leaving_without_saving");else{const _=a-l;i=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_leaving_without_saving",_)}if(1===_){if(!o&&!i)return!0;const _=_=>{cur.leaving=!0,_.hide(),cur.onContinueCb&&cur.onContinueCb()};if(o){const e=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)({title:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_warning")},o,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_continue"),(()=>{_(e)}),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_cancel"),(()=>{e.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}))}else if(i){let e;n?(e=new _web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.MessageBox({title:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_stop_editing_title"),containerClass:"video_upload__leave_editing_box"}),e.content(i),e.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_clip_upload_end_editing"),(()=>{e.hide(),window.VideoUpload.saveShortVideoParams((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__ready_button"))})),e.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_cancel"),(()=>{e.hide()}),"no",!1)):(e=new _web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.MessageBox({title:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_warning"),containerClass:"video_upload__leave_editing_box"}),e.content(i),e.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_save"),(()=>{e.hide(),cur.is_showcase||(nav.objLoc.section="upload",nav.setLoc(nav.objLoc)),window.VideoUpload.saveAllVideos()})),e.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_publish_later"),(()=>{window.VideoUpload.saveAllVideosWithMinimalInfo(),_(e)}),"no",!1)),e.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_remove_video"),(()=>{t.forEach((_=>{if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"saved"))return;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"owner_id")||cur.chosenOwnerId,o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"video_id"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"tag"),t=cur.videoHashs[i];ajax.post("/al_video.php?act=a_delete_video",{oid:e,vid:o,from:cur.oid,pl_id:-2,hash:t,tag:i,is_short_video:+n},{onDone:()=>{if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domQuery)(`[data-id="${e}_${o}"]`).forEach((_=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(_)})),!cur.onContinueCb){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload");_&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoEmptyStub")))}}})})),(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("video_upload_page_click_logger")&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onRemoveVideo"),_(e)}),"no",!1,"video_upload__remove_video_btn"),e.show()}return!1}const s=o||i;return s?(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.winToUtf)(s.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0},toUploadVideo:function(){const _=cur.uploadVideoBox;window.VideoUpload.checkResize(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_upload_box_tab"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_add_from_youtube_tab"),window.VideoUpload.onShowUploadPanel(),_.removeButtons(),_.setOptions({hideButtons:1,title:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_header_new")}),_.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_cancel"),_.hide,"no"),_.setBackTitle(),cur.uploadVideoBoxContainer.classList.remove("video_upload_box--with_actions")},toExternalAdd:function(_){const e=cur.uploadVideoBox,o="video"===_?this.toUploadVideo:e.hide;e.setBackTitle(o),window.VideoUpload.onHideUploadPanel(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_upload_box_tab"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_add_from_youtube_tab"),e.removeButtons(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isVisible)("video_extra_settings")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isVisible)("video_share_not_allowed")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isVisible)("video_share_error")?(e.setOptions({hideButtons:0}),e.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_save"),cur.saveExternalVideo),cur.uploadVideoBoxContainer.classList.add("video_upload_box--with_actions")):(e.setOptions({hideButtons:1}),cur.uploadVideoBoxContainer.classList.remove("video_upload_box--with_actions")),e.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_cancel"),e.hide,"no"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_external_link").focus()},toGroupVideoSelect:function(_,e){boxQueue.hideLast();const o=(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)();(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)("al_video.php?act=a_choose_video_box",{from:"video",without_upload:!0},{onDone:function(_){const e=`<div class="back" onclick="curBox().hide();"><span class="back__icon">${(0,_icons_desktop__WEBPACK_IMPORTED_MODULE_28__.getIcon24BrowserBack)().icon}</span>${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_back")}</div>`;_.setOptions({title:e,defaultTitle:e})}}),cur.chooseVideoAdd=function(i,t,a){const d=new CallHub((function(){"groups"!=cur.module&&"public"!=cur.module||!(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("redesign_web_group_feature")?"video"!=cur.module?nav.go("/videos-"+_,!1,{onDone:function(){cur.__phinputs=cur.__phinputs||[],(0,_web_lib_nav_utils__WEBPACK_IMPORTED_MODULE_1__.globalHistoryDestroy)(nav.objLoc[0])}}):window.nav.reload({force:!0}):(nav.reload(),boxQueue.hideAll(),o.destroy())}),i.length);for(let o=0,t=i.length;o<t;o++){let t=i[o];const n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_item_"+t),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(n,"hash");var l;if(t=t.split("_"),!e)e=(null==(l=window.Video)?void 0:l.isInAlbum())?Video._getSectionAlbumId():-2;ajax.post("al_video.php?act=a_add_to_playlist",{oid:t[0],vid:t[1],hash:s,gid:_,add:1,playlist_id:e},{onDone:function(){a&&a(),d.done()},onFail:function(){d.done()}})}return!1}},lockSaveButton:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton)((0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().btns.ok[0])},unlockSaveButton:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton)((0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().btns.ok[0])},initShare:function(_,e,o){const i=cur.uploadVideoBox,t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_external_link");let a,d;(0,_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_5__.placeholderSetup)(t,{back:!0});const l=function(){const _=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.trim)(t.value);_&&d!=_&&(i.showProgress(),d=_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_share_form").submit())};function n(_){a&&clearTimeout(a),_.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.KEY.ENTER?l():a=setTimeout(l,1e3)}let s;window.onParseDone=function(_){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_share_server_error"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_share_error"),_.images_proxy){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_share_form").action.replace(/\/[^\/]*$/,"")+"/upload.php?act=proxy_img&";(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(_.images_proxy,(function(o,i){_.images_proxy[o]=e+i}))}else _.images_proxy=_.images;if(_.extra>0&&_.extraData&&_.images[0]){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_share_descr"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_share_error"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_share_not_allowed"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_share_error"),i.hideProgress(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_share_photo_url").value=_.url,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_share_photo_image").value=_.images[0],(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_share_photo_extra").value=_.extra,cur.changeExternalImage=function(e){cur.externalVideoImage++;_.images[cur.externalVideoImage]?e.src=_.images_proxy[cur.externalVideoImage]:(cur.externalVideoImage=0,e.src=_.images_proxy[0])},_.images[0]){cur.externalVideoImage=0;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_external_image");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(e,{backgroundImage:"url('"+_.images_proxy[0]+"')"}),e.setAttribute("onclick","cur.changeExternalImage(this)"),_.images.length>1){const e=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)();e.src=_.images_proxy[0],e.onload=function(){e.width<130&&cur.changeExternalImage((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_external_img"))}}!function(){const o=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)();o.onerror=function(){let o=!1;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(_.images_proxy,(function(_,i){if(0==_)return;const t=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.vkImage)();t.onload=function(){o||(o=!0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_share_photo_image").value=i,cur.externalVideoImage=_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(e,{backgroundImage:"url('"+i+"')"}))},t.src=i}))},o.src=_.images_proxy[0]}()}if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_external_title").value=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.replaceEntities)(_.title),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_external_description").value=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_4__.replaceEntities)(_.description),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_extra_settings"),cur.videoPlaylists.length){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_external_upload_album_chooser_input",(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().bodyNode),e=parseInt(_.dataset.selectedPlaylist,10),o=cur.videoPlaylists.reduce(((_,o)=>(o[0]===e&&(_[0]=o[0]),_)),[0]);cur._addExternalAlbumDD=new Dropdown(_,[[0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_choose_album_placeholder")]].concat(cur.videoPlaylists),{autocomplete:!0,selectedItems:o,big:!0})}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video-upload-album-chooser"));let e=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_save");"video"!==o&&(e=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_add"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_external_status_export"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video-upload-album-chooser")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domByClass)(i.bodyNode,"video_upload_privacy_wrap"))),s=_,i.removeButtons(),i.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_cancel"),i.hide,"no"),cur.saveExternalVideo=function(){_&&_.images&&(window.VideoUpload.lockSaveButton(),cur.shareExternalImageSave=_.images[cur.externalVideoImage],(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_share_photo_image").value=cur.shareExternalImageSave,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_share_photo_form").submit())},i.setOptions({hideButtons:0}),i.addButton(e,cur.saveExternalVideo),cur.uploadVideoBoxContainer.classList.add("video_upload_box--with_actions")}else-1==_.extra?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_share_not_allowed"),window.VideoUpload.unlockSaveButton()):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_share_error"),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)("video_external_link"),window.VideoUpload.unlockSaveButton())},window.onParseFail=function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_share_server_error"),window.VideoUpload.unlockSaveButton(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_share_error"),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)("video_external_link")},window.onUploadDone=function(t,a){if(a.photo_id&&a.user_id&&s){const t=s.title;s.title=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_external_title").value;const d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_external_description").value;let l=0;if(cur.vSection){const _=cur.vSection.split("_");"album"===_[0]&&(l=_[1])}const n=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(s,{oid:_,folder_id:l,from:o,hash:e,share_title:t||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_external_title").value,share_text:d,image_url:cur.shareExternalImageSave,photo_owner_id:a.user_id,photo_id:a.photo_id,extra:s.extra,extra_data:s.extraData,to_video:"video"===o?1:0,album_id:cur._addExternalAlbumDD?cur._addExternalAlbumDD.selectedItems()[0][0]:"",to_status:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_external_status_export")?1:0});n.openGraph&&delete n.openGraph,delete s.extraData,_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(n.oid)&&(n.privacy_video=Privacy.getValue("video_external"),n.privacy_videocomm=Privacy.getValue("videocomm_external")),delete n.images,delete n.images_proxy,setTimeout((function(){ajax.post("/al_video.php?act=save_external",n,{onDone:function(_){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("share_error"),_.owner_id&&_.video_id)switch(o){case"video":i.hide(),nav.reload();break;case"market":{i.hide();const e=_.owner_id+"_"+_.video_id;Video.attachVideos([e]);break}default:{boxQueue.hideAll();const e=_.owner_id+"_"+_.video_id;Video.attachVideos([e])}}else window.VideoUpload.unlockSaveButton(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_share_server_error")},onFail:function(_){window.VideoUpload.unlockSaveButton(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_share_error"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_share_server_error").innerHTML=_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_share_server_error")}})}),0)}else i.showProgress(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_share_error")},window.onUploadFail=function(){i.hideProgress(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)("video_share_error"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)("video_share_server_error")},(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.addEvent)(t,"paste blur",l),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.addEvent)(t,"keydown input",n),(0,_shared_lib_nav_helpers__WEBPACK_IMPORTED_MODULE_29__.pushNavDestroy)((()=>{(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.removeEvent)(t,"paste blur",l),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.removeEvent)(t,"keydown input",n)}))},showLiveKeyTab(_,e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("video_upload__live_tab_content").forEach((_=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggle)(_,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(_,`video_upload__live_tab_content--${e}`))})),uiTabs.switchTab(_);const o=(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)();if(o.removeButtons(),"constant"===e){const _=o.bodyNode.querySelector(".video_upload__live_tab_content--constant .VideoLiveCoderSettings__input--key");o.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_copy_live_constant_key_button"),window.VideoUpload.copyLiveKey.bind(null,null,_)),o.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_cancel_but"),o.hide,"no")}else o.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_save_but"),window.VideoUpload.saveLiveStream),o.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_cancel_but"),o.hide,"no")},showLiveVideoLeaveWarning(_){const e=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_warning"),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_settings_leave_warning"),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_continue"),(()=>{e.hide(),window.nav.go("/video",null,{onDone:()=>{window.VideoUpload.showLiveTypeModal(_)}})}),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_cancel"),(()=>{e.hide()}))},showLiveTypeModal(_=cur.oid){if(!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(_))return(0,_web_index__WEBPACK_IMPORTED_MODULE_20__.showQuickLoginBox)(),!1;(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)("al_video.php?act=a_add_live_type_selection",{owner_id:_},{stat:["video_edit.css"],onDone:function(_){_.setOptions({width:500}),_.titleWrap.classList.toggle("OwnerChooseWrapper",cur.is_showcase),_.titleWrap.classList.toggle("OwnerChooseWrapper--colorGrey",!0),_.removeButtons(),_.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_cancel_but"),_.hide,"neutral")},onFail:function(_){if(_)return(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().hide(),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_error"),_),!0}})},createLiveStream(_=cur.oid){if(!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(_))return(0,_web_index__WEBPACK_IMPORTED_MODULE_20__.showQuickLoginBox)(),!1;(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showBox)("al_video.php?act=a_add_new_live_trans_form",{owner_id:_},{stat:["video_edit.css","privacy.css",window.jsc("web/privacy.js"),window.jsc("web/upload.js")],onDone:function(e,{owner_selected:o=1}){e.setOptions({width:500}),cur.chosenOwnerId=_,e.titleWrap.classList.toggle("OwnerChooseWrapper",cur.is_showcase),e.removeButtons(),o||e.bodyNode.closest(".popup_box_container").classList.add("PopupStub"),cur.saveNewLiveTransBtn=e.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_save_but"),(()=>{window.VideoUpload.saveLiveStream()}),"ok",!0,"popup_save_button"),e.addButton(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_cancel_but"),e.hide,"no"),(0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_9__.autosizeSetup)("video_new_live_trans_description",{minHeight:60,maxHeight:160})},onFail:function(_){if(_)return(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().hide(),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_error"),_),!0}})},initWebStreamingForm:(_,e,o,i,t,a)=>{const d=document.getElementById("video_web_streaming_block");window.VideoUpload.initThumbUpload(e,d),window.VideoUpload.initTitleInput(),window.VideoUpload.initLiveStreamCategoryDropdown(o,i),cur.resizeWebStreamingElementsHandler||(cur.resizeWebStreamingElementsHandler=!0,(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_11__.addEvent)(window,"resize",window.VideoUpload.resizeWebStreamingElements)),cur.newLiveInfo={videoId:_.video_id,streamUrl:_.stream_url,streamName:_.stream_name},cur.newLiveHash=a.hash,cur.newLiveRandomTag=a.random_tag,cur.videoTitleLength=a.max_text_length.title,cur.videoDescriptionLength=a.max_text_length.description,t&&(cur.privacy=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.privacy||{},t),window.VideoUpload.initPrivacyControls(_.owner_id,t)),window.VideoUpload.showTab(d),window.VideoUpload.initActionLink()},initNewLiveTransFormBox:(_,e,o,i,t,a)=>{window.VideoUpload.initThumbUpload(e,(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().bodyNode),window.VideoUpload.initLiveStreamCategoryDropdown(o,i),cur.newLiveInfo={videoId:_.video_id,streamUrl:_.stream_url,streamName:_.stream_name},cur.newLiveHash=a.hash,cur.newLiveRandomTag=a.random_tag,cur.videoTitleLength=a.max_text_length.title,cur.videoDescriptionLength=a.max_text_length.description,t&&(cur.privacy=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.privacy||{},t),window.VideoUpload.initPrivacyControls(_.owner_id,t)),window.VideoUpload.showTab((0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().bodyNode),window.VideoUpload.initActionLink(),window.VideoUpload.initLiveTransTimePicker({start_time_limit:a.start_time_limit,end_time_limit:a.end_time_limit},!0),(0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_9__.autosizeSetup)("video_new_live_trans_description",{minHeight:60,maxHeight:160})},updateLiveTypeModal:_=>{ajax.post("al_video.php?act=a_add_live_type_selection",{owner_id:_,update:1},{onDone:function(_){const{html:e}=JSON.parse(_),o=document.getElementById("video_add_live_wrapper");o&&(o.innerHTML="",o.insertAdjacentHTML("beforeend",e),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().bodyNode.closest(".popup_box_container").classList.remove("PopupStub"),window.VideoUpload.updateLiveTypeModal())}})},updateNewLiveTransFormBox:_=>{ajax.post("al_video.php?act=a_add_new_live_trans_form",{owner_id:_,update:1},{showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton.pbind(cur.saveNewLiveTransBtn),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton.pbind(cur.saveNewLiveTransBtn),onDone:function(_){const{liveInfo:e,uploadOptions:o,categories:i,gameCategories:t,privacyData:a,options:d,html:l}=JSON.parse(_),n=document.getElementById("video_add_live_wrapper");n&&(n.innerHTML="",n.insertAdjacentHTML("beforeend",l),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().bodyNode.closest(".popup_box_container").classList.remove("PopupStub"),window.VideoUpload.initNewLiveTransFormBox(e,o,i,t,a,d),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().updateBoxCoords())}})},initVideoUploadBox:(_,e,o,i,t,a,d,l,n,s,r,c)=>{window.VideoUpload.buildExtMasks(c),window.VideoUpload.initUpload(_,e,i,c),window.VideoUpload.initShare(d,l,a),cur.privacy=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.privacy||{},t),cur.videoTitleLength=r.title,cur.videoDescriptionLength=r.description,cur.videoPlaylists=n,cur.videoThumbUploadOpts=o,cur.videoUploadThumbBtnTpl=s},updateVideoUploadBox:(_,e=!1)=>{ajax.post("al_video.php?act=upload_box",{oid:_,update:1,is_short_video:+e,new_tpl:+e},{onDone:function(_,o,i){cur.newVideoUploadBlock=i,(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().bodyNode.innerHTML="",(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().bodyNode.insertAdjacentHTML("beforeend",o);const t=JSON.parse(_);window.VideoUpload.initUpload(t.upload_options,t.subtitles_upload_options,t.upload_tpl,e),window.VideoUpload.initShare(t.owner_id,t.hash_share,t.from),cur.privacy=t.privacy_data,cur.videoPlaylists=JSON.parse(t.playlists_data),cur.videoThumbUploadOpts=JSON.parse(t.thumb_upload_options),cur.videoUploadThumbBtnTpl=JSON.parse(t.thumb_upload_btn_tpl)}})},initTitleInput:function(){const _=document.getElementById("video_new_live_trans_title");_&&_.addEventListener("input",(()=>{window.VideoUpload.removeTitleError(),window.VideoUpload.checkRequiredFields()}))},initLiveStreamCategoryDropdown:function(_,e){const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_live_category"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_live_game_category"),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(o).offsetWidth;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggle)("video_upload_live_game_category_wrap",3==(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(o)),window.VideoUpload._liveCategoryDropdown=new Dropdown(o,_,{multiselect:!1,zeroPlaceholder:!0,big:!0,width:t,onChange:function(_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggle)("video_upload_live_game_category_wrap",3==_),window.VideoUpload.checkRequiredFields(),_&&window.VideoUpload.removeCategoryError()}}),window.VideoUpload._gameCategoryDropdown=new Dropdown(i,e,{multiselect:!1,zeroPlaceholder:!0,big:!0,width:t,onChange:function(){}}),(0,_shared_lib_nav_helpers__WEBPACK_IMPORTED_MODULE_29__.pushNavDestroy)((()=>{window.VideoUpload._liveCategoryDropdown.destroy(),window.VideoUpload._gameCategoryDropdown.destroy()}))},getLiveStreamCategoryVal:function(){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_live_category"),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_live_game_category");if(!_)return 0;let o=+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(_);if(3==o){const _=+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e);o=_>0?_:o}return o},updateLiveTransSettings:function(_,e,o,i,t,a){ajax.post("al_video.php?act=generate_live_trans_keys",{rhash:t,hash:i,owner_id:cur.oid,video_id:_,need_new:e?1:0},{onDone:function(_){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)("video_live_trans_settings_url"+a,_.url),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)("video_live_trans_settings_key"+a,_.key),o&&o()}})},updatedLiveKeyMsg:function(){(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_trans_key_updated"),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_trans_key_updated_msg"))},onLiveCoderSettingsFocus:function(_){"password"===_.type?this.toggleLiveKeyVisibility(null,_):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.elfocus)(_,0,_.value.length)},toggleLiveKeyVisibility(_,e){if(e||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_live_trans_settings_key"+_)),"password"===e.type){const o=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_view_key_box_title"),i=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_view_key_box_msg"),t=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_view_key_box_confirm"),a=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_view_key_box_cancel"),d=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(o,i,t,l,a);function l(){d.hide(),e.type="text"}}else e.type="password"},copyLiveKey:function(_,e){e||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_live_trans_settings_key"+_)),(0,_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_18__.copyToClipboard)(e.value),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.showDoneBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_key_copied"),{out:1500})},checkOptionalStreamField:(_,e)=>{if(!_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(_))return!1;const o=["1","2","3","4","-1_1_1","-1_1_2"];for(let _ of o)if(e.startsWith(_))return!0;return!1},saveWebStream:function(_,e){const o=document.getElementById(_),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_tc_item_selected",o);let t=null,a=null;i&&(t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(i,"thumb-id"),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(i,"thumb-hash"));const d=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.trim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)("video_new_live_trans_title")),l=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.trim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)("video_new_live_trans_description")),n=window.VideoUpload.getLiveStreamCategoryVal();cur.chosenOwnerId=e,cur.newLiveInfo=cur.newLiveInfo||{};const s={owner_id:cur.chosenOwnerId,video_id:cur.newLiveInfo.videoId,stream_url:cur.newLiveInfo.streamUrl,stream_name:cur.newLiveInfo.streamName,thumb_id:t,thumb_hash:a,title:d,description:l,start_time:0,end_time:0,category:n,publish:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_publish_on_wall"),preparation_check:0,notify_followers:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_notify_followers"),enable_donations:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_enable_donations"),enable_bitrate_alerts:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_enable_bitrate_alerts"),forbid_rewind:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_forbid_rewind"),is_endless:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_endless"),rhash:cur.newLiveHash,random_tag:cur.newLiveRandomTag,action_link:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-input",o)?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-input",o).value:"",is_web_streaming:1,webcast_preview:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_preparation_check"),screen_sharing:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_share_screen")};localStorage.getItem("video_live_stream_name")&&localStorage.removeItem("video_live_stream_name"),localStorage.setItem("video_live_stream_name",cur.newLiveInfo.streamName),_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(cur.chosenOwnerId)?(s.privacy_view=Privacy.getValue("video_live_view"),s.privacy_comment=Privacy.getValue("video_live_comment")):(s.privacy_view=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(`${cur.privacy.view.key}_input`)),s.privacy_comment=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(`${cur.privacy.comment.key}_input`)));let r=!1;cur.call&&(s.call=!0);const c=window.VideoUpload.checkOptionalStreamField(s.owner_id,s.privacy_view);if((!c&&!s.title||s.title.length>cur.videoTitleLength)&&(window.VideoUpload.setTitleError(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_trans_title_error_empty")),r=!0),s.description.length>cur.videoDescriptionLength&&(r=!0),!s.category)if(c)s.category=-1;else{const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domClosest)("selector_table","video_upload_live_category");_&&(_.scrollIntoView({block:"center"}),window.VideoUpload.setCategoryError(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_trans_type_error_empty")),r=!0)}if(r)return;const E=document.getElementById("webcast_save_btn");_web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.lock(E),ajax.post("al_video.php?act=a_add_new_live_trans",s,{onFail:function(_){return _web_ui_FlatButton__WEBPACK_IMPORTED_MODULE_22__.FlatButton.unlock(E),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_create_live_error"),_||_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_create_live_error_try_later")),!0}})},saveLiveStream:function(){const _=(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)(),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_tc_item_selected",_.bodyNode);let o=null,i=null;e&&(o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"thumb-id"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"thumb-hash"));const t=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.trim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)("video_new_live_trans_title")),a=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.trim)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)("video_new_live_trans_description")),d=window.VideoUpload.getLiveStreamCategoryVal(),l=!!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("VideoLiveTransTimeEnabled"),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoLiveTransTime__optionalEnding"),"VideoLiveTransTime__optionalEnding--active"),s=l?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("date-input_start-time"))):0,r=l&&!n?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("date-input_end-time"))):0;cur.newLiveInfo=cur.newLiveInfo||{};const c={owner_id:cur.chosenOwnerId,video_id:cur.newLiveInfo.videoId,stream_url:cur.newLiveInfo.streamUrl,stream_name:cur.newLiveInfo.streamName,thumb_id:o,thumb_hash:i,title:t,description:a,start_time:s,end_time:r,category:d,publish:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_publish_on_wall"),preparation_check:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_preparation_check"),notify_followers:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_notify_followers"),enable_donations:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_enable_donations"),enable_bitrate_alerts:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_enable_bitrate_alerts"),forbid_rewind:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_forbid_rewind"),is_endless:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_create_live_endless"),rhash:cur.newLiveHash,random_tag:cur.newLiveRandomTag,action_link:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-input",_.bodyNode)?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-input",_.bodyNode).value:"",is_web_streaming:0};_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(cur.chosenOwnerId)?(c.privacy_view=Privacy.getValue("video_live_view"),c.privacy_comment=Privacy.getValue("video_live_comment")):(c.privacy_view=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(`${cur.privacy.view.key}_input`)),c.privacy_comment=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(`${cur.privacy.comment.key}_input`))),cur.call&&(c.call=!0);const E=window.VideoUpload.checkOptionalStreamField(c.owner_id,c.privacy_view);if(!E&&!c.title||c.title.length>cur.videoTitleLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)("video_new_live_trans_title");if(c.description.length>cur.videoDescriptionLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)("video_new_live_trans_description");if(!c.category)if(E)c.category=-1;else{const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domClosest)("selector_table","video_upload_live_category");if(_)return _.scrollIntoView({block:"center"}),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)(_)}window.VideoUpload.lockSaveButton(),ajax.post("al_video.php?act=a_add_new_live_trans",c,{onFail:function(_){return window.VideoUpload.unlockSaveButton(),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_create_live_error"),_||_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_create_live_error_try_later")),!0}})},switchLiveEndlessCheckbox(_){if((0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(_)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"skip-warning"))(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.checkbox)(_);else{const e=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_endless_confirm_box_title"),o=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_endless_confirm_box_msg"),i=_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_live_endless_confirm_box_yes_btn"),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)(`<div class="checkbox video_upload__live_endless_dont_warn_checkbox" onclick="checkbox(this)">${_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_dont_warn_next_time")}</div>`),a=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_14__.showFastBox)(e,o,i,(()=>{a.hide(),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.checkbox)(_),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(t)&&ajax.post("/al_video.php?act=skip_live_endless_warning",{hash:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"skip-warning-hash")},{onDone:()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(_,"skip-warning",1)}})}),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("global_cancel"));a.bodyNode.appendChild(t)}},showTab(_,e=""){const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(_,"js-video_upload")?_:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("js-video_upload",_);if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__tab",o))return;e||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__tab",o).dataset.type);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-video_upload__tab",o).forEach((_=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(_)})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)(`video_upload__${e}`,o)),uiTabs.switchTab((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domByClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)(`video_upload__tab_${e}`,o),"ui_tab")),(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("video_upload_page_click_logger")&&("subtitles"===e?(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onSubtitles"):"action_link"===e&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onLinkInVideo"))},initEdit(_,e,o,i,t,a,d=!1){cur.privacy=_;const l=window.VideoUpload.options[0],n=l.ownerId,s=l.videoId,r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload");if((0,_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_9__.autosizeSetup)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__description",r),{minHeight:80,maxHeight:250}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-video_upload__tab",r)),window.VideoUpload.showTab(r),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_upload__tab_subtitles",r)&&(window.VideoUploadSubtitles[0].elems.blockEl=r,window.VideoUploadSubtitles.init(0)),e&&(cur.videoUploadThumbBtnTpl=i,window.VideoUpload.initThumbUpload(o,r),window.VideoUpload.initTC(e,"",r,!0)),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().setOptions({width:495}),t){if(t.uploaded_id){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_tc_upload_image",r);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(_,{backgroundImage:"url("+t.uploaded_url+")"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(_);const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_tc_uploader",r);e&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"thumb-id",t.uploaded_id),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"thumb-hash",t.uploaded_hash))}const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-video_tc_item",r);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(_,(function(e){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(this,"thumb-id")==t.selected)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(this,"video_tc_item_selected"),e>=3&&Video.tcSlide(null,this,Math.min(e-1,_.length-1),!0),!1}))}window.VideoUpload.initPrivacyControls(n,_),window.VideoUpload.initActionLink(n,s),window.VideoUpload.initLiveTransTimePicker(a),l.publishAt&&window.VideoUpload.initPostponePicker(r,l.publishAt),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().removeButtons(),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().addButton(l.saveButtonTitle,d?window.VideoUpload.saveShortVideoParams:window.VideoUpload.editSaveVideo,"yes",!1,"popup_save_button")},initActionLink(_,e){const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-input");o&&(o.value&&window.VideoUpload.updateActionLinkPreview(_,e),o.addEventListener("keyup",(0,_shared_lib_debounce__WEBPACK_IMPORTED_MODULE_30__.debounce)((()=>{window.VideoUpload.updateActionLinkPreview(_,e)}),250)))},updateActionLinkPreview(_,e){const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-input"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-desc"),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-error"),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoEdit__actionLinkPreviewWrap");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(a),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(t),o.value?ajax.post("al_video.php?act=get_action_link_preview",{owner_id:_,video_id:e,link:o.value},{cache:!0,onDone:function(_,e){_?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(a),a.innerHTML=e):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(t)}}):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(i)},initPrivacyControls(_,e,o=0){_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(_)?e.is_live&&(Privacy.update("video_live_view"),Privacy.update("video_live_comment")):(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(e,(_=>{const i=e[_],t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(i.key,{id:o});new InlineDropdown((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(t),{items:i.items,selected:i.selected,onSelect:()=>{window.VideoUpload.updateUploadOptions(o)}})}))},initPostponePicker(_,e=0){if(!_)return;const o=Math.trunc(Date.now()/1e3);e||(cur.postponedLastDate=o),cur.videoUploadPostponePicker||(cur.videoUploadPostponePicker={});var i,t;(cur.videoUploadPostponePicker[_.id]=new window.MediaSelector(_.querySelector("#postpone_picker"),"postpone_picker_preview",[["postpone",_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_publication_time_label"),{date:e||o,postpone_item_hidden:!1,activePeriod:76896e5}]],{onResetPostponeBtnClick:()=>{var e;const i=_.querySelector(`#postpone_date${null==(e=cur.videoUploadPostponePicker[_.id])?void 0:e.lnkId}`);i&&(i.value=o),window.VideoUpload.checkPostponeDate(_,o)},onMediaRemove:()=>{var e;const i=_.querySelector(`#postpone_date${null==(e=cur.videoUploadPostponePicker[_.id])?void 0:e.lnkId}`);i&&(i.value=o),window.VideoUpload.checkPostponeDate(_,o)},onAddMediaChange:()=>{window.VideoUpload.checkPostponeDate(_),(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("video_upload_page_click_logger")&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onPublishTime")},onMediaChange:()=>{window.VideoUpload.checkPostponeDate(_)},date:e},"",_.querySelector("#postpone_picker_btn")),e>o)&&(null==(t=cur.videoUploadPostponePicker[_.id])||null==(i=t.chooseMedia)||i.call(t,"postpone",e,{date:e,postpone_item_hidden:!1}))},editSaveVideo(_){var e,o,i,t;const a=(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().bodyNode,d=a.querySelector(".js-video_upload"),l=(null==(e=window.VideoUpload.options)?void 0:e[0])||{};let n,s=null;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(a.querySelectorAll(".js-video_tc_item"),(function(){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(this,"video_tc_item_selected"))return s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(this,"thumb-id"),s||(s=DEFAULT_THUMB_ID),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(this,"thumb-hash"),!1}));const r=parseInt((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.$)(".VideoEdit__fieldIsShortVideo").value),c=null==(o=window.Videoview)?void 0:o.getPlayerObject(),E=cur.mvMoveToAlbum?cur.mvMoveToAlbum.val():"",p={act:l.isPublish?"save_video_params":"do_edit_box",title:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__title",d)),desc:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__description",d)),vid:l.videoId,oid:l.ownerId,hash:l.hash,action_link:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-input",d)?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-action-link-input",d).value:"",action_link_title_key:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoEdit__actionLinkTitleKey",d)?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoEdit__actionLinkTitleKey",d).value:"",album_id:E,thumb_id:s,thumb_hash:n,is_web_streaming:+cur.is_web_streaming},u=window.VideoUpload.checkPostponeDate(d);if(u>0?p.publish_at=u:0===u&&(p.publish_at=Math.floor(Date.now()/1e3)),window.VideoUpload.ordData&&window.VideoUpload.ordData.is_ad&&(p.ord_info=JSON.stringify(window.VideoUpload.getFormattedOrdData())),l.isPublish&&(p.status_export=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_edit_publish")),-1==E&&(p.album_title=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)("mv_create_album"),!p.album_title))return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)("mv_create_album");_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(p.oid)?(p.privacy_video=Privacy.getValue(`video${l.videoId}`),p.privacy_videocomm=Privacy.getValue(`videocomm${l.videoId}`)):_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isGroupId(p.oid)&&(p.privacy_video=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(`${cur.privacy.view.key}_input`)),p.privacy_videocomm=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(`${cur.privacy.comment.key}_input`))),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_edit_repeat")&&(p.repeat=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_edit_repeat"),c&&c.toggleLoop(p.repeat));const b=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_hide_auto_subs",d);b&&(p.hide_auto_subs=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(b));const m=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("video_improve_quality",d);if(m&&(p.improve=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(m)),!(null==(i=p.title)?void 0:i.trim())&&!r||(null==(t=p.title)?void 0:t.length)>cur.videoTitleLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__title",d));if(p.desc.length>cur.videoDescriptionLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__description",d));if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_live_category")&&(p.live_category=window.VideoUpload.getLiveStreamCategoryVal(),!p.live_category)){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domClosest)("selector_table","video_upload_live_category");if(_)return _.scrollIntoView({block:"center"}),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.notaBene)(_)}if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_edit_live_preparation")&&(p.live_preparation=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_edit_live_preparation")?1:0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_edit_live_endless")&&(p.live_endless=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_edit_live_endless")?1:0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_edit_live_forbid_rewind")&&(p.live_forbid_rewind=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_edit_live_forbid_rewind")?1:0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_edit_live_donations")&&(p.live_donations=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_edit_live_donations")?1:0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_edit_live_enable_bitrate_alerts")&&(p.live_enable_bitrate_alerts=(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("video_edit_live_enable_bitrate_alerts")?1:0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("VideoLiveTransTimeEnabled")){const _=!!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)("VideoLiveTransTimeEnabled"),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("VideoLiveTransTime__optionalEnding"),"VideoLiveTransTime__optionalEnding--active");p.start_time=_?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("date-input_start-time"))):0,p.end_time=_&&!e?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("date-input_end-time"))):0}if(l.withSubtitles&&window.VideoUploadSubtitles[0]&&!window.VideoUploadSubtitles[0].tracksSaved)window.VideoUploadSubtitles.saveEditedTracks(0,window.VideoUpload.editSaveVideo);else if(window.ShortVideoGrid&&((0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"publish",_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserIdTransitional(+p.oid)?"by_user":"by_group"),(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"privacy","all"),(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"clip_publish_checkbox","false"),(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"clip_allow_duets_checkbox","false"),_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(+p.oid)&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("clips_uploader",1,"clip_allow_comments_checkbox","false")),ajax.post(`al_video.php?act=${p.act}`,p,{onDone:function(){let _,e,o,i,t,a,d,l;if("save_video_params"===p.act?[d,_,e,i]=arguments:([_,e,o,i,t,a]=arguments,l=arguments[7]),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)()){if((0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.curBox)().hide(),window.Videoview&&i&&Videoview.updateVideo(p.oid,p.vid,_,e,o,t,a,d,l),cur.videoEditItem&&i)if(window.ShortVideoGrid)(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ShortVideoGridItem__unpublished",cur.videoEditItem));else{if("scheduled"!==cur.showcaseSection||l){const _=Video.buildVideoEl(i,cur.is_showcase);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(cur.videoEditItem).replaceChild(_,cur.videoEditItem)}else{var n,s;const _=null==(n=cur.videoEditItem)?void 0:n.parentNode;if(_.removeChild(cur.videoEditItem),0===(null==(s=_)?void 0:s.childElementCount))return cur.videoEditItem=!1,void nav.go(window.location.pathname)}cur.videoEditItem=!1,Video._reinitSorters()}Video._updateThumbsInView()}},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.lockButton.pbind(_),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.unlockButton.pbind(_)}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("mv_edit_album")){const _=[];_&&(cur.mvMoveToAlbum=new Dropdown((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("mv_edit_album"),_,{width:250,selectedItems:[],autocomplete:_.length>7,big:1,onChange:function(_){-1==_?(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.slideDown)("mv_edit_create_album",200,(function(){(0,_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_5__.placeholderSetup)("mv_create_album",{back:!0}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("mv_create_album").focus()})):(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.slideUp)("mv_edit_create_album",200)}}))}else cur.mvMoveToAlbum=!1},updateUploadOptions(_){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+_);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"owner_id")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"video_id")&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"view_hash_by_link")?window.VideoUpload.updateVideoLink(_):ajax.post("al_video.php?act=get_hash_by_link",{owner_id:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"owner_id"),video_id:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"video_id")},{onDone:o=>{o&&o.hash_by_link&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"view_hash_by_link",o.hash_by_link),window.VideoUpload.updateVideoLink(_))}}))},updateVideoLink(_){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("video_upload_item_"+_),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload_link",e),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"video_id");if(!o||!i)return;const t=Number(Privacy.getValue(`video${_}`)),a=Number((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(`privacy_video_view_${_}_input`))),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(e,"view_hash_by_link"),l=t===USER_UPLOAD_VIEW_BY_LINK_PRIVACY||a===GROUP_UPLOAD_VIEW_BY_LINK_PRIVACY,n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(o,"href-tpl");l&&!d&&window.VideoUpload.updateUploadOptions(_);let s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(n,{video_id:i});l&&(s+=`?list=${d}`),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(o,s),o.removeAttribute("placeholder");const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("js-video_upload__copy_video_link",e);r.onclick=()=>{(0,_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_18__.copyToClipboard)(s),(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_10__.showDoneBox)(_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_link_copied"),{out:1500}),o.focus()},(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isVisible)(r)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(r)},getUniqueUploadItemId:(_,e)=>e?`${Math.abs((0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__.hashCode)(_+e))}_${_}`:_,saveAllVideos(){const _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-video_upload__ready_button");for(let e=0;e<_.length;e++){const o=_[e];window.VideoUpload.saveParams(o,!1,!0)}},saveAllVideosWithMinimalInfo(){const _=document.querySelectorAll(".js-video_upload__ready_button");for(let t=0;t<_.length;t++){var e,o,i;const a=window.VideoUpload.getUploadItem(_[t]),d=a.querySelector(".js-video_upload__title");if(!(null==(e=d)?void 0:e.value))return;const l=a.querySelector(".js-video_upload__description");ajax.post("al_video.php?act=do_edit_box",{title:d.value.slice(0,cur.videoTitleLength-1),desc:(null==(i=l)||null==(o=i.value)?void 0:o.slice(0,cur.videoDescriptionLength-1))||"",vid:a.dataset.video_id,oid:a.dataset.owner_id||cur.chosenOwnerId,tag:a.dataset.tag,hash:a.dataset.edit_hash,ext:a.dataset.extension,ocl:nav.objLoc.ocl?1:0})}(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_23__.partConfigEnabled)("video_upload_page_click_logger")&&(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_24__.statlogsValueEvent)("video_upload_page","","onPublishLater")},checkNeedShowStickyPanel(){let _=0;const e=document.querySelector(".VideoLayout__stickyPanel"),o=document.querySelector(".VideoLayout__scrollTop"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass)("js-video_upload__ready_button");for(let d=0;d<i.length;d++)if(i[d].classList.contains("FlatButton--primary")&&_++,2===_){var t,a;null==(t=e)||t.classList.add("VideoLayout__stickyPanel--visible"),null==(a=o)||a.classList.add("VideoLayout__scrollTop--withGap");break}var d,l;_<2&&(null==(d=e)||d.classList.remove("VideoLayout__stickyPanel--visible"),null==(l=o)||l.classList.remove("VideoLayout__scrollTop--withGap"))},setTitleError(_){const e=document.getElementById("video_new_live_trans_title"),o=document.getElementById("video_new_live_trans_title_error");e&&o&&(e.classList.add("VideoWebcastFormInput--error"),o.classList.add("VideoWebcastFormError--visible"),o.innerHTML=_)},removeTitleError(){const _=document.getElementById("video_new_live_trans_title"),e=document.getElementById("video_new_live_trans_title_error");_&&e&&(_.classList.remove("VideoWebcastFormInput--error"),e.classList.remove("VideoWebcastFormError--visible"),e.innerHTML="")},setCategoryError(_){const e=document.getElementById("video_upload_live_category"),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domClosest)("selector_container",e),i=document.getElementById("video_upload_live_category_error");o&&i&&(o.classList.add("selector_container--error"),i.classList.add("VideoWebcastFormError--visible"),i.innerHTML=_)},removeCategoryError(){const _=document.getElementById("video_upload_live_category"),e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domClosest)("selector_container",_),o=document.getElementById("video_upload_live_category_error");e&&o&&(e.classList.remove("selector_container--error"),o.classList.remove("VideoWebcastFormError--visible"),o.innerHTML="")},checkRequiredFields(){const _=document.getElementById("video_new_live_trans_title"),e=document.getElementById("video_upload_live_category");if(!_||!e)return;const o=document.getElementById("video_upload_live_footer_message");_.value&&_.value.length<=cur.videoTitleLength&&"0"!==e.value?o.classList.remove("VideoWebcastFormFooterMessage--visible"):o.classList.add("VideoWebcastFormFooterMessage--visible")},getCreationEntryPoint:_=>"clips_owner"===_&&location.pathname.match(/clips\/club\w+/)?"public_clips_grid":{profile:"profile_plus",clips_top:"clips_viewer",clips_subscription:"clips_viewer",clips_owner:"clips_viewer",groups:"club_plus",public:"club_plus",feed:"feed_plus"}[_],initPublishCheckboxTooltip(_,{withoutShowOnTimeout:e,ownerId:o}={}){const i=o||_.dataset.owner_id||cur.chosenOwnerId;if(_shared_ranges__WEBPACK_IMPORTED_MODULE_26__.Ranges.isUserId(parseInt(i,10)))return;const t=_.querySelector(".video_upload_publish"),a={hasover:!0,dir:"bottom",nohide:!0,typeClass:"video_upload__publish_on_wall_tooltip",shift:[12,10],className:"tt_black",text:_shared_lib_langs__WEBPACK_IMPORTED_MODULE_19__.getLang("video_upload_publish_tooltip_text")};window.stManager.add([window.jsc("web/tooltips.js"),"tooltips.css"],(()=>{let _;window.tooltips.create(t,a);const o=()=>window.tooltips.show(t,a),i=()=>window.tooltips.hide(t,a),d=e=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(t)&&(clearTimeout(_),o())},l=_=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_13__.isChecked)(t)?o():i()},n=()=>{t.addEventListener("mouseover",d),t.addEventListener("mouseout",i),t.addEventListener("click",l),(0,_shared_lib_nav_helpers__WEBPACK_IMPORTED_MODULE_29__.pushNavDestroy)((()=>{window.tooltips.destroy(t),clearTimeout(_),t.removeEventListener("mouseover",d),t.removeEventListener("mouseout",i),t.removeEventListener("click",l)}))};if(e)n();else{const e=(0,_shared_dom_runOnceInViewport__WEBPACK_IMPORTED_MODULE_31__.runOnceInViewport)(t,(()=>{e(),_=setTimeout((()=>{o(),_=setTimeout(i,5e3)}),1e3),n()}))}}))},destroyPublishCheckboxTooltip(_){var e;const o=_.querySelector(".video_upload_publish");null==(e=window.tooltips)||e.destroy(o)},isPublishCheckboxTooltipEnabled(_){var e;return Boolean(null==(e=_.dataset)?void 0:e.activePublish)}}},223072:(_,e,o)=>{o.d(e,{VideoUploadSubtitles:()=>p});var i=o(725296),t=o(29271),a=o(664988),d=o(265865),l=o(82161),n=o(653902),s=o(795558),r=o(514986),c=o(839470),E=o(504867);const p={init(_){const e=p[_];e.elems.tracksLangDropdown={},e.isEditing&&(e.subtitlesListAdd=[]);const o=!!e.options&&e.subtitlesList;if((0,a.isObject)(o)&&!(0,a.isEmpty)(o)){for(let e in o)if(o.hasOwnProperty(e)){const i=o[e];i.key=e,this.initTrack(_,i)}}else this.initTrack(_);this.initDefaultDropdown(_)},initTrack(_,e=!1){const o=p[_].elems.blockEl,i=(0,s.geByClass1)("js-add-subtitles-track",o);this.initNewTrackEl(i,e)},initNewTrackEl(_,e=!1,o=!1){const a=(0,s.gpeByClass)("js-video_upload",_),d=(0,s.geByClass1)("js-upload-subtitles-wrapper",a),l=(0,s.geByClass1)("js-subtitles-upload-item",d).cloneNode(!0),n=a.id.substr(18);(0,s.domInsertBefore)(l,_);let r=0;(0,s.geByClass)("js-subtitles-upload-item",a).forEach((_=>{if(!(0,s.isVisible)(_))return;r++;(0,s.geByClass1)("js-subtitles-label",_).innerHTML=t.getLang("video_upload_upload_subtitle_label").replace("{index}",r)})),r>=p[n].options.max_tracks_num&&(0,s.hide)(_),this.initLangDropdown(n,l,e);const u=(0,s.geByClass1)("js-subtitle-track-name",l),b=(0,s.geByClass1)("js-subtitle-upload-btn",l),m=(0,s.geByClass1)("js-subtitle-remove-file",l);if(e){const _=e.hasOwnProperty("params")?e.params.full_name:e.name;this.decorateLangName(u,_),(0,i.disableButton)(b,!1),(0,s.hide)(b),(0,s.domData)(l,"track-id",e.key)}else(0,s.hide)(m),(0,s.hide)(u);(0,c.partConfigEnabled)("video_upload_page_click_logger")&&o&&(0,E.statlogsValueEvent)("video_upload_page","","onAddSubtrack")},initDefaultDropdown(_){const e=p[_],o=e.elems.blockEl,t=(0,s.domByClass)(o,"js-video_upload__upload_subtitles");let d;const l=e.subtitlesDefault;d=l==n.VIDEO_UPLOAD_SUBTITLES_DISABLED||l==n.VIDEO_UPLOAD_SUBTITLES_USER_LANG?l==n.VIDEO_UPLOAD_SUBTITLES_USER_LANG&&(0,a.isObject)(e.subtitlesList)?-1:-2:null!=l?e.subtitlesList[l].lang_id:-2;const r=this.getActualDefaultDropdownOptions(_),c=t.elements.subtitle_default;let E;var u;cur.is_showcase&&(E=(null==(u=document.querySelector(".VideoUploadItem__main"))?void 0:u.clientWidth)/2);e.elems.defaultLangDropdown=new Dropdown(c,r,{big:!0,width:E,selectedItems:d,onChange:()=>{this.updateDefaultLang(o)}});const b=e.elems.defaultLangDropdown.container;r.length>1?((0,i.enableEl)(b),(0,s.removeClass)(b,"disabled")):((0,i.disableEl)(b),(0,s.addClass)(b,"disabled"))},decorateLangName(_,e){_&&e&&(_.setAttribute("title",e),e.length>30&&(e=e.slice(0,27)+"…"+e.slice(-4)),_.innerText=e)},getCurrentAvailableLangs(_){const e=p[_],o=e.elems.blockEl,i=[];(0,s.geByClass)("js-subtitles-upload-item",o).forEach((_=>{if(!(0,s.isVisible)(_))return;const e=(0,s.val)((0,s.domQuery1)('input[name="subtitle_lang"]',_));e&&i.push(e)}));const t=[];return(0,l.each)(e.options.langs,((_,e)=>{(0,l.inArray)(_,i)||t.push([_,e])})),t},getActualDefaultDropdownOptions(_){const e=p[_],o=e.elems.blockEl,i=(0,s.geByClass)("js-subtitles-upload-item",o),a=[],d=[];return a.push([-2,t.getLang("video_upload_subtitles_default_off")]),i.forEach((_=>{if(!(0,s.isVisible)(_))return;const o=(0,s.val)((0,s.domQuery1)('input[name="subtitle_lang"]',_)),i=(0,s.domByClass)(_,"js-subtitle-track-name");(0,s.isVisible)(i)&&d.push([o,e.options.langs[o]])})),d.length&&(a.push([-1,t.getLang("video_upload_subtitles_default_user_lang")]),a.push(...d)),a},getActualSelectedLangIds(_){return this.getActualDefaultDropdownOptions(_).map((_=>_[0]))},initLangDropdown(_,e,o){const t=(0,s.domQuery1)('input[name="subtitle_lang"]',e),a=(0,s.domByClass)(e,"video_upload__subtitles_track_loading");let d;var l;((0,s.hide)(a),cur.is_showcase)&&(d=(null==(l=document.querySelector(".VideoUploadItem__main"))?void 0:l.clientWidth)/2);const n=(0,s.geByClass1)("js-subtitle-upload-btn",e),r=new Dropdown(t,this.getCurrentAvailableLangs(_),{autocomplete:!0,big:!0,width:d,placeholder:(0,s.domData)(t,"placeholder"),selectedItems:o?o.lang_id:"",onChange:e=>{const o=(0,s.domData)(r.container,"last-saved");if(o&&""===e)return void r.val(o);if(""===e)return;(0,s.domData)(r.container,"last-saved",e);const t=(0,s.gpeByClass)("js-subtitles-upload-item",r.container);(0,i.disableButton)(n,!1),this.updateAllLangDropdowns(_),e||(0,i.disableButton)(n,!0),this.onUpdateLang(t)}});this.initUploadButton(_,n),p[_].elems.tracksLangDropdown[r.guid]=r},initUploadButton(_,e){const o=p[_],a=o.elems.blockEl,n=(0,s.gpeByClass)("js-subtitles-upload-item",e),u=(0,s.domByClass)(n,"selector_container"),b=(0,s.domByClass)(n,"video_upload__upload_subtitles_input_container"),m=(0,s.domByClass)(n,"video_upload__subtitles_track_loading"),D=(0,s.domByClass)(n,"js-subtitle-track-name"),O=(0,s.domByClass)(n,"js-subtitle-remove-file"),h=o.options;e.onclick=()=>{(0,s.domFC)(b).click(),(0,c.partConfigEnabled)("video_upload_page_click_logger")&&(0,E.statlogsValueEvent)("video_upload_page","","onUploadSub")};let P=null;Upload.init(b,"",{},{accept:".srt",chooseBox:!0,clear:!0,file_name:"file",file_size_limit:h.file_size_limit,file_types:"*.srt",lang:{filesize_error:t.getLang("video_upload_subtitles_size_error")},max_attempts:3,noCheck:!0,requestOptionsForFile:!0,type:"subtitles",withoutAutoUpload:!0,onFilesSelected:(t,a)=>{if(a.length){if(P=a[0],(0,s.domData)(n,"upload-index",t),(0,s.hide)(e),o.isEditing)return(0,s.show)(D),(0,s.show)(O),this.decorateLangName(D,P.name),this.updateDefaultLangDropdown(_),void o.subtitlesListAdd.push(n);(0,s.show)(m),(0,i.disableEl)(u),(0,s.addClass)(u,"disabled"),p.uploadTrack(n)}},onNoFilteredCallback:()=>{(0,i.notaBene)(u),(0,r.showFastBox)(t.getLang("global_error"),t.getLang("video_upload_subtitles_format_error"))},onUploadStart:(_,e)=>{(0,s.hide)(D),(0,s.hide)(O),(0,s.show)(m),(0,i.disableEl)(u),(0,s.addClass)(u,"disabled")},onUploadComplete:(o,t)=>{(0,s.hide)(m),(0,s.show)(D),(0,i.enableEl)(u),(0,s.removeClass)(u,"disabled"),this.decorateLangName(D,P.name),this.updateDefaultLangDropdown(_),(0,s.hide)(e),(0,s.show)(O);const n=(0,d.parseJSON)(t);(0,l.each)(n,((_,e)=>{(0,s.geByClass)("js-subtitles-upload-item",a).forEach((o=>{if(!(0,s.isVisible)(o))return;+(0,s.val)((0,s.domQuery1)('input[name="subtitle_lang"]',o))==+e.lang_id&&(0,s.domData)(o,"track-id",_)}))})),this.updateDefaultLang(a),VideoUpload.updatePlayer(a)},onUploadError:(_,o)=>{(0,s.hide)(m),(0,s.show)(e),(0,i.enableEl)(u),(0,s.removeClass)(u,"disabled")}})},removeTrack(_){const e=(0,s.gpeByClass)("js-video_upload",_),o=(0,s.gpeByClass)("js-subtitles-upload-item",_),i=(0,s.geByClass1)("js-add-subtitles-track",e),a=(0,s.geByClass1)("js-subtitle-remove-file",o),d=e.id.substr(18);this.removeTrackFile(a),(0,s.hide)(o);let l=0;(0,s.geByClass)("js-subtitles-upload-item",e).forEach((_=>{if(!(0,s.isVisible)(_))return;l++;(0,s.geByClass1)("js-subtitles-label",_).innerHTML=t.getLang("video_upload_upload_subtitle_label").replace("{index}",l)})),l<p[d].options.max_tracks_num&&(0,s.show)(i)},removeTrackFile(_,e,o=!1){const i=(0,s.gpeByClass)("js-video_upload",_),t=(0,s.gpeByClass)("js-subtitles-upload-item",_),a=(0,s.geByClass1)("file",(0,s.geByClass1)("video_upload__upload_subtitles_input_container",t)),d=(0,s.geByClass1)("js-subtitle-upload-btn",t),l=(0,s.geByClass1)("video_upload__subtitles_track_loading",t),n=(0,s.geByClass1)("js-subtitle-track-name",t),r=i.id.substr(18),c=p[r];return(e=e||(0,s.domData)(t,"track-id"))===(0,s.domData)(t,"track-id")&&((0,s.val)(a,""),(0,s.hide)(_),(0,s.hide)(n)),this.updateDefaultLangDropdown(r),c.isEditing&&!o?((0,s.show)(d),(0,s.domData)(t,"track-id",""),void(e&&(c.subtitlesList[e].remove=_))):e?(e===(0,s.domData)(t,"track-id")&&((0,s.show)(l),(0,s.hide)(d)),new Promise(((_,o)=>{ajax.post("video?act=edit_subtitles_track",{action:"remove",owner_id:c.ownerId,video_id:c.videoId,track_id:e,hash:c.editHash},{onDone:()=>(e===(0,s.domData)(t,"track-id")&&((0,s.hide)(l),(0,s.show)(d),(0,s.domData)(t,"track-id","")),VideoUpload.updatePlayer(i),_()),onFail:_=>o(_)})}))):void(0,s.show)(d)},onUpdateLang(_,e=!1){const o=(0,s.domData)(_,"track-id"),i=(0,s.gpeByClass)("js-video_upload",_),t=i.id.substr(18),a=(0,s.val)((0,s.domQuery1)('input[name="subtitle_lang"]',_)),d=p[t];if(this.updateDefaultLangDropdown(t),!o)return;if(d.isEditing&&!e)return void(d.subtitlesList[o].update=_);const l=(0,s.geByClass1)("video_upload__subtitles_track_loading",_),n=(0,s.domByClass)(_,"js-subtitle-remove-file"),r=(0,s.geByClass1)("js-subtitle-track-name",_);return(0,s.hide)(n),(0,s.hide)(r),(0,s.show)(l),new Promise(((_,e)=>{ajax.post("video?act=edit_subtitles_track",{action:"edit_lang",owner_id:d.ownerId,video_id:d.videoId,lang_id:a,track_id:o,hash:d.editHash},{onDone:()=>((0,s.hide)(l),(0,s.show)(n),(0,s.show)(r),this.updateDefaultLang(i),VideoUpload.updatePlayer(i),_()),onFail:_=>e(_)})}))},onVideoUploaded(_,e){const o=p[_];o.videoId=e;const i=o.elems.blockEl;(0,s.geByClass)("js-subtitles-upload-item",i).forEach((_=>{p.uploadTrack(_)}))},saveEditedTracks(_,e){var o,i;const t=p[_],a=null==(o=t.elems)?void 0:o.blockEl,d=[],l=t.subtitlesList;null==(i=t.subtitlesListAdd)||i.forEach((_=>{d.push((()=>p.uploadTrack(_)))}));for(let _ in l){if(!l.hasOwnProperty(_))continue;const e=l[_];e.hasOwnProperty("remove")?d.push((()=>p.removeTrackFile(e.remove,_,!0))):e.hasOwnProperty("update")&&d.push((()=>p.onUpdateLang(e.update,!0)))}d.reduce(((_,e)=>_.then(e)),Promise.resolve()).then((()=>{Promise.all(d).then((()=>{const _=p.updateDefaultLang(a,!0);_?_.then((()=>{t.tracksSaved=!0,e()})):(t.tracksSaved=!0,e())}))}))},updateAllLangDropdowns(_){const e=p[_];for(let o in e.elems.tracksLangDropdown)if(e.elems.tracksLangDropdown.hasOwnProperty(o)){e.elems.tracksLangDropdown[o].setOptions({defaultItems:this.getCurrentAvailableLangs(_)})}},updateDefaultLang(_,e=!1){if(!_)return;const o=_.id.substr(18),i=p[o];if(!i.editHash)return;let t=null;const a=i.elems.defaultLangDropdown.val(),d=i.elems.defaultLangDropdown.container;if(-1!=a&&-2!=a){(0,s.geByClass)("js-subtitles-upload-item",_).forEach((_=>{if(!(0,s.isVisible)(_))return;(0,s.val)((0,s.domQuery1)('input[name="subtitle_lang"]',_))===a&&(t=(0,s.domData)(_,"track-id"))}))}else t=-2==+a?n.VIDEO_UPLOAD_SUBTITLES_DISABLED:n.VIDEO_UPLOAD_SUBTITLES_USER_LANG;return i.isEditing&&!e||null===t||t==(0,s.domData)(d,"last-saved")?void 0:new Promise(((e,o)=>{ajax.post("video?act=edit_subtitles_track",{action:"set_default",owner_id:i.ownerId,video_id:i.videoId,track_id:t,hash:i.editHash},{onDone:()=>((0,s.domData)(d,"last-saved",t),VideoUpload.updatePlayer(_),e()),onFail:_=>o(_)})}))},updateDefaultLangDropdown(_){const e=p[_],o=e.elems.blockEl,t=e.elems.defaultLangDropdown,a=t.container,d=t.val(),n=this.getActualDefaultDropdownOptions(_);if(t.setOptions({defaultItems:n}),!(0,l.inArray)(d,this.getActualSelectedLangIds(_))){const _=e.subtitlesDefault,o=(0,s.domQuery1)(`.js-subtitles-upload-item[data-track-id="${_}"]`),i=(0,s.geByClass1)("js-subtitle-remove-file",o);o&&(0,s.isVisible)(i)?t.val((0,s.val)((0,s.domQuery1)('input[name="subtitle_lang"]',o))):t.val(-2)}n.length>1?((0,i.enableEl)(a),(0,s.removeClass)(a,"disabled")):((0,i.disableEl)(a),(0,s.addClass)(a,"disabled")),this.updateDefaultLang(o)},uploadTrack(_){const e=(0,s.gpeByClass)("js-video_upload",_).id.substr(18),o=p[e],i=o.ownerId,t=o.videoId;if(!t)return;const a=(0,s.geByClass1)("file",(0,s.geByClass1)("video_upload__upload_subtitles_input_container",_));if(!a)return;const d=(0,s.domData)(_,"upload-index"),n=(0,s.val)((0,s.domQuery1)('input[name="subtitle_lang"]',_)),r=a.files;return r.length?new Promise(((_,o)=>{ajax.post("al_video.php?act=get_subtitles_upload_params",{oid:i,vid:t},{onDone:o=>{p[e].editHash=o.edit_hash,o.vars.langId=n,o.vars.name=r[0].name,(0,l.extend)(Upload.options[d],o.options),(0,l.extend)(Upload.vars[d],o.vars),Upload.uploadUrls[d]=o.options.url;const i=Upload.options[d].onUploadComplete;Upload.options[d].onUploadComplete=(e,o)=>(i(e,o),_()),Upload.onFileApiSend(d,r,!0)},onFail:_=>(Upload.terminateUpload(d,r[0].name),o(_))})})):void 0}}},184014:(_,e,o)=>{o.d(e,{copyToClipboard:()=>a});var i=o(795558),t=o(301230);function a(_,e=window.utilsNode){let o;const a=(0,i.ce)("textarea",{value:_},{position:"absolute",top:-9999,zIndex:2});e.appendChild(a),t.browser.msie?a.setSelectionRange(0,_.length):a.select();try{o=document.execCommand("copy")}catch(_){o=!1}return a.parentNode.removeChild(a),o}}}]);try{stManager.done("dist/0bceef6ad055b21676eba8b130f26dc1.fe307e9877dd9894f7f9.js")}catch(_){}