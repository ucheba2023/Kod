(()=>{"use strict";var e,t={991251:(e,t,s)=>{var i,o,r,n=s(708786);(null==(o=window.vk)||null==(i=o.pe)?void 0:i.static_manager_dynamic_imports)&&(null==(r=window.vk)?void 0:r.stDomain)&&(s.p=window.vk.stDomain+"/dist/"),window.Poster=n.default;try{window.stManager.done(window.jsc("web/poster.js"))}catch(e){}},439207:(e,t,s)=>{function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M5.23 10.5c-.74 0-1.24.53-1.27 1.11-.04.88-.4 1.47-.79 1.87.35.04.8.02 1.33-.13 1.48-.42 2-1.24 2-1.77S6 10.5 5.23 10.5Zm-2.77 1.04A2.71 2.71 0 0 1 5.23 9c1.45 0 2.76 1.09 2.76 2.58s-1.28 2.7-3.08 3.21a4.1 4.1 0 0 1-3.54-.43.88.88 0 0 1-.29-.33.81.81 0 0 1-.04-.62c.14-.4.53-.56.84-.8.28-.2.55-.5.58-1.07Zm9.95-10.09c.56-.57 1.48-.6 2.08-.07.6.53.68 1.45.17 2.07l-4.6 5.76a.75.75 0 1 1-1.17-.93l4.6-5.77V2.5h-.01l-.01.01-5.34 5.27a.75.75 0 1 1-1.06-1.06l5.34-5.27Z" clip-rule="evenodd"/></svg>',name:"brush_outline_16"}}s.d(t,{getIcon16BrushOutline:()=>i})},75075:(e,t,s)=>{function i(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 4.22a.75.75 0 0 1 0 1.06L7.8 10l4.72 4.72a.75.75 0 1 1-1.06 1.06l-5.25-5.25a.75.75 0 0 1 0-1.06l5.25-5.25a.75.75 0 0 1 1.05 0z" fill="currentColor"/></svg>',name:"chevron_left_outline_20"}}s.d(t,{getIcon20ChevronLeftOutline:()=>i})},876286:(e,t,s)=>{function i(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.47 4.22a.75.75 0 0 0 0 1.06L12.19 10l-4.72 4.72a.75.75 0 1 0 1.06 1.06l5.25-5.25a.75.75 0 0 0 0-1.06L8.53 4.22a.75.75 0 0 0-1.06 0z" fill="currentColor"/></svg>',name:"chevron_right_outline_20"}}s.d(t,{getIcon20ChevronRightOutline:()=>i})},708786:(e,t,s)=>{s.d(t,{default:()=>m});var i=s(795558),o=s(301230),r=s(953908),n=s(725296),l=s(29271),a=s(664988),h=s(82161),d=s(705758),_=s(893106),p=s(320422),c=s(47434),g=s(75075),u=s(876286),v=s(439207),k=s(854099);const m=class{openEditor(){this.state.opened||(this.state.opened=!0,(0,a.isFunction)(this._options.onPreOpen)&&this._options.onPreOpen(),this._flags.isFirstLaunch&&(this._initEditor(),this._flags.isFirstLaunch=!1),this._setBackgroundUrl(this._els.activeBackgroundElem,this._activeBackground),this._loadNearBackgrounds(this._els.activePreviewEl),(0,i.show)(this._els.posterElem),(0,i.domInsertBefore)(this._els.inputMsg,(0,i.domFC)(this._els.posterView)),this._updateText(),this._autoscrollPreviews(!0),this._onChangeData&&this._onChangeData(),(0,a.isFunction)(this._options.onPostOpen)&&this._options.onPostOpen())}closeEditor(){this.state.opened&&(this.state.opened=!1,(0,a.isFunction)(this._options.onPreHide)&&this._options.onPreHide(),(0,i.hide)(this._els.posterElem),(0,i.re)(this._els.inputMsg),this._onChangeData&&this._onChangeData(),this._closeTooltip(this._els.closePosterBtn),(0,a.isFunction)(this._options.onPostHide)&&this._options.onPostHide())}isOpen(){return this.state.opened}isTextValid(e){const t=e.length,s=e.match(/\n/g),i=s?s.length:0;return t<=this._config.constants.max_symbols&&i<=3}isTextFieldValid(e=this._els.inputMsg){return this.isTextValid(this._getFormatString(e))}isCustomBkgId(e){return e&&0!=e.split("_")[0]}checkText(){this._onChangeText()}changeBtnText(e){k.FlatButton.setLabel(this._els.sendBtn,e)}focusPoster(){this._focusOnInput()}sendStatsInfo(e,t=""){((0,a.isObject)(t)||(0,a.isArray)(t))&&(t=JSON.stringify(t)),ajax.post("al_page.php",{act:"poster_event",type:e,bkg_id:this._activeBackground.id,hash:this._config.eventHash,msg:t})}removeCustomBkg(e){if(!this.isCustomBkgId(e))return;const t=this._backgroundsMap[e],s=this._backgroundsMap[t.id].previewEl;this._nextBkg(!0),(0,i.re)(s);(0,i.geByClass1)("poster__new-bkg",this._els.newBkgBtn).innerHTML=l.getLang("wall_poster_upload_bkg_btn"),this._customBkg=null,delete this._backgroundsMap[e],delete this._categoriesMap[t.categoryId].bkgs[e]}addCustomBkg(e,t=!0){if(!this.isCustomBkgId(e.id))return;this._customBkg&&this.removeCustomBkg(this._customBkg.id);(0,i.geByClass1)("poster__new-bkg",this._els.newBkgBtn).innerHTML=l.getLang("wall_poster_change_upload_bkg_btn");const s=Object.keys(this._categoriesMap)[0];e.categoryId=s,this._categoriesMap[s].bkgs[e.id]=e,this._backgroundsMap[e.id]=e,this._customBkg=e;const o=this._els.sliderBody,r=this._getPreviewTemplate(e.id),n=(0,i.se)(r);e.previewEl=n,(0,i.addClass)(n,"poster__slider-item_custom"),o.insertBefore(n,o.firstChild),t&&this.setBkg(e.id,!0)}_onCustomBkgAdded(e){this.addCustomBkg(e)}_onUploaderClose(){(0,a.isFunction)(this._options.onPostUploaderClose)&&this._options.onPostUploaderClose()}nextCategory(e=!1){let t=Object.keys(this._categoriesMap),s=t.indexOf(this._activeCategory.id);s<t.length-1?++s:s=0,this._setFirstBkgByCategoryIdx(s,e),this._onChangeData&&this._onChangeData()}resetPoster(){this._customBkg&&this.removeCustomBkg(this._customBkg.id),this._setFirstBkgByCategoryIdx(0,!0)}getPosterElement(){return this._els.posterElem}getPostOptionsWrapperEl(){return this._els.postOptionsWrapper}getErrorWrapperElement(){return this._els.submitErrorView}getTextInputEl(){return this._els.inputMsg}getText(){return this._text}getTextAsHtml(){return this._els.inputMsg.innerHTML}getBkgId(){return this._bkgId}getCustomBkg(){return this._customBkg}getBtnsWrapper(){return this._els.posterBtnsWrapper}setText(e="",t=!0){t?this._els.inputMsg.innerHTML=e:null!=this._els.inputMsg.innerText?this._els.inputMsg.innerText=e:this._els.inputMsg.textContent=e,this._text=this._getTextFromInput(),this._checkPlaceholder(!0)}setBkg(e,t=!1){if(!e)return;const s=this._backgroundsMap[e];if(!s)return;const o=this._backgroundsMap[e].previewEl,r=this.isCustomBkgId(this._activeBackground.id);this._setBkgInModel(s.id),(0,i.removeClass)(this._els.activePreviewEl,"poster__slider-item_active"),(0,i.addClass)(o,"poster__slider-item_active");const n=this._els.activeBackgroundElem,l=this._createBackgroundElem(s);this._els.posterImageContainer.appendChild(l),r&&this._toggleBkgAuthorEl(!1,t),this.isCustomBkgId(e)&&s.author_link&&(this.changeBkgAuthor({authorName:s.author_name,authorUrl:s.author_link},!0),this._toggleBkgAuthorEl(!0,t)),t?((0,i.re)(n),(0,i.show)(l)):((0,_.fadeOut)(n,250,(()=>{(0,i.re)(n)})),(0,_.fadeIn)(l,250)),this._els.activePreviewEl=o,this._els.activeBackgroundElem=l,this._updateContent(t),this._loadNearBackgrounds(this._els.activePreviewEl),this._onChangeData&&this._onChangeData()}_setBkgInModel(e){this._activeBackground=this._backgroundsMap[e],this._activeCategory=this._categoriesMap[this._activeBackground.categoryId],this._bkgId=e}scrollPreviews(e,t){(0,r.cancelEvent)(e);const s=this._els.sliderBody;if(s.clientWidth===s.scrollWidth)return;let i=t||(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX);i<0||s.scrollLeft+s.clientWidth+i<s.scrollWidth?this._scrollLeft=Math.max(0,s.scrollLeft+i):this._scrollLeft=Math.max(0,s.scrollWidth-s.clientWidth);this._applyScroll(s,e,300)&&this._checkSliderSize()}lockEditPoster(e=!0){(0,i.attr)(this._els.inputMsg,"contenteditable",!1),(0,i.show)(this._els.loadingWrapper),e&&(0,n.lockButton)(this._els.sendBtn)}unlockEditPoster(e=!0){(0,i.attr)(this._els.inputMsg,"contenteditable",!0),(0,i.hide)(this._els.loadingWrapper),e&&(0,n.unlockButton)(this._els.sendBtn)}destroy(){this._removeListeners(),Wall.deinitComposer(this._els.inputMsg),(0,i.re)(this._els.posterElem),(0,a.isFunction)(this._options.onDestroy)&&this._options.onDestroy()}_initEditor(){this._loadImgPreviews(),this._editorWidth||(this._editorWidth=this._options.appendToElem.clientWidth,this._textSizeIdx=null,this._setTextSettings())}_nextBkg(e){const t=this._els.activePreviewEl;let s=(0,i.domNS)(t);s||(s=(0,i.domFC)(this._els.sliderBody));const o=(0,i.domData)(s,"bkg-id");return this.setBkg(o,e),this.sendStatsInfo("select_bkg"),!1}_prevBkg(){const e=this._els.activePreviewEl;let t=(0,i.domPS)(e);t||(t=(0,i.domLC)(this._els.sliderBody));const s=(0,i.domData)(t,"bkg-id");return this.setBkg(s),this.sendStatsInfo("select_bkg"),!1}_createBtnsWrapper(){if(this._els.posterBtnsWrapper=(0,i.se)('<div class="poster__btns-wrapper" style="display: none"></div>'),this._config.uploadBkgsEnabled){const e=this._customBkg?l.getLang("wall_poster_change_upload_bkg_btn"):l.getLang("wall_poster_upload_bkg_btn");this._els.newBkgBtn=(0,i.se)(`\n        <div class="poster__new-bkg-btn-layout" id="poster-new-bkg-btn">\n          <div class="poster__new-bkg-btn-wrapper">\n            <span class="poster__new-bkg">${e}</span>\n          </div>\n        </div>\n      `),this._els.posterBtnsWrapper.appendChild(this._els.newBkgBtn)}}_autoscrollPreviews(e=!1,t=this._backgroundsMap[this._activeBackground.id].previewEl){const s=this._els.sliderBody,i=+getComputedStyle(t).marginLeft.slice(0,-2),o=t.clientWidth+2*i,r=vk.rtl?s.scrollWidth-s.clientWidth+t.offsetLeft:t.offsetLeft;if(this._scrollLeft+37<=r-i&&r+o-i<=this._scrollLeft+s.clientWidth-37)return void this._checkSliderSize();this._scrollLeft=Math.max(0,r-i-s.clientWidth/2+o/2);this._applyScroll(s,e)&&this._checkSliderSize()}_applyScroll(e,t=!1,s=600){if(t)e.scrollLeft=this._scrollLeft;else{if(0===this._scrollLeft||this._scrollLeft+e.clientWidth>=e.scrollWidth)return 0===this._scrollLeft?(0,i.removeClass)(this._els.sliderArrowRight,"poster__slider-arrow_disabled"):(0,i.removeClass)(this._els.sliderArrowLeft,"poster__slider-arrow_disabled"),(0,_.animate)(e,{scrollLeft:this._scrollLeft},s,this._checkSliderSize.bind(this)),!1;(0,_.animate)(e,{scrollLeft:this._scrollLeft},s)}return!0}_createPosterElem(){this._createPosterViewElem(),this._createAuthorInfoElem(),this._createBtnsWrapper(),this._createPosterErrorView(),this._createToolbarElem(),this._createLoadingWrapper(),this._els.posterElem=(0,i.se)(`<div class="poster poster-editor ${this._options.containerClasses}" style="display: none"></div>`),this._options.appendToElem.appendChild(this._els.posterElem),this._els.posterElem.classList.add("poster","poster-editor"),this._els.posterElem.appendChild(this._els.posterImageContainer),this._els.posterElem.appendChild(this._els.posterView),this._els.posterElem.appendChild(this._els.submitErrorView),this._els.posterElem.appendChild(this._els.posterBtnsWrapper),this._els.posterElem.appendChild(this._els.toolbarWrapper),this._els.posterElem.appendChild(this._els.loadingWrapper)}_createToolbarElem(){this._els.toolbarWrapper=(0,i.se)('<div class="poster__toolbar-wrapper"></div>'),this._els.toolbar=(0,i.se)('<div class="poster__toolbar"></div>'),this._els.closePosterBtn=(0,i.se)('<div class="poster__close-button"></div>'),this._createSliderElem(),this._createSidebarElem(),this._els.toolbar.appendChild(this._els.closePosterBtn),this._els.toolbar.appendChild(this._els.slider),this._els.toolbar.appendChild(this._els.sidebar),this._els.authorInfoElem&&this._els.toolbarWrapper.appendChild(this._els.authorInfoElem),this._els.toolbarWrapper.appendChild(this._els.toolbar)}_createSidebarElem(){this._els.sidebar=(0,i.se)('<div class="poster__sidebar"></div>'),this._els.sendBtnWrapper=(0,i.se)('<div class="poster__send-btn-wrapper"></div>'),this._els.sendBtn=k.FlatButton.render({className:"poster__send-btn addpost_button",appearance:k.FlatButtonAppearance.PRIMARY,size:k.FlatButtonSize.M,children:l.getLang("wall_send")}),this._els.sendBtnWrapper.appendChild(this._els.sendBtn),this._els.postOptionsWrapper=(0,i.se)('<div class="poster__settings-btn-wrapper"></div>'),this._els.sidebar.appendChild(this._els.postOptionsWrapper),(0,a.isFunction)(this._options.onCancelClick)&&(this._els.cancelBtnWrapper=(0,i.se)('<div class="poster__cancel-btn-wrapper _cancel-btn"></div>'),this._els.cancelBtn=k.FlatButton.render({className:"poster__cancel-btn wpe_cancel",appearance:k.FlatButtonAppearance.TERTIARY,size:k.FlatButtonSize.M,children:l.getLang("global_cancel")}),this._els.cancelBtnWrapper.appendChild(this._els.cancelBtn),this._els.sidebar.appendChild(this._els.cancelBtnWrapper)),this._els.sidebar.appendChild(this._els.sendBtnWrapper)}_createSliderElem(){this._els.slider=(0,i.se)('<div class="poster__slider"></div>'),this._els.sliderArrowLeft=(0,i.se)(`<div class="poster__slider-arrow _left">${(0,g.getIcon20ChevronLeftOutline)().icon}</div>`),this._els.sliderBody=(0,i.se)('<div class="poster__slider-body"></div>'),this._els.sliderArrowRight=(0,i.se)(`<div class="poster__slider-arrow _right">${(0,u.getIcon20ChevronRightOutline)().icon}</div>`),this._createPreviews(),this._els.slider.appendChild(this._els.sliderArrowLeft),this._els.slider.appendChild(this._els.sliderBody),this._els.slider.appendChild(this._els.sliderArrowRight)}_createPosterViewElem(){this._els.posterView=(0,i.se)('<div class="poster__view"></div>'),this._els.posterImageContainer=(0,i.se)('<div class="poster__image-wrapper"></div>'),this._els.activeBackgroundElem=(0,i.se)(`<div class="poster__image" style="background-color: #${this._activeBackground.main_color}"></div>`),this._els.changeCategoryBtn=(0,i.se)(`<div class="poster__change-bkg-btn">${this._activeCategory.name}</div>`),this._els.posterImageContainer.appendChild(this._els.activeBackgroundElem),this._els.posterView.appendChild(this._els.changeCategoryBtn),this._createInputMsgElem(),this._els.posterView.appendChild(this._els.inputMsg),this._els.placeholder&&this._els.posterView.appendChild(this._els.placeholder),this._els.prevArrowWrapperBkg=(0,i.se)('\n      <div class="poster__bkg-arrow-wrapper poster__bkg-arrow_left">\n        <div class="poster__bkg-arrow-shadow"></div>\n      </div>'),this._els.prevArrowBkg=(0,i.se)('<div class="poster__bkg-arrow"></div>'),this._els.prevArrowWrapperBkg.appendChild(this._els.prevArrowBkg),this._els.nextArrowWrapperBkg=(0,i.se)('\n      <div class="poster__bkg-arrow-wrapper poster__bkg-arrow_right">\n        <div class="poster__bkg-arrow-shadow"></div>\n      </div>'),this._els.nextArrowBkg=(0,i.se)('<div class="poster__bkg-arrow"></div>'),this._els.nextArrowWrapperBkg.appendChild(this._els.nextArrowBkg),this._els.posterView.appendChild(this._els.prevArrowWrapperBkg),this._els.posterView.appendChild(this._els.nextArrowWrapperBkg);const e=this._activeBackground;let t="#",s="",o="none";this.isCustomBkgId(e.id)&&e.author_link&&(t=e.author_link,s=e.author_name,o="block");const r=`<a href="${t}" class="poster__author-bkg" style="display: ${o};" onmouseover="mentionOver(this, { shift: [0, 10, 10] })" target="_blank">\n                    ${s}\n                  </a>`;this._els.bkgAuthorEl=(0,i.se)(r),this._els.posterView.appendChild(this._els.bkgAuthorEl)}_createInputMsgElem(){this._textSizeIdx=0,this._setTextSettings();const e="#"+this._activeBackground.text_color,t=this._options.prefixId?this._options.prefixId:"";this._els.inputMsg=(0,i.ce)("div",{id:t+"poster-field-msg",className:"poster__input-msg"},{fontSize:this._textSettings[this._textSizeIdx].fontSize,lineHeight:this._textSettings[this._textSizeIdx].lineHeight,color:e}),(0,i.attr)(this._els.inputMsg,"contenteditable",!0),(0,i.attr)(this._els.inputMsg,"role","textbox");const s=this._options.placeholder;s&&(this._els.placeholder=(0,i.se)(`<div class="poster__placeholder" style="color: ${e}">${s}</div>`))}_createAuthorInfoElem(){const e=this._options.authorInfoTemplate;e&&(this._els.authorInfoElem=(0,i.se)(`<div class="poster__author-info">${e}</div>`))}_createLoadingWrapper(){this._els.loadingWrapper=(0,i.se)('<div class="poster__loading-wrapper"></div>')}_createBackgroundElem(e){const t=this._getSizeImgIdx(e),s=(0,i.se)(`<div class="poster__image" style="display: none; background-color: #${e.main_color}"></div>`);return null!=t&&(0,i.setStyle)(s,{backgroundImage:`url(${e.urls.main[t].url})`}),s}_createPreviews(){const e=this._els.sliderBody;Object.keys(this._backgroundsMap).forEach((t=>{const s=this._getPreviewTemplate(t),o=(0,i.se)(s);this._backgroundsMap[t].previewEl=o,e.appendChild(o)})),this._els.activePreviewEl=(0,i.geByClass1)("poster__slider-item_active",e)}_closeTooltip(e){e&&e.tt&&(0,a.isFunction)(e.tt.hide)&&e.tt.hide()}_getPreviewTemplate(e){const t=this._backgroundsMap[e];let s="",i="",o="";var r;s+="emoji"===t.categoryId?" poster__slider-item_emoji":"",s+=this._activeBackground.id===t.id?" poster__slider-item_active":"",this.isCustomBkgId(e)?(s=" poster__slider-item_custom",i=(0,v.getIcon16BrushOutline)().icon):o=` style="background-color: ${"#"+t.main_color}"`;const n=null!=(r=(0,a.clean)(t.background_name))?r:"";return`<div class="poster__slider-item${s}" data-bkg-id="${t.id}"${o} role="button" aria-label="${n}">${i}</div>`}_getFormatString(e){if(null!=e.innerText){let t=e.innerText;return"\n"===t.substr(-1)?t.slice(0,-1):t}const t=window.getSelection();let s=null;t.rangeCount&&(s=t.getRangeAt(0));const i=document.createRange();i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i);const o=t.toString();return t.removeAllRanges(),s&&t.addRange(s),o}_getTextSizeIdx(e){return e>this._config.constants.range_threshold?1:0}_getSizeImgIdx(e){if(!e||!e.urls)return null;const t=this._editorWidth*window.devicePixelRatio;for(let s=0;s<e.urls.main.length;s++){if(e.urls.main[s].width<t)return e.urls.main[s-1]?s-1:s}return e.urls.main.length-1}_focusOnInput(e,t){t=t||this._els.inputMsg,setTimeout((()=>{window.wall.focusOnEnd(t)}),0)}_checkSliderSize(){const e=this._els.sliderBody.scrollWidth,t=this._els.sliderBody.clientWidth,s=this._scrollLeft;if(t===e)return;const o=Math.max(0,e-(t+s));0===s?(0,i.addClass)(this._els.sliderArrowLeft,"poster__slider-arrow_disabled"):(0,i.removeClass)(this._els.sliderArrowLeft,"poster__slider-arrow_disabled"),0===o?(0,i.addClass)(this._els.sliderArrowRight,"poster__slider-arrow_disabled"):(0,i.removeClass)(this._els.sliderArrowRight,"poster__slider-arrow_disabled")}_checkPlaceholder(e){if(!this._els.placeholder)return;const t=()=>{let e=this._els.inputMsg.textContent;e&&o.browser.opera&&e.match(/^[ ]+$/)&&(e=""),e||(e=(0,i.geByTag)("br",this._els.inputMsg).length>1),e?((0,i.hide)(this._els.placeholder),(0,i.setStyle)(this._els.inputMsg,{paddingLeft:32,textAlign:"center"})):((0,i.show)(this._els.placeholder),(0,i.setStyle)(this._els.inputMsg,{paddingLeft:this._els.placeholder.offsetLeft,textAlign:"left"}))};e?t():setTimeout(t,100)}_loadNearBackgrounds(e){setTimeout((()=>{let t=(0,i.domPS)(e),s=(0,i.domNS)(e);t&&(this._loadBackgroundImageByPreview(t),t=(0,i.domPS)(t)),t&&this._loadBackgroundImageByPreview(t),s&&(this._loadBackgroundImageByPreview(s),s=(0,i.domNS)(s)),s&&this._loadBackgroundImageByPreview(s)}),0)}_loadBackgroundImageByPreview(e){const t=(0,i.domData)(e,"bkg-id"),s=this._backgroundsMap[t],o=this._getSizeImgIdx(s);(new Image).src=s.urls.main[o].url}_onChangeText(e){const t=(0,a.isFunction)(this._options.onOverTextLimit);if(e&&"input"!=e.type||!t){if(e&&"keypress"==e.type&&!t){let t=e.which,s=String.fromCharCode(t);13==t&&(s="\n");let i=s+this._getTextFromInput();return!!this.isTextValid(i)||((0,r.cancelEvent)(e),!1)}}else if(!this.isTextFieldValid())return void this._options.onOverTextLimit();this._updateText(),this._onChangeData&&this._onChangeData()}_getTextFromInput(){return this._getFormatString(this._els.inputMsg)}_updateTextSize(){const e=this._getTextFromInput(),t=this._getTextSizeIdx(e.length);t!==this._textSizeIdx&&(this._textSizeIdx=t,(0,i.setStyle)(this._els.inputMsg,{fontSize:this._textSettings[t].fontSize,lineHeight:this._textSettings[t].lineHeight}))}_createPosterErrorView(){this._els.submitErrorView=(0,i.se)('<div class="poster__submit-error"></div>')}_createLoadingWrapper(){this._els.loadingWrapper=(0,i.se)('<div class="poster__loading-wrapper"></div>')}_onPosterViewMouseenter(){(0,i.addClass)(this._els.posterView,"poster__view_hover")}_onNextCategoryBtnClick(){this.nextCategory(),this.sendStatsInfo("select_category")}_onPosterViewMouseout(e){0==e.screenX&&0==e.screenY||(0,i.removeClass)(this._els.posterView,"poster__view_hover")}_initListeners(){this._closePosterBtnClickHandler=this._onCloseBtnClick.bind(this),this._changeCategoryBtnClickHandler=this._onNextCategoryBtnClick.bind(this),this._sliderBodyWheelHandler=this.scrollPreviews.bind(this),this._sliderArrowRightClickHandler=this.scrollPreviews.bind(this,null,151),this._sliderArrowLeftClickHandler=this.scrollPreviews.bind(this,null,-151),this._posterViewClickHandler=this._onPosterViewClick.bind(this),this._sendBtnClickHandler=this._send.bind(this),this._inputMsgInputHandler=this._onChangeText.bind(this),this._hotKeyKeydownHandler=this._hotKeyHandler.bind(this),this._inputMsgPasteHandler=this._onPasteText.bind(this),this._inputMsgMouseHandler=this._checkMouseSelection.bind(this),this._inputMsgKeypressHandler=this._onChangeText.bind(this),(0,a.isFunction)(this._options.onOverTextLimit)||(0,r.addEvent)(this._els.inputMsg,"keypress",this._inputMsgKeypressHandler),this._inputMsgPlaceholderFocus=this._checkPlaceholder.bind(this),this._inputMsgPlaceholderBlur=this._checkPlaceholder.bind(this),this._inputMsgPlaceholderInput=this._checkPlaceholder.bind(this),this._nextBkgBtnClickHandler=vk.rtl?this._prevBkg.bind(this,!1):this._nextBkg.bind(this,!1),this._prevBkgBtnClickHandler=vk.rtl?this._nextBkg.bind(this,!1):this._prevBkg.bind(this,!1),this._posterViewMouseenterHandler=this._onPosterViewMouseenter.bind(this),this._posterViewMouseleaveHandler=this._onPosterViewMouseout.bind(this),this._arrowBkgMouseenterHandler=this._toggleBkgArrowHover.bind(this,!0),this._arrowBkgMouseleaveHandler=this._toggleBkgArrowHover.bind(this,!1),this._sliderClickHandler=this._onPreviewItemClick.bind(this),this._sliderMousedownHandler=this._saveFocus.bind(this);const e=p.showTooltip.bind(this._els.closePosterBtn,this._els.closePosterBtn,{text:l.getLang("wall_poster_close"),black:1,shift:[5,-10]});this._closePosterBtnMouseoverHandler=e,(0,r.addEvent)(this._els.posterView,"mouseenter",this._posterViewMouseenterHandler),(0,r.addEvent)(this._els.posterView,"mouseleave",this._posterViewMouseleaveHandler),(0,r.addEvent)(this._els.nextArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),(0,r.addEvent)(this._els.prevArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),(0,r.addEvent)(this._els.nextArrowWrapperBkg,"mouseleave",this._arrowBkgMouseleaveHandler),(0,r.addEvent)(this._els.prevArrowWrapperBkg,"mouseleave",this._arrowBkgMouseleaveHandler),(0,r.addEvent)(this._els.nextArrowWrapperBkg,"mousedown",this._nextBkgBtnClickHandler),(0,r.addEvent)(this._els.prevArrowWrapperBkg,"mousedown",this._prevBkgBtnClickHandler),(0,r.addEvent)(this._els.closePosterBtn,"click",this._closePosterBtnClickHandler),(0,r.addEvent)(this._els.closePosterBtn,"mouseover",this._closePosterBtnMouseoverHandler),(0,r.addEvent)(this._els.changeCategoryBtn,"mousedown",this._changeCategoryBtnClickHandler),(0,r.addEvent)(this._els.sliderBody,o.browserFeatures.wheelEvent,this._sliderBodyWheelHandler),(0,r.addEvent)(this._els.sliderBody,"click",this._sliderClickHandler),(0,r.addEvent)(this._els.sliderBody,"mousedown",this._sliderMousedownHandler),(0,r.addEvent)(this._els.sliderArrowRight,"click",this._sliderArrowRightClickHandler),(0,r.addEvent)(this._els.sliderArrowLeft,"click",this._sliderArrowLeftClickHandler),(0,r.addEvent)(this._els.posterView,"click",this._posterViewClickHandler),(0,r.addEvent)(this._els.inputMsg,"input",this._inputMsgInputHandler),(0,r.addEvent)(this._els.inputMsg,"keydown",this._hotKeyKeydownHandler),(0,r.addEvent)(this._els.inputMsg,"paste",this._inputMsgPasteHandler),(0,r.addEvent)(this._els.inputMsg,"mousedown mouseup",this._inputMsgMouseHandler),(0,r.addEvent)(this._els.closePosterBtn,"mousedown",this._saveFocus.bind(this)),(0,r.addEvent)(this._els.changeCategoryBtn,"mousedown",this._saveFocus.bind(this)),(0,r.addEvent)(this._els.sliderArrowRight,"mousedown",this._saveFocus.bind(this)),(0,r.addEvent)(this._els.sliderArrowLeft,"mousedown",this._saveFocus.bind(this)),(0,r.addEvent)(this._els.sidebar,"mousedown",this._saveFocus.bind(this)),(0,r.addEvent)(this._els.sendBtn,"click",this._sendBtnClickHandler),this._config.uploadBkgsEnabled&&(0,r.addEvent)(this._els.newBkgBtn,"click",this._openUploader.bind(this)),(0,a.isFunction)(this._options.onCancelClick)&&(0,r.addEvent)(this._els.cancelBtn,"click",this._options.onCancelClick),this._els.placeholder&&((0,r.addEvent)(this._els.inputMsg,"focus",this._inputMsgPlaceholderFocus),(0,r.addEvent)(this._els.inputMsg,"input",this._inputMsgPlaceholderInput),(0,r.addEvent)(this._els.inputMsg,"blur",this._inputMsgPlaceholderBlur))}_removeListeners(){(0,r.removeEvent)(this._els.posterView,"mouseenter",this._posterViewMouseenterHandler),(0,r.removeEvent)(this._els.posterView,"mouseleave",this._posterViewMouseleaveHandler),(0,r.removeEvent)(this._els.nextArrowWrapperBkg,"mousedown",this._nextBkgBtnClickHandler),(0,r.removeEvent)(this._els.prevArrowWrapperBkg,"mousedown",this._prevBkgBtnClickHandler),(0,r.removeEvent)(this._els.nextArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),(0,r.removeEvent)(this._els.prevArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),(0,r.removeEvent)(this._els.nextArrowWrapperBkg,"mouseleave",this._arrowBkgMouseenterHandler),(0,r.removeEvent)(this._els.prevArrowWrapperBkg,"mouseleave",this._arrowBkgMouseleaveHandler),(0,r.removeEvent)(this._els.closePosterBtn,"click",this._closePosterBtnClickHandler),(0,r.removeEvent)(this._els.closePosterBtn,"mouseover",this._closePosterBtnMouseoverHandler),(0,r.removeEvent)(this._els.changeCategoryBtn,"mousedown",this._changeCategoryBtnClickHandler),(0,r.removeEvent)(this._els.sliderBody,"wheel",this._sliderBodyWheelHandler),(0,r.removeEvent)(this._els.sliderBody,"click",this._sliderClickHandler),(0,r.removeEvent)(this._els.sliderBody,"mousedown",this._sliderMousedownHandler),(0,r.removeEvent)(this._els.sliderArrowRight,"click",this._sliderArrowRightClickHandler),(0,r.removeEvent)(this._els.sliderArrowLeft,"click",this._sliderArrowLeftClickHandler),(0,r.removeEvent)(this._els.posterView,"click",this._posterViewClickHandler),(0,r.removeEvent)(this._els.sendBtn,"click",this._sendBtnClickHandler),(0,r.removeEvent)(this._els.inputMsg,"input keydown",this._inputMsgInputHandler),(0,r.removeEvent)(this._els.inputMsg,"paste",this._inputMsgPasteHandler),(0,r.removeEvent)(this._els.inputMsg,"mousedown mouseup",this._inputMsgMouseHandler),(0,a.isFunction)(this._options.onOverTextLimit)||(0,r.removeEvent)(this._els.inputMsg,"keypress",this._inputMsgKeypressHandler),(0,r.removeEvent)(this._els.closePosterBtn,"mousedown",this._saveFocus.bind(this)),(0,r.removeEvent)(this._els.changeCategoryBtn,"mousedown",this._saveFocus.bind(this)),(0,r.removeEvent)(this._els.sliderArrowRight,"mousedown",this._saveFocus.bind(this)),(0,r.removeEvent)(this._els.sliderArrowLeft,"mousedown",this._saveFocus.bind(this)),(0,r.removeEvent)(this._els.sidebar,"mousedown",this._saveFocus.bind(this)),this._config.uploadBkgsEnabled&&(0,r.removeEvent)(this._els.newBkgBtn,"click",this._openUploader.bind(this)),(0,a.isFunction)(this._options.onCancelClick)&&(0,r.removeEvent)(this._els.cancelBtn,"click",this._options.onCancelClick),this._els.placeholder&&((0,r.removeEvent)(this._els.inputMsg,"focus",this._inputMsgPlaceholderFocus),(0,r.removeEvent)(this._els.inputMsg,"input",this._inputMsgPlaceholderInput),(0,r.removeEvent)(this._els.inputMsg,"blur",this._inputMsgPlaceholderBlur))}_openUploader(){this._uploader&&((0,a.isFunction)(this._options.onPreUploaderOpen)&&this._options.onPreUploaderOpen(),this._uploader.show())}_onPosterViewClick(e){e.target==e.currentTarget&&this._focusOnInput()}_checkMouseSelection(e){"mousedown"==e.type?((0,i.setStyle)(this._els.nextArrowWrapperBkg,{pointerEvents:"none"}),(0,i.setStyle)(this._els.prevArrowWrapperBkg,{pointerEvents:"none"})):"mouseup"==e.type&&((0,i.setStyle)(this._els.nextArrowWrapperBkg,{pointerEvents:"auto"}),(0,i.setStyle)(this._els.prevArrowWrapperBkg,{pointerEvents:"auto"}))}_createEditor(){this._createPosterElem(),this._initListeners(),cur.destroy.push(this.destroy.bind(this)),Wall.initComposer(this._els.inputMsg,{lang:{introText:l.getLang("profile_mention_start_typing"),noResult:l.getLang("profile_mention_not_found")},appendTo:this._insertComposer.bind(this),poster:this})}_updateContent(e=!1){const t="#"+this._activeBackground.text_color,s=this._activeCategory.name;this._els.changeCategoryBtn.innerHTML!==s&&(this._els.changeCategoryBtn.innerHTML=s),(0,i.setStyle)(this._els.inputMsg,{color:t}),(0,i.setStyle)(this._els.placeholder,{color:t}),this._onChangeText(),this._autoscrollPreviews(e)}_insertComposer(e){e&&(0,i.domInsertAfter)(e,this._els.posterView)}_loadImgPreviews(){const e=this._els.sliderBody.children,t=/.([a-z-]{3,5})((\?.*)?$)/,s=window.devicePixelRatio;for(let o=0;o<e.length;o++){const r=e[o],n=(0,i.domData)(r,"bkg-id"),l=this._backgroundsMap[n],a=s>1&&l.preview?l.preview.replace(t,"_2x.$1$2"):l.preview,h=l.preview?"background":"backgroundColor";r.style[h]=l.preview?`url('${a}') no-repeat 50% / cover`:"#"+l.main_color}}_onPreviewItemClick(e){if(!(0,i.hasClass)(e.target,"poster__slider-item"))return!1;const t=e.target,s=(0,i.domData)(t,"bkg-id");if(this._activeBackground.id===s)return!1;this.setBkg(s),this.sendStatsInfo("select_bkg"),this._onChangeData&&this._onChangeData()}_onCloseBtnClick(e){this.sendStatsInfo("close"),this.closeEditor(e),(0,r.cancelEvent)(e)}_onPasteText(e){let t=Emoji.getClipboard(e),s=t+this._getTextFromInput();if(!this.isTextValid(s)&&!(0,a.isFunction)(this._options.onOverTextLimit))return(0,r.cancelEvent)(e),!1;t=t.replace(/\n/g,"<br/>");let o=(0,i.ce)("div",{innerHTML:t});Emoji.insertHTML(o.innerHTML),e&&this._onChangeData&&this._onChangeData(),(0,r.cancelEvent)(e)}_hotKeyHandler(e){if(!this.state.opened||this.state.toggled)return!1;e.ctrlKey&&e.keyCode==r.KEY.ENTER&&this._send(),e.ctrlKey||e.keyCode!=r.KEY.ESC||this._onCloseBtnClick(e)}_send(){const e=this._bkgId,t=(0,h.trim)(this._text),s=encodeURIComponent(t),i=this._backgroundsMap[e].access_hash;if(t.length&&!(0,n.isButtonLocked)(this._els.sendBtn)){if(this.lockEditPoster(),this._config.uploadGen){const o=this,r=`${this._config.uploadGen}&bkg_access_hash=${i}&text=${s}&bkg_id=${e}&ajx=1`,n=new XMLHttpRequest,l=1e3*this._config.constants.upload_gen_timeout||4e3;let a=!1;n.open("POST",r,!0);const _=setTimeout((function(){o.sendStatsInfo("upload_timeout"),o._options.onSend({text:t,bkgId:e,accessHash:i}),a=!0,n.abort()}),l);n.onreadystatechange=function(){if(4!=this.readyState||a)return;let s=null,n=(0,d.parseJSON)(this.responseText);var l;200===this.status&&((l=n)&&l.owner_id&&l.id&&l.post_hash)?s=n:o.sendStatsInfo("upload_failed",(0,h.extend)(n||{},{status:this.status,statusText:this.statusText,responseText:n?"":this.responseText,urlUploadFail:r})),o._options.onSend({text:t,bkgId:e,fallbackObj:s,accessHash:i}),clearTimeout(_)},n.send()}else this._options.onSend({text:t,bkgId:e,accessHash:i});return!0}}_setFirstBkgByCategoryIdx(e,t=!1,s=!1){const i=Object.keys(this._categoriesMap)[e],o=this._categoriesMap[i],r=this._customBkg&&0===e?this._customBkg.id:Object.keys(o.bkgs)[0];s?this._setBkgInModel(r):this.setBkg(r,t)}_setBackgroundUrl(e,t){const s=this._getSizeImgIdx(t);null!=s&&(0,i.setStyle)(e,{backgroundImage:`url(${this._activeBackground.urls.main[s].url})`})}_setTextSettings(){this._textSettings=[{fontSize:Math.round(this._config.constants.font_size_ratio_range_1*this._editorWidth)+"px",lineHeight:Math.round(this._config.constants.line_height_ratio_range_1*this._editorWidth)+"px"},{fontSize:Math.round(this._config.constants.font_size_ratio_range_2*this._editorWidth)+"px",lineHeight:Math.round(this._config.constants.line_height_ratio_range_2*this._editorWidth)+"px"}]}_saveFocus(){const e=(0,i.geByClass1)("post_action_btn_layout",this._els.postAvailableBtn),t=(0,i.geByClass1)("post_action_btn_layout",this._els.postponeBtn);if(e){(0,i.data)(e,"ett").hide()}if(t){(0,i.data)(t,"ett").hide()}return!1}_updateText(){this._text=this._getTextFromInput(),this._checkPlaceholder(),this._updateTextSize()}_toggleBkgArrowHover(e,t){if(0==t.screenX&&0==t.screenY)return;const s=t.currentTarget;(0,i.hasClass)(s,"poster__bkg-arrow_right")?((0,i.toggleClass)(this._els.nextArrowWrapperBkg,"poster__bkg-arrow_hovered",e),(0,i.toggleClass)(this._els.prevArrowWrapperBkg,"poster__bkg-arrow_faded",e)):(0,i.hasClass)(s,"poster__bkg-arrow_left")&&((0,i.toggleClass)(this._els.prevArrowWrapperBkg,"poster__bkg-arrow_hovered",e),(0,i.toggleClass)(this._els.nextArrowWrapperBkg,"poster__bkg-arrow_faded",e))}_toggleBkgAuthorEl(e=!0,t=!1,s=!1){e?t?(0,i.show)(this._els.bkgAuthorEl):(0,_.fadeIn)(this._els.bkgAuthorEl,250,(()=>{(0,a.isFunction)(s)&&s()})):t?(0,i.hide)(this._els.bkgAuthorEl):(0,_.fadeOut)(this._els.bkgAuthorEl,250,(()=>{(0,a.isFunction)(s)&&s()}))}changeBkgAuthor(e,t=!1){if(!e.authorUrl||!e.authorName)return;if(!this._customBkg)return;this._activeBackground!==this._customBkg&&(t=!0);const s=()=>{this._els.bkgAuthorEl.href=e.authorUrl,this._els.bkgAuthorEl.innerHTML=l.getLang("wall_poster_author_custom_bkg").replace("{author_name}",e.authorName),(0,i.attr)(this._els.bkgAuthorEl,"mention_id",e.authorUrl.substr(1)),t||this._toggleBkgAuthorEl(),this._els.bkgAuthorEl.tt&&(0,a.isFunction)(this._els.bkgAuthorEl.tt.destroy)&&this._els.bkgAuthorEl.tt.destroy()};t?s():this._toggleBkgAuthorEl(!1,!1,s),this._customBkg.author_link=e.authorUrl,this._customBkg.author_name=e.authorName,this._onChangeData&&this._onChangeData()}_prepareConfiguration(e){e.forEach((e=>{const t={};e.bkgs.forEach((s=>{t[s.id]=s,t[s.id].categoryId=e.id,this.isCustomBkgId(s.id)&&(this._customBkg=s)})),this._categoriesMap[e.id]=e,this._categoriesMap[e.id].bkgs=t,Object.assign(this._backgroundsMap,t)}))}constructor(e,t){this.state={disabled:!1,opened:!1,toggled:!1},this._flags={isFirstLaunch:!0},this._els={},this._backgroundsMap={},this._categoriesMap={},this._config={constants:e.constants,eventHash:e.events_hash,uploadGen:e.upload_gen,uploadBkgsEnabled:e.custom_enabled,customLayerPlaceholder:e.custom_layer_placeholder},this._options={containerClasses:""},Object.assign(this._options,t),this._prepareConfiguration(e.categories.slice()),this._config.uploadBkgsEnabled&&(this._uploader=new c.default({onSubmit:this._onCustomBkgAdded.bind(this),onHide:this._onUploaderClose.bind(this),getExampleText:this.getTextAsHtml.bind(this),getPostOwnerId:this._options.getPostOwnerId,placeholder:this._config.customLayerPlaceholder})),this._editorWidth=t.width,this._onChangeData=this._options.onChangeData,this._setFirstBkgByCategoryIdx(0,!0,!0),this._createEditor()}}},47434:(e,t,s)=>{s.d(t,{default:()=>c});var i=s(514986),o=s(29271),r=s(265865),n=s(82161),l=s(795558),a=s(953908),h=s(893106),d=s(725296),_=s(664988);const p="*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;";class c{show(){let e={oid:this._getPostOwnerId(),act:"upload_bkg_box"},t={containerClass:"poster-uploader",params:{hideButtons:!0,width:655,onDestroy:this._onLayerDestroy.bind(this)},onDone:this._onShowBoxDone.bind(this)};this.box=(0,i.showBox)("al_poster.php",e,t)}hide(){this.box.hide()}_init(e,t){e.isVisible()&&(this._initElements(e.bodyNode),this._initListeners(),this._initUpload(t),this._initDragAndDrop())}_initElements(e){this._els={},this._els.dropBox=(0,l.geByClass1)("poster-uploader__drop-box",e),this._els.dropArrowBtn=(0,l.geByClass1)("poster-uploader__arrow-btn",e),this._els.dropWrapper=(0,l.geByClass1)("poster-uploader__drop-area",e),this._els.editWrapper=(0,l.geByClass1)("poster-uploader__background-edit",e),this._els.closeBtn=(0,l.ge)("poster-uploader-close-btn"),this._els.uploadInput=(0,l.ge)("poster-uploader-file-input"),this._els.uploadMainInput=(0,l.ge)("poster-uploader-main-file-input"),this._els.status=(0,l.ge)("poster-uploader-status"),this._els.posterView=(0,l.geByClass1)("poster__image",e),this._els.posterTextEl=(0,l.geByClass1)("poster__text",e),this._els.overlay=(0,l.geByClass1)("poster-uploader__overlay",e),this._els.pickerItem=(0,l.geByClass1)("poster-color-ctrl__picker",e),this._els.pickerInput=(0,l.ge)("poster-color-picker"),this._els.pickerTextInput=(0,l.ge)("poster-color-input"),this._els.pickerTextInputWrapper=(0,l.geByClass1)("poster-color-ctrl__color-input-wrapper",e),this._els.gallery=(0,l.geByClass1)("poster-color-ctrl__gallery",e),this._els.saveBtn=(0,l.geByClass1)("poster-uploader__save",e),this._els.cancelBtn=(0,l.geByClass1)("poster-uploader__cancel",e),this._isColorPickerSupport()||((0,l.re)(this._els.pickerItem),(0,l.show)(this._els.pickerTextInputWrapper)),this._swipeColorItem(this._els.gallery.firstElementChild),this._updateText()}_initListeners(){this._handlersForDestroy=[];const e=()=>{this.hide()},t=()=>{this._els.uploadInput.click()},s=this._submit.bind(this),i=e=>{const t=e.target.files;this._uploadToModel(t)},o=this._onColorItemClick.bind(this);if((0,a.addEvent)(this._els.uploadInput,"change",i),(0,a.addEvent)(this._els.saveBtn,"click",s),(0,a.addEvent)(this._els.closeBtn,"click",e),(0,a.addEvent)(this._els.cancelBtn,"click",(()=>{(0,l.hide)(this._els.editWrapper),(0,l.show)(this._els.dropWrapper),this._files=null,this._els.pickerInput.value="",this._els.pickerTextInput.value="",this._els.uploadInput.value=null,this._swipeColorItem(this._els.gallery.firstElementChild)})),(0,a.addEvent)(this._els.dropBox,"click",t),(0,a.addEvent)(this._els.dropArrowBtn,"click",t),(0,a.addEvent)(this._els.gallery,"click",o),this._handlersForDestroy.push((()=>{(0,a.removeEvent)(this._els.dropArrowBtn,"click",t),(0,a.removeEvent)(this._els.gallery,"click",o),(0,a.removeEvent)(this._els.uploadInput,"change",i),(0,a.removeEvent)(this._els.closeBtn,"click",e),(0,a.removeEvent)(this._els.dropBox,"click",t)})),this._isColorPickerSupport()){const e=()=>{this._swipeColorItem(this._els.pickerItem,this._els.pickerInput.value),this._els.pickerItem.style.backgroundColor=this._els.pickerInput.value},t=()=>{this._els.pickerInput.click()};(0,a.addEvent)(this._els.pickerInput,"input",e),(0,a.addEvent)(this._els.pickerItem,"click",t),this._handlersForDestroy.push((()=>{(0,a.removeEvent)(this._els.pickerInput,"input",e),(0,a.removeEvent)(this._els.pickerItem,"click",t)}))}else{const e=e=>{if(s(e))return;const t=String.fromCharCode(e.keyCode);function s(e){return e.keyCode===a.KEY.DEL||e.keyCode===a.KEY.UP||e.keyCode===a.KEY.RIGHT||e.keyCode===a.KEY.LEFT||e.keyCode===a.KEY.DOWN||46===e.keyCode||e.ctrlKey||e.metaKey}(s(e)||/^[a-f0-9]$/i.test(t))&&(this._els.pickerInput.focus(),document.execCommand("insertText",!1,t)),(0,a.cancelEvent)(e)},t=()=>{let e="#"+this._els.pickerTextInput.value.toUpperCase();/^#([0-9a-f]{3}){1,2}$/i.test(e)&&this._swipeColorItem(this._els.pickerTextInput,e),"#"===e&&this._swipeColorItem(this._els.pickerTextInput,"#fff")},s=e=>{let t=(0,n.trim)(e.clipboardData.getData("Text")).toUpperCase();"#"===t[0]&&(t=t.slice(1)),/^[a-f0-9]{1,6}$/i.test(t)&&document.execCommand("insertText",!1,t),(0,a.cancelEvent)(e)};(0,a.addEvent)(this._els.pickerTextInput,"paste",s),(0,a.addEvent)(this._els.pickerTextInput,"keydown",e),(0,a.addEvent)(this._els.pickerTextInput,"input",t),this._handlersForDestroy.push((()=>{(0,a.removeEvent)(this._els.pickerTextInput,"paste",s),(0,a.removeEvent)(this._els.pickerTextInput,"keydown",e),(0,a.removeEvent)(this._els.pickerTextInput,"input",t)}))}}_initCallbacks(e){(0,_.isFunction)(e.onHide)&&(this._onHideCallback=e.onHide),(0,_.isFunction)(e.getExampleText)&&(this._getExampleText=e.getExampleText),(0,_.isFunction)(e.getPostOwnerId)?this._getPostOwnerId=e.getPostOwnerId:this._getPostOwnerId=()=>cur.oid}_updateColor(e){const t=(0,h.getRGB)(e);function s(e){const t=e.toString(16);return 1===t.length?"0"+t:t}this._textColor=function(e,t,i){return"#"+s(e)+s(t)+s(i)}(...t),this._els.posterTextEl.style.color=this._textColor,this._isColorPickerSupport()&&(this._els.pickerInput.value=this._textColor)}_initUpload(e){const t=this._getUploadParams(e);this._files=null,this._minImageSizesArr=e.min_image_sizes,this.uploadId=Upload.init(this._els.uploadMainInput,e.url,{},t)}_uploadToBackend(){Upload.onFileApiSend(this.uploadId,this._files)}_uploadToModel(e){if(!e.length)return;if(e.length>1)return void(0,i.showFastBox)(o.getLang("global_error"),o.getLang("wall_poster_upload_wrong_number_image"));if(!this._isFileTypeValid(e[0].name))return void(0,i.showFastBox)(o.getLang("global_error"),o.getLang("wall_poster_upload_wrong_type_file"));const t=e[0],s=new FileReader,r=this;s.onload=function(){r._checkImageSizes(s.result,(()=>{r._files=e,r._els.posterView.style.backgroundImage=`url("${s.result}")`,(0,l.hide)(r._els.dropWrapper),(0,l.show)(r._els.editWrapper)}),(()=>{(0,i.showFastBox)(o.getLang("global_error"),o.getLang("wall_poster_upload_wrong_image_size"))}))},s.readAsDataURL(t)}_checkImageSizes(e,t,s){const i=new Image,o=this;i.onload=function(){this.width<o._minImageSizesArr[0]||this.height<o._minImageSizesArr[1]?s():t()},i.src=e}_submit(){this._uploadToBackend()}_swipeColorItem(e,t=e.style.backgroundColor){(0,l.removeClass)(this._els.activeColorItem,"_active"),this._els.activeColorItem=e,(0,l.addClass)(e,"_active"),this._updateColor(t)}_isColorPickerSupport(){if(null!=this._pickerSupport)return this._pickerSupport;const e=document.createElement("input");return e.type="color",e.value="<!>",this._pickerSupport="color"===e.type&&"<!>"!==e.value}_onShowBoxDone(e,t){this._init(e,t)}_getUploadParams(e){return{file_name:"photo",file_size_limit:26214400,file_types:p,file_types_description:"Image files (*.jpg, *.jpeg, *.png)",clear:1,type:"photo",max_attempts:3,signed:1,static_url:e.static_url,check_url:e.check_url,base_url:e.base_url,buttonClass:"poster-uploader__select-file",lang:e.lang,onUploadStart:this._onUploadStart.bind(this),onUploadComplete:this._onUploadComplete.bind(this)}}_onUploadStart(){this._lockUploader()}_onUploadComplete(e,t,s){const n=()=>{(0,i.showFastBox)(o.getLang("global_error"),o.getLang("wall_poster_upload_unknown_error")),this._unlockUploader()};try{const e=(0,r.parseJSON)(t);if(this._resultBkg={main_color:e.main_color},e&&e.error)return void n()}catch(e){return void n()}this._sendParams(t,(e=>{this._resultBkg=e,this._onSubmitCallback(this._resultBkg),this._unlockUploader(),this.hide()}),n)}_onColorItemClick(e){const t=e.target;(0,l.hasClass)(t,"poster-color-ctrl__gallery-item")&&t!==this._els.pickerItem&&(this._els.pickerItem.style.backgroundColor="",this._swipeColorItem(t))}_sendParams(e,t,s){ajax.post("al_poster.php",{act:"add_custom_bkg",_query:e,text_color:this._textColor.slice(1)},{onDone:t,onFail:s})}_updateText(){let e=this._getExampleText&&this._getExampleText();this._els.posterTextEl.innerHTML=e||this._placeholderText}_lockUploader(){(0,d.lockButton)(this._els.saveBtn),(0,l.show)(this._els.overlay)}_unlockUploader(){(0,d.unlockButton)(this._els.saveBtn),(0,l.hide)(this._els.overlay)}_initDragAndDrop(){const e=this._onDragEnter.bind(this),t=this._onDragLeave.bind(this),s=this._onDrop.bind(this);function i(e){e.preventDefault(),e.stopPropagation()}["dragenter","dragover","dragleave","drop"].forEach((e=>{this._els.dropBox.addEventListener(e,i)})),["dragenter","dragover"].forEach((t=>{(0,a.addEvent)(this._els.dropBox,t,e)})),["dragleave","drop"].forEach((e=>{(0,a.addEvent)(this._els.dropBox,e,t)})),(0,a.addEvent)(this._els.dropBox,"drop",s),this._handlersForDestroy.push((()=>{["dragenter","dragover","dragleave","drop"].forEach((e=>{this._els.dropBox.removeEventListener(e,i)})),["dragenter","dragover"].forEach((t=>{this._els.dropBox.removeEventListener(t,e)})),["dragleave","drop"].forEach((e=>{this._els.dropBox.removeEventListener(e,t)})),(0,a.removeEvent)(this._els.dropBox,"drop",s)}))}_onDragEnter(e){this._dragAndDropTimeoutId&&(clearTimeout(this._dragAndDropTimeoutId),(0,a.cancelEvent)(e)),this._dragAndDropTimeoutId=setTimeout((()=>{(0,l.addClass)(this._els.dropBox,"dropbox_over")}))}_onDragLeave(e){this._dragAndDropTimeoutId&&(clearTimeout(this._dragAndDropTimeoutId),(0,a.cancelEvent)(e)),this._dragAndDropTimeoutId=setTimeout((()=>{(0,l.removeClass)(this._els.dropBox,"dropbox_over")}),100)}_onDrop(e){const t=e.dataTransfer.files;this._uploadToModel(t)}_onLayerDestroy(){this._onHideCallback(),this.destroy()}_isFileTypeValid(e){return!!e&&p.split(";").some((t=>(t=t.slice(1),e.substr(-t.length).toLowerCase()===t)))}destroy(){let e=null,t=this._handlersForDestroy||[];for(;e=t.pop();)e();Upload.deinit(this.uploadId)}constructor(e){this._onSubmitCallback=e.onSubmit,this._placeholderText=e.placeholder,this._initCallbacks(e)}}}},s={};function i(e){var o=s[e];if(void 0!==o)return o.exports;var r=s[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,s,o,r)=>{if(!s){var n=1/0;for(d=0;d<e.length;d++){for(var[s,o,r]=e[d],l=!0,a=0;a<s.length;a++)(!1&r||n>=r)&&Object.keys(i.O).every((e=>i.O[e](s[a])))?s.splice(a--,1):(l=!1,r<n&&(n=r));if(l){e.splice(d--,1);var h=o();void 0!==h&&(t=h)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,o,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.e=()=>Promise.resolve(),i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/dist/",(()=>{var e={66623:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var o,r,[n,l,a]=s,h=0;if(n.some((t=>0!==e[t]))){for(o in l)i.o(l,o)&&(i.m[o]=l[o]);if(a)var d=a(i)}for(t&&t(s);h<n.length;h++)r=n[h],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(d)},s=self.webpackChunkvk=self.webpackChunkvk||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var o=i.O(void 0,[75514,68592],(()=>i(991251)));o=i.O(o)})();