"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[62182],{737169:(e,t,s)=>{s.d(t,{Icon12Cancel:()=>n});var n=(0,s(426435).makeIcon)("Icon12Cancel","cancel_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12" id="cancel_12"><path fill="currentColor" d="M3.525 2.464a.75.75 0 0 0-1.06 1.061L4.938 6 2.464 8.475a.75.75 0 1 0 1.061 1.06L6 7.062l2.475 2.475a.75.75 0 0 0 1.06-1.061L7.062 6l2.475-2.475a.75.75 0 1 0-1.061-1.06L6 4.938z" /></symbol>',12,12,!1,void 0)},769777:(e,t,s)=>{s.d(t,{Icon12Favorite:()=>n});var n=(0,s(426435).makeIcon)("Icon12Favorite","favorite_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="favorite_12"><path d="m4.559 2.876-.277.653a.337.337 0 0 1-.044.086.15.15 0 0 1-.048.037.322.322 0 0 1-.093.02l-.403.059c-1.136.163-1.703.245-1.942.516a1.015 1.015 0 0 0-.233.866c.07.357.518.723 1.412 1.454l.153.124c.04.033.06.05.074.07.011.02.019.04.022.062a.344.344 0 0 1-.011.103l-.046.245c-.25 1.347-.375 2.02-.178 2.35.17.285.47.465.796.479.378.016.895-.423 1.93-1.3l.177-.15a.351.351 0 0 1 .111-.077.146.146 0 0 1 .082 0c.03.008.057.031.111.077l.178.15c1.034.877 1.55 1.316 1.929 1.3a.979.979 0 0 0 .796-.479c.197-.33.072-1.003-.178-2.35l-.046-.245a.344.344 0 0 1-.01-.103.154.154 0 0 1 .021-.061.339.339 0 0 1 .074-.07l.153-.125c.894-.731 1.342-1.097 1.412-1.454.06-.31-.025-.631-.233-.866-.239-.27-.806-.353-1.942-.516l-.403-.058c-.048-.007-.072-.01-.093-.02a.15.15 0 0 1-.048-.038c-.015-.018-.024-.04-.044-.086l-.277-.653c-.455-1.071-.682-1.607-1-1.77a.965.965 0 0 0-.881 0c-.319.163-.546.699-1.001 1.77Z" /></symbol>',12,12,!1,void 0)},480266:(e,t,s)=>{s.d(t,{Icon12OnlineMobile:()=>n});var n=(0,s(426435).makeIcon)("Icon12OnlineMobile","online_mobile_12","0 0 8 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 8 12" id="online_mobile_12"><path fill="currentColor" d="M5.99 0C7.1 0 8 .9 8 2.01v7.98C8 11.1 7.1 12 5.99 12H2.01C.9 12 0 11.1 0 9.99V2.01C0 .9.9 0 2.01 0h3.98Zm.007 3H2.004a.502.502 0 0 0-.503.502v4.995c0 .278.225.503.503.503h3.995a.502.502 0 0 0 .502-.502V3.503A.502.502 0 0 0 5.997 3Z" /></symbol>',8,12,!1,void 0)},676126:(e,t,s)=>{s.d(t,{Icon16Cancel:()=>n});var n=(0,s(426435).makeIcon)("Icon16Cancel","cancel_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="cancel_16"><path fill="currentColor" d="M12.736 3.264a.9.9 0 0 1 0 1.272L9.273 8l3.463 3.464a.9.9 0 0 1 .081 1.18l-.08.092a.9.9 0 0 1-1.273 0L8 9.273l-3.464 3.463a.9.9 0 0 1-1.272-1.272L6.727 8 3.264 4.536a.9.9 0 0 1-.08-1.18l.08-.092a.9.9 0 0 1 1.272 0L8 6.727l3.464-3.463a.9.9 0 0 1 1.272 0Z" /></symbol>',16,16,!1,void 0)},453165:(e,t,s)=>{s.d(t,{Icon16Done:()=>n});var n=(0,s(426435).makeIcon)("Icon16Done","done_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="done_16"><path fill="currentColor" d="M13.743 3.756a.872.872 0 0 1 0 1.237l-7.317 7.25a.88.88 0 0 1-1.242 0L2.257 9.366a.872.872 0 0 1 0-1.237.88.88 0 0 1 1.242 0l2.306 2.261L12.5 3.756a.88.88 0 0 1 1.242 0Z" /></symbol>',16,16,!1,void 0)},984172:(e,t,s)=>{s.d(t,{Icon16Education:()=>n});var n=(0,s(426435).makeIcon)("Icon16Education","education_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="education_16"><path fill="currentColor" d="M14.495 5.078 8.467 1.625a.936.936 0 0 0-.934 0L1.505 5.078a.995.995 0 0 0-.385.402c-.258.492-.086 1.11.385 1.38l.995.567 5.002 2.874a1 1 0 0 0 .996 0l4.168-2.395 1.167-.668v2.996c0 .337.261.61.583.61a.597.597 0 0 0 .584-.61V5.968c0-.358-.183-.705-.505-.89Z" /><path fill="currentColor" d="M12.666 9.385 8.48 11.666a1 1 0 0 1-.958 0L3.333 9.382v1.055C3.334 12.713 5.447 14.5 8 14.5s4.667-1.787 4.667-4.063V9.385Z" /></symbol>',16,16,!1,void 0)},205922:(e,t,s)=>{s.d(t,{Icon16Ghost:()=>n});var n=(0,s(426435).makeIcon)("Icon16Ghost","ghost_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="ghost_16"><path fill-rule="evenodd" d="M8 1a6.5 6.5 0 0 0-6.5 6.5v4.881c0 .407.095.809.277 1.172a1.498 1.498 0 0 0 2.11.615l.35-.21a1.406 1.406 0 0 1 1.504.036l.857.571.03.02a2.5 2.5 0 0 0 2.745 0l.03-.02.856-.571a1.406 1.406 0 0 1 1.504-.036l.35.21c.748.449 1.72.166 2.11-.615a2.62 2.62 0 0 0 .277-1.172V7.5A6.5 6.5 0 0 0 8 1Zm-1.091 9.121a.75.75 0 0 0-.818 1.258c.601.39 1.243.618 1.916.619.675 0 1.315-.225 1.911-.625a.75.75 0 1 0-.836-1.246c-.397.267-.75.371-1.072.37-.325 0-.687-.107-1.101-.376ZM5.5 8.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm6-1a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0)},351506:(e,t,s)=>{s.d(t,{Icon16LogoVk:()=>n});var n=(0,s(426435).makeIcon)("Icon16LogoVk","logo_vk_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_vk_16"><path fill="currentColor" fill-rule="evenodd" d="M2.844 2.844C2 3.687 2 5.044 2 7.76v.48c0 2.715 0 4.073.844 4.916.843.844 2.2.844 4.916.844h.48c2.715 0 4.073 0 4.916-.844.844-.843.844-2.2.844-4.916v-.48c0-2.715 0-4.073-.844-4.916C12.313 2 10.956 2 8.24 2h-.48c-2.715 0-4.073 0-4.916.844ZM4 5.65c.065 3.123 1.624 5 4.357 5h.155V8.863c1.005.1 1.764.836 2.069 1.787H12c-.39-1.421-1.414-2.207-2.054-2.507.64-.37 1.54-1.272 1.754-2.493h-1.29c-.279.991-1.108 1.892-1.898 1.977V5.65H7.223v3.463c-.8-.2-1.809-1.17-1.854-3.463H4Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0)},920392:(e,t,s)=>{s.d(t,{Icon16MessageCross:()=>n});var n=(0,s(426435).makeIcon)("Icon16MessageCross","message_cross_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="message_cross_16"><path fill-rule="evenodd" d="M14.5 7.766C14.5 4.582 11.59 2 8 2S1.5 4.582 1.5 7.766c0 1.554.693 2.964 1.82 4-.11.646-.44 1.493-.994 2.54l-.126.235a.313.313 0 0 0 .117.42.294.294 0 0 0 .22.03c1.723-.443 2.954-1.002 3.692-1.675A7.28 7.28 0 0 0 8 13.531c3.59 0 6.5-2.581 6.5-5.766ZM5.721 5.372a.75.75 0 0 1 1.06 0L8 6.59l1.218-1.218a.75.75 0 0 1 1.06 1.06l-1.217 1.22 1.218 1.217a.75.75 0 0 1-1.06 1.061L8 8.712 6.782 9.93a.75.75 0 1 1-1.06-1.06l1.216-1.22-1.217-1.217a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0)},768770:(e,t,s)=>{s.d(t,{Icon16Muted:()=>n});var n=(0,s(426435).makeIcon)("Icon16Muted","muted_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="muted_16"><path d="m4.69 5.496 6.31 6.31v1.702c0 .284-.225.464-.488.488l-3.635-3.489-2.88-.008A1 1 0 0 1 3 9.5V6.497a1 1 0 0 1 1-1l.69-.001Zm.774-2.846 2.191 2.19 2.857-2.344c.263.023.488.204.488.488v5.201l2.596 2.596a.75.75 0 0 1-1.06 1.061L4.404 3.71a.75.75 0 0 1 1.06-1.06Z" /></symbol>',16,16,!1,void 0)},583841:(e,t,s)=>{s.d(t,{Icon16Verified:()=>n});var n=(0,s(426435).makeIcon)("Icon16Verified","verified_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="verified_16"><path fill="currentColor" d="M4.5 9.586 2.957 8.043a1 1 0 0 0-1.414 1.414l2.25 2.25a1 1 0 0 0 1.414 0l5.25-5.25a1 1 0 0 0-1.414-1.414L4.5 9.586Z" /></symbol>',16,16,!1,void 0)},822350:(e,t,s)=>{s.d(t,{Icon20Cancel:()=>n});var n=(0,s(426435).makeIcon)("Icon20Cancel","cancel_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="cancel_20"><path fill="currentColor" fill-rule="evenodd" d="M4.72 4.72a.75.75 0 0 1 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},970748:(e,t,s)=>{s.d(t,{Icon20CheckCircleOff:()=>n});var n=(0,s(426435).makeIcon)("Icon20CheckCircleOff","check_circle_off_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" viewBox="0 0 20 20" id="check_circle_off_20"><defs><path id="check_circle_off_20_a" fill="currentColor" fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm0-1a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z" clip-rule="evenodd" /></defs><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /><use xlink:href="#check_circle_off_20_a" fill-rule="evenodd" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},976004:(e,t,s)=>{s.d(t,{Icon20CheckCircleOn:()=>n});var n=(0,s(426435).makeIcon)("Icon20CheckCircleOn","check_circle_on_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="check_circle_on_20"><path fill-rule="evenodd" d="M10 20c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Zm5.35-12.72a.75.75 0 1 0-1.062-1.06l-5.955 5.968L5.81 9.66a.75.75 0 1 0-1.062 1.06l3.054 3.06a.75.75 0 0 0 1.062 0l6.486-6.5Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},247847:(e,t,s)=>{s.d(t,{Icon20EducationOutline:()=>n});var n=(0,s(426435).makeIcon)("Icon20EducationOutline","education_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" id="education_outline_20"><g fill="none" fill-rule="evenodd"><path d="M0 0h20v20H0z" /><path fill="currentColor" fill-rule="nonzero" d="m17.5 9.063-1.5.822V13c0 2.8-2.717 5-6 5s-6-2.2-6-5V9.885L1.649 8.596a1.25 1.25 0 0 1 0-2.192l7.75-4.25a1.25 1.25 0 0 1 1.202 0l7.75 4.25c.424.232.66.674.649 1.125v5.221a.75.75 0 1 1-1.5 0V9.063Zm-3 1.645-3.899 2.138a1.25 1.25 0 0 1-1.202 0L5.5 10.708V13c0 1.894 1.984 3.5 4.5 3.5s4.5-1.606 4.5-3.5v-2.292ZM10 3.535 2.77 7.5 10 11.465 17.23 7.5 10 3.535Z" /></g></symbol>',20,20,!1,void 0)},257797:(e,t,s)=>{s.d(t,{Icon20GlobeCrossOutline:()=>n});var n=(0,s(426435).makeIcon)("Icon20GlobeCrossOutline","globe_cross_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="globe_cross_outline_20"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M8.219 7.999h4.191a.75.75 0 0 0 .7-1.02 19.061 19.061 0 0 0-1.653-3.827 7.013 7.013 0 0 1 5.08 4.339l.01.024a.75.75 0 1 0 1.401-.533l-.01-.03A8.5 8.5 0 1 0 6.973 17.945a.75.75 0 0 0 .533-1.4 7.023 7.023 0 0 1-3.57-3.043H6.86a.75.75 0 1 0 0-1.5H3.29A7 7 0 0 1 3 10c0-.696.101-1.367.29-2.001h3.401a12.457 12.457 0 0 0-.182 1.623l-.003.059a.884.884 0 0 0 .002.106.75.75 0 1 0 1.498-.078l.001-.018c.027-.584.101-1.15.212-1.692zm.361-4.855a7.01 7.01 0 0 0-4.643 3.355h3.116c.39-1.281.942-2.414 1.527-3.355zm1.443.528a17.78 17.78 0 0 1 1.344 2.827H8.63c.375-1.084.876-2.04 1.393-2.827z" /><path d="M14.002 19a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm2.524-6.47a.75.75 0 1 0-1.061-1.06l-1.466 1.468-1.469-1.468a.75.75 0 1 0-1.06 1.06L12.938 14l-1.469 1.47a.75.75 0 1 0 1.062 1.06l1.468-1.47 1.47 1.47a.75.75 0 1 0 1.061-1.06l-1.47-1.471z" /></g></symbol>',20,20,!1,void 0)},116438:(e,t,s)=>{s.d(t,{Icon20Search:()=>n});var n=(0,s(426435).makeIcon)("Icon20Search","search_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="search_20"><path fill="currentColor" fill-rule="evenodd" d="M9.5 4.5a5 5 0 1 0 0 10 5 5 0 0 0 0-10zM3 9.5a6.5 6.5 0 1 1 11.596 4.035l3.184 3.185a.75.75 0 1 1-1.06 1.06l-3.185-3.184A6.5 6.5 0 0 1 3 9.5z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},249826:(e,t,s)=>{s.d(t,{Icon20Stars:()=>n});var n=(0,s(426435).makeIcon)("Icon20Stars","stars_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="stars_20"><path fill-rule="evenodd" d="M12.004 8.13c-.368.835-.857 1.717-1.507 2.367-.65.65-1.532 1.14-2.367 1.507.835.367 1.717.857 2.367 1.507.65.65 1.14 1.532 1.507 2.367.367-.835.857-1.717 1.507-2.367.65-.65 1.532-1.14 2.367-1.507-.835-.368-1.717-.857-2.367-1.507-.65-.65-1.14-1.532-1.507-2.367Zm-.785-2.178c-.421 1.317-1.014 2.716-1.782 3.485-.769.768-2.168 1.36-3.485 1.782a21.073 21.073 0 0 1-1.162.338c-.38.1-.38.793 0 .894a27.146 27.146 0 0 1 .912.26c.083.025.166.05.25.078 1.317.421 2.716 1.014 3.485 1.782.768.768 1.36 2.168 1.782 3.485a20.843 20.843 0 0 1 .27.907l.068.255c.1.38.793.38.894 0a27.487 27.487 0 0 1 .26-.912c.025-.083.05-.166.078-.25.421-1.317 1.014-2.717 1.782-3.485.768-.768 2.168-1.36 3.485-1.782a20.843 20.843 0 0 1 .907-.27l.255-.068c.38-.1.38-.793 0-.894a27.487 27.487 0 0 1-.912-.26 20.843 20.843 0 0 1-.25-.078c-1.317-.421-2.717-1.014-3.485-1.782-.768-.769-1.36-2.168-1.782-3.485a21.13 21.13 0 0 1-.338-1.162c-.1-.38-.793-.38-.894 0a27.146 27.146 0 0 1-.26.912 21.13 21.13 0 0 1-.078.25ZM4.365.763a.385.385 0 0 0-.73 0l-.414 1.24a1.926 1.926 0 0 1-1.218 1.218l-1.24.414a.385.385 0 0 0 0 .73l1.24.414a1.926 1.926 0 0 1 1.218 1.218l.414 1.24a.385.385 0 0 0 .73 0l.414-1.24a1.926 1.926 0 0 1 1.218-1.218l1.24-.414a.385.385 0 0 0 0-.73l-1.24-.414a1.926 1.926 0 0 1-1.218-1.218L4.365.763Z" /></symbol>',20,20,!1,void 0)},952077:(e,t,s)=>{s.d(t,{Icon20WriteOutline:()=>n});var n=(0,s(426435).makeIcon)("Icon20WriteOutline","write_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="write_outline_20"><path fill="currentColor" fill-rule="evenodd" d="M13.076 2.649A2.215 2.215 0 0 1 14.645 2c.566 0 1.135.216 1.568.649l1.137 1.136a2.21 2.21 0 0 1 0 3.133l-.941.94-9.17 9.179a3.296 3.296 0 0 1-2.33.963H3a1 1 0 0 1-1-1v-1.893a3.288 3.288 0 0 1 .965-2.34l8.123-8.132 1.988-1.986zm2.286 4.135.927-.926a.711.711 0 0 0 0-1.013l-1.137-1.136a.713.713 0 0 0-.507-.21.713.713 0 0 0-.507.21l-.927.926 2.15 2.149zM12.135 5.71l-8.109 8.118a1.79 1.79 0 0 0-.525 1.266V16.2a.3.3 0 0 0 .3.3H4.91c.475 0 .931-.189 1.267-.525l8.11-8.118-2.152-2.148z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},841344:(e,t,s)=>{s.d(t,{Icon24Back:()=>n});var n=(0,s(426435).makeIcon)("Icon24Back","back_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="back_24"><g fill="none" fill-rule="evenodd"><path d="M24 0H0v24h24z" /><path fill="currentColor" d="m7.8 11 4.9-4.9a.99.99 0 0 0-1.4-1.4l-6.593 6.593a1 1 0 0 0 0 1.414L11.3 19.3a.99.99 0 0 0 1.4-1.4L7.8 13H20a1 1 0 0 0 0-2H7.8Z" /></g></symbol>',24,24,!1,void 0)},102697:(e,t,s)=>{s.d(t,{Icon24CheckCircleOn:()=>n});var n=(0,s(426435).makeIcon)("Icon24CheckCircleOn","check_circle_on_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="check_circle_on_24"><path fill="currentColor" fill-rule="evenodd" d="M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12Zm6.207-14.793a1 1 0 0 0-1.414-1.414L10 14.586l-2.793-2.793a1 1 0 0 0-1.414 1.414l3.5 3.5a1 1 0 0 0 1.414 0l7.5-7.5Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},832963:(e,t,s)=>{s.d(t,{Icon24ChevronCompactRight:()=>n});var n=(0,s(426435).makeIcon)("Icon24ChevronCompactRight","chevron_compact_right_24","0 0 16 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 24" id="chevron_compact_right_24"><path fill="currentColor" d="M4.706 7.706a1 1 0 0 1 0-1.412l.088-.088a.997.997 0 0 1 1.414.002l5.084 5.084a.998.998 0 0 1 0 1.416l-5.084 5.084a1.002 1.002 0 0 1-1.414.002l-.088-.088a.995.995 0 0 1 0-1.412L9 12z" /></symbol>',16,24,!1,void 0)},951178:(e,t,s)=>{s.d(t,{Icon24DotsVertical:()=>n});var n=(0,s(426435).makeIcon)("Icon24DotsVertical","dots_vertical_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="dots_vertical_24"><path fill="currentColor" fill-rule="evenodd" d="M9 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm0 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm2 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4-10a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm2 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm-2 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},391738:(e,t,s)=>{s.d(t,{Icon56BookmarkOutline:()=>n});var n=(0,s(426435).makeIcon)("Icon56BookmarkOutline","bookmark_outline_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 56 56" id="bookmark_outline_56"><path fill="currentColor" fill-rule="evenodd" d="M25.433 5h5.134c2.744 0 4.894 0 6.623.141 1.76.144 3.215.442 4.53 1.112a11.5 11.5 0 0 1 5.027 5.026c.67 1.316.968 2.77 1.112 4.53.141 1.73.141 3.88.141 6.624v20.321c0 1.783 0 3.224-.101 4.336-.1 1.102-.317 2.18-.984 3.02A5 5 0 0 1 43.024 52c-1.072.005-2.054-.491-2.982-1.094-.936-.607-2.07-1.499-3.47-2.6l-6.433-5.06c-1.206-.948-1.476-1.124-1.718-1.19a1.6 1.6 0 0 0-.843 0c-.24.066-.51.242-1.717 1.19l-6.433 5.06c-1.4 1.101-2.534 1.993-3.47 2.6-.928.603-1.91 1.1-2.982 1.094a5 5 0 0 1-3.891-1.89c-.667-.84-.884-1.918-.984-3.02C8 45.978 8 44.536 8 42.754V22.433c0-2.743 0-4.894.141-6.623.144-1.76.442-3.215 1.112-4.53a11.5 11.5 0 0 1 5.026-5.027c1.316-.67 2.77-.968 4.53-1.112C20.54 5 22.69 5 25.434 5zm-6.379 3.131c-1.575.129-2.59.376-3.413.795a8.5 8.5 0 0 0-3.715 3.715c-.419.823-.666 1.838-.795 3.413-.13 1.592-.131 3.621-.131 6.446v20.177c0 1.878.002 3.182.089 4.141.09.986.252 1.309.345 1.426A2 2 0 0 0 12.99 49c.149 0 .503-.071 1.333-.61.808-.524 1.835-1.33 3.31-2.49l6.372-5.012.19-.15c.904-.712 1.684-1.328 2.592-1.576a4.601 4.601 0 0 1 2.424 0c.908.248 1.688.864 2.592 1.576l.19.15 6.371 5.011c1.476 1.161 2.503 1.967 3.31 2.491.83.539 1.185.61 1.334.61a2 2 0 0 0 1.557-.756c.093-.117.256-.44.345-1.426.088-.959.089-2.263.089-4.141V22.5c0-2.825-.001-4.854-.131-6.446-.129-1.575-.376-2.59-.795-3.413a8.5 8.5 0 0 0-3.715-3.715c-.823-.419-1.838-.666-3.413-.795C35.354 8.001 33.325 8 30.5 8h-5c-2.825 0-4.854.001-6.446.131z" clip-rule="evenodd" /></symbol>',56,56,!1,void 0)},318016:(e,t,s)=>{s.d(t,{Icon56ErrorOutline:()=>n});var n=(0,s(426435).makeIcon)("Icon56ErrorOutline","error_outline_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56" id="error_outline_56"><g fill="none" fill-rule="evenodd"><path d="M0 0h56v56H0z" /><path fill="currentColor" fill-rule="nonzero" d="M28 4c13.255 0 24 10.745 24 24S41.255 52 28 52 4 41.255 4 28 14.745 4 28 4Zm0 3C16.402 7 7 16.402 7 28s9.402 21 21 21 21-9.402 21-21S39.598 7 28 7Zm0 27a2 2 0 1 1 0 4 2 2 0 0 1 0-4Zm0-17.5a1.5 1.5 0 0 1 1.5 1.5v11l-.007.144A1.5 1.5 0 0 1 26.5 29V18l.007-.144A1.5 1.5 0 0 1 28 16.5Z" /></g></symbol>',56,56,!1,void 0)},164497:(e,t,s)=>{s.d(t,{Icon56MessagesOutline:()=>n});var n=(0,s(426435).makeIcon)("Icon56MessagesOutline","messages_outline_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 56 56" id="messages_outline_56"><path fill="currentColor" fill-rule="evenodd" d="M22.029 10c-8.474 0-14.971 5.925-14.971 12.806 0 2.468.817 4.782 2.253 6.738a1.5 1.5 0 0 1 .291.888c0 1.638-.425 3.23-.953 4.674-.351.962-.772 1.919-1.17 2.803 3.314-.334 5.494-1.392 6.807-2.955a1.5 1.5 0 0 1 1.68-.437 17.062 17.062 0 0 0 6.063 1.095c8.474 0 14.97-5.925 14.97-12.806C37 15.925 30.504 10 22.03 10zM4.058 22.806C4.058 13.886 12.309 7 22.028 7 31.749 7 40 13.885 40 22.806c0 8.92-8.251 15.806-17.971 15.806-2.165 0-4.244-.337-6.172-.956-2.254 2.144-5.545 3.181-9.592 3.342-1.618.065-2.726-1.62-2.077-3.08.14-.318.282-.633.423-.946.434-.963.861-1.911 1.22-2.895.41-1.12.689-2.184.756-3.19-1.6-2.346-2.53-5.115-2.53-8.081z" clip-rule="evenodd" /><path fill="currentColor" fill-rule="evenodd" d="M43.012 18.768a1.5 1.5 0 0 0 .377 2.088c3.437 2.385 5.553 5.988 5.553 9.95 0 2.469-.817 4.782-2.253 6.738a1.5 1.5 0 0 0-.291.888c0 1.638.425 3.23.952 4.674.352.962.773 1.919 1.17 2.803-3.314-.334-5.493-1.392-6.806-2.955a1.5 1.5 0 0 0-1.68-.437 17.063 17.063 0 0 1-6.063 1.095c-2.986 0-5.755-.748-8.078-2.026a1.5 1.5 0 0 0-1.446 2.63c2.77 1.523 6.037 2.396 9.524 2.396 2.164 0 4.244-.337 6.172-.956 2.254 2.144 5.545 3.181 9.592 3.342 1.618.065 2.726-1.62 2.077-3.08-.14-.318-.282-.633-.423-.946-.434-.962-.861-1.911-1.22-2.895-.41-1.12-.69-2.184-.756-3.19 1.6-2.346 2.53-5.115 2.53-8.081 0-5.09-2.725-9.557-6.843-12.415a1.5 1.5 0 0 0-2.088.377z" clip-rule="evenodd" /></symbol>',56,56,!1,void 0)},130845:(e,t,s)=>{s.d(t,{default:()=>a});var n=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function r(e,t){if(e.length!==t.length)return!1;for(var s=0;s<e.length;s++)if(r=e[s],a=t[s],!(r===a||n(r)&&n(a)))return!1;var r,a;return!0}const a=function(e,t){var s;void 0===t&&(t=r);var n,a=[],o=!1;return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return o&&s===this&&t(r,a)||(n=e.apply(this,r),o=!0,s=this,a=r),n}}},968641:()=>{},760398:()=>{},688274:()=>{},380283:()=>{},320428:()=>{},183638:()=>{},100732:()=>{},677749:()=>{},988426:()=>{},774996:()=>{},709639:()=>{},784256:()=>{},360862:()=>{},58245:()=>{},279478:()=>{},42505:()=>{},932823:()=>{},737968:()=>{},501954:()=>{},883061:()=>{},669721:()=>{},466135:()=>{},168577:()=>{},980160:()=>{},516073:()=>{},126449:()=>{},705413:()=>{},974004:(e,t,s)=>{s.d(t,{default:()=>h});var n=s(263366),r=s(487462),a=s(497326),o=s(894578),i=s(667294),c=s(500220),d=s(597803),l=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},u=function(e){function t(t,s){var n,r=(n=e.call(this,t,s)||this).handleExited.bind((0,a.default)(n));return n.state={contextValue:{isMounting:!0},handleExited:r,firstRender:!0},n}(0,o.default)(t,e);var s=t.prototype;return s.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},s.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(e,t){var s=t.children,n=t.handleExited;return{children:t.firstRender?(0,d.getInitialChildMapping)(e,n):(0,d.getNextChildMapping)(e,s,n),firstRender:!1}},s.handleExited=function(e,t){var s=(0,d.getChildMapping)(this.props.children);e.key in s||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var s=(0,r.default)({},t.children);return delete s[e.key],{children:s}})))},s.render=function(){var e=this.props,t=e.component,s=e.childFactory,r=(0,n.default)(e,["component","childFactory"]),a=this.state.contextValue,o=l(this.state.children).map(s);return delete r.appear,delete r.enter,delete r.exit,null===t?i.createElement(c.default.Provider,{value:a},o):i.createElement(c.default.Provider,{value:a},i.createElement(t,r,o))},t}(i.Component);u.propTypes={},u.defaultProps={component:"div",childFactory:function(e){return e}};const h=u},597803:(e,t,s)=>{s.d(t,{getChildMapping:()=>r,getInitialChildMapping:()=>o,getNextChildMapping:()=>i});var n=s(667294);function r(e,t){var s=Object.create(null);return e&&n.Children.map(e,(function(e){return e})).forEach((function(e){s[e.key]=function(e){return t&&(0,n.isValidElement)(e)?t(e):e}(e)})),s}function a(e,t,s){return null!=s[t]?s[t]:e.props[t]}function o(e,t){return r(e.children,(function(s){return(0,n.cloneElement)(s,{onExited:t.bind(null,s),in:!0,appear:a(s,"appear",e),enter:a(s,"enter",e),exit:a(s,"exit",e)})}))}function i(e,t,s){var o=r(e.children),i=function(e,t){function s(s){return s in t?t[s]:e[s]}e=e||{},t=t||{};var n,r=Object.create(null),a=[];for(var o in e)o in t?a.length&&(r[o]=a,a=[]):a.push(o);var i={};for(var c in t){if(r[c])for(n=0;n<r[c].length;n++){var d=r[c][n];i[r[c][n]]=s(d)}i[c]=s(c)}for(n=0;n<a.length;n++)i[a[n]]=s(a[n]);return i}(t,o);return Object.keys(i).forEach((function(r){var c=i[r];if((0,n.isValidElement)(c)){var d=r in t,l=r in o,u=t[r],h=(0,n.isValidElement)(u)&&!u.props.in;!l||d&&!h?l||!d||h?l&&d&&(0,n.isValidElement)(u)&&(i[r]=(0,n.cloneElement)(c,{onExited:s.bind(null,c),in:u.props.in,exit:a(c,"exit",e),enter:a(c,"enter",e)})):i[r]=(0,n.cloneElement)(c,{in:!1}):i[r]=(0,n.cloneElement)(c,{onExited:s.bind(null,c),in:!0,exit:a(c,"exit",e),enter:a(c,"enter",e)})}})),i}},365691:(e,t,s)=>{s.d(t,{default:()=>o});var n=s(667294);var r=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};const o=function(e){function t(){var e,s,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];return s=n=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),n._lastRenderedStartIndex=-1,n._lastRenderedStopIndex=-1,n._memoizedUnloadedRanges=[],n._onItemsRendered=function(e){var t=e.visibleStartIndex,s=e.visibleStopIndex;n._lastRenderedStartIndex=t,n._lastRenderedStopIndex=s,n._ensureRowsLoaded(t,s)},n._setRef=function(e){n._listRef=e},a(n,s)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"resetloadMoreItemsCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._memoizedUnloadedRanges=[],e&&this._ensureRowsLoaded(this._lastRenderedStartIndex,this._lastRenderedStopIndex)}},{key:"componentDidMount",value:function(){0}},{key:"render",value:function(){return(0,this.props.children)({onItemsRendered:this._onItemsRendered,ref:this._setRef})}},{key:"_ensureRowsLoaded",value:function(e,t){var s=this.props,n=s.isItemLoaded,r=s.itemCount,a=s.minimumBatchSize,o=void 0===a?10:a,i=s.threshold,c=void 0===i?15:i,d=function(e){for(var t=e.isItemLoaded,s=e.itemCount,n=e.minimumBatchSize,r=e.startIndex,a=e.stopIndex,o=[],i=null,c=null,d=r;d<=a;d++)t(d)?null!==c&&(o.push(i,c),i=c=null):(c=d,null===i&&(i=d));if(null!==c){for(var l=Math.min(Math.max(c,i+n-1),s-1),u=c+1;u<=l&&!t(u);u++)c=u;o.push(i,c)}if(o.length)for(;o[1]-o[0]+1<n&&o[0]>0;){var h=o[0]-1;if(t(h))break;o[0]=h}return o}({isItemLoaded:n,itemCount:r,minimumBatchSize:o,startIndex:Math.max(0,e-c),stopIndex:Math.min(r-1,t+c)});(this._memoizedUnloadedRanges.length!==d.length||this._memoizedUnloadedRanges.some((function(e,t){return d[t]!==e})))&&(this._memoizedUnloadedRanges=d,this._loadUnloadedRanges(d))}},{key:"_loadUnloadedRanges",value:function(e){for(var t=this,s=this.props.loadMoreItems||this.props.loadMoreRows,n=function(n){var r=e[n],a=e[n+1],o=s(r,a);null!=o&&o.then((function(){if(function(e){var t=e.lastRenderedStartIndex,s=e.lastRenderedStopIndex,n=e.startIndex,r=e.stopIndex;return!(n>s||r<t)}({lastRenderedStartIndex:t._lastRenderedStartIndex,lastRenderedStopIndex:t._lastRenderedStopIndex,startIndex:r,stopIndex:a})){if(null==t._listRef)return;"function"==typeof t._listRef.resetAfterIndex?t._listRef.resetAfterIndex(r,!0):("function"==typeof t._listRef._getItemStyleCache&&t._listRef._getItemStyleCache(-1),t._listRef.forceUpdate())}}))},r=0;r<e.length;r+=2)n(r)}}]),t}(n.PureComponent)},274061:(e,t,s)=>{s.d(t,{FixedSizeList:()=>w,VariableSizeList:()=>I});var n=s(487462),r=s(497326),a=s(894578),o=s(130845),i=s(667294),c=(s(263366),"object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()});function d(e){cancelAnimationFrame(e.id)}function l(e,t){var s=c();var n={id:requestAnimationFrame((function r(){c()-s>=t?e.call(null):n.id=requestAnimationFrame(r)}))};return n}var u=-1;function h(e){if(void 0===e&&(e=!1),-1===u||e){var t=document.createElement("div"),s=t.style;s.width="50px",s.height="50px",s.overflow="scroll",document.body.appendChild(t),u=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return u}var p=null;function m(e){if(void 0===e&&(e=!1),null===p||e){var t=document.createElement("div"),s=t.style;s.width="50px",s.height="50px",s.overflow="scroll",s.direction="rtl";var n=document.createElement("div"),r=n.style;return r.width="100px",r.height="100px",t.appendChild(n),document.body.appendChild(t),t.scrollLeft>0?p="positive-descending":(t.scrollLeft=1,p=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),p}return p}var f=function(e,t){return e};function g(e){var t,s=e.getItemOffset,c=e.getEstimatedTotalSize,u=e.getItemSize,p=e.getOffsetForIndexAndAlignment,g=e.getStartIndexForOffset,_=e.getStopIndexForStartIndex,C=e.initInstanceProps,y=e.shouldResetStyleCacheOnItemSizeChange,k=e.validateProps;return t=function(e){function t(t){var n;return(n=e.call(this,t)||this)._instanceProps=C(n.props,(0,r.default)(n)),n._outerRef=void 0,n._resetIsScrollingTimeoutId=null,n.state={instance:(0,r.default)(n),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof n.props.initialScrollOffset?n.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},n._callOnItemsRendered=void 0,n._callOnItemsRendered=(0,o.default)((function(e,t,s,r){return n.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:s,visibleStopIndex:r})})),n._callOnScroll=void 0,n._callOnScroll=(0,o.default)((function(e,t,s){return n.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:s})})),n._getItemStyle=void 0,n._getItemStyle=function(e){var t,r=n.props,a=r.direction,o=r.itemSize,i=r.layout,c=n._getItemStyleCache(y&&o,y&&i,y&&a);if(c.hasOwnProperty(e))t=c[e];else{var d=s(n.props,e,n._instanceProps),l=u(n.props,e,n._instanceProps),h="horizontal"===a||"horizontal"===i,p="rtl"===a,m=h?d:0;c[e]=t={position:"absolute",left:p?void 0:m,right:p?m:void 0,top:h?0:d,height:h?"100%":l,width:h?l:"100%"}}return t},n._getItemStyleCache=void 0,n._getItemStyleCache=(0,o.default)((function(e,t,s){return{}})),n._onScrollHorizontal=function(e){var t=e.currentTarget,s=t.clientWidth,r=t.scrollLeft,a=t.scrollWidth;n.setState((function(e){if(e.scrollOffset===r)return null;var t=n.props.direction,o=r;if("rtl"===t)switch(m()){case"negative":o=-r;break;case"positive-descending":o=a-s-r}return o=Math.max(0,Math.min(o,a-s)),{isScrolling:!0,scrollDirection:e.scrollOffset<r?"forward":"backward",scrollOffset:o,scrollUpdateWasRequested:!1}}),n._resetIsScrollingDebounced)},n._onScrollVertical=function(e){var t=e.currentTarget,s=t.clientHeight,r=t.scrollHeight,a=t.scrollTop;n.setState((function(e){if(e.scrollOffset===a)return null;var t=Math.max(0,Math.min(a,r-s));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}}),n._resetIsScrollingDebounced)},n._outerRefSetter=function(e){var t=n.props.outerRef;n._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},n._resetIsScrollingDebounced=function(){null!==n._resetIsScrollingTimeoutId&&d(n._resetIsScrollingTimeoutId),n._resetIsScrollingTimeoutId=l(n._resetIsScrolling,150)},n._resetIsScrolling=function(){n._resetIsScrollingTimeoutId=null,n.setState({isScrolling:!1},(function(){n._getItemStyleCache(-1,null)}))},n}(0,a.default)(t,e),t.getDerivedStateFromProps=function(e,t){return v(e,t),k(e),null};var I=t.prototype;return I.scrollTo=function(e){e=Math.max(0,e),this.setState((function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}}),this._resetIsScrollingDebounced)},I.scrollToItem=function(e,t){void 0===t&&(t="auto");var s=this.props,n=s.itemCount,r=s.layout,a=this.state.scrollOffset;e=Math.max(0,Math.min(e,n-1));var o=0;if(this._outerRef){var i=this._outerRef;o="vertical"===r?i.scrollWidth>i.clientWidth?h():0:i.scrollHeight>i.clientHeight?h():0}this.scrollTo(p(this.props,e,t,a,this._instanceProps,o))},I.componentDidMount=function(){var e=this.props,t=e.direction,s=e.initialScrollOffset,n=e.layout;if("number"==typeof s&&null!=this._outerRef){var r=this._outerRef;"horizontal"===t||"horizontal"===n?r.scrollLeft=s:r.scrollTop=s}this._callPropsCallbacks()},I.componentDidUpdate=function(){var e=this.props,t=e.direction,s=e.layout,n=this.state,r=n.scrollOffset;if(n.scrollUpdateWasRequested&&null!=this._outerRef){var a=this._outerRef;if("horizontal"===t||"horizontal"===s)if("rtl"===t)switch(m()){case"negative":a.scrollLeft=-r;break;case"positive-ascending":a.scrollLeft=r;break;default:var o=a.clientWidth,i=a.scrollWidth;a.scrollLeft=i-o-r}else a.scrollLeft=r;else a.scrollTop=r}this._callPropsCallbacks()},I.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&d(this._resetIsScrollingTimeoutId)},I.render=function(){var e=this.props,t=e.children,s=e.className,r=e.direction,a=e.height,o=e.innerRef,d=e.innerElementType,l=e.innerTagName,u=e.itemCount,h=e.itemData,p=e.itemKey,m=void 0===p?f:p,g=e.layout,v=e.outerElementType,_=e.outerTagName,C=e.style,y=e.useIsScrolling,k=e.width,I=this.state.isScrolling,w="horizontal"===r||"horizontal"===g,M=w?this._onScrollHorizontal:this._onScrollVertical,R=this._getRangeToRender(),b=R[0],S=R[1],E=[];if(u>0)for(var U=b;U<=S;U++)E.push((0,i.createElement)(t,{data:h,key:m(U,h),index:U,isScrolling:y?I:void 0,style:this._getItemStyle(U)}));var P=c(this.props,this._instanceProps);return(0,i.createElement)(v||_||"div",{className:s,onScroll:M,ref:this._outerRefSetter,style:(0,n.default)({position:"relative",height:a,width:k,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:r},C)},(0,i.createElement)(d||l||"div",{children:E,ref:o,style:{height:w?"100%":P,pointerEvents:I?"none":void 0,width:w?P:"100%"}}))},I._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],s=e[1],n=e[2],r=e[3];this._callOnItemsRendered(t,s,n,r)}if("function"==typeof this.props.onScroll){var a=this.state,o=a.scrollDirection,i=a.scrollOffset,c=a.scrollUpdateWasRequested;this._callOnScroll(o,i,c)}},I._getRangeToRender=function(){var e=this.props,t=e.itemCount,s=e.overscanCount,n=this.state,r=n.isScrolling,a=n.scrollDirection,o=n.scrollOffset;if(0===t)return[0,0,0,0];var i=g(this.props,o,this._instanceProps),c=_(this.props,i,o,this._instanceProps),d=r&&"backward"!==a?1:Math.max(1,s),l=r&&"forward"!==a?1:Math.max(1,s);return[Math.max(0,i-d),Math.max(0,Math.min(t-1,c+l)),i,c]},t}(i.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var v=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},_=function(e,t,s){var n=e.itemSize,r=s.itemMetadataMap,a=s.lastMeasuredIndex;if(t>a){var o=0;if(a>=0){var i=r[a];o=i.offset+i.size}for(var c=a+1;c<=t;c++){var d=n(c);r[c]={offset:o,size:d},o+=d}s.lastMeasuredIndex=t}return r[t]},C=function(e,t,s,n,r){for(;n<=s;){var a=n+Math.floor((s-n)/2),o=_(e,a,t).offset;if(o===r)return a;o<r?n=a+1:o>r&&(s=a-1)}return n>0?n-1:0},y=function(e,t,s,n){for(var r=e.itemCount,a=1;s<r&&_(e,s,t).offset<n;)s+=a,a*=2;return C(e,t,Math.min(s,r-1),Math.floor(s/2),n)},k=function(e,t){var s=e.itemCount,n=t.itemMetadataMap,r=t.estimatedItemSize,a=t.lastMeasuredIndex,o=0;if(a>=s&&(a=s-1),a>=0){var i=n[a];o=i.offset+i.size}return o+(s-a-1)*r},I=g({getItemOffset:function(e,t,s){return _(e,t,s).offset},getItemSize:function(e,t,s){return s.itemMetadataMap[t].size},getEstimatedTotalSize:k,getOffsetForIndexAndAlignment:function(e,t,s,n,r,a){var o=e.direction,i=e.height,c=e.layout,d=e.width,l="horizontal"===o||"horizontal"===c?d:i,u=_(e,t,r),h=k(e,r),p=Math.max(0,Math.min(h-l,u.offset)),m=Math.max(0,u.offset-l+u.size+a);switch("smart"===s&&(s=n>=m-l&&n<=p+l?"auto":"center"),s){case"start":return p;case"end":return m;case"center":return Math.round(m+(p-m)/2);default:return n>=m&&n<=p?n:n<m?m:p}},getStartIndexForOffset:function(e,t,s){return function(e,t,s){var n=t.itemMetadataMap,r=t.lastMeasuredIndex;return(r>0?n[r].offset:0)>=s?C(e,t,r,0,s):y(e,t,Math.max(0,r),s)}(e,s,t)},getStopIndexForStartIndex:function(e,t,s,n){for(var r=e.direction,a=e.height,o=e.itemCount,i=e.layout,c=e.width,d="horizontal"===r||"horizontal"===i?c:a,l=_(e,t,n),u=s+d,h=l.offset+l.size,p=t;p<o-1&&h<u;)p++,h+=_(e,p,n).size;return p},initInstanceProps:function(e,t){var s={itemMetadataMap:{},estimatedItemSize:e.estimatedItemSize||50,lastMeasuredIndex:-1};return t.resetAfterIndex=function(e,n){void 0===n&&(n=!0),s.lastMeasuredIndex=Math.min(s.lastMeasuredIndex,e-1),t._getItemStyleCache(-1),n&&t.forceUpdate()},s},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}}),w=g({getItemOffset:function(e,t){return t*e.itemSize},getItemSize:function(e,t){return e.itemSize},getEstimatedTotalSize:function(e){var t=e.itemCount;return e.itemSize*t},getOffsetForIndexAndAlignment:function(e,t,s,n,r,a){var o=e.direction,i=e.height,c=e.itemCount,d=e.itemSize,l=e.layout,u=e.width,h="horizontal"===o||"horizontal"===l?u:i,p=Math.max(0,c*d-h),m=Math.min(p,t*d),f=Math.max(0,t*d-h+d+a);switch("smart"===s&&(s=n>=f-h&&n<=m+h?"auto":"center"),s){case"start":return m;case"end":return f;case"center":var g=Math.round(f+(m-f)/2);return g<Math.ceil(h/2)?0:g>p+Math.floor(h/2)?p:g;default:return n>=f&&n<=m?n:n<f?f:m}},getStartIndexForOffset:function(e,t){var s=e.itemCount,n=e.itemSize;return Math.max(0,Math.min(s-1,Math.floor(t/n)))},getStopIndexForStartIndex:function(e,t,s){var n=e.direction,r=e.height,a=e.itemCount,o=e.itemSize,i=e.layout,c=e.width,d=t*o,l="horizontal"===n||"horizontal"===i?c:r,u=Math.ceil((l+s-d)/o);return Math.max(0,Math.min(a-1,t+u-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}})},906978:(e,t,s)=>{s.d(t,{API_ERROR_ACCESS:()=>d,API_ERROR_AUTH:()=>r,API_ERROR_AUTH_VALIDATION:()=>l,API_ERROR_CAPTCHA:()=>c,API_ERROR_FLOOD:()=>o,API_ERROR_LIMITS:()=>f,API_ERROR_MESSAGES_CHAT_DISABLED:()=>k,API_ERROR_MESSAGES_CHAT_MEMBER_NOT_STAFF:()=>M,API_ERROR_MESSAGES_CHAT_NOT_ADMIN:()=>v,API_ERROR_MESSAGES_CHAT_UNSUPPORTED:()=>I,API_ERROR_MESSAGES_CHAT_USER_NO_ACCESS:()=>g,API_ERROR_MESSAGES_CONTACT_NOT_FOUND:()=>C,API_ERROR_MESSAGES_GROUP_PEER_ACCESS:()=>_,API_ERROR_MESSAGES_MEMBER_ACCESS_TO_GROUP_DENIED:()=>w,API_ERROR_MESSAGES_MESSAGE_REQUEST_ALREADY_SENT:()=>y,API_ERROR_METHOD_DISABLED:()=>u,API_ERROR_PARAM:()=>m,API_ERROR_RATE_LIMIT:()=>h,API_ERROR_SECTION_DISABLED:()=>p,API_ERROR_SERVER:()=>i,API_ERROR_TOO_MANY:()=>a,API_ERROR_UNKNOWN:()=>n,API_ERROR_USER_DEACTIVATED:()=>R});const n=1,r=5,a=6,o=9,i=10,c=14,d=15,l=17,u=23,h=29,p=43,m=100,f=103,g=917,v=925,_=932,C=936,y=939,k=945,I=946,w=947,M=967,R=3610},199195:(e,t,s)=>{s.d(t,{Player:()=>i});var n=s(434788),r=s(302278),a=s(851369);const o="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=";class i extends r.EventEmitter{play(e,t){var s,n;(null==(n=this.state.currentTrackEntity)||null==(s=n.audioTrack)?void 0:s.url)!==e.audioTrack.url?("stopped"!==this.state.status&&this.stopCurrentTrackBeforeStartingNewTrack(),this.startNewTrack(e,t)):"stopped"===this.state.status?this.repeateCurrentTrack(e,t):"paused"===this.state.status?this.resumeTrack(e,t):this.player.currentTime=e.audioTrack.duration*e.audioTrack.progress}playNext(e,t){var s;const{shuffle:n,repeatMode:r}=this.getState(),a=null==(s=t)?void 0:s.getNext(e,n,r);a&&this.play(a,t)}playPrev(e,t){var s;const{shuffle:n,repeatMode:r}=this.getState(),a=null==(s=t)?void 0:s.getPrev(e,n,r);a&&this.play(a,t)}pause(){var e;const{currentTrackEntity:t,playlist:s,playedTimeAccumulator:r}=this.state,o=null==(e=t)?void 0:e.audioTrack;if(o){const{currentTime:e}=this.player,{duration:i}=o,c=(0,n._)({},this.state,{status:"paused",playlist:s,playedTimeAccumulator:r,currentTrackEntity:(0,n._)({},t,{audioTrack:(0,n._)({},o,{progress:e/i})})});this.setState(c),this.player.pause();const d={state:c};this.emit(a.PlayerEventTypes.PAUSE_CURRENT_TRACK,d)}}resume(){var e;const{currentTrackEntity:t,playlist:s}=this.state;(null==(e=t)?void 0:e.audioTrack)&&this.resumeTrack(t,s)}resetCurrentTrackState(){var e;const{currentTrackEntity:t,playlist:s,playedTimeAccumulator:r}=this.state,a=null==(e=t)?void 0:e.audioTrack;if(a){const e=(0,n._)({},this.state,{status:"stopped",playlist:s,playedTimeAccumulator:r,currentTrackEntity:(0,n._)({},t,{audioTrack:(0,n._)({},a,{progress:0})})});this.setState(e)}}startNewTrack(e,t){const s=this.getState(),r=(0,n._)({},s,{status:"playing",playlist:t,playedTimeAccumulator:{},currentTrackEntity:e});this.setState(r);const o={state:r};this.emit(a.PlayerEventTypes.START_NEW_TRACK,o);const i=e.audioTrack.url,c=e.audioTrack.duration*e.audioTrack.progress;this.playHTML5Player(i,c)}resumeTrack(e,t){var s,r,o,i;const c=this.getState(),d=(0,n._)({},c,{status:"playing",playlist:t,playedTimeAccumulator:c.playedTimeAccumulator,currentTrackEntity:e}),l=null==(r=c.currentTrackEntity)||null==(s=r.audioTrack)?void 0:s.url;let u;this.player.duration!==1/0&&(null==(i=this.state.currentTrackEntity)||null==(o=i.audioTrack)?void 0:o.progress)!==e.audioTrack.progress&&(u=e.audioTrack.duration*e.audioTrack.progress),this.setState(d);const h={state:d};this.emit(a.PlayerEventTypes.RESUME_TRACK,h),this.playHTML5Player(l,u)}repeateCurrentTrack(e,t){this.startNewTrack(e,t)}startNextTrackAutomatically(){const e=this.getState(),{playlist:t,currentTrackEntity:s,repeatMode:r,shuffle:o}=e;let i={state:e};if(!t||!s)return void this.emit(a.PlayerEventTypes.PLAYLIST_ENDED,i);const c="one"===r?(0,n._)({},s,{audioTrack:(0,n._)({},s.audioTrack,{progress:0})}):t.getNext(s,o,r);if(!c)return void this.emit(a.PlayerEventTypes.PLAYLIST_ENDED,i);const d=(0,n._)({},e,{status:"playing",playlist:t,playedTimeAccumulator:{},currentTrackEntity:c});this.setState(d),i={state:d},this.emit(a.PlayerEventTypes.START_NEXT_TRACK_AUTOMATICALLY,i);const l=c.audioTrack.url,u=c.audioTrack.duration*c.audioTrack.progress;this.playHTML5Player(l,u)}stopCurrentTrackAutomatically(){const{currentTrackEntity:e}=this.state;if(e){const e={state:(0,n._)({},this.state)};this.emit(a.PlayerEventTypes.STOP_CURRENT_TRACK_AUTOMATICALLY,e),this.resetCurrentTrackState(),this.player.duration===1/0&&(this.player.src="")}}stopCurrentTrackBeforeStartingNewTrack(){var e;const{currentTrackEntity:t,status:s}=this.state,r=null==(e=t)?void 0:e.audioTrack;if(r&&"playing"===s){this.player.pause();const e={state:(0,n._)({},this.state,{status:"stopped"})};this.emit(a.PlayerEventTypes.STOP_CURRENT_TRACK_BEFORE_STARTING_NEW_TRACK,e),this.resetCurrentTrackState()}else r&&"paused"===s&&this.resetCurrentTrackState()}stopCurrentTrackByError(){var e;const{currentTrackEntity:t}=this.state;if(null==(e=t)?void 0:e.audioTrack){this.resetCurrentTrackState();const e={state:this.state};this.emit(a.PlayerEventTypes.STOP_CURRENT_TRACK_BY_ERROR,e)}}stopPlayer(){var e;(null==(e=this.state.currentTrackEntity)?void 0:e.audioTrack)&&(this.pause(),this.resetCurrentTrackState(),this.setState((0,n._)({},this.state,{currentTrackEntity:void 0,playlist:void 0})))}seek(e){var t;const s=this.getState(),{currentTrackEntity:r}=s,a=null==(t=r)?void 0:t.audioTrack;if(!a)return;const o=(0,n._)({},s,{currentTrackEntity:(0,n._)({},r,{audioTrack:(0,n._)({},a,{progress:e})})});this.player.currentTime=a.duration*e,this.setState(o)}setState(e){this.state=e,this.player.volume=e.volume/100,this.player.muted=e.mute,this.player.playbackRate=e.playbackRate,this.emit("stateupdated",e)}getState(){return(0,n._)({},this.state)}forceUpdate(e){var t,s;this.setState(e),this.player.src=(null==(s=e.currentTrackEntity)||null==(t=s.audioTrack)?void 0:t.url)||o}setVolume(e){const t=(0,n._)({},this.getState(),{mute:!1,volume:e});this.setState(t)}setMute(e){const t=(0,n._)({},this.getState(),{mute:e});this.setState(t)}setShuffle(e){const t=this.getState(),s=(0,n._)({},t,{shuffle:e});this.setState(s)}setRepeatMode(e){const t=this.getState(),s=(0,n._)({},t,{repeatMode:e});this.setState(s)}setPlaybackRate(e){const t=this.getState();this.setState((0,n._)({},t,{playbackRate:e}))}playHTML5Player(e,t){"number"==typeof t&&(this.player.currentTime=t),e&&this.player.src!==e&&(this.player.src=e),this.player.play().then((()=>{"playing"!==this.getState().status&&this.player.pause(),e&&this.player.src!==e&&this.player.pause()})).catch((()=>{this.stopCurrentTrackByError()}))}constructor(e){super(),this.state=e,this.player=document.createElement("audio"),this.player.volume=e.volume/100,this.player.src=o,this.player.playbackRate=e.playbackRate,this.player.addEventListener("ended",(()=>{var e;const{currentTrackEntity:t}=this.state;if(null==(e=t)?void 0:e.audioTrack){const e=(0,n._)({},this.state,{status:"ended"});this.setState(e),this.stopCurrentTrackAutomatically(),this.startNextTrackAutomatically()}})),this.player.addEventListener("error",(()=>{this.stopCurrentTrackByError()})),this.player.addEventListener("timeupdate",(()=>{var e;const t=(0,n._)({},this.state);if(null==(e=t.currentTrackEntity)?void 0:e.audioTrack){const{currentTime:e,duration:s}=this.player,{duration:r,progress:a,id:o}=t.currentTrackEntity.audioTrack,i=e/r;i>0&&(t.playedTimeAccumulator[o]=(e=>{const t=e.played;let s=0;for(let e=0;e<t.length;e++)s+=t.end(e)-t.start(e);return s})(this.player)),this.setState((0,n._)({},t,{currentTrackEntity:(0,n._)({},t.currentTrackEntity,{audioTrack:(0,n._)({},t.currentTrackEntity.audioTrack,{progress:i>1?1:i})})})),s===1/0&&(0===i&&0!==a||i>1)&&this.player.dispatchEvent(new Event("ended"))}}))}}},624990:(e,t,s)=>{s.d(t,{PlayerStorage:()=>a,VoicePlayerStorage:()=>o});var n=s(395340),r=s(460554);class a extends n.Storage{getPlaylist(){const e=this.get("reforged_audio_player_playlist");if((0,r.isRestoredConvoAudiosPlaylist)(e))return new r.ConvoAudiosPlaylist(e)}getCurrentTrack(){const e=this.get("reforged_audio_player_track");if((0,r.isConvoAudioTrack)(e))return e}getVolume(){return this.get("reforged_audio_player_volume")}storeVolume(e){this.set("reforged_audio_player_volume",e)}getMute(){return this.get("reforged_audio_player_mute")}storeMute(e){this.set("reforged_audio_player_mute",e)}getShuffle(){return this.get("reforged_audio_player_shuffle")}storeShuffle(e){this.set("reforged_audio_player_shuffle",e)}getRepeatMode(){return this.get("reforged_audio_player_repeat_mode")}storeRepeatMode(e){this.set("reforged_audio_player_repeat_mode",e)}invalidatePlayerStateCache(){const e=this.get("reforged_audio_player_saved")||0;Date.now()-72e5>e&&(this.del("reforged_audio_player_playlist"),this.del("reforged_audio_player_saved"),this.del("reforged_audio_player_track"))}restorePlayerState(){this.invalidatePlayerStateCache();const e=this.getVolume()||100,t=this.getMute()||!1,s=this.getShuffle()||!1,n=this.getRepeatMode()||"none";return{status:"stopped",playedTimeAccumulator:{},currentTrackEntity:this.getCurrentTrack(),playlist:this.getPlaylist(),volume:e,mute:t,shuffle:s,repeatMode:n,playbackRate:1}}storePlayerState(e){const{currentTrackEntity:t,playlist:s,volume:n}=e;this.set("reforged_audio_player_saved",Date.now()),this.set("reforged_audio_player_volume",n),t?this.set("reforged_audio_player_track",t):this.del("reforged_audio_player_track"),s?s instanceof r.ConvoAudiosPlaylist&&this.set("reforged_audio_player_playlist",{meta:s.getPlaylistMeta(),list:s.getConvoAudiosList()}):this.del("reforged_audio_player_playlist")}}class o extends n.Storage{getVolume(){return this.get("reforged_voice_player_volume")}storeVolume(e){this.set("reforged_voice_player_volume",e)}getMute(){return this.get("reforged_voice_player_mute")}storeMute(e){this.set("reforged_voice_player_mute",e)}getPlaybackRate(){return this.get("reforged_voice_player_playback_rate")}storePlaybackRate(e){this.set("reforged_voice_player_playback_rate",e)}restorePlayerState(){return{status:"stopped",playedTimeAccumulator:{},volume:this.getVolume()||100,mute:this.getMute()||!1,shuffle:!1,repeatMode:"none",playbackRate:this.getPlaybackRate()||1}}}},13211:(e,t,s)=>{s.d(t,{BroadcastChannel:()=>r});var n=s(302278);class r extends n.EventEmitter{emit(e){const t=this.connectionId,s=JSON.stringify((e=>({__act:e}))(e));window.localStorage.removeItem(t),window.localStorage.setItem(t,s)}emitLocally(e,t){super.emit(e,t)}constructor(){super(),this.connectionId="queue_connection_events_queue78668286",window.addEventListener("storage",(e=>{try{if(e.key===this.connectionId&&e.newValue){var t;const s=null==(t=JSON.parse(e.newValue))?void 0:t.__act;s&&super.emit(s)}}catch(e){}}))}}},982732:(e,t,s)=>{s.d(t,{ExternalEvents:()=>n});class n{constructor(){this.listeners=[],this.send=(e,t)=>{for(const s of this.listeners)s(e,t)},this.subscribe=e=>(this.listeners.push(e),()=>{this.listeners=this.listeners.filter((t=>t!==e))})}}},277210:(e,t,s)=>{s.d(t,{MEAppMediaMediator:()=>r});var n=s(13211);class r{constructor(){this.broadcastChannel=new n.BroadcastChannel,this.player=null,this.voicePlayer=null,this.videoMessagePlayer=null,this.currentMedia=null,this.prevMedia=null,this.destroy=()=>{this.currentMedia=null,this.prevMedia=null,this.player=null,this.voicePlayer=null,this.videoMessagePlayer=null,this.broadcastChannel.unsubscribe("audio_start",this.pauseCurrentMedia),this.broadcastChannel.unsubscribe("video_message_start",this.pauseCurrentMedia),this.broadcastChannel.unsubscribe("stories_video_start",this.pauseCurrentMedia)},this.pauseCurrentMedia=()=>{var e;(null==(e=this.currentMedia)?void 0:e.isPlaying())&&this.currentMedia.handleMediaMediatorPause()},this.handlePlayerOn=e=>{if(this.broadcastChannel.emit("audio_start"),this.player=e,this.currentMedia){if(this.currentMedia&&this.currentMedia!==this.player){this.currentMedia.isPlaying()?(this.currentMedia.handleMediaMediatorPause(),this.prevMedia=this.currentMedia,this.currentMedia=this.player):(this.prevMedia=null,this.currentMedia=this.player)}}else this.prevMedia=null,this.currentMedia=this.player},this.handleVoicePlayerOn=e=>{if(this.broadcastChannel.emit("audio_start"),this.voicePlayer=e,this.currentMedia){if(this.currentMedia&&this.currentMedia!==this.voicePlayer){this.currentMedia.isPlaying()?(this.currentMedia.handleMediaMediatorPause(),this.prevMedia=this.currentMedia,this.currentMedia=this.voicePlayer):(this.prevMedia=null,this.currentMedia=this.voicePlayer)}}else this.prevMedia=null,this.currentMedia=this.voicePlayer},this.handleVoicePlayerOff=e=>{this.voicePlayer=e,this.currentMedia&&this.currentMedia===this.voicePlayer&&(this.currentMedia=null,this.prevMedia&&(this.prevMedia.handleMediaMediatorResume(),this.currentMedia=this.prevMedia,this.prevMedia=null))},this.handleVideoMessagePlayerOn=e=>{if(this.broadcastChannel.emit("video_message_start"),this.videoMessagePlayer=e,this.currentMedia){if(this.currentMedia&&this.currentMedia!==this.videoMessagePlayer){this.currentMedia.isPlaying()?(this.currentMedia.handleMediaMediatorPause(),this.prevMedia=this.currentMedia,this.currentMedia=this.videoMessagePlayer):(this.prevMedia=null,this.currentMedia=this.videoMessagePlayer)}}else this.prevMedia=null,this.currentMedia=this.videoMessagePlayer},this.handleVideoMessagePlayerOff=e=>{this.videoMessagePlayer=e,this.currentMedia&&this.currentMedia===this.videoMessagePlayer&&(this.currentMedia=null,this.prevMedia&&(this.prevMedia.handleMediaMediatorResume(),this.currentMedia=this.prevMedia,this.prevMedia=null))},this.handleVoiceRecorderOn=()=>{if(this.broadcastChannel.emit("audio_start"),this.currentMedia||this.prevMedia!==this.player)if(this.currentMedia){if(this.currentMedia){this.currentMedia.isPlaying()?(this.currentMedia.handleMediaMediatorPause(),this.prevMedia=this.currentMedia,this.currentMedia=null):(this.prevMedia=null,this.currentMedia=null)}}else this.prevMedia=null,this.currentMedia=null},this.handleVoiceRecorderOff=()=>{this.prevMedia&&this.prevMedia===this.player?(this.prevMedia.handleMediaMediatorResume(),this.currentMedia=this.prevMedia,this.prevMedia=null):(this.currentMedia=null,this.prevMedia=null)},this.broadcastChannel.subscribe("audio_start",this.pauseCurrentMedia),this.broadcastChannel.subscribe("video_message_start",this.pauseCurrentMedia),this.broadcastChannel.subscribe("stories_video_start",this.pauseCurrentMedia)}}},915234:(e,t,s)=>{s.d(t,{MEAppPlayer:()=>d,MEAppVideoMessagePlayer:()=>u,MEAppVoicePlayer:()=>l});var n=s(434788),r=s(199195),a=s(188305),o=s(624990),i=s(851369),c=s(95154);class d extends r.Player{play(e,t){return this.mediaMediator.handlePlayerOn(this),super.play(e,t)}setVolume(e){super.setVolume(e);const{volume:t,mute:s}=this.getState();this.playerStorage.storeVolume(t),this.playerStorage.storeMute(s)}setMute(e){super.setMute(e);const{volume:t,mute:s}=this.getState();this.playerStorage.storeVolume(t),this.playerStorage.storeMute(s)}setShuffle(e){super.setShuffle(e);const{shuffle:t}=this.getState();this.playerStorage.storeShuffle(t)}setRepeatMode(e){super.setRepeatMode(e);const{repeatMode:t}=this.getState();this.playerStorage.storeRepeatMode(t)}stopPlayer(){super.stopPlayer();const e=this.getState();this.playerStorage.storePlayerState((0,n._)({},e,{status:"stopped"}))}isPlaying(){const{status:e}=this.getState();return"playing"===e}handleMediaMediatorResume(){super.resume()}handleMediaMediatorPause(){super.pause()}constructor(e,t){super({status:"stopped",playedTimeAccumulator:{},volume:100,mute:!1,shuffle:!1,repeatMode:"none",playbackRate:1}),this.subscribe(i.PlayerEventTypes.START_NEW_TRACK,(e=>{this.playerStorage.storePlayerState((0,n._)({},e.state,{status:"stopped"}))})),this.subscribe(i.PlayerEventTypes.START_NEXT_TRACK_AUTOMATICALLY,(e=>{this.playerStorage.storePlayerState((0,n._)({},e.state,{status:"stopped"}))})),this.mediaMediator=e,this.playerStorage=new o.PlayerStorage(c.STORAGE_DB_NAME),this.playerStorage.identify(t);const s=this.playerStorage.restorePlayerState();this.forceUpdate(s)}}class l extends r.Player{setVolume(e){var t,s;super.setVolume(e);const{volume:n,mute:r}=this.getState();null==(t=this.playerStorage)||t.storeVolume(n),null==(s=this.playerStorage)||s.storeMute(r)}setMute(e){var t,s;super.setMute(e);const{volume:n,mute:r}=this.getState();null==(t=this.playerStorage)||t.storeVolume(n),null==(s=this.playerStorage)||s.storeMute(r)}setPlaybackRate(e){var t;super.setPlaybackRate(e);const{playbackRate:s}=this.getState();null==(t=this.playerStorage)||t.storePlaybackRate(s)}play(e,t){return this.mediaMediator.handleVoicePlayerOn(this),super.play(e,t)}isPlaying(){const{status:e}=this.getState();return"playing"===e}handleMediaMediatorResume(){super.resume()}handleMediaMediatorPause(){super.pause()}constructor(e,t){super({status:"stopped",playedTimeAccumulator:{},volume:100,mute:!1,shuffle:!1,repeatMode:"none",playbackRate:1}),this.pause=()=>{super.pause(),this.mediaMediator.handleVoicePlayerOff(this)},this.mediaMediator=e,this.subscribe(i.PlayerEventTypes.PLAYLIST_ENDED,(()=>this.mediaMediator.handleVoicePlayerOff(this))),this.playerStorage=new o.VoicePlayerStorage(c.STORAGE_DB_NAME),this.playerStorage.identify(t);const s=this.playerStorage.restorePlayerState();this.forceUpdate(s)}}class u extends a.VideoMessagePlayer{play(e,t){this.mediaMediator.handleVideoMessagePlayerOn(this),super.play(e,t)}resume(){this.mediaMediator.handleVideoMessagePlayerOn(this),super.resume()}stop(){this.mediaMediator.handleVideoMessagePlayerOff(this),super.stop()}destroy(){this.mediaMediator.destroy()}isPlaying(){const{status:e}=this.getState();return"playing"===e}handleMediaMediatorResume(){super.resume()}handleMediaMediatorPause(){super.pause()}constructor(e){super({status:"stopped",settings:{volume:1,playbackRate:1,muted:!1}}),this.pause=()=>{super.pause(),this.mediaMediator.handleVideoMessagePlayerOff(this)},this.mediaMediator=e}}},327320:(e,t,s)=>{s.d(t,{MEAppRecorder:()=>r});var n=s(924222);class r extends n.Recorder{start(){return this.mediaMediator.handleVoiceRecorderOn(),super.start()}pause(){const e=super.pause();return this.mediaMediator.handleVoiceRecorderOff(),e}resume(){return this.mediaMediator.handleVoiceRecorderOn(),super.resume()}stop(){const e=super.stop();return this.mediaMediator.handleVoiceRecorderOff(),e}constructor(e={},t,s){super(e,s),this.mediaMediator=t}}},924222:(e,t,s)=>{s.d(t,{Recorder:()=>a});var n=s(434788);const r={bufferLength:4096,encoderApplication:2049,encoderFrameSize:20,encoderSampleRate:48e3,maxFramesPerPage:40,mediaTrackConstraints:!0,monitorGain:0,numberOfChannels:1,recordingGain:1,resampleQuality:3,streamPages:!0,wavBitDepth:16,encoderPath:new URL(s(923562),s.b).href,reuseWorker:!0};class a{initWorklet(){return this.audioContext.audioWorklet?this.audioContext.audioWorklet.addModule(this.config.encoderPath):Promise.resolve()}initEncoder(){this.audioContext.audioWorklet&&(this.encoderNode=new AudioWorkletNode(this.audioContext,"encoder-worklet",{numberOfOutputs:0}),this.encoder=this.encoderNode.port)}storePage(e){this.recordedPages.push(e),this.totalLength+=e.length}streamPage(e){this.onDataAvailable(e)}clearStream(){this.stream&&this.stream.getTracks&&this.stream.getTracks().forEach((e=>e.stop()))}finish(){if(!this.config.streamPages){const e=new Uint8Array(this.totalLength);this.recordedPages.reduce(((t,s)=>(e.set(s,t),t+s.length)),0),this.onDataAvailable(e)}this.onStop()}initWorker(){const e=(this.config.streamPages?this.streamPage:this.storePage).bind(this);return this.recordedPages=[],this.totalLength=0,new Promise((t=>{var s,n,r;const a=({data:s})=>{switch(s.message){case"ready":t();break;case"page":e(s.page);break;case"done":var n;null==(n=this.encoder)||n.removeEventListener("message",a),this.finish()}};null==(s=this.encoder)||s.addEventListener("message",a),(null==(n=this.encoder)?void 0:n.start)&&this.encoder.start(),null==(r=this.encoder)||r.postMessage(Object.assign({command:"init",originalSampleRate:this.audioContext.sampleRate,wavSampleRate:this.audioContext.sampleRate},this.config))}))}initSourceNode(){return window.navigator.mediaDevices.getUserMedia({audio:this.config.mediaTrackConstraints}).then((e=>{this.stream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e)}))}start(){return"inactive"===this.state?(this.state="loading",this.audioContext.resume().then((()=>this.initialize)).then((()=>Promise.all([this.initSourceNode(),this.initWorker()]))).then((()=>{var e,t,s;this.sourceNode&&this.encoderNode?(this.state="recording",null==(e=this.encoder)||e.postMessage({command:"getHeaderPages"}),null==(t=this.sourceNode)||t.connect(this.monitorGainNode),null==(s=this.sourceNode)||s.connect(this.recordingGainNode),this.monitorGainNode.connect(this.audioContext.destination),this.recordingGainNode.connect(this.encoderNode),this.onStart()):this.state="inactive"})).catch((e=>{throw this.state="inactive",e}))):Promise.resolve()}pause(){return"recording"===this.state?(this.state="paused",this.recordingGainNode.disconnect(),new Promise((e=>{var t,s,n;const r=({data:t})=>{var s;"flushed"===t.message&&(null==(s=this.encoder)||s.removeEventListener("message",r),this.onPause(),e())};null==(t=this.encoder)||t.addEventListener("message",r),null==(s=this.encoder)||s.start(),null==(n=this.encoder)||n.postMessage({command:"flush"})}))):(this.onPause(),Promise.resolve())}resume(){"paused"===this.state&&this.encoderNode&&(this.state="recording",this.recordingGainNode.connect(this.encoderNode),this.onResume())}stop(){return this.resume(),"recording"===this.state?(this.state="inactive",this.monitorGainNode.disconnect(),this.clearStream(),new Promise((e=>{var t,s,n;const r=({data:t})=>{var s;"done"===t.message&&(null==(s=this.encoder)||s.removeEventListener("message",r),e())};null==(t=this.encoder)||t.addEventListener("message",r),null==(s=this.encoder)||s.start(),null==(n=this.encoder)||n.postMessage({command:"done"})}))):(this.onStop(),Promise.resolve())}subscribeToAnalyzer(e){const t=this.sourceNode,s=t.context.createAnalyser();s.fftSize=64,t.connect(s);const n=s.frequencyBinCount,r=new Uint8Array(n);let a=!1;function o(){if(a)return;s.getByteFrequencyData(r);const t=r.reduce(((e,t)=>e+t),0)/n/255;e(t<.1?0:t),requestAnimationFrame(o)}return o(),[()=>{a=!0},()=>{a=!1,o()}]}constructor(e={},t){this.state="inactive",this.config=r,this.recordedPages=[],this.totalLength=0,this.onDataAvailable=function(e){},this.onStart=function(){},this.onPause=function(){},this.onResume=function(){},this.onStop=function(){},this.config=(0,n._)({},r,e);try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(e){t.info(`[VoiceRecorder]: new AudioContext ERROR: ${e}`),this.audioContext={createGain(){}}}this.monitorGainNode=this.audioContext.createGain(),this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(this.config.monitorGain,this.audioContext.currentTime,.01),this.recordingGainNode=this.audioContext.createGain(),this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(this.config.recordingGain,this.audioContext.currentTime,.01),this.initialize=this.initWorklet().then((()=>this.initEncoder()))}}},395340:(e,t,s)=>{s.d(t,{Storage:()=>a});var n=s(11010),r=s(891047);class a{mapKey(e){if(!this.viewerPeerId)throw new Error("Перед использованием Storage должен быть идентифицирован!");return`${this.dbName}-${this.viewerPeerId}-${e}`}constructor(e){this.idbStoreName="storage",this.identify=e=>{this.viewerPeerId=e},this.get=e=>{const t=this.mapKey(e);try{const e=localStorage.getItem(t);if(!e)return;return JSON.parse(e,i)}catch(e){return}},this.set=(e,t)=>{const s=this.mapKey(e);try{localStorage.setItem(s,JSON.stringify(t,o))}catch(e){}},this.del=e=>{const t=this.mapKey(e);try{localStorage.removeItem(t)}catch(e){}};var t=this;this.getIDB=(0,n._)((function*(e){const s=t.mapKey(e);return yield r.get(s,t.idbStorage)}));var s=this;this.setIDB=(0,n._)((function*(e,t){const n=s.mapKey(e);return yield r.set(n,t,s.idbStorage)}));var a=this;this.updateIDB=(0,n._)((function*(e,t){const s=a.mapKey(e);return r.update(s,t,a.idbStorage)}));var c=this;this.delIDB=(0,n._)((function*(e){const t=c.mapKey(e);return yield r.del(t,c.idbStorage)})),this.dbName=e,this.idbStorage=window.indexedDB&&r.createStore(e,this.idbStoreName)}}function o(e,t){return t instanceof Map?{dataType:"Map",entries:Array.from(t.entries())}:t instanceof Set?{dataType:"Set",values:Array.from(t.values())}:t}function i(e,t){if("object"==typeof t&&null!==t){if("Map"===t.dataType)return new Map(t.entries);if("Set"===t.dataType)return new Set(t.values)}return t}},188305:(e,t,s)=>{s.d(t,{VideoMessagePlayer:()=>c});var n=s(434788),r=s(302278),a=s(851369),o=s(51174);const i={volume:1,playbackRate:1};class c extends r.EventEmitter{setVolume(e){this.setState((0,n._)({},this.state,{settings:(0,n._)({},this.state.settings,{muted:!1,volume:e})})),this.player.muted=!1,this.player.volume=e,localStorage.setItem("videomessage_settings",JSON.stringify(this.state.settings))}setMuted(e){const t=(0,n._)({},this.state,{settings:(0,n._)({},this.state.settings,{muted:e})});this.setState(t),this.player.muted=e}setPlaybackRate(e){this.setState((0,n._)({},this.state,{settings:(0,n._)({},this.state.settings,{playbackRate:e})})),this.player.playbackRate=e,localStorage.setItem("videomessage_settings",JSON.stringify(this.state.settings))}stop(){this.player.pause(),this.player.currentTime=0,this.player.src="",this.setState((0,n._)({},this.state,{status:"stopped",playlist:void 0,currentVideoMessageTrack:void 0}))}play(e,t){this.playHTML5Player(t,t.progress),this.setState((0,n._)({},this.state,{status:"playing",convoPeerId:e,currentVideoMessageTrack:t}))}move(e=!1){if(!this.state.currentVideoMessageTrack)return;const{playlist:t}=this.state;if(t){const s=e?t.getPrev(this.state.currentVideoMessageTrack):t.getNext(this.state.currentVideoMessageTrack),{convoPeerId:n}=t.getPlaylistMeta();if(s)return this.play(n,s),this.scrollToMessage(),s;this.stop()}else this.stop()}pause(){const{currentVideoMessageTrack:e}=this.state;e&&(this.player.pause(),this.setState((0,n._)({},this.state,{status:"paused"})))}resume(){const{currentVideoMessageTrack:e}=this.state;e&&(this.playHTML5Player(e),this.setState((0,n._)({},this.state,{status:"playing"})))}endTrack(){this.setState((0,n._)({},this.state,{status:"ended"}));const{playlist:e}=this.state;e?this.move():this.stop()}setProgress(e){const{currentVideoMessageTrack:t}=this.state;t&&this.setState((0,n._)({},this.state,{currentVideoMessageTrack:(0,n._)({},t,{progress:e})}))}scrollToMessage(){this.state.currentVideoMessageTrack&&this.emit(a.VideoMessagePlayerEventTypes.SCROLL_TO_MESSAGE,this.state.currentVideoMessageTrack.id)}stopCurrentTrackByError(e){var t;const{currentVideoMessageTrack:s}=this.state;(null==(t=s)?void 0:t.id)===e&&this.setState((0,n._)({},this.state,{status:"stopped",currentVideoMessageTrack:(0,n._)({},s,{progress:0})}))}setState(e){this.state=e,this.emit(a.VideoMessagePlayerEventTypes.STATE_UPDATED,e)}getState(){return this.state}getPlayer(){return this.player}forceUpdate(e){this.setState(e)}setPlaylist(e){this.setState((0,n._)({},this.state,{playlist:e}))}tick(){const{currentVideoMessageTrack:e}=this.state;if(e){const{currentTime:t,duration:s}=this.player,{duration:n=1,progress:r=0}=e,a=t/n;this.setProgress(a>1?1:a),s===1/0&&0===a&&0!==r&&this.player.dispatchEvent(new Event("ended"))}}playHTML5Player(e,t){const s=(0,o.getVideoSource)(e.files);"number"==typeof t&&(this.player.currentTime=t),s&&this.player.src!==s&&(this.player.src=s),this.player.volume=this.state.settings.volume,this.player.playbackRate=this.state.settings.playbackRate,this.player.muted=this.state.settings.muted,this.player.play().then((()=>{const{status:e}=this.state;"playing"!==e&&this.player.pause(),s&&this.player.src!==s&&this.player.pause()})).catch((()=>{this.stopCurrentTrackByError(e.id)}))}constructor(e){super(),this.player=document.createElement("video"),this.player.disablePictureInPicture=!0,this.player.playsInline=!0,this.player.src="",this.state=e;const t=localStorage.getItem("videomessage_settings");this.state.settings=t?JSON.parse(t):i,this.player.addEventListener("ended",(()=>{this.endTrack()})),this.player.addEventListener("timeupdate",(()=>{this.tick()})),this.player.addEventListener("error",(()=>{const{currentVideoMessageTrack:e}=this.state;e&&this.stopCurrentTrackByError(e.id)}))}}},51174:(e,t,s)=>{s.d(t,{getVideoSource:()=>a,toVideoMessageTrack:()=>r});var n=s(434788);function r(e,t,s,r,a){return(0,n._)({},t,{id:`${s}_${t.id}`,rootMessageId:s,progress:e,messageSentAt:r,messageAuthorId:a})}function a(e){var t,s,n,r,a,o,i,c;return(null==(t=e)?void 0:t.mp4_2160)||(null==(s=e)?void 0:s.mp4_1440)||(null==(n=e)?void 0:n.mp4_1080)||(null==(r=e)?void 0:r.mp4_720)||(null==(a=e)?void 0:a.mp4_480)||(null==(o=e)?void 0:o.mp4_360)||(null==(i=e)?void 0:i.mp4_240)||(null==(c=e)?void 0:c.mp4_144)||""}},785132:(e,t,s)=>{s.d(t,{searchConversations:()=>d,searchMessages:()=>u,searchUsersGlobal:()=>p});var n=s(11010),r=s(434788),a=s(954811),o=s(96190),i=s(481186),c=s(95154);function d(e,t,s,n){return l.apply(this,arguments)}function l(){return(l=(0,n._)((function*(e,t,s,n){const r=yield e("messages.searchConversations",{q:s,count:c.SEARCH_CONVOS_COUNT,extended:1,group_id:n}),{profiles:o,groups:i,items:d,contacts:l}=r;return t({profiles:o,groups:i,conversations:d,contacts:l}),d.reduce(((e,t)=>{const s=(0,a.fromApiConvo)(t);return s&&e.add(s.convo.peerId),e}),new Set)}))).apply(this,arguments)}function u(e,t,s,n){return h.apply(this,arguments)}function h(){return(h=(0,n._)((function*(e,t,s,n){const a=yield e("messages.search",(0,r._)({},n,{extended:1,count:c.SEARCH_MESSAGES_COUNT})),{items:o,count:d,conversations:l,contacts:u,profiles:h,groups:p}=a;s({profiles:h,groups:p,conversations:l,contacts:u});return{results:o.reduce(((e,s)=>{const n=(0,i.fromApiMessage)(s).message;return"Normal"===n.kind?e.push(n):t.error(`Сообщение неожиданного типа вернулось из message.search: ${n.kind}`),e}),[]),count:d,apiItemsCount:o.length}}))).apply(this,arguments)}function p(e,t,s){return m.apply(this,arguments)}function m(){return(m=(0,n._)((function*(e,t,s){const n=yield e("users.search",s),{items:r,count:a}=n;t({profiles:r});return{results:r.map((e=>o.resolveRealId("User",e.id))),count:a}}))).apply(this,arguments)}},663126:(e,t,s)=>{s.d(t,{useApiFetch:()=>c});var n=s(434788),r=s(696023),a=s(667294),o=s(927411),i=s(53416);function c(){const{api:e}=(0,r.useBrowserEnv)(),t=(0,a.useRef)(new Set);return(0,a.useEffect)((()=>()=>{t.current.forEach((s=>{e.dangerouslyAbort(s),t.current.delete(s)}))}),[e]),(0,a.useCallback)(((s,r,a)=>{const c=o.IApi.resolveTrackId(s,(0,i.nanoid)(5));return t.current.add(c),e.fetch(s,r,(0,n._)({},a,{trackId:c}))}),[e])}},955625:(e,t,s)=>{s.d(t,{useConvoOrganiser:()=>d});var n=s(185327),r=s(498928),a=s(999504),o=s(667294),i=s(89131),c=s(696023);function d(e,t,s,d){const[l,u]=(0,o.useState)(s),h=(0,o.useMemo)((()=>{let s=[];switch(l.kind){case"filters":{if(!(l.filter in e.filters))throw new Error("Выбрана несуществущая папка");const a=e.filters[l.filter];return s=Array.from(a.peerIds,(e=>n.safeGet(t,e))).sort(r.sorter),{organiser:l,convos:s,hasMore:a.hasMore}}case"folders":{const o=e.folders.find((e=>e.id===l.id));return o?(s=Array.from(o[l.filter].peerIds,(e=>n.safeGet(t,e))).sort(a.sorter),{organiser:l,convos:s,hasMore:o[l.filter].hasMore}):(u({kind:"filters",filter:d}),{organiser:{kind:"filters",filter:d},hasMore:e.filters.all.hasMore,convos:Array.from(e.filters.all.peerIds,(e=>n.safeGet(t,e))).sort(r.sorter)})}default:(0,i.exhaustivenessCheck)(l)}}),[l,e.filters,e.folders,t,d]),p=(0,c.useMemoWithCustomCompare)((()=>h.convos),h.convos,i.isShallowEqual);return{selectedOrganiser:h.organiser,convos:p,hasMore:h.hasMore,setSelectedOrganiser:u}}},897297:(e,t,s)=>{s.d(t,{useTabListNavigation:()=>a});var n=s(667294);const r=0;function a({hasMore:e=!1}){const[t,s]=(0,n.useState)(r),[a,o]=(0,n.useState)(!1),i=(0,n.useRef)(0),c=(0,n.useCallback)((e=>i.current=e),[]),d=(0,n.useRef)(),l=(0,n.useCallback)((e=>d.current=e),[]),u=(0,n.useCallback)((()=>{o(!1),s(r)}),[]),h=(0,n.useCallback)(((n,r)=>{if(0!==i.current)switch(n){case"Enter":var a,c;r(),null==(a=(c=d).current)||a.call(c,t);break;case"ArrowDown":r(),o(e&&t+1===i.current),s((e=>e+1<i.current?e+1:e));break;case"ArrowUp":r(),s((e=>e>0?e-1:0)),o(!1)}}),[t,e]);return{setTabsCount:c,setSelectHandler:l,indexToSelect:t,onKeyDown:h,resetIndexToSelect:u,forceScrollToLoader:a}}},760802:(e,t,s)=>{s.d(t,{usePicker:()=>i,usePickerSearch:()=>c});var n=s(667294),r=s(89131),a=s(897297),o=s(546428);const i=({selection:e,strategy:t})=>{const[s,a]=(0,n.useState)(e);return"singular"===t&&e.size>1&&r.isDev&&console.error("В режиме выбора одной единицы данных должно быть не более одного элемента по умолчанию"),(0,n.useEffect)((()=>{a(e)}),[e]),{toggleSelection(e){let n;switch(t){case"singular":n=new Map(s.has(e.id)?[[e.id,e.value]]:[]);break;case"multiple":n=new Map(s);break;default:(0,r.exhaustivenessCheck)(t)}n.has(e.id)?n.delete(e.id):n.set(e.id,e.value),a(n)},selection:s}};function c({items:e,onSelect:t,getItemId:s,onQueryChange:r,initialQuery:i,hasMore:c}){const{setTabsCount:d,setSelectHandler:l,resetIndexToSelect:u,onKeyDown:h,indexToSelect:p,forceScrollToLoader:m}=(0,a.useTabListNavigation)({hasMore:c}),f=(0,n.useCallback)((n=>{const r=e[n];void 0!==r&&t({id:s(r),value:r})}),[e,t,s]);(0,n.useEffect)((()=>{l(f)}),[l,f]),(0,n.useEffect)((()=>{d(e.length)}),[e.length,d]);const[g,v]=(0,n.useState)(i),_=(0,n.useCallback)((e=>{u(),v(e),r(e)}),[u,v,r]),C=(0,n.useCallback)((()=>{u()}),[u]),y=(0,n.useCallback)((()=>{u()}),[u]),k=(0,n.useMemo)((()=>(0,o.onElementKeyDownFactory)(((e,t)=>{if("Escape"===e)t(),_(i);h(e,t)}))),[_,h,i]);return{query:g,onQueryUpdate:_,onFocus:C,onBlur:y,onKeyDown:k,indexToSelect:p,forceScrollToLoader:m}}},686260:(e,t,s)=>{s.d(t,{useConvoSearch:()=>v,useConvoSearchData:()=>y,useMessagesSearchData:()=>I,useSearchHandlers:()=>_,useUsersGlobalSearchData:()=>R});var n=s(11010),r=s(434788),a=s(820224),o=s(667294),i=s(696023),c=s(96190),d=s(821551),l=s(785132),u=s(897297),h=s(546428),p=s(991792),m=s(663126),f=s(95154),g=s(709646);function v({onSelect:e,searchIndex:t,defaultResults:s}){const{setTabsCount:n,setSelectHandler:i,resetIndexToSelect:c,onKeyDown:d,indexToSelect:l,forceScrollToLoader:h}=(0,u.useTabListNavigation)({}),p=_(),{query:m,setNavigationParams:f}=p,g=(0,a._)(p,["query","setNavigationParams"]);(0,o.useEffect)((()=>{f({resetIndexToSelect:c,onKeyDown:d})}),[f,c,d]);const{results:v,isLoading:C,isDefault:k}=y({searchIndex:t,defaultResults:s,query:m});var I;const w=(0,o.useMemo)((()=>null!=(I=b(v))?I:[]),[v]),M=(0,o.useCallback)((t=>{const s=w[t];void 0!==s&&e(s)}),[w,e]);return(0,o.useEffect)((()=>{i(M)}),[M,i]),(0,o.useEffect)((()=>{n(w.length)}),[w,n]),(0,r._)({query:m},g,{results:v,isLoading:C,isDefault:k,indexToSelect:l,forceScrollToLoader:h})}function _(){const e=(0,o.useRef)(null),t=(0,o.useCallback)((t=>e.current=t),[]),[s,n]=(0,o.useState)(""),[r,a]=(0,o.useState)(!1),i=(0,o.useCallback)((t=>{var s;n(t),null==(s=e.current)||s.resetIndexToSelect()}),[]),c=(0,o.useCallback)((e=>i(e.target.value)),[i]),d=(0,o.useMemo)((()=>(0,h.onElementKeyDownFactory)(((t,s)=>{var n;if("Escape"===t)s(),i("");null==(n=e.current)||n.onKeyDown(t,s)}))),[i]),l=(0,o.useCallback)((()=>{var t;a(!0),null==(t=e.current)||t.resetIndexToSelect()}),[]),u=(0,o.useCallback)((()=>{var t;a(!1),null==(t=e.current)||t.resetIndexToSelect()}),[]),p=(0,o.useCallback)((()=>{i("")}),[i]),m=(0,o.useRef)(),[f,g]=(0,o.useState)(!1);return(0,o.useLayoutEffect)((()=>{r&&g(!1)}),[r]),(0,o.useLayoutEffect)((()=>{g(!s&&!!m.current),m.current=s}),[s]),{onChange:c,onKeyDown:d,onFocus:l,onBlur:u,reset:p,isFocused:r,becameEmpty:f,setNavigationParams:t,query:s,setQuery:i}}const C=new Set;function y({defaultResults:e=C,searchIndex:t,query:s}){const[a,u]=(0,o.useState)({isLoading:!1,results:e}),h=(0,o.useRef)(!0),{debounced:g,debouncedUpdatesCount:v}=(0,i.useDebounced)(s,f.SEARCH_DEBOUNCE_MS),_=(0,m.useApiFetch)(),y=(0,i.useOwner)(),k=(0,i.useInsertIntoCache)(),I=0===s.length,w=(0,i.usePeers)();(0,o.useEffect)((()=>{I&&(h.current=!0,u({isLoading:!1,results:e}))}),[I,e]),(0,o.useEffect)((()=>{if(I)return;h.current=!1;const e=t?d.search(t,s):new Set;u({isLoading:!0,results:e})}),[s,I]);const M=(0,o.useRef)(s);M.current=s;const R=(0,o.useCallback)((0,n._)((function*(e){if(0!==e.length){u((e=>(0,r._)({},e,{loading:!0})));try{const t=yield(0,l.searchConversations)(_,k,e,(0,p.getOwnerGroupId)(y.id));if(M.current!==e)return;u((e=>{const s=new Set([...e.results.values()]);return t.forEach((e=>{if(c.isContactPeerId(e)){var t;const s=w.get(e);if("Contact"===(null==(t=s)?void 0:t.kind)&&s.userId)return}s.has(e)||s.add(e)})),{isLoading:!1,results:s}}))}catch(e){u((e=>(0,r._)({},e,{loading:!1})))}}})),[_,k,y.id,w]);(0,o.useEffect)((()=>{R(g)}),[v,g]);const{isLoading:b,results:S}=a;let E;return E=s&&b&&0===S.size?"loading":s&&!b&&0===S.size?"empty":S,{results:E,isLoading:b,isDefault:h.current}}const k=[];function I({query:e,date:t,peerId:s}){const a=0===e.length&&!t,{logger:c}=(0,i.useBrowserEnv)(),d=(0,i.useOwner)(),u=(0,i.useInsertIntoCache)(),h=(0,m.useApiFetch)(),[f,g]=(0,o.useState)({isLoading:!1,hasMore:!0,results:k}),v=(0,o.useRef)(0),_=(0,o.useRef)(e);_.current=e;const C=(0,o.useCallback)((0,n._)((function*(e){if(!a){g((e=>(0,r._)({},e,{isLoading:!0})));try{const n=yield(0,l.searchMessages)(h,c,u,{q:e,peer_id:s,date:t,offset:v.current,group_id:(0,p.getOwnerGroupId)(d.id)});if(_.current!==e)return;const{results:r,count:a,apiItemsCount:o}=n;v.current+=o,g((e=>({isLoading:!1,hasMore:a>v.current&&o>0,results:[...e.results,...r]})))}catch(e){g((e=>(0,r._)({},e,{isLoading:!1,hasMore:!1})))}}})),[a,s,t,h,u,c,d.id]),{isLoading:y,hasMore:I,results:w}=f,M=(0,o.useCallback)((()=>{I&&!y&&C(e)}),[I,y,C,e]);(0,o.useLayoutEffect)((()=>{v.current=0,a?g({isLoading:!1,hasMore:!1,results:k}):(g({isLoading:!0,hasMore:!0,results:[]}),C(e))}),[a,e,s,t]);return{results:0===w.length&&!y&&!I&&!a?"empty":w,isLoading:y,hasMore:I,loadMore:M}}const w=20,M=[];function R({query:e}){const t=0===e.length,s=(0,m.useApiFetch)(),a=(0,i.useFeatureFlags)(),{profileType:c}=(0,i.useViewer)(),d=!a.vkm_add_non_friends||g.isEdu(c),u=(0,i.useInsertIntoCache)(),[h,p]=(0,o.useState)({isLoading:!1,hasMore:!0,results:M}),f=(0,o.useRef)(0),v=(0,o.useRef)(e);v.current=e;const _=(0,o.useCallback)((0,n._)((function*(e){if(!t){p((e=>(0,r._)({},e,{isLoading:!0})));try{const t=yield(0,l.searchUsersGlobal)(s,u,{q:e,offset:f.current,count:w});if(v.current!==e)return;const{results:n,count:r}=t;f.current+=w,p((e=>({isLoading:!1,hasMore:r>f.current&&0!==n.length,results:[...e.results,...n]})))}catch(e){p((e=>(0,r._)({},e,{isLoading:!1,hasMore:!1})))}}})),[t,s,u]),{isLoading:C,hasMore:y,results:k}=h,I=(0,o.useCallback)((()=>{!y||C||d||_(e)}),[y,C,_,e,d]);(0,o.useLayoutEffect)((()=>{f.current=0,t||d?p({isLoading:!1,hasMore:!1,results:M}):(p({isLoading:!0,hasMore:!0,results:M}),_(e))}),[t,e,d]);return{results:0===k.length&&!C&&!y&&!t?"empty":k,isLoading:C,hasMore:y,loadMore:I}}const b=e=>"empty"===e||"loading"===e?null:Array.from(e.values())},433348:(e,t,s)=>{s.d(t,{SnackbarProvider:()=>u,useSnackbar:()=>h});var n=s(434788),r=s(820224),a=s(667294),o=s(814640),i=s(129879),c=s(974004),d=s(429697),l=s(247293);const u=(0,a.memo)((e=>{const[t,s]=(0,a.useState)(l.snackbarStore.getState());return(0,a.useEffect)((()=>{const e=l.snackbarStore.subscribe(s);return()=>{e(),l.snackbarStore.reset()}}),[]),a.createElement(o.SnackbarContainer,(0,n._)({},e),a.createElement(c.default,{component:"ul",className:"SnackbarContainer__list"},t.map((e=>a.createElement(p,{key:e.id,timeout:400,classNames:"SnackbarContainer__item-"},a.createElement(i.Snackbar,(0,n._)({},e)))))))}));function h(){return(0,a.useMemo)((()=>(0,l.createSnackbar)()),[])}const p=e=>{var{children:t}=e,s=(0,r._)(e,["children"]);const o=(0,a.useRef)(null);return a.createElement(d.default,(0,n._)({},s,{nodeRef:o}),a.createElement("li",{className:"SnackbarContainer__item",ref:o},t))}},413066:(e,t,s)=>{s.d(t,{AttachCard:()=>l,getExpectedPhotoWidth:()=>u});var n=s(820224),r=(s(760398),s(667294)),a=s(294184),o=s.n(a),i=s(597298),c=s(696023),d=s(772132);const l=e=>{var t,s,a,{href:l,attach:u,onClick:h,picture:p,title:m,subtitle:f,alt:g}=e,v=(0,n._)(e,["href","attach","onClick","picture","title","subtitle","alt"]);const{router:_}=(0,c.useBrowserEnv)(),[C,y]=(0,r.useState)(p),k="isInBubble"in v,I="isLongTitle"in v,w=!C&&!!v.picturePlaceholder,M=o()("AttachCard",{"AttachCard--withLongTitle":I,"AttachCard--withBackground":!k,"AttachCard--inBubble":k}),R=r.createElement(r.Fragment,null,r.createElement("figure",{className:o()("AttachCard__pic",{AttachCard__picPlaceholder:w})},"string"==typeof C?r.createElement("img",{src:C,alt:g,className:"AttachCard__img",onError:()=>{y(void 0)}}):C||v.picturePlaceholder),r.createElement("div",{className:"AttachCard__main",style:"background"in v?{backgroundColor:v.background}:{}},r.createElement("div",{className:"AttachCard__content"},r.createElement("h2",{className:"AttachCard__title"},m),"caption"in v&&r.createElement("div",{className:"AttachCard__caption"},v.caption),"Link"===(null==(t=u)?void 0:t.kind)?r.createElement(d.AttachLinkMeta,{meta:u.meta}):null,r.createElement("div",{className:"AttachCard__subtitle"},"Link"===(null==(s=u)?void 0:s.kind)&&(null==(a=u.meta)?void 0:a.favicon)&&r.createElement("img",{className:"AttachCard__favicon",src:u.meta.favicon,alt:g}),f)))),b=u?{kind:"AttachProxyRoute",attach:u,fallbackUrl:l||void 0}:null;return b&&_.toUrl(b)?r.createElement(i.Link,{to:b,className:M,onClick:h},R):l?r.createElement(i.ExternalLink,{href:l,className:M,onClick:h},R):r.createElement("span",{className:M,onClick:h},R)};function u(e){return 16*(e?3.5:4)*("undefined"!=typeof window?window.devicePixelRatio:1)}},772132:(e,t,s)=>{s.d(t,{AttachLinkMeta:()=>o});s(688274);var n=s(667294),r=s(769777),a=s(696023);const o=({meta:e})=>{const{lang:t}=(0,a.useBrowserEnv)();return e?n.createElement("div",{className:"AttachLinkMeta"},e.ownerName&&n.createElement("div",{className:"AttachLinkMeta__owner"},e.ownerName),e.rating&&e.reviews&&n.createElement("div",{className:"AttachLinkMeta__rating"},n.createElement(r.Icon12Favorite,null)," ",e.rating,n.createElement("span",null,"·"),n.createElement("span",{className:"AttachLinkMeta__reviews"},t.use("me_reviews_count_text",{num:e.reviews})))):null}},936890:(e,t,s)=>{s.d(t,{Avatar:()=>u});s(380283);var n=s(667294),r=s(294184),a=s.n(r),o=s(696023),i=s(96190),c=s(89131),d=s(480266),l=s(351381);const u=n.memo((function({peer:e,size:t,activityIndicator:s,withOnline:r=!1,withBirthday:c=!1,activeCall:d,className:u}){const p=(0,o.useLastSeen)(e.id),m=(0,o.usePixelDensity)(),f=function(e,t){var s;if(!(null==(s=e)?void 0:s.isOnline))return"Offline";if(t)switch(e.platform){case"vkme":case"mobile":return"Mobile";case"other":return"Online";default:e.platform;return"Online"}return"Offline"}(p,r),g=!!d,v=c&&function(e){var t;if("User"!==e.kind||!e.bdate)return!1;const s=new Date,n=String(s.getDate()),r=String(s.getMonth()+1),{day:a,month:o}=(null==(t=RegExp("(?<day>\\d+)\\.(?<month>\\d+)").exec(e.bdate))?void 0:t.groups)||{};return a===n&&o===r}(e),_=function(e,t,s){var n;if("Contact"===e.kind)return e.photo50;s&&(t*=2);const r=[{size:50,url:e.photo50},{size:100,url:e.photo100||e.photo50},{size:200,url:e.photo200||e.photo100||e.photo50}];return null==(n=r.find((e=>t<=e.size&&Boolean(e.url))))?void 0:n.url}(e,t,m),[C,y]=(0,n.useState)((()=>{if(!_)return!1;const e=new Image;return e.src=_,e.complete||e.width+e.height>0})),k=(0,n.useMemo)((()=>({width:t,height:t})),[t]),I=function(e,t,s){return`mePeerFrame${e}${t}${s?"c":""}`}(f,t,g||v),w=`url(#${I}Mask${e.id})`,M=a()("MEAvatar",`MEAvatar--size-${t}`,{"MEAvatar--withActivity":!!s,"MEAvatar--emptyCall":"empty"===d},u);return n.createElement("figure",{style:k,className:M},n.createElement("div",{className:"MEAvatar__imgWrapper",style:{clipPath:w}},(!C||!_)&&n.createElement(l.AvatarNoPhoto,{peer:e,size:t}),_&&n.createElement("img",{className:a()("MEAvatar__img",{"MEAvatar__img--ready":C}),alt:i.name(e),src:_,onLoad:()=>y(!0)}),s&&n.createElement("div",{className:"MEAvatar__activityIndicator"},s)),n.createElement(h,{frameType:f}),v&&n.createElement("div",{className:"MEAvatar__upperRightIcon MEAvatar__birthday"},n.createElement("svg",{className:"MEAvatar__upperRightIconSvg"},n.createElement("use",{href:"#meCake10"}))),g&&n.createElement("div",{className:"MEAvatar__upperRightIcon MEAvatar__call"},n.createElement("svg",{className:"MEAvatar__upperRightIconSvg"},n.createElement("use",{href:"#mePhone10"}))),n.createElement("svg",{className:"MEAvatar__svg"},n.createElement("clipPath",{id:I+"Mask"+e.id},n.createElement("use",{href:"#"+I})),n.createElement("use",{href:"#"+I,className:"MEAvatar__shadow",clipPath:w})))}));const h=({frameType:e})=>{switch(e){case"Mobile":return n.createElement("div",{className:"MEAvatar__mobile"},n.createElement(d.Icon12OnlineMobile,null));case"Online":return n.createElement("div",{className:"MEAvatar__online"});case"Offline":return null;default:(0,c.exhaustivenessCheck)(e)}}},377291:(e,t,s)=>{s.d(t,{AvatarFavorites:()=>c});var n=s(667294),r=(s(320428),s(294184)),a=s.n(r),o=s(696023),i=s(391738);const c=({size:e,className:t})=>{const{lang:s}=(0,o.useBrowserEnv)(),r=(0,n.useMemo)((()=>({width:e,height:e})),[e]),i=a()("AvatarFavorites",t);return n.createElement("div",{style:r,className:i,"aria-label":s.use("me_favorites")},d[e])},d={24:n.createElement("svg",{fill:"currentColor",height:"12",width:"12",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},n.createElement("path",{d:"M5.55 1.29h.9c.58 0 1.05 0 1.42.03.38.03.71.1 1.01.25.49.24.88.64 1.13 1.12.15.3.21.63.25 1.01.03.38.03.84.03 1.42v3.7c0 .44 0 .8-.03 1.07-.02.27-.08.55-.25.77-.24.3-.61.48-1 .48-.28 0-.53-.12-.76-.27-.23-.15-.51-.36-.85-.63l-.82-.64a1.8 1.8 0 00-.47-.32.43.43 0 00-.22 0 1.8 1.8 0 00-.47.32l-.82.64c-.34.27-.62.48-.85.63-.23.15-.48.28-.76.27-.39 0-.76-.18-1-.48-.17-.22-.23-.5-.25-.77-.03-.28-.03-.63-.03-1.06v-3.7c0-.59 0-1.05.03-1.43.04-.38.1-.71.25-1.01.25-.48.64-.88 1.13-1.12.3-.16.63-.22 1-.25.38-.03.85-.03 1.43-.03zm-1.35.88c-.33.03-.53.08-.7.16-.32.16-.58.43-.74.75-.08.16-.13.36-.16.69-.03.34-.03.77-.03 1.37v3.67c0 .46 0 .77.02 1 .02.24.06.3.07.32.08.1.2.16.34.16.01 0 .09-.01.29-.14.2-.12.44-.32.8-.6l.8-.62.06-.04c.25-.2.46-.37.71-.43.22-.06.46-.06.68 0 .25.06.46.23.71.43l.06.04.8.62c.36.28.6.48.8.6.2.13.28.14.3.14.12 0 .25-.06.33-.16 0-.02.05-.08.07-.32.02-.23.02-.54.02-1V5.14c0-.6 0-1.03-.03-1.37a1.81 1.81 0 00-.16-.7 1.71 1.71 0 00-.75-.74 1.81 1.81 0 00-.69-.16c-.33-.03-.76-.03-1.37-.03h-.86c-.6 0-1.04 0-1.37.03z"})),32:n.createElement("svg",{fill:"currentColor",height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},n.createElement("path",{d:"M7.4 1.71h1.2c.78 0 1.4 0 1.9.05.5.04.94.12 1.34.33.65.33 1.17.85 1.5 1.5.2.4.3.83.33 1.34.04.5.04 1.12.04 1.9v4.94c0 .58 0 1.05-.03 1.41-.03.37-.1.74-.34 1.03-.32.4-.8.65-1.33.65-.37 0-.7-.17-1.01-.36-.31-.2-.68-.5-1.14-.84l-1.09-.85a2.4 2.4 0 00-.62-.43.57.57 0 00-.3 0 2.4 2.4 0 00-.62.43l-1.1.85c-.45.35-.82.64-1.13.84-.3.2-.64.36-1.01.36-.52 0-1.01-.24-1.33-.65-.24-.3-.3-.66-.34-1.03-.03-.36-.03-.83-.03-1.4V6.82c0-.78 0-1.4.04-1.9s.13-.94.33-1.34c.33-.65.85-1.17 1.5-1.5.4-.2.83-.3 1.35-.33.5-.05 1.11-.05 1.9-.05zM5.6 2.9c-.44.04-.71.1-.92.22-.43.22-.78.57-1 1-.11.2-.18.48-.21.92a24.9 24.9 0 00-.04 1.83v4.88c0 .61 0 1.03.03 1.34.03.32.08.4.1.42.1.14.26.22.44.22.02 0 .12-.01.38-.19.26-.16.6-.42 1.08-.8l1.07-.83.07-.05c.33-.26.62-.48.95-.57.3-.08.6-.08.9 0 .33.09.62.31.95.57l.07.05 1.07.84c.49.37.82.63 1.08.8.26.17.36.18.38.18.18 0 .34-.08.45-.22.01-.02.06-.1.1-.42.02-.3.02-.73.02-1.34V6.86c0-.81 0-1.39-.04-1.83-.03-.44-.1-.71-.2-.92a2.29 2.29 0 00-1-1c-.22-.11-.49-.18-.93-.22a24.9 24.9 0 00-1.83-.03H7.43c-.81 0-1.38 0-1.83.03z"})),40:n.createElement("svg",{fill:"currentColor",height:"20",width:"20",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},n.createElement("path",{d:"M9.25 2.14h1.5c.97 0 1.74 0 2.37.05a4.4 4.4 0 011.68.42c.8.41 1.46 1.07 1.88 1.87.25.5.36 1.05.41 1.69.05.62.05 1.4.05 2.37v6.18c0 .71 0 1.3-.04 1.76-.04.45-.13.92-.42 1.28-.4.51-1.01.8-1.66.81-.47 0-.89-.2-1.27-.45-.39-.25-.85-.6-1.42-1.05L10.96 16a3 3 0 00-.77-.54.71.71 0 00-.38 0 3 3 0 00-.77.54l-1.37 1.06c-.57.44-1.03.8-1.42 1.05-.38.24-.8.46-1.27.45-.65 0-1.26-.3-1.66-.8a2.36 2.36 0 01-.42-1.29c-.04-.46-.04-1.05-.04-1.76V8.54c0-.97 0-1.75.05-2.37a4.4 4.4 0 01.41-1.69A4.29 4.29 0 015.2 2.61a4.4 4.4 0 011.68-.42c.63-.05 1.4-.05 2.37-.05zM7 3.62c-.55.04-.89.13-1.15.26-.54.28-.98.71-1.25 1.25-.14.27-.22.6-.27 1.15-.04.56-.04 1.28-.04 2.3v6.1c0 .76 0 1.29.03 1.67.04.4.1.5.12.52.13.17.34.27.55.28.03 0 .16-.02.5-.23.32-.21.73-.53 1.33-1l1.34-1.04a41 41 0 00.09-.07c.4-.32.77-.6 1.19-.72.37-.1.75-.1 1.12 0 .42.12.78.4 1.2.72l.08.07 1.34 1.04c.6.47 1.01.79 1.34 1 .33.21.46.23.49.23.21 0 .42-.1.55-.27.02-.03.08-.13.12-.53.03-.38.03-.9.03-1.67v-6.1c0-1.02 0-1.74-.04-2.3a3.02 3.02 0 00-.27-1.15 2.86 2.86 0 00-1.25-1.25c-.26-.13-.6-.22-1.15-.26-.56-.05-1.27-.05-2.29-.05H9.3c-1.02 0-1.73 0-2.3.05z"})),44:n.createElement("svg",{fill:"currentColor",height:"22",width:"22",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},n.createElement("path",{d:"M10.18 2.36h1.64c1.07 0 1.92 0 2.61.05.7.06 1.3.18 1.85.46.89.45 1.61 1.17 2.06 2.06.28.55.4 1.15.46 1.85.06.7.06 1.54.06 2.61v6.8c0 .79 0 1.44-.05 1.94-.04.5-.14 1-.46 1.4-.44.57-1.12.9-1.83.9a2.6 2.6 0 01-1.4-.5c-.42-.27-.93-.67-1.56-1.15l-1.5-1.17a3.3 3.3 0 00-.85-.59.78.78 0 00-.42 0 3.3 3.3 0 00-.85.59l-1.5 1.17c-.63.48-1.14.88-1.56 1.15-.42.27-.89.5-1.4.5-.71 0-1.39-.33-1.83-.9a2.6 2.6 0 01-.46-1.4c-.05-.5-.05-1.15-.05-1.94v-6.8c0-1.07 0-1.92.06-2.6.06-.7.18-1.3.46-1.86a4.71 4.71 0 012.06-2.06c.55-.28 1.15-.4 1.85-.46.69-.05 1.54-.05 2.61-.05zM7.7 3.98c-.6.05-.98.14-1.27.3-.6.3-1.07.77-1.37 1.36-.15.3-.25.67-.3 1.27-.05.62-.05 1.4-.05 2.52v6.72c0 .84 0 1.41.04 1.84.04.43.11.55.13.57.15.19.38.3.61.3.04 0 .17-.01.54-.25.36-.23.81-.58 1.47-1.1l1.47-1.14.1-.08c.45-.35.85-.66 1.31-.79.4-.1.83-.1 1.24 0 .46.13.86.44 1.3.8l.1.07 1.48 1.14c.66.52 1.11.87 1.47 1.1.37.24.5.25.54.25.23 0 .46-.11.6-.3.03-.02.1-.14.14-.57.03-.43.04-1 .04-1.84V9.43c0-1.11 0-1.9-.06-2.52-.04-.6-.14-.97-.29-1.27-.3-.59-.78-1.07-1.37-1.37-.3-.15-.66-.24-1.27-.29-.61-.05-1.4-.05-2.51-.05H10.2c-1.1 0-1.9 0-2.51.05z"})),46:n.createElement("svg",{fill:"currentColor",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},n.createElement("path",{d:"M11.1 2.57h1.8c1.16 0 2.1 0 2.84.06.77.07 1.42.2 2.02.5.97.5 1.76 1.28 2.25 2.25.3.6.44 1.25.5 2.02.06.75.06 1.68.06 2.85v7.4c0 .87 0 1.58-.05 2.13-.05.54-.16 1.1-.5 1.53-.49.61-1.22.97-2 .98-.56 0-1.06-.25-1.52-.55-.47-.3-1.02-.73-1.7-1.26l-1.64-1.27a3.6 3.6 0 00-.94-.64.86.86 0 00-.44 0 3.6 3.6 0 00-.94.64L9.2 20.48c-.68.53-1.23.97-1.7 1.26-.46.3-.96.55-1.52.55-.78 0-1.51-.37-2-.98-.34-.44-.45-1-.5-1.53-.05-.55-.05-1.26-.05-2.12v-7.41c0-1.17 0-2.1.06-2.85.06-.77.2-1.42.5-2.02a5.14 5.14 0 012.25-2.25c.6-.3 1.25-.43 2.02-.5.75-.06 1.68-.06 2.85-.06zM8.4 4.34c-.66.06-1.07.16-1.39.32-.64.33-1.16.85-1.5 1.5-.16.32-.26.72-.31 1.38-.06.67-.06 1.53-.06 2.75v7.32c0 .92 0 1.55.05 2.01.04.48.12.6.14.63.16.2.4.32.66.33.04 0 .19-.02.59-.28.39-.25.88-.63 1.6-1.2l1.61-1.24.1-.09c.5-.38.93-.72 1.44-.86.44-.12.9-.12 1.34 0 .5.14.94.48 1.43.86l.11.09 1.6 1.24c.73.57 1.22.95 1.61 1.2.4.26.55.28.59.28.26 0 .5-.13.66-.33.02-.03.1-.15.14-.63.05-.46.05-1.09.05-2v-7.33c0-1.22 0-2.08-.06-2.75a3.62 3.62 0 00-.32-1.38 3.43 3.43 0 00-1.5-1.5 3.62 3.62 0 00-1.38-.32c-.67-.05-1.53-.05-2.74-.05h-1.72c-1.21 0-2.07 0-2.74.05z"})),56:n.createElement(i.Icon56BookmarkOutline,{width:36,height:36}),80:n.createElement(i.Icon56BookmarkOutline,null)}},351381:(e,t,s)=>{s.d(t,{AvatarNoPhoto:()=>i,AvatarNoPhotoSimple:()=>c});s(183638);var n=s(667294),r=s(294184),a=s.n(r),o=s(96190);const i=({peer:e,size:t,className:s})=>n.createElement(c,{peerId:e.id,size:t,className:s,text:o.initials(e)}),c=({text:e,peerId:t,size:s,className:r})=>{const i=void 0!==t&&o.isContactPeerId(t)?"AvatarNoPhoto--color-contact":`AvatarNoPhoto--color-${Math.abs((null!=t?t:0)%6)}`;return n.createElement("div",{className:a()("AvatarNoPhoto",`AvatarNoPhoto--size-${s}`,i,r)},e)}},7817:(e,t,s)=>{s.d(t,{AvatarSimple:()=>d});s(100732);var n=s(667294),r=s(96190),a=s(696023),o=s(294184),i=s.n(o),c=s(351381);const d=n.memo((({peer:e,size:t,className:s})=>{const o=(0,a.usePixelDensity)(),d=(0,n.useMemo)((()=>function(e,t,s){if("Contact"===e.kind)return e.photo50;switch(t){case 64:case 72:case 80:return s?e.photo200:e.photo100;default:return s?e.photo100:e.photo50}}(e,t,o)),[e,t,o]),l=i()("AvatarSimple",`AvatarSimple--size-${t}`,s);return n.createElement("div",{className:l},d?n.createElement("img",{className:"AvatarSimple__img",alt:r.name(e),src:d}):n.createElement(c.AvatarNoPhoto,{peer:e,size:t}))}))},814977:(e,t,s)=>{s.d(t,{CasperIcon:()=>d});var n=s(205922),r=s(696023),a=(s(677749),s(943997)),o=s(294184),i=s.n(o),c=s(667294);const d=({className:e})=>{const{lang:t}=(0,r.useBrowserEnv)();return c.createElement("div",{className:i()("CasperIcon__container",e)},c.createElement(a.Tooltip,{content:c.createElement("span",{className:"CasperIcon__tooltip"},t.use("me_casper_chat_info")),position:"top",align:"center"},c.createElement("span",{className:"CasperIcon__icon"},c.createElement(n.Icon16Ghost,null))))}},337400:(e,t,s)=>{s.d(t,{ConvoPicker:()=>y});var n=s(11010),r=s(667294),a=s(696023),o=s(954811),i=s(96190),c=s(185327),d=s(821551),l=s(519478),u=s(4738),h=s(827258),p=(s(988426),s(294184)),m=s.n(p),f=s(991792),g=s(955625),v=s(89131),_=s(95154);const C=[],y=({filter:e="all",selectedPeerIds:t=C,initialQuery:s="",onSelectionChange:p,strategy:y="singular",searchRenderer:k=l.PeerChipsSearchInput,listRenderer:I=u.PeerPickerList,listFilter:w,className:M,withFavorites:R=!1})=>{const{api:b}=(0,a.useBrowserEnv)(),S=(0,a.useDispatch)(),E=(0,a.useInsertIntoCache)(),U=(0,a.useConvosSearchIndex)(),P=(0,a.useOwner)(),A=(0,a.useConvos)(),T=(0,a.useOrganisers)(),{selectedOrganiser:N,convos:x,setSelectedOrganiser:F,hasMore:q}=(0,g.useConvoOrganiser)(T,A,{kind:"filters",filter:e},"all"),O=(0,r.useMemo)((()=>(x||[]).map((e=>e.peerId))),[x]),[L,D]=(0,r.useState)(O),[B,H]=(0,r.useState)(!1),[G,V]=(0,r.useState)(!1),[z,j]=(0,r.useState)(null),K=(0,r.useRef)(null),[W,$]=(0,r.useState)(s),Q=!!W,Z=(0,r.useCallback)((e=>Array.from(d.search(U,e).values())),[U]);(0,r.useEffect)((()=>{F({kind:"filters",filter:e})}),[F,e]);const Y=(0,r.useCallback)((e=>{const t=new Map;return e.forEach((e=>{t.set(e.toString(),{kind:"peer",peerId:e})})),t}),[]),[J,X]=(0,r.useState)(Y(t)),ee=e=>{const t=Array.from(e.values()),s=[];for(let e=0;e<t.length;e+=1){var n;const r=t[e];"peer"===(null==(n=r)?void 0:n.kind)&&s.push(r.peerId)}return s};(0,r.useEffect)((()=>{var e;const s=ee(J);s.length===(null==(e=t)?void 0:e.length)&&s.every((e=>t.includes(e)))||X(Y(t))}),[t,Y]);const te=(0,r.useMemo)((()=>(0,v.debounce)((0,n._)((function*(e){try{H(!0),V(!1);const t=yield b.fetch("messages.searchConversations",{q:e,count:_.SEARCH_CONVOS_COUNT,extended:1,group_id:(0,f.getOwnerGroupId)(P.id)});if(K.current!==e)return;const s=t.count,n=t.items,r=t.profiles||[],a=t.groups||[],i=t.contacts||[];E({profiles:r,groups:a,conversations:n,contacts:i});const c=[];n.forEach((e=>{var t;const s=(0,o.fromApiConvo)(e);(null==(t=s)?void 0:t.convo.peerId)&&c.push(s.convo.peerId)})),D((e=>{const t=e.slice();return c.forEach((e=>{t.includes(e)||t.push(e)})),t})),j(s),H(!1)}catch(e){V(!0),H(!1)}})),300,!1)),[H,D,j,b,E,P.id]);(0,r.useEffect)((()=>()=>{te.cancel()}),[]),(0,r.useEffect)((()=>{Q||(D(O),H(q))}),[Q,O,q,D,H]);(0,r.useEffect)((()=>{p(ee(J))}),[J]);const se=(0,r.useMemo)((()=>{let t=L;R&&!Q&&(t=t.filter((e=>!i.isFavorites(e,P.id))),t.unshift(P.id)),(w||"chats"===e)&&(t=t.filter((t=>{const s=c.safeGet(A,t);return!(w&&!w(s))&&!("chats"===e&&!i.isChatPeerId(t))})));return t.map((e=>({kind:"peer",peerId:e})))}),[L,R,Q,w,e,P.id,A]),ne=(0,r.useMemo)((()=>Q?null===z?null:se.length:q?null:se.length),[Q,q,se,z]),re=(0,n._)((function*({query:e,offset:t,count:s}){if(V(!1),K.current=e,!Q&&e&&j(null),e)te(e);else{const e=t+s;se.length<=e&&S({type:"MoreConvosNeeded",organiser:N})}}));return r.createElement(h.Picker,{items:se,total:ne,isLoading:B,hasFailed:G,onSelectionChange:e=>{X(e)},getItemId:function(e){switch(e.kind){case"peer":return e.peerId.toString();case"template":return e.id;default:return(0,v.exhaustivenessCheck)(e)}},search:re,prefetch:({query:e})=>{if(!e)return;let t=Z(e);D(t),0===t.length&&H(!0)},initialQuery:s,selection:J,listRenderer:I,searchRenderer:k,strategy:y,onQueryChange:$,className:m()("vkmConvoPicker",M)})}},661059:(e,t,s)=>{s.d(t,{ConvoTitle:()=>g});s(774996);var n=s(667294),r=s(351506),a=s(984172),o=s(583841),i=s(920392),c=s(768770),d=s(96190),l=s(709646),u=s(294184),h=s.n(u),p=s(696023),m=s(814977),f=s(943997);const g=n.memo((function({peer:e,isMuted:t,isCasper:s,isShortened:u=!1,isMultiline:g=!1,showEmployeeMark:v=!1,className:_,isForbidedWritingForAll:C}){const{lang:y}=(0,p.useBrowserEnv)(),k=(0,p.useOwner)(),I=(0,p.useViewer)(),w=l.isEdu(I.profileType),M=!d.isFavorites(e.id,k.id)&&"User"===e.kind&&d.isEmployee(e),R=u?d.firstName(e):d.name(e),b=d.isFavorites(e.id,k.id)?y.use("me_favorites"):R,S=h()("ConvoTitle",_,{"ConvoTitle--singleLine":!g,"ConvoTitle--multiLine":g}),E=n.createElement(n.Fragment,null,v&&M?n.createElement(f.Tooltip,{align:"left",content:y.use("me_employees_vk_employee"),delay:1e3,position:"bottom"},n.createElement("span",{className:"ConvoTitle__icon ConvoTitle__employeeIcon"},n.createElement(r.Icon16LogoVk,null))):null,"Chat"!==e.kind&&"Contact"!==e.kind&&e.isVerified?n.createElement("span",{className:"ConvoTitle__icon ConvoTitle__verifiedIcon"},w&&"User"===e.kind?n.createElement(a.Icon16Education,null):n.createElement(o.Icon16Verified,null)):null,s&&n.createElement(m.CasperIcon,{className:"ConvoTitle__icon"}),C&&n.createElement("span",{className:"ConvoTitle__icon ConvoTitle__forbidedWritingIcon"},n.createElement(i.Icon16MessageCross,null)),t&&n.createElement("span",{className:"ConvoTitle__icon ConvoTitle__mutedIcon"},n.createElement(c.Icon16Muted,{"aria-hidden":!1,"aria-label":y.use("me_convo_title_muted")})));return n.createElement("div",{className:S},g?n.createElement("header",{className:"ConvoTitle__title","aria-label":y.use("me_convo_title_name")},b,E):n.createElement(n.Fragment,null,n.createElement("header",{className:"ConvoTitle__title","aria-label":y.use("me_convo_title_name")},b),E))}))},337270:(e,t,s)=>{s.d(t,{Emoji:()=>d});s(709639);var n=s(667294),r=s(331092),a=s(294184),o=s.n(a),i=s(127848),c=s(15285);const d=({emoji:e})=>{const[t,s]=(0,n.useState)(!0),a=(0,n.useRef)(null);return(0,n.useLayoutEffect)((()=>{if(!a.current)return;const t=(0,i.getEmojiSupportFromCache)(e),n="unknown"!==t?"supported"===t:(0,i.checkEmojiSupportViaCss)(a.current);s(n)}),[e]),t?n.createElement("img",{src:c.emptyImage,alt:e,className:o()("Emoji","@"+(0,r.unicodeToByteHex)(e)),ref:a}):n.createElement(n.Fragment,null,e)}},67091:(e,t,s)=>{s.d(t,{FormattedPhoneNumber:()=>a});var n=s(667294),r=s(15285);const a=({phone:e,className:t})=>{const[s,a]=(0,n.useState)(e);return(0,n.useEffect)((()=>{(0,r.formatPhoneNumber)(e).then((e=>a(e.international))).catch((()=>a(e)))}),[e]),n.createElement("div",{className:t},null!=s?s:e)}},53763:(e,t,s)=>{s.d(t,{IconNote:()=>r});var n=s(667294);s(784256);const r=({icon:e,actions:t,children:s})=>n.createElement("div",{className:"IconNote"},e&&n.createElement("div",{className:"IconNote__icon"},e),n.createElement("div",{className:"IconNote__content"},s),t&&n.createElement("div",{className:"IconNote__actions"},t))},266864:(e,t,s)=>{s.d(t,{ModalInterface:()=>l});s(360862);var n=s(667294),r=s(671324),a=s(874971),o=s(964929),i=s(798855),c=s(234325),d=s(506315);const l=({onClose:e,closeLabel:t,onBack:s,backLabel:l,title:u,contextClass:h,panelClass:p,hasClearBackdrop:m,isHidden:f,portalTarget:g,buttons:v,withCustomLayout:_,children:C,footerHint:y})=>n.createElement(r.ModalView,{onEscape:e,contextClass:h,portalTarget:g,isHidden:f},n.createElement(a.ModalBackdrop,{onClick:e,isClear:m},n.createElement(o.ModalPanel,{className:p},n.createElement(i.ModalHeader,{closeLabel:t,onClose:e,backLabel:l,onBack:s,title:u}),n.createElement(c.ModalBody,{withCustomLayout:_},C),v&&n.createElement(d.ModalFooter,{buttons:v,hint:y}))))},988277:(e,t,s)=>{s.d(t,{NoResults:()=>i});s(58245);var n=s(667294),r=s(164497),a=s(294184),o=s.n(a);const i=n.memo((function({children:e,icon:t=n.createElement(r.Icon56MessagesOutline,null),className:s}){return n.createElement("div",{className:o()("NoResults",s)},n.createElement("span",{className:"NoResults__icon"},t),n.createElement("div",{className:"NoResults__text"},e))}))},282384:(e,t,s)=>{s.d(t,{OnlineStatus:()=>a});var n=s(667294),r=s(696023);const a=n.memo((function({className:e,user:t}){const{lang:s}=(0,r.useBrowserEnv)(),a=(0,r.useLastSeen)(t.id),o=(0,r.useNow)(6e5);if("Contact"===t.kind){if(t.lastSeen&&["today","recently"].includes(t.lastSeen)){const r={today:s.use("global_online_was_today",{sex:"male"}),recently:s.use("global_online_was_recently",{sex:"male"})}[t.lastSeen];return n.createElement("span",{className:e,role:"status"},r)}return null}const i=n.createElement("div",{className:e}," ");if(!a)return i;if(a.isOnline)return n.createElement("span",{className:e,role:"status"},s.use("global_online",{sex:t.sex}));if("number"==typeof a.at)return n.createElement("span",{className:e,role:"status"},s.formatDate(a.at,{now:o,variant:"time-ago"}));let c;switch(a.at){case"recently":c="global_online_was_recently";break;case"last_week":c="global_online_was_week";break;case"last_month":c="global_online_this_month";break;case"long_ago":case"not_show":c="global_online_long_ago";break;default:a.at;return i}return n.createElement("span",{role:"status",className:e},s.use(c,{sex:t.sex}))}))},863994:(e,t,s)=>{s.d(t,{PeerChip:()=>l});var n=s(667294),r=s(96190),a=s(676126),o=(s(279478),s(294184)),i=s.n(o),c=s(696023),d=s(7817);const l=({peerId:e,onRemove:t,className:s})=>{const{lang:o}=(0,c.useBrowserEnv)(),l=(0,c.usePeers)(),u=r.safeGet(l,e);return n.createElement("div",{className:i()("PeerChip",s)},n.createElement("div",{className:"PeerChip__content"},n.createElement(d.AvatarSimple,{peer:u,size:20}),n.createElement("div",{className:"PeerChip__name"},r.firstName(u))),t&&n.createElement("button",{"aria-label":o.use("me_remove"),className:"PeerChip__remove",onClick:t},n.createElement(a.Icon16Cancel,null)))}},519478:(e,t,s)=>{s.d(t,{PeerChipsSearchInput:()=>u});var n=s(667294),r=s(24087),a=(s(42505),s(696023)),o=s(863994),i=s(116438),c=s(367763),d=s(65970),l=s(546428);const u=({onQueryChange:e,onRemove:t,selection:s,placeholder:u,onSearchInputBlur:h,onSearchInputFocus:p,onSearchInputKeyDown:m})=>{const{lang:f}=(0,a.useBrowserEnv)(),g=(0,n.useRef)(null),v=(0,n.useRef)(null),[_,C]=(0,n.useState)(""),y=(0,a.usePrevious)(s),{isTouchOnly:k}=(0,c.useDeviceData)(),[I,w]=(0,n.useState)(!1);(0,n.useEffect)((()=>{var e,t;(null!=(t=null==(e=y)?void 0:e.size)?t:0)<s.size&&!I&&C("")}),[y,s.size,I]);(0,n.useEffect)((()=>{e(_)}),[_]),(0,n.useEffect)((()=>{const e=v.current;e&&(y&&y.size>=s.size||e.scrollIntoView({block:"nearest"}))}),[y,s]),(0,n.useEffect)((()=>{v.current&&(k||v.current.focus())}),[s,k]);const M=(0,n.useMemo)((()=>Array.from(s.values())),[s]),R=(0,n.useMemo)((()=>{const e=[];for(let s=0;s<M.length;s+=1){var t;const n=M[s];"peer"===(null==(t=n)?void 0:t.kind)&&e.push(n.peerId)}return e}),[M]),b=(0,n.useMemo)((()=>(0,l.onElementKeyDownFactory)(((e,t)=>{switch(e){case"Mod":w(!0);break;case"Escape":t(),C("")}}))),[]);return n.createElement("div",{className:"PeerChipsSearchInput","data-testid":"PeerChipsSearchInput"},n.createElement(r.default,{style:{maxHeight:134},ref:g},n.createElement("div",{className:"PeerChipsSearchInput__content",onMouseDown:e=>{const t=v.current;t&&document.activeElement===t&&e.stopPropagation()},onClick:e=>{e.currentTarget===e.target&&v.current&&v.current.focus()}},0===R.length&&n.createElement("div",{className:"PeerChipsSearchInput__icon"},n.createElement(i.Icon20Search,null)),R.length>0&&R.map((e=>n.createElement(o.PeerChip,{key:e,peerId:e,className:"PeerChipsSearchInput__item",onRemove:()=>(e=>{var s;const n=M.find((t=>"peer"===t.kind&&t.peerId===e));n&&(null==(s=t)||s(n))})(e)}))),n.createElement("div",{className:"PeerChipsSearchInput__inputContainer"},n.createElement("input",{"data-testid":"PeerChipsSearchInput__input",className:"PeerChipsSearchInput__input",ref:v,onChange:e=>{C(e.currentTarget.value)},value:_,placeholder:(()=>{if(!(R.length>0))return u||f.use("me_picker_peer_search_placeholder")})(),onBlur:h,onFocus:p,onKeyDown:e=>{b(e),m(e)},onKeyUp:e=>{"Mod"===(0,d.getKeyCombo)(e)&&w(!1)}})))))}},4738:(e,t,s)=>{s.d(t,{PeerPickerList:()=>m});var n=s(434788),r=s(820224),a=s(667294),o=s(318016),i=(s(932823),s(684709)),c=s(414831),d=s(126528),l=s(53763),u=s(988277),h=s(696023),p=s(89131);const m=e=>{var{controlType:t,controlSide:s,descriptive:m=!0,loaderNode:f,errorNode:g,emptyNode:v,itemRenderer:_,itemHeight:C=56}=e,y=(0,r._)(e,["controlType","controlSide","descriptive","loaderNode","errorNode","emptyNode","itemRenderer","itemHeight"]);const{lang:k}=(0,h.useBrowserEnv)(),I=(0,a.useCallback)((e=>{switch(e.item.kind){case"peer":return a.createElement(c.PeerPickerListItem,{isGlobal:e.item.isGlobal,controlType:t,controlSide:s,descriptive:m,selected:e.selected,disabled:e.disabled,peerId:e.item.peerId,onSelection:()=>e.onSelection({id:e.id,value:e.item})});case"template":return e.item.node;default:return(0,p.exhaustivenessCheck)(e.item)}}),[m,t,s]),w=e=>a.createElement("div",{className:"PeerPickerList__content"},e);return a.createElement(i.PickerList,(0,n._)({},y,{itemRenderer:_||I,itemHeight:C,loaderNode:w(f||a.createElement(d.OptimizedSpinner,null)),errorNode:w(g||a.createElement(l.IconNote,{icon:a.createElement(o.Icon56ErrorOutline,null)},a.createElement("div",{className:"PeerPickerList__error"},k.use("me_picker_peer_list_error")))),emptyNode:w(v||a.createElement(u.NoResults,null,k.use("me_picker_peer_list_empty")))}))}},414831:(e,t,s)=>{s.d(t,{PeerPickerListItem:()=>p});var n=s(667294),r=s(96190),a=s(185327),o=s(760540),i=s(696023),c=(s(737968),s(7817)),d=s(377291),l=s(248390),u=s(661059),h=s(953614);const p=({selected:e=!1,disabled:t=!1,peerId:s,onSelection:p,controlType:m="check",controlSide:f="left",descriptive:g=!0,isGlobal:v=!1})=>{const _=(0,i.usePeers)(),C=(0,i.useConvos)(),y=r.safeGet(_,s),k=(0,i.useOwner)(),I="Chat"===y.kind?a.safeGet(C,y.id):null,w=r.isFavorites(y.id,k.id);return n.createElement(o.PickerItem,{selected:e,disabled:t,onSelection:p,controlType:m,controlSide:f,className:"PeerPickerListItem__item"},n.createElement("div",{className:"PeerPickerListItem","data-testid":"PeerPickerListItem"},n.createElement("div",{className:"PeerPickerListItem__avatar"},w?n.createElement(d.AvatarFavorites,{size:40}):n.createElement(c.AvatarSimple,{peer:y,size:40})),n.createElement("div",{className:"PeerPickerListItem__content"},n.createElement("div",{className:"PeerPickerListItem__name"},"User"===y.kind?n.createElement(l.PeerTitle,{peer:y,isFavorites:w}):n.createElement(u.ConvoTitle,{peer:y,isMuted:!1,isCasper:null!==I&&a.isCasper(I)})),!w&&g&&n.createElement(h.PeerSubhead,{className:"PeerPickerListItem__info",peer:y,convo:I,showScreenName:v}))))}},953614:(e,t,s)=>{s.d(t,{PeerSubhead:()=>d});var n=s(667294),r=s(696023),a=s(282384),o=s(86894),i=s(89131),c=s(67091);const d=({peer:e,convo:t,showScreenName:s,className:d})=>{const{lang:l}=(0,r.useBrowserEnv)();return n.createElement(o.Subhead,{className:d,Component:"span",weight:"3"},(()=>{if(s&&("User"===e.kind||"Group"===e.kind)&&e.screenName)return n.createElement(n.Fragment,null,"@",e.screenName);switch(e.kind){case"User":return n.createElement(a.OnlineStatus,{user:e});case"Chat":var r;if("ChatConvo"!==(null==(r=t)?void 0:r.kind))return"";switch(t.state){case"in":return l.use("me_group_members_count",{num:t.membersCount,formatted:"short"});case"left":return l.use("me_convo_profile_left_chat_label");case"kicked":return l.use("me_convo_profile_kicked_chat_label");case"out":return"";default:t.state;return""}case"Group":return l.use("me_group_members_count",{num:e.memberCount,formatted:"short"});case"Contact":return n.createElement(c.FormattedPhoneNumber,{phone:e.phone});default:(0,i.exhaustivenessCheck)(e)}})())}},248390:(e,t,s)=>{s.d(t,{PeerTitle:()=>h});s(501954);var n=s(667294),r=s(984172),a=s(583841),o=s(769777),i=s(96190),c=s(294184),d=s.n(c),l=s(696023),u=s(709646);const h=n.memo((function({peer:e,isShortened:t=!1,isAdmin:s=!1,isFavorites:c=!1,className:h}){const{lang:p}=(0,l.useBrowserEnv)(),m=(0,l.useViewer)(),f=u.isEdu(m.profileType);let g;switch(!0){case c:g=p.use("me_favorites");break;case t:g=i.firstName(e);break;default:g=i.name(e)}return n.createElement("div",{className:d()("PeerTitle",{"PeerTitle--vkAdmin":i.isVkAdministration(e.id)},h)},n.createElement("div",{className:"PeerTitle__title"},g),"Chat"!==e.kind&&"Contact"!==e.kind&&e.isVerified?n.createElement("span",{className:"PeerTitle__icon PeerTitle__verifiedIcon"},f&&"User"===e.kind?n.createElement(r.Icon16Education,{width:12,height:12}):n.createElement(a.Icon16Verified,null)):null,s&&n.createElement("span",{className:"PeerTitle__icon PeerTitle__adminIcon"},n.createElement(o.Icon12Favorite,{"aria-hidden":!1,"aria-label":p.use("me_admin")})))}))},827258:(e,t,s)=>{s.d(t,{Picker:()=>d});var n=s(667294),r=s(294184),a=s.n(r),o=(s(883061),s(760802)),i=s(696023);const c=new Map,d=({strategy:e="singular",onSelectionChange:t,searchRenderer:s,listRenderer:r,selection:d=c,items:l,total:u,search:h,prefetch:p,isLoading:m=!1,isPristine:f=!1,hasFailed:g=!1,checkDisabledItem:v,initialQuery:_,getItemId:C,className:y,onQueryChange:k,onLoadMore:I})=>{const{toggleSelection:w,selection:M}=(0,o.usePicker)({strategy:e,selection:d}),{query:R,onBlur:b,onKeyDown:S,onFocus:E,onQueryUpdate:U,indexToSelect:P,forceScrollToLoader:A}=(0,o.usePickerSearch)({items:l,onSelect:w,getItemId:C,onQueryChange:k,initialQuery:_,hasMore:null===u||u>l.length});(0,n.useEffect)((()=>{var e;null==(e=p)||e({query:R}),h({query:R,offset:0,count:50})}),[R]),(0,n.useEffect)((()=>{t(M)}),[M]);const T=(0,n.useMemo)((()=>l.map(((e,t)=>{const s=C(e);return{id:s,item:e,selected:M.has(s),disabled:!!v&&v(e),focusedWithNavigation:t===P}}))),[C,v,l,M,P]),N=I||(({offset:e,count:t})=>{h({offset:e,count:t,query:R})});(0,i.useDidUpdate)((()=>{var e;null==(e=x.current)||e.scrollToItem(P)}),[P]),(0,n.useLayoutEffect)((()=>{var e;A&&(null==(e=x.current)||e.scrollToItem(P+1))}),[A,P]);const x=(0,n.useRef)(null);return n.createElement("div",{className:a()("Picker",y)},n.createElement(s,{items:l,onQueryChange:U,selection:M,onRemove:e=>{w({id:C(e),value:e})},onSearchInputBlur:b,onSearchInputFocus:E,onSearchInputKeyDown:S}),n.createElement(r,{items:T,total:u,onItemSelection:w,loadMore:N,loading:m,pristine:f,failed:g,listRef:x}))}},760540:(e,t,s)=>{s.d(t,{PickerItem:()=>h});var n=s(434788),r=s(820224),a=s(667294),o=s(832963),i=s(976004),c=s(970748),d=s(294184),l=s.n(d),u=(s(669721),s(89131));const h=e=>{var{controlType:t="check",controlSide:s="left",selected:d,disabled:h,onSelection:p,children:m,className:f}=e,g=(0,r._)(e,["controlType","controlSide","selected","disabled","onSelection","children","className"]);const v=(0,a.useCallback)((()=>{h||p()}),[h,p]),_=(0,a.useMemo)((()=>{switch(t){case"arrow":return a.createElement(o.Icon24ChevronCompactRight,{className:"PickerItem__arrow"});case"check":return d?a.createElement(i.Icon20CheckCircleOn,null):a.createElement(c.Icon20CheckCircleOff,null);default:(0,u.exhaustivenessCheck)(t)}}),[t,d]),C=(0,a.useCallback)((e=>{"Enter"===e.key&&v()}),[v]);return a.createElement("div",(0,n._)({},g,{className:l()("PickerItem",`PickerItem--${s}`,{"PickerItem--disabled":h},{"PickerItem--selected":d},f),tabIndex:-1,role:"checkbox","aria-checked":d,onClick:v,onKeyDown:C}),a.createElement("button",{type:"button",className:"PickerItem__button",tabIndex:-1},_),a.createElement("div",{className:"PickerItem__content"},m))}},684709:(e,t,s)=>{s.d(t,{PickerList:()=>u});var n=s(11010),r=s(434788),a=s(667294),o=s(24087),i=(s(466135),s(274061)),c=s(365691),d=s(294184),l=s.n(d);const u=({items:e,total:t,loading:s,failed:d,pristine:u,onItemSelection:h,itemRenderer:p,itemHeight:m,loaderNode:f,emptyNode:g,errorNode:v,loadMore:_,header:C,footer:y,listRef:k})=>{var I;const[w,M]=(0,a.useState)(null),R=(0,a.useRef)(null),b=(0,a.useRef)(null),S=(0,a.useRef)(null),[,E]=(0,a.useState)({}),U=null===t||t>e.length,P=(0,a.useCallback)((({index:e,style:t,data:{loaderNode:s,loading:n,items:o}})=>{const i=o[e];return i?a.createElement("div",{style:t,key:i.id,className:l()("PickerList__item",{"PickerList__item--selected":i.focusedWithNavigation})},a.createElement(p,(0,r._)({},i))):e===o.length&&n&&s?a.createElement("div",{style:t,className:"PickerList__item"},s):null}),[p]);(0,a.useEffect)((()=>{if(!w)return;b.current=w.offsetHeight;const e=new ResizeObserver((e=>{if(0===e.length)return;if(e.forEach((e=>{const t=e.contentRect;b.current&&(S.current=b.current),b.current=t.height})),!(S.current&&b.current&&R.current&&k.current))return;const t=S.current-b.current;k.current.scrollTo(R.current.scrollTop+t),E({})}));return e.observe(w),()=>e.disconnect()}),[w,R,k,E]);const A=(0,a.useCallback)((t=>!!e[t]),[e]),T=(0,a.useCallback)((0,n._)((function*(e,t){_({offset:e,count:t-e})})),[_]);if(0===(null==(I=e)?void 0:I.length))return a.createElement(a.Fragment,null,C,s?f:u?null:d?v:g||null,y);const N={loaderNode:f,loading:s,items:e.map((e=>(0,r._)({},e,{onSelection:h})))};return a.createElement("div",{ref:e=>M(e),className:"PickerList"},C,a.createElement("div",{className:"PickerList__container"},a.createElement(c.default,{isItemLoaded:A,loadMoreItems:T,itemCount:U?t||e.length+20:e.length},(({onItemsRendered:n,ref:r})=>a.createElement(o.default,{style:{width:"100%",height:"100%"}},(({scrollableNodeRef:o,contentNodeRef:c})=>(R.current=o.current,a.createElement(i.FixedSizeList,{ref:e=>{k.current=e,r(e)},direction:"ltr",onItemsRendered:n,height:b.current||0,width:"100%",overscanCount:25,itemSize:m,itemData:N,outerRef:o,className:"PickerList__list",innerRef:c,itemCount:null!==t?s?e.length+1:t:e.length+1},P))))))),y)}},740779:(e,t,s)=>{s.d(t,{SortableList:()=>a,useSortable:()=>i});var n=s(667294);const r=n.createContext(null),a=({children:e,items:t,disabled:s,onChange:a})=>{const[o,i]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),l=(0,n.useMemo)((()=>o?t.indexOf(o):-1),[o,t]),u=(0,n.useMemo)((()=>({items:t,active:o,activeIndex:l,hover:c,disabled:!0===s,setActive:i,setHover:d,onChange:a})),[t,o,l,c,s,a]);return n.createElement(r.Provider,{value:u},e)};function o(e,t,s){return e>=t&&e<=s}function i({id:e,lockAxis:t}){const s=(0,n.useContext)(r);if(!s)throw new Error("Сортируемые элементы должны быть обёрнуты в SortableList");const{active:a,disabled:o,activeIndex:i,hover:d,items:l,setActive:u,setHover:h,onChange:p}=s,m=(0,n.useMemo)((()=>l.indexOf(e)),[e,l]),f=(0,n.useRef)(null),[g,v]=(0,n.useState)({transform:"translate(0, 0)"}),_=(0,n.useMemo)((()=>({"data-item-id":e})),[e]),C=(0,n.useCallback)((()=>{o||(u(e),v({pointerEvents:"none",touchAction:"none"}),document.body.style.overscrollBehavior="contain")}),[o,e,u]),y=(0,n.useCallback)((()=>{if(d){const s=[...l],n=s.indexOf(d.id);let r=n;var t;if(r=1===(i<n?1:-1)?"top"===d.side?n-1:n:"top"===d.side?n:n-1,void 0!==e)s.splice(i,1),s.splice(r,0,e),null==(t=p)||t(s)}v({transform:"translate(0, 0)"}),u(null),h(null),document.body.style.overscrollBehavior="auto"}),[i,d,e,l,p,u,h]),k=(0,n.useCallback)((({shiftX:e,shiftY:s,originalEvent:n})=>{let r,o,i="";switch(t){case"x":i=`translateX(${e}px)`;break;case"y":i=`translateY(${s}px)`;break;default:i=`translate(${e}px, ${s}px)`}v({transform:i,pointerEvents:"none",touchAction:"none",position:"relative",zIndex:99999});const{touches:c}=n;c&&c[0]?(({clientX:r,clientY:o}=c[0]),n.preventDefault(),n.stopPropagation()):(r=n.clientX,o=n.clientY);const l=document.elementFromPoint(r,o);if(l){var u,p;const e=l.closest("[data-item-id]"),t=(null==(u=e)?void 0:u.dataset.itemId)?parseInt(null==(p=e)?void 0:p.dataset.itemId):null;if(e&&null!==a&&a!==t){var m,f;const s=e.getBoundingClientRect(),n=s.top+s.height/2<o?"bottom":"top";(null==(m=d)?void 0:m.id)===t&&(null==(f=d)?void 0:f.side)===n||h({id:t,side:n})}}}),[a,d,t,h]);return(0,n.useEffect)((()=>{if(null!==a){if(a!==e&&d&&f.current){const t=l.indexOf(e),s=l.indexOf(d.id),n=c(t,i,s,d.side,f.current.offsetHeight);v({transform:`translateY(${n}px)`,transition:"transform 150ms"})}}else v({transform:"translateY(0px)",transition:""})}),[a,i,d,e,l]),{index:m,setNodeRef:f,active:e===a,isDragging:null!==a,styles:g,attrs:_,disabled:o,onStart:C,onEnd:y,onMove:k}}const c=(e,t,s,n,r)=>{if(null===t||null===s||null===r||t===e)return 0;if(!(t>s?o(e,s,t):o(e,t,s)))return 0;if(1===(t<s?1:-1)){if("top"===n&&e<s)return-1*r;if("bottom"===n)return-1*r}else{if("bottom"===n&&e>s)return r;if("top"===n)return r}return 0}},129879:(e,t,s)=>{s.d(t,{Snackbar:()=>d});s(168577);var n=s(667294),r=s(294184),a=s.n(r),o=s(367763),i=s(86894),c=s(737169);const d=(0,n.memo)((({message:e,layout:t="horizontal",action:s,before:r,after:d,duration:l=4e3,onActionClick:u,onClose:h,mode:p="default",className:m,stopOnHover:f=!0,isManuallyClosable:g=!1,autoClose:v=!0,requestClose:_=!1,onRequestRemove:C})=>{const{isTouchOnly:y}=(0,o.useDeviceData)(),[k,I]=(0,n.useState)(l);(0,n.useEffect)((()=>{I(l)}),[l]);const w=(0,n.useRef)((()=>{}));w.current=()=>{var e;C(),null==(e=h)||e()};(0,n.useEffect)((()=>{if(null==k||!v)return;let e=null;return e=window.setTimeout((()=>{w.current()}),k),()=>{e&&window.clearTimeout(e)}}),[v,k]),(0,n.useEffect)((()=>{_&&w.current()}),[_]);const M=d||!y?"vertical":t;return n.createElement("div",{className:a()("Snackbar",`Snackbar--layout-${M}`,`Snackbar--mode-${p}`,m),onMouseEnter:()=>{f&&I(null)},onMouseLeave:()=>{f&&I(l)}},n.createElement("div",{className:"Snackbar__body"},r&&n.createElement("div",{className:"Snackbar__before"},r),n.createElement("div",{className:"Snackbar__content"},n.createElement(i.Paragraph,{className:"Snackbar__content-text"},e),s&&n.createElement(i.Button,{align:"left",hasHover:!1,mode:"tertiary",appearance:"dark"===p?"overlay":"accent",size:"s",className:"Snackbar__action",onClick:e=>{var t;(w.current(),s)&&(null==(t=u)||t(e))}},s)),d&&n.createElement("div",{className:"Snackbar__after"},d)),g&&n.createElement(i.Button,{onClick:w.current,after:n.createElement(c.Icon12Cancel,null),mode:"tertiary",appearance:"dark"===p?"overlay":"neutral",size:"s",className:"Snackbar__close"}))}))},814640:(e,t,s)=>{s.d(t,{SnackbarContainer:()=>o});var n=s(434788),r=s(667294),a=s(355795);s(980160);const o=({withPortal:e=!0,portalProps:t={portalClassName:"MEConfig SnackbarModal"},children:s})=>r.createElement(i,{withPortal:e,portalProps:t},r.createElement("div",{className:"SnackbarContainer"},s)),i=(0,r.memo)((({withPortal:e,children:t,portalProps:s})=>e?r.createElement(a.Portal,(0,n._)({},s),t):r.createElement(r.Fragment,null,t)))},545443:(e,t,s)=>{s.d(t,{Symbols:()=>r});s(516073);var n=s(667294);const r=()=>n.createElement("svg",{className:"Symbols"},n.createElement("defs",null,n.createElement("symbol",{id:"mePhone10"},n.createElement("path",{d:"M6.17 6.8c1.1-1.09 2.32-.5 3.3.33 1.15.97.26 2.7-1.08 2.83-1.82.24-3.72-.63-5.72-2.63-2-2-2.88-3.91-2.63-5.73C.16.27 1.91-.62 2.87.52c.82.98 1.41 2.2.32 3.3-.9.9-.16 1.55.64 2.35s1.45 1.53 2.34.64z"})),n.createElement("symbol",{id:"meExpand"},n.createElement("path",{d:"M15.7688 13.7067L11.906 10L15.7688 6.29326C16.0771 5.99741 16.0771 5.51774 15.7688 5.22189C15.4605 4.92604 14.9606 4.92604 14.6523 5.22189L10.2312 9.46431C9.92292 9.76017 9.92292 10.2398 10.2312 10.5357L14.6523 14.7781C14.9606 15.074 15.4605 15.074 15.7688 14.7781C16.0771 14.4823 16.0771 14.0026 15.7688 13.7067Z"}),n.createElement("path",{d:"M9.76877 13.7067L5.90596 10L9.76877 6.29326C10.0771 5.99741 10.0771 5.51774 9.76877 5.22189C9.46046 4.92604 8.96059 4.92604 8.65228 5.22189L4.23123 9.46431C3.92292 9.76017 3.92292 10.2398 4.23123 10.5357L8.65228 14.7781C8.96059 15.074 9.46046 15.074 9.76877 14.7781C10.0771 14.4823 10.0771 14.0026 9.76877 13.7067Z"})),n.createElement("symbol",{id:"meCake10"},n.createElement("path",{d:"M9.16667 8.07392C8.33947 8.29895 7.41292 8.1867 6.66667 7.73385C5.66596 8.34111 4.33404 8.34111 3.33333 7.73385C2.58708 8.1867 1.66053 8.29895 0.833333 8.07392V9.09126C0.833333 9.59314 1.20643 10 1.66667 10H8.33333C8.79357 10 9.16667 9.59314 9.16667 9.09126V8.07392Z"}),n.createElement("path",{d:"M0 5.00191C0 4.50003 0.373096 4.09317 0.833333 4.09317H9.16667C9.6269 4.09317 10 4.50003 10 5.00191C10 6.36503 9.16667 6.8194 8.33333 6.8194C7.08333 6.8194 6.66667 5.91065 6.66667 5.91065C6.66667 5.91065 6.25 6.8194 5 6.8194C3.75 6.8194 3.33333 5.91065 3.33333 5.91065C3.33333 5.91065 2.91667 6.8194 1.66667 6.8194C0.833333 6.8194 0 6.36503 0 5.00191Z"}),n.createElement("path",{d:"M7.83935 0.0492567C7.87234 -0.0164189 7.96099 -0.0164189 7.99398 0.0492567C8.38334 0.824332 8.75 1.16164 8.75 1.82131C8.75 2.32319 8.3769 2.73005 7.91667 2.73005C7.45643 2.73005 7.08333 2.32319 7.08333 1.82131C7.08333 1.16164 7.44999 0.824332 7.83935 0.0492567Z"}),n.createElement("path",{d:"M2.00602 0.0492567C2.03901 -0.0164189 2.12766 -0.0164189 2.16065 0.0492567C2.55001 0.824332 2.91667 1.16164 2.91667 1.82131C2.91667 2.32319 2.54357 2.73005 2.08333 2.73005C1.6231 2.73005 1.25 2.32319 1.25 1.82131C1.25 1.16164 1.61665 0.824332 2.00602 0.0492567Z"}),n.createElement("path",{d:"M4.92268 0.0492567C4.95568 -0.0164189 5.04432 -0.0164189 5.07732 0.0492567C5.46668 0.824332 5.83333 1.16164 5.83333 1.82131C5.83333 2.32319 5.46024 2.73005 5 2.73005C4.53976 2.73005 4.16667 2.32319 4.16667 1.82131C4.16667 1.16164 4.53332 0.824332 4.92268 0.0492567Z"}))),n.createElement("circle",{id:"mePeerFrameOffline20",cx:"10",cy:"10",r:"10"}),n.createElement("path",{id:"mePeerFrameMe24",d:"M20 10a12 12 0 10-9.9 9.9 7 7 0 019.9-9.9z"}),n.createElement("circle",{id:"mePeerFrameOffline24",cx:"12",cy:"12",r:"12"}),n.createElement("path",{id:"mePeerFrameOnline24",d:"M23.57 15.18A12.02 12.02 0 0012 0a12 12 0 103.18 23.57 6 6 0 018.4-8.4z"}),n.createElement("path",{id:"mePeerFrameMobile24",d:"M14.08 23.82a12 12 0 119.9-12.29 3.98 3.98 0 00-1.98-.53h-4a4 4 0 00-4 4v8c0 .28.03.56.08.82z"}),n.createElement("path",{id:"mePeerFrameMe24",d:"M23.84 13.95a12 12 0 10-9.9 9.9 7 7 0 019.9-9.9z"}),n.createElement("circle",{id:"mePeerFrameOffline32",cx:"16",cy:"16",r:"16"}),n.createElement("path",{id:"mePeerFrameOnline32",d:"M30.72 22.29a16 16 0 10-8.43 8.43 6 6 0 018.43-8.43z"}),n.createElement("path",{id:"mePeerFrameMobile32",d:"M21 31.2a16 16 0 1110.52-11.3A3.98 3.98 0 0029 19h-4a4 4 0 00-4 4v8.2z"}),n.createElement("path",{id:"mePeerFrameMe32",d:"M31.1 21.32a16 16 0 10-9.77 9.77 7 7 0 019.77-9.77z"}),n.createElement("path",{id:"mePeerFrameMe32c",d:"M18.1533 0.143651C17.449 0.0489165 16.7302 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32C17.8656 32 19.6565 31.6807 21.3213 31.0938C20.4899 29.9426 20 28.5285 20 27C20 24.8923 20.9316 23.0021 22.4054 21.7188C17.0253 20.533 13 15.7366 13 10C13 5.91761 15.0386 2.31134 18.1533 0.143651ZM30.2451 20.796C30.5411 20.9512 30.8247 21.1269 31.0938 21.3213C31.2337 20.9244 31.3584 20.5204 31.4672 20.1099C31.0749 20.3614 30.6669 20.5907 30.2451 20.796Z"}),n.createElement("path",{id:"mePeerFrameMobile32c",d:"M18.1533 0.143651C17.449 0.0489165 16.7302 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32C17.748 32 19.4305 31.7197 21.005 31.2016C21.0017 31.1348 21 31.0676 21 31V23C21 22.4411 21.1146 21.9089 21.3217 21.4257C16.4937 19.8727 13 15.3443 13 10C13 5.91761 15.0386 2.31134 18.1533 0.143651Z"}),n.createElement("path",{id:"mePeerFrameOffline32c",d:"M31.47 20.11A12 12 0 0118.16.14a16 16 0 1013.31 19.97z"}),n.createElement("path",{id:"mePeerFrameOnline32c",d:"M18.1533 0.143651C17.449 0.0489165 16.7302 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32C18.2328 32 20.3588 31.5426 22.2893 30.7165C21.4819 29.6945 21 28.4035 21 27C21 24.8726 22.1072 23.0038 23.7767 21.9384C17.7239 21.3256 13 16.2145 13 10C13 5.91761 15.0386 2.31134 18.1533 0.143651ZM28.9655 21.3293C29.6052 21.551 30.1958 21.8779 30.7165 22.2893C31.0169 21.5873 31.2686 20.8594 31.4672 20.1099C30.6899 20.6082 29.8514 21.0192 28.9655 21.3293Z"}),n.createElement("circle",{id:"mePeerFrameOffline40",cx:"20",cy:"20",r:"20"}),n.createElement("path",{id:"mePeerFrameOnline40",d:"M29.29 37.72a20 20 0 118.43-8.43 5.99 5.99 0 10-8.43 8.43z"}),n.createElement("path",{id:"mePeerFrameMobile40",d:"M28.2 38.25a20 20 0 1110.78-11.92A3.99 3.99 0 0036 25h-4a4 4 0 00-4 4v8a4 4 0 00.2 1.25z"}),n.createElement("path",{id:"mePeerFrameMe40",d:"M28.31 38.2a20 20 0 119.89-9.89 7 7 0 10-9.89 9.89z"}),n.createElement("path",{id:"mePeerFrameMe40c",d:"M33 22c2.61 0 5.03-.83 7-2.25V20c0 2.97-.65 5.78-1.8 8.31a7 7 0 10-9.89 9.89A20 20 0 1125.38.73 12 12 0 0033 22z"}),n.createElement("path",{id:"mePeerFrameMobile40c",d:"M33 22c2.61 0 5.03-.83 7-2.25V20c0 2.21-.36 4.34-1.02 6.33A3.99 3.99 0 0036 25h-4a4 4 0 00-4 4v8a4 4 0 00.2 1.25A20 20 0 1125.38.73 12 12 0 0033 22z"}),n.createElement("path",{id:"mePeerFrameOffline40c",d:"M40 19.75A12 12 0 0125.38.73 20.02 20.02 0 000 20a20 20 0 1040-.25z"}),n.createElement("path",{id:"mePeerFrameOnline40c",d:"M33 22c2.61 0 5.03-.83 7-2.25V20c0 3.35-.83 6.51-2.28 9.29a5.99 5.99 0 10-8.43 8.43A20 20 0 1125.38.74 12 12 0 0033 22z"}),n.createElement("circle",{id:"mePeerFrameOffline44",cx:"22",cy:"22",r:"22"}),n.createElement("path",{id:"mePeerFrameOnline44",d:"M41.21 32.73a22 22 0 10-8.49 8.49 6 6 0 018.49-8.49z"}),n.createElement("path",{id:"mePeerFrameMobile44",d:"M31.13 42.02a22 22 0 1111.1-11.37A4 4 0 0039 29h-4a4 4 0 00-4 4v8c0 .35.05.7.13 1.02z"}),n.createElement("path",{id:"mePeerFrameMe44",d:"M41.7 31.81a22 22 0 10-9.89 9.89 7 7 0 019.89-9.89z"}),n.createElement("path",{id:"mePeerFrameOffline44c",d:"M43.97 20.77A12 12 0 0129.78 1.41a22 22 0 1014.19 19.36z"}),n.createElement("path",{id:"mePeerFrameOnline44c",d:"M29.78 1.41a22 22 0 102.95 39.8 6 6 0 018.49-8.49 21.9 21.9 0 002.75-11.95A12 12 0 0129.78 1.41z"}),n.createElement("path",{id:"mePeerFrameMobile44c",d:"M43.97 20.77A12 12 0 0129.78 1.41a22 22 0 101.35 40.6 4 4 0 01-.13-1.01v-8a4 4 0 014-4h4a4 4 0 013.24 1.65 21.93 21.93 0 001.73-9.88z"}),n.createElement("path",{id:"mePeerFrameMe44c",d:"M29.78 1.41A22 22 0 1031.8 41.7a7 7 0 019.89-9.89 21.91 21.91 0 002.27-11.03A12 12 0 0129.78 1.41z"}),n.createElement("circle",{id:"mePeerFrameOffline46",cx:"23",cy:"23",r:"23"}),n.createElement("path",{id:"mePeerFrameOnline46",d:"M42.94 34.47a23 23 0 10-8.47 8.47 6 6 0 018.47-8.47z"}),n.createElement("path",{id:"mePeerFrameMobile46",d:"M33.06 43.69A23 23 0 1144 32.37 3.99 3.99 0 0041 31h-4a4 4 0 00-4 4v8c0 .24.02.47.06.69z"}),n.createElement("path",{id:"mePeerFrameMe46",d:"M43.43 33.58a23 23 0 10-9.85 9.85 7 7 0 019.85-9.85z"}),n.createElement("path",{id:"mePeerFrameOffline46c",d:"M45.9 20.82A12 12 0 0131.5 1.62a23 23 0 1014.39 19.2z"}),n.createElement("path",{id:"mePeerFrameOnline46c",d:"M31.5 1.63a23 23 0 102.96 41.31 6 6 0 018.47-8.47 22.9 22.9 0 002.97-13.65A12 12 0 0131.5 1.62z"}),n.createElement("path",{id:"mePeerFrameMobile46c",d:"M45.9 20.82A12 12 0 0131.5 1.62a23 23 0 101.55 42.06A4.03 4.03 0 0133 43v-8a4 4 0 014-4h4c1.2 0 2.28.53 3.01 1.37a22.92 22.92 0 001.89-11.55z"}),n.createElement("path",{id:"mePeerFrameMe46c",d:"M31.5 1.63a23 23 0 102.07 41.8 7 7 0 019.85-9.85 22.9 22.9 0 002.48-12.76A12 12 0 0131.5 1.62z"}),n.createElement("circle",{id:"mePeerFrameOffline72",cx:"37",cy:"37",r:"37"}),n.createElement("circle",{id:"mePeerFrameOffline92",cx:"46",cy:"46",r:"46"}),n.createElement("circle",{id:"mePeerFrameOffline96",cx:"48",cy:"48",r:"48"}),n.createElement("path",{id:"meUsersStack16",d:"M14 2.715A8 8 180 008 0 8 8 180 008 16 8 8 180 0014 13.285 8 8 180 0114 2.715"}),n.createElement("path",{id:"meUsersStack18",d:"M 16 14 A 9 9 90 0 1 9 18 A 9 9 90 0 1 9 0 A 9 9 90 0 1 16 4 A 9 9 90 0 0 16 14"}),n.createElement("path",{id:"meUsersStack24",d:"M22 18.6A12 12 0 0112 24 12 12 0 0112 0 12 12 0 0122 5.4 12 12 0 0022 18.6"}),n.createElement("path",{id:"meUsersStack32",d:"M30 23.8A16 16 0 0116 32 16 16 0 0116 0 16 16 0 0130 8.3 16 16 0 0030 23.8"}),n.createElement("path",{id:"meUsersStack40",d:"M37.5 29.8A20 20 90 0120 40 20 20 90 0120 0 20 20 90 0137.5 10.4 20 20 90 0037.5 29.8"}),n.createElement("path",{id:"meUsersStack44",d:"M41.3 32.7A22 22 90 0122 44 22 22 90 0122 0 22 22 90 0141.3 11.4 22 22 90 0041.3 32.7"}),n.createElement("path",{id:"meUsersStack46",d:"M43.1 34.2A23 23 90 0123 46 23 23 90 0123 0 23 23 90 0143.1 11.9 23 23 90 0043.1 34.2"}))},40803:(e,t,s)=>{s.d(t,{TextWithEmoji:()=>i});var n=s(667294),r=s(468336),a=s(89131),o=s(337270);const i=({text:e})=>{const t=(0,r.toTextAndEmojiChunks)(e);return n.createElement(n.Fragment,null,t.map(((e,t)=>{switch(e.kind){case"Text":return e.text;case"Emoji":return n.createElement(o.Emoji,{emoji:e.text,key:t});default:return(0,a.exhaustivenessCheck)(e)}})))}},943997:(e,t,s)=>{s.d(t,{Tooltip:()=>d});s(126449);var n=s(667294),r=s(294184),a=s.n(r),o=s(837492),i=s(696023),c=s(367763);const d=(0,n.forwardRef)((({children:e,content:t,disabled:s=!1,open:r=!1,onOpen:d,onClose:l,delay:u=50,backgroundColor:h,pointerEvents:p="none",showOnTouch:m=!1,align:f="auto",position:g="auto"},v)=>{const _=(0,i.useFeatureFlags)(),C=(0,c.useDeviceData)(),[y,k]=(0,n.useState)(r?"opened":"closed"),I=h||"rgba(0, 0, 0, 0.72)",w=(0,n.useRef)(null),M=(0,n.useRef)(null),R=(0,n.useRef)(null),b=()=>{M.current&&clearTimeout(M.current),R.current&&clearTimeout(R.current),M.current=R.current=null},S=(0,n.useCallback)((()=>{k("closed"),l&&l()}),[l]),E=(0,n.useCallback)((()=>{"opened"===y?(k("is_closing"),R.current=window.setTimeout(S,200)):S()}),[y,S]),U=(0,n.useCallback)((()=>{b(),M.current=window.setTimeout((()=>{k("opened"),d&&d()}),u)}),[u,d]),P=(0,n.useCallback)((()=>{b(),M.current=window.setTimeout(E,0)}),[E]);(0,n.useEffect)((()=>{const e=w.current;return e&&(e.addEventListener("mouseenter",U),e.addEventListener("mouseleave",P)),()=>{e&&(e.removeEventListener("mouseenter",U),e.removeEventListener("mouseleave",P))}}),[U,P]),(0,n.useEffect)((()=>b),[]),(0,i.useDidUpdate)((()=>{r?U():P()}),[r]);const A=n.createElement("div",{className:a()("METooltip",{"METooltip--removed":"is_closing"===y}),style:{"--tooltip_dark_background":I,pointerEvents:p}},t);return _.me_fc_tooltips?!m&&C.isTouchOnly?e:n.createElement(o.Popper,{content:A,open:!s&&"closed"!==y,ref:e=>{w.current=e,"function"==typeof v?v(e):v&&(v.current=e)},portalClassName:"MEConfig",mode:"side",align:f,position:g},e):e}))},546428:(e,t,s)=>{s.d(t,{onElementKeyDownFactory:()=>r});var n=s(65970);const r=(e,t=!1)=>s=>{const r=(0,n.getKeyCombo)(s);!t&&(0,n.isGlobalKeyCombo)(r)||(0,n.isModuleKeyCombo)(r)&&(s.stopPropagation(),e(r,s.preventDefault.bind(s)))}},127848:(e,t,s)=>{s.d(t,{checkEmojiSupportViaCss:()=>o,createEmojiElement:()=>c,getEmojiSupportFromCache:()=>i});var n=s(331092),r=s(15285);const a=new Map;function o(e){const{backgroundImage:t}=window.getComputedStyle(e),s=""!==t&&"none"!==t;return a.set(e.alt,s),s}function i(e){return a.has(e)?a.get(e)?"supported":"unsupported":"unknown"}function c(e){const t=document.createElement("img");let s;return t.classList.add("Emoji","@"+(0,n.unicodeToByteHex)(e)),t.src=r.emptyImage,t.alt=e,a.has(e)?s=!!a.get(e):(document.head.appendChild(t),s=o(t),t.remove()),s?t:document.createTextNode(e)}},709646:(e,t,s)=>{s.d(t,{VIEWER_DEFAULT_PUSH_SETTINGS:()=>n,eduAccount:()=>a,isEdu:()=>r});const n={userConvo:{isEnabled:!0,withMessageText:!0},chatConvo:{isEnabled:!0,withMessageText:!0},groupConvo:{isEnabled:!0,withMessageText:!0},mention:"every-mention",messageReaction:{isEnabled:!0,withMessageText:!0}};function r(e){return"edu"===e}function a(e){return e.accounts.find((e=>r(e.profileType)))}},737061:(e,t,s)=>{s.d(t,{Semaphore:()=>r});var n=s(11010);class r{lock(){var e=this;return(0,n._)((function*(){return e.resources>0?(e.resources--,Promise.resolve()):new Promise((t=>{e.queue.push(t)}))}))()}release(){window.setTimeout((()=>{const e=this.queue.shift();if(e)return e();this.resources++}),this.window)}constructor(e,t){this.queue=[],this.capacity=e,this.window=t,this.resources=e}}},698057:(e,t,s)=>{s.d(t,{fromApiChatMembers:()=>r});var n=s(96190);function r(e){return e.reduce(((e,t)=>{const s=n.resolveId(t.member_id);if(!n.isUserPeerId(s)&&!n.isGroupPeerId(s)&&!n.isContactPeerId(s))return e;const r={isAdmin:Boolean(t.is_admin),canKick:Boolean(t.can_kick),isMessageRequest:Boolean(t.is_message_request),peerId:s};return t.is_message_request&&t.request_date&&(r.requestDate=1e3*t.request_date),e.members.push(r),n.isContactPeerId(s)||(t.is_admin&&e.adminIds.push(s),t.is_owner&&(e.ownerId=s)),e}),{members:[],adminIds:[]})}},851828:(e,t,s)=>{s.d(t,{fromApiComment:()=>u});var n=s(434788),r=s(866358),a=s(96190),o=s(86144),i=s(839963),c=s(434425),d=s(504698),l=s(694788);function u(e){var t,s,h,p,m,f;const g={cmid:r.resolveCmid(e.id),postCmid:o.resolveCmid(e.post_id||0),channelId:i.resolveId(e.owner_id||0),canEdit:Boolean(e.can_edit),rootCmid:(null==(t=e.parents_stack)?void 0:t[0])?r.resolveCmid(e.parents_stack[0]):void 0,replies:{count:(null==(h=e)||null==(s=h.thread)?void 0:s.count)||0,history:((null==(p=e.thread)?void 0:p.items)||[]).map(u)},sentAt:1e3*e.date};return e.deleted?(0,n._)({kind:"Deleted"},g):(0,n._)({kind:"Normal"},g,{chunks:e.text?d.fromServerText(e.text):[],attaches:(0,l.fromApiWallReplyAttach)(e.attachments||[]),likes:{count:(null==(m=e.likes)?void 0:m.count)||0,reactionId:Boolean(null==(f=e.likes)?void 0:f.user_likes)?c.resolveId(0):void 0,availableReactionIds:[],peerIds:new Set},peerId:a.resolveId(e.from_id)})}},597990:(e,t,s)=>{s.d(t,{fromApiProfileType:()=>o,fromApiViewerAccount:()=>r,fromApiViewerProfileInfo:()=>a});var n=s(96190);function r(e){var t,s;return{id:n.resolveRealId("User",e.id),profileType:o(e.profile_type),firstName:null!=(t=e.first_name)?t:"",lastName:null!=(s=e.last_name)?s:"",photo:e.photo_100}}function a(e){const{screen_name:t,phone:s,id:r,photo_200:a,first_name:o,last_name:i,nick_name:c}=e;return{screenName:t,phoneNumber:s,id:n.resolveRealId("User",r),avatarPhoto:a,firstName:o,lastName:i,nickName:c}}function o(e){var t;return null!=(t={0:"normal",2:"edu"}[null!=e?e:0])?t:"normal"}},906e3:(e,t,s)=>{s.d(t,{Engine:()=>i});var n=s(11010),r=s(434788),a=s(89131),o=s(95154);class i{constructor(e,t){this.isWorking=!1,this.empty=()=>({kind:"Buffer",buffer:[]}),this.queued=this.empty(),this.connect=e=>{if(this.isWorking)return;this.isWorking=!0,this.queued=this.empty();var t=this;(0,n._)((function*(){for(;t.isWorking;){if("Buffer"===t.queued.kind){if(t.queued.buffer.reduce(((e,t)=>"Batch"===t.kind?e+t.updates.length:e+1),0)>=1e3)return t.isWorking=!1,void t.dispatch({kind:"Failure"})}try{const s=`https://${e.server}?version=${t.version}&mode=682`,n=new AbortController,a=setTimeout((()=>n.abort()),3e4),o=yield t.request(s,{act:"a_check",key:e.key,ts:e.ts,wait:25},n.signal).finally((()=>clearTimeout(a)));if("failed"in o)throw o;e.ts=o.ts,e.pts=o.pts,t.dispatch((0,r._)({kind:"Batch"},o))}catch(e){t.logger.info("[ENGINE] Error",e),t.isWorking=!1,t.dispatch({kind:"Failure"})}}}))().catch((e=>{this.isWorking=!1,this.logger.error("[ENGINE] Drain error",e)})),this.logger.info("[ENGINE] Connected")},this.dispatch=e=>{if("Callback"===this.queued.kind)return this.queued.resolve(e),void(this.queued=this.empty());switch(e.kind){case"Failure":return void this.queued.buffer.push(e);case"Batch":{const t=this.queued.buffer[this.queued.buffer.length-1];return void(t&&"Failure"!==t.kind&&t.pts===e.pts?(t.ts=e.ts,t.pts=e.pts,t.updates.push(...e.updates)):this.queued.buffer.push(e))}default:(0,a.exhaustivenessCheck)(e)}},this.poll=()=>{if("Callback"===this.queued.kind)return this.queued.reject("Engine.poll вызван повторно до обработки первого вызова!"),new Promise(((e,t)=>{this.queued={kind:"Callback",resolve:e,reject:t}}));const e=this.queued.buffer.shift();return e?Promise.resolve(e):this.isWorking?new Promise(((e,t)=>{this.queued={kind:"Callback",resolve:e,reject:t}})):Promise.reject("Engine.connect еще не был вызван!")},this.isConnected=()=>this.isWorking,this.logger=e,this.request=t,this.version=o.ENGINE_VERSION}}},302278:(e,t,s)=>{s.d(t,{EventEmitter:()=>n});class n{subscribe(e,t){var s;Array.isArray(this.subscriptions[e])?null==(s=this.subscriptions[e])||s.push(t):this.subscriptions[e]=[t]}unsubscribe(e,t){var s;Array.isArray(this.subscriptions[e])&&(this.subscriptions[e]=(null==(s=this.subscriptions[e])?void 0:s.filter((e=>e!==t)))||[])}emit(e,t){var s;Array.isArray(this.subscriptions[e])&&(null==(s=this.subscriptions[e])||s.forEach((e=>e(t))))}constructor(){this.subscriptions={}}}},851369:(e,t,s)=>{var n,r;s.d(t,{PlayerEventTypes:()=>n,VideoMessagePlayerEventTypes:()=>r}),function(e){e.STATE_UPDATED="stateupdated",e.START_NEW_TRACK="startNewTrack",e.START_NEXT_TRACK="startNextTrack",e.START_PREV_TRACK="startPrevTrack",e.RESUME_TRACK="resumeTrack",e.START_NEXT_TRACK_AUTOMATICALLY="startNextTrackAutomatically",e.STOP_CURRENT_TRACK_AUTOMATICALLY="stopCurrentTrackAutomatically",e.PLAYLIST_ENDED="playlistEnded",e.STOP_CURRENT_TRACK_BEFORE_STARTING_NEW_TRACK="stopCurrentTrackBeforeStartingNewTrack",e.STOP_CURRENT_TRACK_BY_ERROR="stopCurrentTrackByError",e.PAUSE_CURRENT_TRACK="pauseCurrentTrack"}(n||(n={})),function(e){e.SCROLL_TO_MESSAGE="scrollToMessage",e.STATE_UPDATED="stateUpdated"}(r||(r={}))},166916:(e,t,s)=>{var n;s.d(t,{IUploader:()=>n}),function(e){class t extends Error{constructor(e="Aborted"){super(e),Object.setPrototypeOf(this,t.prototype)}}e.AbortError=t;class s extends Error{constructor(e="Timeout"){super(e),Object.setPrototypeOf(this,s.prototype)}}e.TimeoutError=s}(n||(n={}))},790351:(e,t,s)=>{s.d(t,{AUDIO_TYPES:()=>m,IMAGE_TYPES:()=>h,Uploader:()=>I,VIDEO_TYPES:()=>p,areAudios:()=>U,areImages:()=>R,areVideos:()=>S,isChannelUpload:()=>q,isConvoUpload:()=>O,isImage:()=>M,preloadImage:()=>P});var n=s(11010),r=s(434788),a=s(694788),o=s(166916),i=s(89131),c=s(96190),d=s(839963),l=s(453934),u=s(737061);const h=["image/png","image/gif","image/jpeg","image/webp"],p=["video/x-msvideo","video/mp4","video/mpeg","video/3gpp","video/quicktime","video/x-flv","video/x-ms-wmv","video/avi","video/webm"],m=["audio/mp3","audio/ogg","audio/wav","audio/mpeg","audio/flac","audio/aac","audio/m4a","audio/mp4","audio/x-m4a"],f=e=>"image"===e.kind,g=e=>"video"===e.kind,v=e=>"audio"===e.kind,_=e=>"doc"===e.kind;class C{getUploadServer(e,t){let s=this.cache.get(e);if(!s)return s=t().then((t=>(this.cache.set(e,{url:t,timestamp:Date.now()}),t))),this.cache.set(e,s),s;if(s instanceof Promise)return s;return this.validateCache(s.timestamp)?Promise.resolve(s.url):(this.cache.delete(e),this.getUploadServer(e,t))}dropCache(){0!==this.cache.size&&Array.from(this.cache.entries()).forEach((([e,t])=>{if(t instanceof Promise)return;this.validateCache(t.timestamp)||this.cache.delete(e)}))}validateCache(e){return Date.now()-e<=5e3}constructor(){this.cache=new Map,setInterval((()=>{this.dropCache.call(this)}),6e4)}}class y{uploadImage(e,t){var s=this;return(0,n._)((function*(){const n={peer_id:t.viewerId,group_id:t.groupId&&c.toRealId(t.groupId),upload_v2:0},r=()=>s.api.fetch("photos.getMessagesUploadServer",n).then((({upload_url:e})=>e)),o=new FormData;return o.append("photo",e.file),s.uploadRequest((()=>s.photosUploadUrlCache.getUploadServer(JSON.stringify(n),r)),o,e.trackId,(({data:{server:e,hash:t,photo:n}})=>s.api.fetch("photos.saveMessagesPhoto",{server:e,hash:t,photo:n}).then((e=>{if(0===e.length||void 0===e[0])throw new Error("Метод photos.saveMessagesPhoto не вернул фотографию");const t=(0,a.fromApiPhoto)({apiPhoto:e[0]});if(void 0===t)throw new Error("Не удалось конвертировать фотографию с сервера");return t}))))}))()}uploadVideo(e,t){var s=this;return(0,n._)((function*(){const r={target:t,preview:1,no_comments:1},o=new FormData;return o.append("video_file",e.file),s.uploadRequest((()=>s.api.fetch("video.save",r).then((({upload_url:e})=>{if(!e)throw new Error("В методе video.save не вернулся upload_url");return e}))),o,e.trackId,(0,n._)((function*({data:{video_id:e,owner_id:t}}){const n={kind:"Video",id:e,ownerId:t,image:[{url:a.emptyPreview,width:1,height:1}],views:0};try{const r=(yield s.api.fetch("video.get",{owner_id:t,videos:`${t}_${e}`,extended:0})).items[0];if(!r)return n;return(0,a.fromApiVideo)({apiVideo:r})||n}catch(e){return n}})))}))()}uploadAudio(e){var t=this;return(0,n._)((function*(){const s={},n=new FormData;return n.append("file",e.file),t.uploadRequest((()=>t.api.fetch("audio.getUploadServer",s).then((({upload_url:e})=>e))),n,e.trackId,(({data:{server:e,audio:s,hash:n}})=>t.api.fetch("audio.save",{server:e,audio:s,hash:n}).then((e=>(0,a.fromApiAudio)(e)))))}))()}uploadDoc(e){var t=this;return(0,n._)((function*(){const s=()=>t.api.fetch("docs.getUploadServer",{}).then((({upload_url:e})=>e)),n=new FormData;return n.append("file",e.file),t.uploadRequest((()=>t.docsUploadUrlCache.getUploadServer("docsUploadServer",s)),n,e.trackId,(({data:{file:e}})=>t.api.fetch("docs.save",{file:e}).then((e=>{if(!e.doc)throw new Error("Метод doc.save не вернул документ");const t=(0,a.fromApiDoc)(e.doc);if(!t)throw new Error("Не удалось конвертировать документ (нет поля url)");return t}))))}))()}uploadWallDoc(e,t){var s=this;return(0,n._)((function*(){const t={group_id:0},n=()=>s.api.fetch("docs.getWallUploadServer",t).then((({upload_url:e})=>e)),r=new FormData;return r.append("file",e.file),s.uploadRequest((()=>s.wallDocsUploadUrlCache.getUploadServer(JSON.stringify(t),n)),r,e.trackId,(({data:{file:e}})=>s.api.fetch("docs.save",{file:e,group_id:0}).then((e=>{if(!e.doc)throw new Error("Метод doc.save не вернул документ");const t=(0,a.fromApiDoc)(e.doc);if(!t)throw new Error("Не удалось конвертировать документ (нет поля url)");return t}))))}))()}uploadVoice(e,t){var s=this;return(0,n._)((function*(){const n={type:"audio_message",peer_id:t.targetPeerId},r=new FormData;return r.append("file",e.file),s.uploadRequest((()=>s.api.fetch("docs.getMessagesUploadServer",n).then((({upload_url:e})=>e))),r,e.trackId,(({data:{file:e}})=>s.api.fetch("docs.save",{file:e}).then((e=>{if(!e.audio_message)throw new Error("Метод doc.save не вернул аудиосообщение");return(0,a.fromApiVoice)(e.audio_message)}))))}))()}uploadChatPhoto(e,t){var s=this;return(0,n._)((function*(){if(!t.targetPeerId||!c.isChatPeerId(t.targetPeerId))throw new Error("Для обновления аватара чата targetPeerId обязательно должен быть ChatId");const n=yield(r=e,new Promise((e=>{const t=new Image,s=URL.createObjectURL(r.file);t.onload=()=>{const s=Math.min(t.width,t.height),n=Math.floor((t.width-s)/2),r=Math.floor((t.height-s)/2);e({x:n,y:r,width:s})},t.src=s})));var r;const a={chat_id:c.toRealId(t.targetPeerId),crop_x:n.x,crop_y:n.y,crop_width:n.width},o=new FormData;return o.append("photo",e.file),s.uploadRequest((()=>s.api.fetch("photos.getChatUploadServer",a).then((({upload_url:e})=>e))),o,e.trackId,(({data:{response:e}})=>s.api.fetch("messages.setChatPhoto",{file:e,user_id:c.toRealId(t.viewerId)}).then((()=>{}))))}))()}uploadOwnerPhoto(e,t){var s=this;return(0,n._)((function*(){const n={owner_id:t.viewerId},r=new FormData;return r.append("photo",e.file),s.uploadRequest((()=>s.api.fetch("photos.getOwnerPhotoUploadServer",n).then((({upload_url:e})=>e))),r,e.trackId,(({data:{hash:e,photo:n,server:r}})=>s.api.fetch("photos.saveOwnerPhoto",{owner_id:t.viewerId,server:r,hash:e,photo:n}).then((()=>{}))))}))()}uploadChannelPhoto(e,t){var s=this;return(0,n._)((function*(){const n={owner_id:t.targetPeerId},r=new FormData;return r.append("photo",e.file),s.uploadRequest((()=>s.api.fetch("photos.getOwnerPhotoUploadServer",n).then((({upload_url:e})=>e))),r,e.trackId,(({data:{hash:e,photo:n,server:r}})=>s.api.fetch("photos.saveOwnerPhoto",{owner_id:d.toRealGroupId(t.targetPeerId),server:r,hash:e,photo:n}).then((()=>{}))))}))()}uploadWallImage(e,t){var s=this;return(0,n._)((function*(){const n={group_id:d.toRealGroupId(t.targetPeerId),upload_v2:0},r=()=>s.api.fetch("photos.getWallUploadServer",n).then((({upload_url:e})=>e)),o=new FormData;return o.append("photo",e.file),s.uploadRequest((()=>s.wallPhotosUploadUrlCache.getUploadServer(JSON.stringify(n),r)),o,e.trackId,(({data:{server:e,hash:n,photo:r}})=>s.api.fetch("photos.saveWallPhoto",{group_id:d.toRealGroupId(t.targetPeerId),server:e,hash:n,photo:r}).then((e=>{if(0===e.length||void 0===e[0])throw new Error("Метод photos.saveWallPhoto не вернул фотографию");const t=(0,a.fromApiPhoto)({apiPhoto:e[0]});if(void 0===t)throw new Error("Не удалось конвертировать фотографию с сервера");return t}))))}))()}convoUpload(e,t){var s=this;return(0,n._)((function*(){return f(e)?s.uploadImage(e,t):g(e)?s.uploadVideo(e,"messages"):v(e)?s.uploadAudio(e):_(e)?s.uploadDoc(e):"voice"===e.kind?s.uploadVoice(e,t):(e=>"chat-photo"===e.kind)(e)?s.uploadChatPhoto(e,t):(e=>"owner-photo"===e.kind)(e)?s.uploadOwnerPhoto(e,t):Promise.reject()}))()}channelsUpload(e,t){var s=this;return(0,n._)((function*(){return f(e)?s.uploadWallImage(e,t):g(e)?s.uploadVideo(e,"wall"):v(e)?s.uploadAudio(e):_(e)?s.uploadWallDoc(e,t):"channel-photo"===e.kind?s.uploadChannelPhoto(e,t):Promise.reject()}))()}upload(e,t){var s=this;return(0,n._)((function*(){return F(t)?s.channelsUpload(e,t):function(e){return!F(e)}(t)?s.convoUpload(e,t):Promise.reject()}))()}uploadRequest(e,t,s,r){const a=s,i=new AbortController;var c=this;return{abort:()=>i.abort(),trackId:s,response:(0,n._)((function*(){yield c.semaphore.lock();return function(e,t,s={}){return new Promise(((n,r)=>{var a;const{method:i="POST",signal:c,onUploadProgress:d,headers:l={},timeout:u}=s;if(null==(a=c)?void 0:a.aborted)return r(new o.IUploader.AbortError);const h=new XMLHttpRequest,p=()=>h.abort();c&&(c.addEventListener("abort",p),h.addEventListener("readystatechange",(()=>{const{readyState:e}=h;e===L&&c.removeEventListener("abort",p)}))),h.addEventListener("abort",(()=>{r(new o.IUploader.AbortError)})),h.addEventListener("error",r),h.addEventListener("timeout",(()=>{r(new o.IUploader.TimeoutError)})),h.upload.addEventListener("progress",(e=>{var t;e.lengthComputable&&(null==(t=d)||t(e))})),h.addEventListener("loadend",(()=>{const{readyState:e,status:t,responseText:s}=h;let a;try{a=JSON.parse(s)}catch(e){return r(e)}return e===L&&t===D?n({data:a}):r(a)})),h.open(i,e,!0),Object.entries(l).forEach((([e,t])=>{h.setRequestHeader(e,t)})),u&&(h.timeout=u),h.send(t)}))}(yield e(),t,{signal:i.signal,timeout:c.requestTimeout,headers:{Accept:"application/json, text/plain, */*"},onUploadProgress:e=>{c.emitter.emit(a,{loaded:e.loaded,total:e.total})}}).then((e=>(c.emitter.removeListener(a),r(e)))).finally((()=>c.semaphore.release()))}))()}}trackProgress(e,t){this.emitter.addListener(e,t)}constructor(e){this.emitter=new w,this.requestTimeout=0,this.semaphore=new u.Semaphore(5,0),this.photosUploadUrlCache=new C,this.wallPhotosUploadUrlCache=new C,this.docsUploadUrlCache=new C,this.wallDocsUploadUrlCache=new C,this.api=e}}class k{subscribe(e,t){return this.emitter.addListener(e,t),()=>{this.emitter.removeListener(e)}}get(e){return this.attaches.get(e)}filterMissing(e){return e.filter((e=>!this.attaches.has(e)))}update(e,t){const s=this.attaches.get(e),n="function"==typeof t?t(s):t;n&&(this.attaches.set(e,n),this.emitter.emit(e,n))}remove(e){new Set(e).forEach((e=>{this.attaches.delete(e),this.emitter.removeListener(e)}))}constructor(){this.attaches=new Map,this.emitter=new w}}class I extends y{uploadFiles(e,t,s,n={}){e.forEach((e=>{this.toUploaderFileInfo(e,t).then((e=>{this.doUpload(e,s,n)})).catch((()=>{var t,s;null==(t=(s=n).onConvertationError)||t.call(s,e)}))}))}abortUpload(e){const t=this.uploads.get(e);var s,n;t&&(t.process.abort(),null==(s=(n=t.handlers).onUploadAbort)||s.call(n,e),this.uploads.delete(e));const r=this.failedUploads.get(e);var a,o;r&&(null==(a=(o=r.handlers).onUploadAbort)||a.call(o,e),this.failedUploads.delete(e));this.state.remove([e])}retryUpload(e){const t=this.failedUploads.get(e);if(t){this.failedUploads.delete(e);const{file:s,messengerData:n,handlers:a}=t;this.doUpload(s,n,a),this.state.update(s.trackId,(e=>{if(e)return(0,r._)({},e,{error:!1,abortable:!1})}))}}getOrphans(e){return this.state.filterMissing(e)}subscribe(e,t){if(0===e.length)return()=>{};t(this.getState(e));const s=e.map((s=>this.state.subscribe(s,(()=>{t(this.getState(e))}))));return t=>{s.forEach((e=>e())),t(e)}}getState(e){if(0===e.length)return{};const t=e.reduce(((e,t)=>{const s=this.state.get(t);return s&&e.push(s),e}),[]);return this.buildOptimisticAttachments(t)}doUpload(e,t,s){var n,r;const{trackId:a}=e;null==(n=(r=s).onUploadStart)||n.call(r,[a]),this.upload(e,t).then((e=>(this.uploads.set(a,{process:e,handlers:s}),this.trackProgress(a,(({loaded:e,total:t})=>this.updateAttachProgress(a,{loaded:e,total:t,error:!1,abortable:e!==t},s))),Promise.resolve(e.response).then((e=>{var t,n;const r=this.modifyUploadedAttach(a,e),o=new Map(r?[[a,r]]:[]);null==(t=(n=s).onUploadFinish)||t.call(n,o),this.state.remove([a])})).catch((e=>e instanceof o.IUploader.AbortError?Promise.resolve():Promise.reject(e))).finally((()=>{this.uploads.delete(a)}))))).catch((n=>{var r,o;console.error("[UPLOADER] Ошибка загрузки",n),null==(r=(o=s).onError)||r.call(o,a),this.failedUploads.set(a,{file:e,messengerData:t,handlers:s}),this.updateAttachProgress.call(this,a,{loaded:0,total:0,error:!0,abortable:!1},s)}))}toUploaderFileInfo(e,{asFiles:t,asVoice:s,asChatPhoto:n,asOwnerPhoto:r,asChannelPhoto:a}){if(!(e instanceof File)){if(!s)throw new Error("Загрузить аудиосообщения можно только с флагом asVoice");const{blob:t,duration:n,waveform:r}=e,a=new File([t],"voice_recording",{type:"audio/ogg"}),o=I.toFileInfo(a,"voice");return function(e,t,s,n){return Promise.resolve({kind:"OptimisticVoice",id:e.trackId,blob:t,duration:s,waveform:n,loaded:0,total:e.file.size})}(o,t,n,r).then((e=>(this.state.update(o.trackId,e),o)))}const o=e;if(n){const e=I.toFileInfo(o,"chat-photo");return Promise.resolve(e)}if(r){const e=I.toFileInfo(o,"owner-photo");return Promise.resolve(e)}if(a){const e=I.toFileInfo(o,"channel-photo");return Promise.resolve(e)}if(!t&&M(o)){const e=I.toFileInfo(o,"image");return function(e){return T.apply(this,arguments)}(e).then((t=>(this.state.update(e.trackId,t),e)))}if(!t&&b(o)){const e=I.toFileInfo(o,"video");return function(e){return N.apply(this,arguments)}(e).then((t=>(this.state.update(e.trackId,t),e)))}if(!t&&E(o)){const e=I.toFileInfo(o,"audio");return(i=e,new Promise((e=>{const t=new Audio,s=URL.createObjectURL(i.file);t.addEventListener("loadedmetadata",(()=>{e({kind:"OptimisticAudio",id:i.trackId,duration:t.duration,artist:"",title:i.file.name,loaded:0,total:i.file.size})})),t.src=s}))).then((t=>(this.state.update(e.trackId,t),e)))}var i;const c=I.toFileInfo(o,"doc");return function(e){return x.apply(this,arguments)}(c).then((e=>(this.state.update(c.trackId,e),c)))}modifyUploadedAttach(e,t){var s;if(!t)return null;const n=this.state.get(e);let o=t;if("Video"===t.kind&&"OptimisticVideo"===(null==(s=n)?void 0:s.kind)){const e=!!n.duration,s=n.image.url!==a.emptyPreview,i=t.image.length>1||t.image[0].url!==a.emptyPreview;e&&s&&!i&&(o=(0,r._)({},t,{duration:n.duration,image:[n.image]}))}return o}updateAttachProgress(e,t,{onUploadProgressUpdate:s}){this.state.update(e,(e=>{if(e){switch(e.kind){case"OptimisticPhoto":var n;null==(n=s)||n("photo");break;case"OptimisticVideo":var a;null==(a=s)||a("video");break;case"OptimisticDoc":var o;null==(o=s)||o("file")}return(0,r._)({},e,t)}}))}buildOptimisticAttachments(e){return e.reduce(((e,t)=>{const s=[],n=[],r=[],a=[];switch(t.kind){case"OptimisticPhoto":s.push(t);break;case"OptimisticVideo":n.push(t);break;case"OptimisticAudio":r.push(t);break;case"OptimisticDoc":a.push(t);break;case"OptimisticVoice":e.voice=t}return s.length&&(e.photos=[...e.photos||[],...s]),n.length&&(e.videos=[...e.videos||[],...n]),r.length&&(e.audios=[...e.audios||[],...r]),a.length&&(e.docs=[...e.docs||[],...a]),e}),{})}static clearOptimisticAttachments(e,t){t.forEach((t=>{if("photos"in e){if(!e.photos)return;const s=(0,i.toNonEmpty)(e.photos.filter((({id:e})=>e!==t)));s?e.photos=s:delete e.photos}if("videos"in e){if(!e.videos)return;const s=(0,i.toNonEmpty)(e.videos.filter((({id:e})=>e!==t)));s?e.videos=s:delete e.videos}if("audios"in e){if(!e.audios)return;const s=(0,i.toNonEmpty)(e.audios.filter((({id:e})=>e!==t)));s?e.audios=s:delete e.audios}if("docs"in e){if(!e.docs)return;const s=(0,i.toNonEmpty)(e.docs.filter((({id:e})=>e!==t)));s?e.docs=s:delete e.docs}"voice"in e&&delete e.voice}))}static buildAttachments(e){return e.reduce(((e,t)=>(0,l.produce)(e,(s=>{var n,r,a,o;let c=null,d=null,l=null,u=null;switch(t.kind){case"Photo":c=(0,i.toNonEmpty)([t]);break;case"Video":d=(0,i.toNonEmpty)([t]);break;case"Audio":l=(0,i.toNonEmpty)([t]);break;case"Doc":u=(0,i.toNonEmpty)([t]);break;case"Voice":s.voice=t}(null==(n=c)?void 0:n.length)&&(s.photos=[...e.photos||[],...c]),(null==(r=d)?void 0:r.length)&&(s.videos=[...e.videos||[],...d]),(null==(a=l)?void 0:a.length)&&(s.audios=[...e.audios||[],...l]),(null==(o=u)?void 0:o.length)&&(s.docs=[...e.docs||[],...u])}))),{})}static hash(){return Math.floor(1e8*Math.random()+1e8).toString(16)}static resolveTrackId(e,t){if(0===t.length)throw new Error("Нельзя отдавать пустую строку в Uploader.resolveTrackId");return`${e}-${t}`}static toFileInfo(e,t){switch(t){case"image":return{kind:"image",trackId:I.resolveTrackId("image",I.hash()),file:e};case"video":return{kind:"video",trackId:I.resolveTrackId("video",I.hash()),file:e};case"audio":return{kind:"audio",trackId:I.resolveTrackId("audio",I.hash()),file:e};case"doc":return{kind:"doc",trackId:I.resolveTrackId("doc",I.hash()),file:e};case"voice":return{kind:"voice",trackId:I.resolveTrackId("voice",I.hash()),file:e};case"chat-photo":return{kind:"chat-photo",trackId:I.resolveTrackId("chat-photo",I.hash()),file:e};case"owner-photo":return{kind:"owner-photo",trackId:I.resolveTrackId("owner-photo",I.hash()),file:e};case"channel-photo":return{kind:"channel-photo",trackId:I.resolveTrackId("channel-photo",I.hash()),file:e};default:(0,i.exhaustivenessCheck)(t)}}constructor(...e){super(...e),this.uploads=new Map,this.failedUploads=new Map,this.state=new k}}class w{addListener(e,t){this.map.set(e,[...this.map.get(e)||[],t])}removeListener(e){this.map.delete(e)}emit(e,t){var s;null==(s=this.map.get(e))||s.forEach((e=>e(t)))}constructor(){this.map=new Map}}function M(e){return!(e instanceof DataTransferItem&&"file"!==e.kind)&&Boolean(e.type&&h.includes(e.type))}function R(e){return e.every(M)}function b(e){return!(e instanceof DataTransferItem&&"file"!==e.kind)&&(e instanceof File&&!e.type?/\.wmv$|\.avi$/.test(e.name):Boolean(e.type&&p.includes(e.type)))}function S(e){return e.every(b)}function E(e){return!(e instanceof DataTransferItem&&"file"!==e.kind)&&Boolean(e.type&&m.includes(e.type))}function U(e){return e.every(E)}function P(e){const t=URL.createObjectURL(e);return new Promise(((e,s)=>{const n=new Image;n.onload=()=>{e({url:t,width:n.width,height:n.height})},n.onerror=s,n.src=t}))}function A(e){return new Promise(((t,s)=>{const n=document.createElement("video");n.volume=0,n.preload="metadata",n.onloadedmetadata=()=>t(n),n.onerror=s,n.src=e}))}function T(){return(T=(0,n._)((function*(e){const t=yield P(e.file);return{kind:"OptimisticPhoto",id:e.trackId,image:t,loaded:0,total:e.file.size}}))).apply(this,arguments)}function N(){return(N=(0,n._)((function*(e){var t,s,r;let o=null,i=a.emptyPreview;try{o=yield(c=e.file,A(URL.createObjectURL(c))),i=(yield function(e){function t(e,t){return new Promise(((s,n)=>{e.onseeked=()=>{e.videoWidth&&e.videoHeight||s(void 0);const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;const n=t.getContext("2d");n?(n.drawImage(e,0,0),s(t.toDataURL("image/jpeg"))):s(void 0)},e.onerror=n,e.currentTime=t}))}return t(e,.5*e.duration).catch((0,n._)((function*(s){var n,r,a;if("string"==typeof s)return Promise.reject(s);const o=null==(n=s.composedPath())?void 0:n[0];return o instanceof HTMLVideoElement&&4===(null==(a=o)||null==(r=a.error)?void 0:r.code)?t(yield A(e.src),Math.min(e.duration,1)):Promise.reject(s)})))}(o))||a.emptyPreview}catch(e){}var c;return{kind:"OptimisticVideo",id:e.trackId,duration:Math.floor((null==(t=o)?void 0:t.duration)||0),loaded:0,total:e.file.size,image:{url:i,width:(null==(s=o)?void 0:s.videoWidth)||1,height:(null==(r=o)?void 0:r.videoHeight)||1}}}))).apply(this,arguments)}function x(){return(x=(0,n._)((function*(e){var t;const s=/\.([0-9a-z]+)$/i.exec(e.file.name),n={kind:"OptimisticDoc",id:e.trackId,title:e.file.name,size:e.file.size,ext:(null==(t=s)?void 0:t[1])||"",loaded:0,total:e.file.size};if(M(e.file)){const t=yield P(e.file);return(0,r._)({},n,{image:t})}return n}))).apply(this,arguments)}function F(e){return!!e.targetPeerId&&d.isChannelId(e.targetPeerId)&&!!e.isChannel}function q(e,t){return!!e&&d.isChannelId(e)&&!!t}function O(e,t){return!!e&&!d.isChannelId(e)||!t}const L=4,D=200},397384:(e,t,s)=>{s.d(t,{handler:()=>a});var n=s(991792),r=s(96190);const a=(e,t)=>{const{profiles:s,groups:a,conversations:o,mutualFriends:i,contacts:c}=t;if((0,n.insertConvos)(e,o||[]),(0,n.insertPeers)(e,{apiUsers:s||[],apiGroups:a||[],apiContacts:c||[]}),i){const t=e.peers.get(r.resolveId(i.peerId));t&&r.updateMutualFriends(t,i.hint.map(r.resolveId),i.count)}return[]}},664061:(e,t,s)=>{s.d(t,{handler:()=>f});var n=s(11010),r=s(434788),a=s(991792),o=s(89131),i=s(83062),c=s(452788),d=s(839963),l=s(86144),u=s(96190),h=s(54965),p=s(95154);const m=1e3;const f=(e,t)=>{switch(t.type){case"ChannelEngineBatchReceived":switch(t.variant.kind){case"FromChannelEngine":return g(e,t.variant);case"FromChannelEngineWithMissingData":return function(e,t){const{next:s,response:[n,r,...o]}=t;let i=new Map;o&&o.forEach((t=>{var s;(0,a.insertPeers)(e,{apiUsers:t.profiles||[],apiGroups:t.groups||[],apiContacts:[]}),(null==(s=t.items)?void 0:s.length)&&(i=function(e){const t=new Map;for(const s of e){let e=t.get(s.channel_id);e||(e=new Map,t.set(s.channel_id,e)),e.set(s.cmid,s)}return t}(t.items))}));n&&(0,a.insertChannels)(e,{apiChannels:n.items||[],apiGroups:n.groups||[],dangerouslyMerge:!0});var c,d;(r||n)&&(0,a.insertPeers)(e,{apiUsers:[...r||[],...(null==(c=n)?void 0:c.profiles)||[]],apiGroups:(null==(d=n)?void 0:d.groups)||[],apiContacts:[]});return g(e,{kind:"FromChannelEngine",isRetry:!0,next:s},{channelsMessagesById:i})}(e,t.variant);case"FromChannelEngineApiHistory":return function(e,t){const{ts:s,history:n,posts:r}=t,a=new Map;for(const e of r){let t=a.get(e.channel_id);t||(t=new Map,a.set(e.channel_id,t)),t.set(e.cmid,e)}return g(e,{kind:"FromChannelEngine",next:{kind:"Batch",ts:s,updates:n.reduce(((e,t)=>{switch(t[0]){case 70001:case 70002:{var s;const n=null==(s=a.get(t[1]))?void 0:s.get(t[2]);return n?(e.push([...t,n]),e):e}default:return e.push(t),e}}),[])}})}(e,t.variant);default:return(0,o.exhaustivenessCheck)(t.variant)}case"ComposerDraftsUpdateNeeded":return[];default:return(0,o.exhaustivenessCheck)(t)}};function g(e,t,s){const{isRetry:a,next:f}=t;if("Failure"===f.kind){e.channelConn.status="resyncing";const{ts:t}=e.channelConn;return[(g=(0,n._)((function*({api:e,channelEngine:s}){if(!s)return{type:"Noop"};let n;yield(0,o.sleep)(m);try{n=yield e.fetch("channels.getLongPollHistory",{lp_version:s.version,ts:t,limit:1e3,extended:1},{retries:1/0,timeout:p.CHANNELS_GLPH_TIMEOUT})}catch(e){return{type:"Noop"}}return s.connect((0,r._)({},n.credentials,{ts:n.new_ts})),{type:"ChannelEngineBatchReceived",variant:{kind:"FromChannelEngineApiHistory",ts:n.new_ts,history:n.history,posts:n.messages||[]}}})),function(e){return g.apply(this,arguments)})]}var g,v;if(!a){const t=function(e,t){const s=new Set,n=new Set,r=new Map;function a(t){switch(t[0]){case 70001:{var o,i,c,h;const[,a,p,,m]=t,f=d.resolveId(a);if(e.channels.has(f)||s.add(f),!m){const e=l.resolveCmid(p);let t=r.get(f);t?t.add(e):r.set(f,new Set([e]));break}if(null==(h=m.attachments)||null==(c=h[0])||null==(i=c.wall.copy_history)||null==(o=i[0])?void 0:o.from_id){const e=u.resolveId(m.attachments[0].wall.copy_history[0].from_id);if(u.isUserPeerId(e)){n.add(e);break}if(u.isGroupPeerId(e)){s.add(d.resolveId(e));break}}break}case 70002:{const[,s,n,a]=t,o=d.resolveId(s);if(!e.channels.has(o))break;if(!a){const e=l.resolveCmid(n);let t=r.get(o);t?t.add(e):r.set(o,new Set([e]));break}break}case 70010:{const[,s,n,,a]=t,o=d.resolveId(s);if(!e.channels.has(o))break;if(!a){const e=l.resolveCmid(n);let t=r.get(o);t?t.add(e):r.set(o,new Set([e]));break}break}case 70003:case 70004:case 70007:case 70008:break;case 70005:{const[,e,n]=t;if(n){const t=d.resolveId(e);s.add(t)}break}case 70009:{const[,e,n]=t;if(n){const t=d.resolveId(e);s.add(t)}break}case 70011:for(const e of t[1])a(e);break;default:}}for(const e of t.updates)a(e);return{channelIds:s,userIds:n,postCmidsByChannel:r}}(e,f);if(t.channelIds.size>0||t.userIds.size>0||t.postCmidsByChannel.size>0)return[(v=(0,n._)((function*({api:e}){try{const s=yield e.fetchMany([t.channelIds.size>0&&{method:"channels.getById",params:{channel_ids:Array.from(t.channelIds).join(","),extended:1}},t.userIds.size>0&&{method:"users.get",params:{user_ids:Array.from(t.userIds).map(u.toRealId).join(","),extended:1}},...Array.from(t.postCmidsByChannel).map((([e,t])=>({method:"channels.getMessagesById",params:{channel_id:e,cmids:Array.from(t).join(","),extended:1}})))],{retries:1/0});return{type:"ChannelEngineBatchReceived",variant:{kind:"FromChannelEngineWithMissingData",next:f,response:s}}}catch(e){return{type:"Noop"}}})),function(e){return v.apply(this,arguments)})]}e.channelConn.status="running",e.channelConn.ts=f.ts;const _=t=>{switch(t[0]){case 70001:return function(e,t,s){var n,r;const[,a,o,c,l]=t,u=d.resolveId(a),p=e.channels.get(u);if(!p)return[];if("ChannelRestricted"===p.kind)return[];d.setSortId(p,{minorSortId:c});const m=(null==(r=s)||null==(n=r.channelsMessagesById.get(u))?void 0:n.get(o))||l;if(!m)return[];const{post:f,reactions:g}=(0,h.fromApiPost)(m);for(const t of g)e.reactions.set(t.id,t);d.appendPost(p,f),i.refreshChannels(e.organisers,p),e.locks.channelsCleanup.has(u)||d.cleanup(p);return[]}(e,t,s);case 70002:return function(e,t,s){var r,a;const[,o,i,c]=t,l=d.resolveId(o),u=e.channels.get(l);if(!u)return[];if("ChannelRestricted"===u.kind)return[];const p=(null==(a=s)||null==(r=a.channelsMessagesById.get(l))?void 0:r.get(i))||c;if(!p)return[];const{post:m,reactions:f}=(0,h.fromApiPost)(p);for(const t of f)e.reactions.set(t.id,t);return d.replacePost(u,m),[(0,n._)((function*(){return{type:"ComposerDraftsUpdateNeeded",foreignKind:"post",itemsToReplace:[m]}}))]}(e,t,s);case 70003:return function(e,t){const[,s,r,a]=t,o=d.resolveId(s),i=l.resolveCmid(r),c=e.channels.get(o);if(!c)return[];if("ChannelRestricted"===c.kind)return[];return d.setSortId(c,{minorSortId:a}),d.deletePost(c,i,!1),[(0,n._)((function*(){return{type:"ComposerDraftsUpdateNeeded",foreignKind:"post",itemsToDelete:[{channelId:o,cmid:i}]}}))]}(e,t);case 70004:return function(e,t){const[,s,n,r]=t,a=d.resolveId(s),o=l.resolveCmid(n),i=e.channels.get(a);if(!i)return[];if("ChannelRestricted"===i.kind)return[];return d.readUntil(i,o,r),[]}(e,t);case 70005:return function(e,t){const[,s,n,r]=t,a=d.resolveId(s),o=e.channels.get(a);if(!o)return[];if("ChannelRestricted"===o.kind)return[];return d.setArchived(o,!n),c.updateCounters(e.organisers.channelFilters,{archiveTotal:r}),i.refreshChannels(e.organisers,o),[]}(e,t);case 70007:return function(e,t){const[,s,n]=t,r=d.resolveId(s),a=e.channels.get(r);if(!a)return[];if("ChannelRestricted"===a.kind)return[];return d.setMuted(a,0!==n),[]}(e,t);case 70008:return function(e,t){const[,s]=t;return c.updateCounters(e.organisers.channelFilters,{unread:s}),[]}(e,t);case 70009:return function(e,t){const[,s,n]=t,r=d.resolveId(s),a=e.channels.get(r);if(!a)return[];if("ChannelRestricted"===a.kind)return[];return d.setMembership(a,Boolean(n)),i.refreshChannels(e.organisers,a),[]}(e,t);case 70010:return function(e,t,s){var n,r;const[,a,o,,i]=t,c=d.resolveId(a),l=e.channels.get(c);if(!l)return[];if("ChannelRestricted"===l.kind)return[];const u=(null==(r=s)||null==(n=r.channelsMessagesById.get(c))?void 0:n.get(o))||i;if(!u)return[];const{post:p}=(0,h.fromApiPost)(u);"Normal"===p.kind&&d.restorePost(l,p.cmid,p);return[]}(e,t,s);case 70011:return t[1].flatMap(_);default:return[]}};return[...f.updates.flatMap(_),(C=(0,n._)((function*({channelEngine:e}){return e?{type:"ChannelEngineBatchReceived",variant:{kind:"FromChannelEngine",next:yield e.poll()}}:{type:"Noop"}})),function(e){return C.apply(this,arguments)})];var C}},967819:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(89131),a=s(452788),o=s(991792);const i=(e,t)=>{switch(t.type){case"ChannelsOnboardingDone":return 0===t.pickedChannelsIds.length?(a.push(e.organisers.channelFilters,"all",[],!1),[(0,n._)((function*({api:e}){return yield e.fetch("account.hideHelpHint",{hint_id:"im:channels_onboarding"},{retries:1/0}),{type:"Noop"}}))]):[(0,n._)((function*({api:e}){try{return{type:"ChannelsOnboardingDone_RequestSucceeded",responseChannels:yield e.fetch("channels.unarchive",{channel_ids:t.pickedChannelsIds.join(",")||"",extended:1})}}catch(e){return{type:"ChannelsOnboardingDone_RequestFailed"}}}))];case"ChannelsOnboardingDone_RequestSucceeded":{const s=(0,o.insertChannels)(e,{apiChannels:t.responseChannels.succeeded||[],apiGroups:t.responseChannels.groups||[]});return a.push(e.organisers.channelFilters,"all",s,!1),[(0,n._)((function*({api:e}){return yield e.fetch("account.hideHelpHint",{hint_id:"im:channels_onboarding"},{retries:1/0}),{type:"Noop"}}))]}case"ChannelsOnboardingDone_RequestFailed":return[];default:(0,r.exhaustivenessCheck)(t)}}},4854:(e,t,s)=>{s.d(t,{handler:()=>a});var n=s(89131),r=s(96190);const a=(e,t)=>{switch(t.type){case"ConvoMediaViewerCacheRemoved":{const{convo:s}=t,n=e.convos.get(s.peerId);return n?(n.mediaViewerCache=void 0,n.mediaViewerCacheHasNext=void 0,n.mediaViewerCacheHasPrev=void 0,[]):[]}case"ConvoMediaViewerCacheInserted":{const{peer_id:s,items:n,direction:a}=t,o=e.convos.get(r.resolveId(s));if(!o)return[];if(!o.mediaViewerCache)return o.mediaViewerCache=n,[];switch(a){case"next":o.mediaViewerCache.push(...n);break;case"prev":o.mediaViewerCache.unshift(...n);break;case"both":o.mediaViewerCache=n}return[]}case"ConvoMediaViewerCacheSetHasNext":{const{peer_id:s,value:n}=t,a=e.convos.get(r.resolveId(s));return a?(a.mediaViewerCacheHasNext=n,[]):[]}case"ConvoMediaViewerCacheSetHasPrev":{const{peer_id:s,value:n}=t,a=e.convos.get(r.resolveId(s));return a?(a.mediaViewerCacheHasPrev=n,[]):[]}default:return(0,n.exhaustivenessCheck)(t)}}},500156:(e,t,s)=>{s.d(t,{handler:()=>b});var n=s(11010),r=s(434788),a=s(453934),o=s(991792),i=s(877740),c=s(481186),d=s(83062),l=s(498928),u=s(96190),h=s(185327),p=s(777634),m=s(999504),f=s(197934),g=s(651285),v=s(168465),_=s(89131),C=s(95154),y=s(954811),k=s(233300),I=s(171949),w=s(927411);const M=1e3,R=200,b=(e,t,s)=>{switch(t.type){case"EngineBatchReceived":{const{variant:r}=t;switch(r.kind){case"FromEngine":return S(s,e,r);case"FromEngineWithMissingData":return function(e,t,s){const{apiConvos:n,apiMessages:r,apiUsers:a,apiGroups:i,apiContacts:c}=s,d=E(r,n);return(0,o.insertConvos)(t,n.map((e=>({conversation:e,last_message:d.messages_legacy.get(e.last_message_id)}))),{dangerouslyMerge:!0}),(0,o.insertPeers)(t,{apiUsers:a,apiGroups:i,apiContacts:c}),S(e,t,{kind:"FromEngine",next:s.skippedBatch},d)}(s,e,r);case"FromApiEngineHistory":return function(e,t,s){var r;const{next:a,apiMessages:i,apiConvos:c,apiUsers:d,apiGroups:u,apiContacts:h,apiCounters:p}=s,f=E(i,c);(0,o.insertConvos)(t,c.map((e=>({conversation:e,last_message:f.messages_legacy.get(e.last_message_id)}))),{dangerouslyMerge:!0}),(0,o.insertPeers)(t,{apiUsers:d,apiGroups:u,apiContacts:h},{dangerouslyOverwrite:!0}),t.activeCallsCount=p.calls||0,l.updateCounters(t.organisers.filters,{unread:p.messages||0,unreadUnmuted:p.messages_unread_unmuted||0,headerNotMutedUnread:0,archive:p.messages_archive_unread||0,archiveMentions:p.messages_archive_mentions_count||0,archiveTotal:p.messages_archive||0,messageRequests:p.message_requests||0,businessNotify:p.business_notify||0,businessNotifyTotal:p.business_notify_all||0}),null==(r=p.messages_folders)||r.forEach((e=>{m.setUnreadCounters(t.organisers.folders,m.resolveId(e.folder_id),e.total_count,e.unmuted_count)}));const{unreadUnmutedCount:g}=t.organisers.filters.unread;return[...S(e,t,{kind:"FromEngine",next:a},f),function(){var e=(0,n._)((function*({notification:e}){return e.setCounters({unread:g}),{type:"Noop"}}));function t(t){return e.apply(this,arguments)}return t}()]}(s,e,r);default:return(0,_.exhaustivenessCheck)(r)}}case"EngineBatchReceived_TypingsTimedOut":{const{peerId:s,typingType:n,timestamp:r}=t,a=e.typings.get(s);if(!a)return[];const o=a[n];return o?(o.updatedAt<=r&&delete a[n],0===Object.keys(a).length&&e.typings.delete(s),[]):[]}case"UpdateMessageRequestsCounter":return[(0,n._)((function*({api:e}){try{const t=w.IApi.resolveTrackId("account.getCounters","message_requests");e.dangerouslyAbort(t);const{message_requests:s}=yield e.fetch("account.getCounters",{filter:"message_requests"},{trackId:t});return{type:"UpdateMessageRequestsCounter_RequestCompleted",count:null!=s?s:0}}catch(e){return{type:"Noop"}}}))];case"UpdateMessageRequestsCounter_RequestCompleted":return l.updateCounters(e.organisers.filters,{messageRequests:t.count}),[];case"TemporaryHackForResync":case"LoadChatMembers":case"LoadChatInfo":case"ComposerDraftsUpdateNeeded":return[];default:return(0,_.exhaustivenessCheck)(t)}};function S(e,t,s,f){const{next:w}=s;if("Failure"===w.kind){t.convoConn.status="resyncing";const e=t.convoConn.pts,s=t.ownerId;return[(b=(0,n._)((function*({api:t,engine:n,queue:a}){var i;let c,d;yield(0,_.sleep)(M);try{[c,d]=yield t.fetchSeq([{method:"messages.getLongPollHistory",params:{lp_version:n.version,credentials:1,pts:e,msgs_limit:1100,events_limit:1100,last_n:1e3,extended:1,group_id:(0,o.getOwnerGroupId)(s)}},{method:"account.getCounters",params:{filter:"all"}}],{retries:1/0})}catch(e){return{type:"Noop"}}if(e<(c.from_pts||0))return a.disconnect(),console.error("Выполняется полный ресинк"),{type:"TemporaryHackForResync"};if(!c.credentials||!c.credentials.pts)throw new Error("В ответе getLongPollHistory отсутствуют новые креды!");return yield n.connect((0,r._)({},c.credentials,{pts:c.credentials.pts})),{type:"EngineBatchReceived",variant:{kind:"FromApiEngineHistory",apiMessages:(null==(i=c.messages)?void 0:i.items)||[],apiConvos:c.conversations||[],apiUsers:c.profiles||[],apiGroups:c.groups||[],apiContacts:c.contacts||[],apiCounters:d,next:{kind:"Batch",pts:c.credentials.pts,ts:c.credentials.ts,updates:c.history||[]}}}})),function(e){return b.apply(this,arguments)})]}var b;if(!(void 0!==f)&&function(e,t){for(const s of t.updates){if(i.IEngine.isIncompleteUpdate(s))return!0;switch(s[0]){case 20:case 21:{const[,t]=s,n=u.resolveId(t);if(!e.convos.has(n))return!0;break}case 52:{const[,t,n,r]=s,a=u.resolveId(n),o=e.convos.get(a);if(!o)break;switch(t){case i.IEngine.ChatUpdateType.FlagsChanged:case i.IEngine.ChatUpdateType.TitleChanged:case i.IEngine.ChatUpdateType.AvatarChanged:case i.IEngine.ChatUpdateType.BannerChanged:case i.IEngine.ChatUpdateType.MessageRequestChanged:case i.IEngine.ChatUpdateType.MessageRequestCanceled:case i.IEngine.ChatUpdateType.MessageRequestAccepted:case i.IEngine.ChatUpdateType.MessageRequestRejected:case i.IEngine.ChatUpdateType.CallInProgressChanged:case i.IEngine.ChatUpdateType.ContactConverted:case i.IEngine.ChatUpdateType.ContactJoined:case i.IEngine.ChatUpdateType.DescriptionChanged:return!0;case i.IEngine.ChatUpdateType.UserJoined:case i.IEngine.ChatUpdateType.UserLeft:case i.IEngine.ChatUpdateType.UserKicked:{const s=u.resolveId(r);if(!e.peers.has(s))return!0;if(t===i.IEngine.ChatUpdateType.UserJoined&&s===e.ownerId)return!0;break}case i.IEngine.ChatUpdateType.Pinned:{const[,,,e]=s;if(0===e)break;const t=p.resolveCmid(e),{status:n}=h.findHistoryNodeByCmid(o,t);return"NotLoaded"===n}case i.IEngine.ChatUpdateType.CopyFlagChanged:case i.IEngine.ChatUpdateType.AdminGrated:case i.IEngine.ChatUpdateType.AdminKicked:case i.IEngine.ChatUpdateType.KeyboardChanged:case i.IEngine.ChatUpdateType.BusinessNotifyDataChanged:case i.IEngine.ChatUpdateType.DonUnsubscribed:case i.IEngine.ChatUpdateType.DonSubscribed:case i.IEngine.ChatUpdateType.IsNewChange:case i.IEngine.ChatUpdateType.StyleChanged:case i.IEngine.ChatUpdateType.ShortPollReactionsChanged:break;default:}break}case 10013:{const[,t]=s,n=u.resolveId(t);return e.convos.has(n)}case 63:case 64:case 65:case 66:case 67:case 68:case 1:case 2:case 3:case 6:case 7:case 10:case 11:case 12:case 80:case 114:case 115:case 119:case 501:case 502:case 503:case 504:case 505:case 506:case 507:case 508:case 602:case 10001:case 10002:case 10006:case 10007:break;case 10003:{const[,,t,n]=s;if(i.IEngine.isIncompleteUpdate(s))break;const r=u.resolveId(n),a=e.convos.get(r);if(!a)break;const{isDeleted:o,isSpam:c}=p.convertFlags(t);if((o||c)&&a)return!0;break}case 4:case 10004:{const[,,,,t,,,n,r]=s,a=u.resolveId(t),o=e.convos.get(a);if(!o)return!0;const i=U(o);if(P(r,i))return!0;if(n.has_template)return!0;const{message:d}=(0,c.fromEngineMessage)(s,e.ownerId,i);if(!e.peers.has(d.peerId)||!e.peers.has(d.authorId))return!0;if(u.isUserPeerId(d.authorId)&&d.peerId===d.authorId&&!e.lastSeens.has(d.authorId))return!0;break}case 5:case 18:case 10005:case 10018:{const[,t,n,r,,,,a,,,o]=s,i=u.resolveId(r),c=e.convos.get(i);if(!c)break;const d=p.resolveCmid(t),l=h.findMessageByCmid(c,d);if(!l)break;if(P(a,U(c)))return!0;if(p.convertFlags(n).hasReactions&&"Normal"===l.kind&&l.updatedAt!==1e3*o)return!0;break}case 19:case 10019:return!0;case 601:{const[,t,n,r]=s;if(1!==t&&2!==t)break;const a=e.convos.get(u.resolveId(n));if(!a||"NotLoaded"===v.findNodeByCmid(a.history,p.resolveCmid(r)).status)return!0;break}default:}}return!1}(t,w))return[(E=t.convoConn.pts,N=w,x=t.ownerId,S=(0,n._)((function*({api:e,engine:t}){var s;let n;try{n=yield e.fetch("messages.getLongPollHistory",{pts:E,lp_version:t.version,extended:1,group_id:(0,o.getOwnerGroupId)(x)},{retries:1/0})}catch(e){return{type:"Noop"}}return{type:"EngineBatchReceived",variant:{kind:"FromEngineWithMissingData",apiConvos:n.conversations||[],apiMessages:(null==(s=n.messages)?void 0:s.items)||[],apiUsers:n.profiles||[],apiGroups:n.groups||[],skippedBatch:N,apiContacts:n.contacts||[]}}})),function(e){return S.apply(this,arguments)})];var S,E,N,x;t.convoConn.status="running",t.convoConn.pts=w.pts;const F=w.updates.flatMap((e=>{switch(e[0]){case 1:case 2:case 3:return function(e,t,s){const[n,r,a,o]=t,i=u.resolveId(o),c=p.resolveId(r),d=e.convos.get(i);if(!d)return[];const l=h.findMessageById(d,c);if(!l)return[];return A(e,[{1:10001,2:10002,3:10003}[n],l.cmid,a,o],s)}(t,e,f);case 4:case 5:case 18:case 19:return function(e,t,s){var n;const[,r]=t,a=null==(n=s)?void 0:n.messages_legacy.get(r);let o;switch(t[0]){case 4:{if(i.IEngine.isIncompleteUpdate(t)){if(!a)return[];const[,,e,s]=t;o=[10004,a.conversation_message_id,e,s,a.peer_id];break}const[,,e,s,n,c,d,l,u,h,p,m]=t;o=[10004,p,e,s,n,c,d,l,u,h,r,m];break}case 5:{if(i.IEngine.isIncompleteUpdate(t)){if(!a)return[];const[,,e]=t;o=[10005,a.conversation_message_id,e,a.peer_id];break}const[,,e,s,n,c,d,l,u,h,p]=t;o=[10005,h,e,s,n,c,d,l,u,r,p];break}case 18:{if(i.IEngine.isIncompleteUpdate(t)){if(!a)return[];const[,,e]=t;o=[10018,a.conversation_message_id,e,a.peer_id];break}const[,,e,s,n,c,d,l,u,h,p]=t;o=[10018,h,e,s,n,c,d,l,u,r,p];break}case 19:if(!a)return[];o=[10019,a.conversation_message_id,a.peer_id];break;default:(0,_.exhaustivenessCheck)(t)}return T(e,o,s)}(t,e,f);case 6:case 7:return function(e,t,s){var n,r;const[a,o]=t,i=u.resolveId(o),c=e.convos.get(i);if(!c)return[];const l=null==(n=s)?void 0:n.convos.get(o),p=l&&(null==(r=(0,y.fromApiConvo)(l))?void 0:r.convo);if(!p)return[];return 6===a?h.readInUntil(c,p.inReadBy,p.unreadCount):h.readOutUntil(c,p.outReadBy),d.refresh(e.organisers,c),[]}(t,e,f);case 10:case 11:case 12:return function(e,t){const[s,n,r]=t,a=u.resolveId(n),o=e.convos.get(a);if(!o)return[];const i={10:"unset",11:"replace",12:"set"}[s];return h.updateFlags(o,i,r),d.refresh(e.organisers,o),[]}(t,e);case 20:return function(e,t){const[,s,n]=t,r=u.resolveId(s),a=e.convos.get(r);if(!a)return[];return h.updateSortId(a,{majorSortId:n}),d.refresh(e.organisers,a),[]}(t,e);case 21:return function(e,t){const[,s,r]=t,a=u.resolveId(s),o=e.convos.get(a);if(!o)return[];h.updateSortId(o,{minorSortId:r}),d.refresh(e.organisers,o);const i=r<=0,c=e.organisers.filters.messageRequest.totalCount>0;if(i&&c)return[(0,n._)((function*(){return{type:"UpdateMessageRequestsCounter",peerId:a}}))];return[]}(t,e);case 52:return function(e,t,s,a){var o;const[,c,l,m]=t,f=u.resolveId(l),g=e.convos.get(f);if(!g)return[];const v=null==(o=a)?void 0:o.convos.get(l),_=v&&(0,y.fromApiConvo)(v);switch(c){case i.IEngine.ChatUpdateType.CopyFlagChanged:case i.IEngine.ChatUpdateType.TitleChanged:case i.IEngine.ChatUpdateType.AvatarChanged:return[];case i.IEngine.ChatUpdateType.FlagsChanged:var C;return"ChatConvo"!==g.kind||"ChatConvo"!==(null==(C=_)?void 0:C.convo.kind)||(g.isService=_.convo.isService,g.permissions=_.convo.permissions,g.acl=_.convo.acl,g.inviteLinks=_.convo.inviteLinks),[];case i.IEngine.ChatUpdateType.Pinned:{var k;if("ChatConvo"!==g.kind)return[];const t=m,s=p.resolveCmid(t);if(g.pinnedMessage){var I;const e=h.findMessageByCmid(g,g.pinnedMessage.cmid);"Normal"===(null==(I=e)?void 0:I.kind)&&p.unpinMessage(e)}if(e.hiddenPinnedMessages.delete(f),(null==(k=_)?void 0:k.convo.kind)===g.kind)return _.convo.pinnedMessage&&h.pinMessage(g,_.convo.pinnedMessage),[];if(0===s)h.unpinMessage(g);else{var w;const e=h.findMessageByCmid(g,s);"Normal"===(null==(w=e)?void 0:w.kind)&&h.pinMessage(g,p.toPinned(e))}return[]}case i.IEngine.ChatUpdateType.ContactJoined:return[];case i.IEngine.ChatUpdateType.UserJoined:{if("ChatConvo"!==g.kind)return[];const t=u.resolveId(m);if(!u.isUserPeerId(t)&&!u.isGroupPeerId(t))return[];if(g.members){const s=g.adminIds.has(t),n={peerId:t,isAdmin:s,canKick:g.adminIds.has(e.ownerId)&&!s||g.ownerId===e.ownerId,isMessageRequest:!1};h.addMembers(g,[n])}return t===e.ownerId?(h.changeUserState(g,"in"),h.allowWrite(g),e.locks.getConversationMembers.add(f),[u.isChatPeerId(f)&&(0,n._)((function*(){return{type:"LoadChatMembers",peerId:f}})),u.isChatPeerId(f)&&(0,n._)((function*(){return{type:"LoadChatInfo",peerId:f}}))]):[]}case i.IEngine.ChatUpdateType.UserLeft:{if("ChatConvo"!==g.kind)return[];const t=u.resolveId(m);return u.isUserPeerId(t)||u.isGroupPeerId(t)?(t===e.ownerId&&h.changeUserState(g,"left"),g.adminIds.has(t)&&g.adminIds.delete(t),h.removeMember(g,t),[]):[]}case i.IEngine.ChatUpdateType.UserKicked:{if("ChatConvo"!==g.kind)return[];const t=u.resolveId(m);if(!u.isUserPeerId(t)&&!u.isGroupPeerId(t))break;t===e.ownerId&&(h.changeUserState(g,"kicked"),h.restrictWrite(g,"kicked")),g.adminIds.has(t)&&g.adminIds.delete(t),h.removeMember(g,t);break}case i.IEngine.ChatUpdateType.KeyboardChanged:return[];case i.IEngine.ChatUpdateType.CallInProgressChanged:var M;if("ChatConvo"===g.kind&&(null==(M=_)?void 0:M.convo.kind)===g.kind){h.updateActiveCall(g,_.convo.activeCall);const e=_.convo.inReadBy,t=_.convo.unreadCount;return[function(){var s=(0,n._)((function*({calls:s}){var n;return null==(n=s)||n.updateConvoCounter(f,e,t),{type:"Noop"}}));function r(e){return s.apply(this,arguments)}return r}()]}return[];case i.IEngine.ChatUpdateType.IsNewChange:return h.updateIsNew(g,!!m),[];case i.IEngine.ChatUpdateType.MessageRequestChanged:{const t=m;switch(t){case i.IEngine.MRStatus.Accepted:{var R;if("MessageRequestChatConvo"!==g.kind&&"MessageRequestUserConvo"!==g.kind||"pending"!==g.MRStatus){d.refresh(e.organisers,g);break}const t=h.fromAcceptedMessageRequest(g,null==(R=_)?void 0:R.convo);e.convos.set(f,t),d.refresh(e.organisers,t);break}case i.IEngine.MRStatus.New:var b,S,E,U;if(null==(b=_)?void 0:b.convo)e.convos.set(f,null==(E=_)?void 0:E.convo);d.refresh(e.organisers,null!=(U=null==(S=_)?void 0:S.convo)?U:g);break;case i.IEngine.MRStatus.Deleted:if("MessageRequestChatConvo"!==g.kind&&"MessageRequestUserConvo"!==g.kind&&"UserConvo"!==g.kind)break;const t=h.fromCancelledMessageRequest(g);e.convos.set(f,t),d.refresh(e.organisers,t);break;case i.IEngine.MRStatus.Rejected:if(h.isRejectedMR(g)){d.refresh(e.organisers,g);break}if("MessageRequestChatConvo"!==g.kind&&"MessageRequestUserConvo"!==g.kind&&"UserConvo"!==g.kind)break;const s=h.fromRejectedMessageRequest(g);e.convos.set(f,s),d.refresh(e.organisers,s);break;default:}return[(0,n._)((function*(){return{type:"UpdateMessageRequestsCounter",peerId:f}}))]}case i.IEngine.ChatUpdateType.AdminGrated:{var P;const t=u.resolveId(m);if("ChatConvo"!==g.kind||!u.isUserPeerId(t)&&!u.isGroupPeerId(t))return[];g.adminIds.add(t);const s=null==(P=g.members)?void 0:P.get(t);return s&&h.addMembers(g,[(0,r._)({},s,{isAdmin:!0,canKick:g.ownerId===e.ownerId})]),[]}case i.IEngine.ChatUpdateType.AdminKicked:{var A;const t=u.resolveId(m);if("ChatConvo"!==g.kind||!u.isUserPeerId(t)&&!u.isGroupPeerId(t))return[];g.adminIds.delete(t);const s=null==(A=g.members)?void 0:A.get(t);return s&&h.addMembers(g,[(0,r._)({},s,{isAdmin:!1,canKick:g.adminIds.has(e.ownerId)})]),[]}case i.IEngine.ChatUpdateType.ContactConverted:{const t=u.resolveId(m),s=e.convos.get(t),n=e.peers.get(t);return n&&s&&"Contact"===n.kind&&u.isUserPeerId(f)?(u.convertContact(n,f),h.updateSortId(s,{minorSortId:0}),[]):[]}case i.IEngine.ChatUpdateType.BannerChanged:var T,N;return"UserConvo"!==g.kind||(null==(T=_)?void 0:T.convo.kind)!==g.kind||(g.convoBanner=null==(N=_)?void 0:N.convo.convoBanner),[];case i.IEngine.ChatUpdateType.DescriptionChanged:var x;return"ChatConvo"!==g.kind||(null==(x=_)?void 0:x.convo.kind)!==g.kind||(g.description=_.convo.description),[];case i.IEngine.ChatUpdateType.ShortPollReactionsChanged:return"ChatConvo"!==g.kind||(g.shouldShortPollReactions=Boolean(m)),[];case i.IEngine.ChatUpdateType.BusinessNotifyDataChanged:case i.IEngine.ChatUpdateType.MessageRequestAccepted:case i.IEngine.ChatUpdateType.MessageRequestCanceled:case i.IEngine.ChatUpdateType.MessageRequestRejected:case i.IEngine.ChatUpdateType.DonSubscribed:case i.IEngine.ChatUpdateType.DonUnsubscribed:case i.IEngine.ChatUpdateType.StyleChanged:return[];default:}return[]}(t,e,0,f);case 63:case 64:case 65:case 66:case 67:case 68:return function(e,t){const[s,a,o,i,c]=t,d=u.resolveId(a),l=new Set(o.map((e=>u.resolveId(e))));l.delete(e.viewer.id);const h=e.convos.get(d);if(!h)return[];const p={63:"text",64:"voice",65:"photo",66:"video",67:"file",68:"videomessage"}[s],m=(0,r._)({},e.typings.get(d)||{},{[p]:{peerIds:l,updatedAt:c,totalCount:i}});return e.typings.set(d,m),[function(){var e=(0,n._)((function*(){return yield(0,_.sleep)(C.TYPING_EXPIRATION_TIME),{type:"EngineBatchReceived_TypingsTimedOut",peerId:d,typingType:p,timestamp:c}}));function t(){return e.apply(this,arguments)}return t}()]}(t,e);case 80:return function(e,t){const[,s,r,,a,,o,i,,c]=t;return l.updateCounters(e.organisers.filters,{unread:s,headerNotMutedUnread:o,unreadUnmuted:r,archive:i,archiveMentions:c,businessNotify:a}),[function(){var e=(0,n._)((function*({notification:e}){return e.setCounters({unreadIdle:o,unread:r}),{type:"Noop"}}));function t(t){return e.apply(this,arguments)}return t}()]}(t,e);case 114:return function(e,t){const[,{peer_id:s}]=t,n=u.resolveId(s),r=e.convos.get(n);if(!r)return[];const a=(0,y.fromLongpollPushSettings)(t);return h.updatePush(r,a),[]}(t,e);case 115:return function(e,t){const[,s]=t,{browserNotifications:r}=e.viewer.settings;return[(0,n._)((function*({calls:e,notification:t}){if(!e)return{type:"Noop"};if(e.showIncomingCall(s),!r)return{type:"Noop"};const n=u.resolveId(s.from_id);let a,o="";return s.caller_info&&(o=`${s.caller_info.first_name} ${s.caller_info.last_name}`,a=s.caller_info.photo_400),s.chat_info&&(o=s.chat_info.title,a=s.chat_info.photo_400),t.notify({kind:"call",peerId:n,caller:o,image:a},n),{type:"Noop"}}))]}(t,e);case 119:return function(e,t){const[,s]=t,n=u.resolveId(s.peer_id),r=u.resolveId(s.owner_id),a=e.convos.get(n),o=e.peers.get(n),i=e.peers.get(r),c=a&&o&&i?(0,k.fromApiMessageEvent)(o,i,s):void 0;return e.botKeyboardEvent=c,[]}(t,e);case 501:return function(e,t){const[,s,n]=t;return(0,o.insertFolders)(e,[{id:s,name:n}]),[]}(t,e);case 502:return function(e,t){const[,s]=t,n=m.resolveId(s);m.deleteFolder(e.organisers.folders,n);for(const t of e.convos.values())h.removeFolder(t,n);return[]}(t,e);case 503:return function(e,t){const[,s,n]=t,r=m.resolveId(s),a=e.organisers.folders.find((e=>e.id===r));if(!a)return[];return m.setName(a,n),[]}(t,e);case 504:return function(e,t){const[,s,...n]=t,r=m.resolveId(s),a=(0,o.getConvosByIds)(e,n),i=e.organisers.folders.find((e=>e.id===r));if(!i)return[];return(0,o.addConvosToFolder)(e,r,a),[]}(t,e);case 505:return function(e,t){const[,s,...n]=t,r=m.resolveId(s),a=(0,o.getConvosByIds)(e,n),i=e.organisers.folders.find((e=>e.id===r));if(!i)return[];return(0,o.removeConvosFromFolder)(e,r,a),[]}(t,e);case 506:return function(e,t){const[,...s]=t;return m.reorderFolders(e.organisers.folders,s.map((e=>m.resolveId(e)))),[]}(t,e);case 507:return function(e,t){const[,...s]=t;for(const t of s){if(t.length<3)continue;const s=m.resolveId(t[0]);m.setUnreadCounters(e.organisers.folders,s,t[1],t[2])}return[]}(t,e);case 508:return function(e,t){const[,s]=t,n=m.resolveId(s),r=e.organisers.folders.find((e=>e.id===n));if(!r)return[];return m.replaceFolder(e.organisers.folders,(0,I.fromApiFolder)({id:n,name:r.name})),[]}(t,e);case 601:return function(e,t,s){var r;const[,o,i,d]=t,l=u.resolveId(i),m=p.resolveCmid(d);let f,v=0,_=[];switch(o){case 1:{const[,,,,e,s,...n]=t;v=s,_=n,f=g.resolveId(e);break}case 2:case 3:case 4:{const[,,,,e,...s]=t;v=e,_=s;break}default:return[]}const C=[];let y=0;for(let e=0;e<v;e++){const e=_[y];if(!e)return[];const t=_.slice(y+1,y+1+e);y+=1+e;const[s,n,r]=t.slice(0,3);if(void 0===s||void 0===n||void 0===r)return[];const a=t.slice(3,3+r).map(u.resolveId);C.push({reactionId:g.resolveId(s),count:n,peerIds:new Set(a)})}const k=e.convos.get(l);if(!k)return[];let I,w,M=0,b=[];if(2===o||4===o){var S;M=null!=(S=_[y])?S:0;const e=y+1,t=e+Math.min(3,null!=M?M:0);b=_.slice(e,t).map((e=>u.resolveId(e))),I=_[t]?g.resolveId(_[t]):void 0}w=h.findMessageByCmid(k,m),"Normal"===(null==(r=w)?void 0:r.kind)&&(1!==o&&3!==o||p.setCurrentUserReaction(w,f),p.setReactions(w,C));if(w)w=(0,a.isDraft)(w)?(0,a.current)(w):w;else{var E,U;const e=null==(U=s)||null==(E=U.messagesByPeerId.get(l))?void 0:E.get(m);if(w=e&&(0,c.fromApiMessage)(e).message,!w)return[]}const P=`${l}-${m}`;var A;const T=null!=(A=e.messageReactedPeers.get(P))?A:new Set;let N=[];switch(o){case 2:N=b.filter((e=>!T.has(e))),e.messageReactedPeers.set(P,new Set([...T,...N]));break;case 4:const t=new Set([...T].filter((e=>!b.includes(e))));if(0===t.size){e.messageReactedPeers.delete(P);break}e.messageReactedPeers.set(P,t)}if(e.messageReactedPeers.size>R){const t=e.messageReactedPeers.keys(),s=e.messageReactedPeers.size-R;for(let n=0;n<s;n++)e.messageReactedPeers.delete(t.next().value)}let x=N.map((t=>{const s=e.peers.get(u.resolveId(t)),n=(0,a.isDraft)(s)?(0,a.current)(s):s;return null!=n?n:null})).filter((e=>null!==e));const F=!h.isMuted(k)&&e.viewer.settings.push.messageReaction.isEnabled,q=C.some((t=>!e.messageReactions.has(t.reactionId)));I&&h.setUnreadReaction(k,m,I);return[function(){var e=(0,n._)((function*({notification:e}){var t;if("Normal"!==(null==(t=w)?void 0:t.kind))return{type:"Noop"};const s=w.sentAt<Date.now()-432e5,n=[...w.reactions.values()].reduce(((e,t)=>e+t.count),0);return F&&w.isOut&&2===o&&!s&&n<8&&M>0&&e.notify({kind:"reaction",message:w,reactedPeers:x,reactedCount:M}),{type:"Noop"}}));function t(t){return e.apply(this,arguments)}return t}(),q&&(0,n._)((function*(){return{type:"InvalidateMessageReactions",force:!0}}))]}(t,e,f);case 602:return function(e,t){const[,s,...n]=t,r=u.resolveId(s),a=e.convos.get(r);if(!a)return[];const o=n[0];if(void 0===o)return[];const i=n.slice(1,o+1).map(p.resolveCmid);return h.replaceUnreadReactions(a,i),[]}(t,e);case 10001:case 10002:case 10003:return A(t,e,f);case 10004:case 10005:case 10018:case 10019:return T(t,e,f);case 10006:case 10007:return function(e,t){const[s,r,a,o]=t,i=u.resolveId(r),c=p.resolveCmid(a),l=e.convos.get(i);if(!l)return[];10006===s?(h.readInUntil(l,c,o),u.isFavorites(l.peerId,e.ownerId)&&h.readOutUntil(l,c)):h.readOutUntil(l,c);return d.refresh(e.organisers,l),[10006===s&&"ChatConvo"===l.kind&&l.activeCall&&function(){var e=(0,n._)((function*({calls:e}){var t;return null==(t=e)||t.updateConvoCounter(i,a,o),{type:"Noop"}}));function t(t){return e.apply(this,arguments)}return t}()]}(t,e);case 10013:return function(e,t,s){var r;const[,a,o]=t,i=u.resolveId(a),c=p.resolveCmid(o),l=e.convos.get(i);if(!l)return[];if(v.lastCmid(l.history)!==c)return[];const h=null==(r=s)?void 0:r.convos.get(a),m=h&&(0,y.fromApiConvo)(h);if(!m)return[function(){var e=(0,n._)((function*({logger:e}){return e.error("[EngineBatchReceived]",new Error(`В ${t[0]} отсутствует дозагруженная беседа`)),{type:"Noop"}}));function s(t){return e.apply(this,arguments)}return s}()];e.convos.set(m.convo.peerId,m.convo),m.peer&&e.peers.set(m.peer.id,m.peer);return d.refresh(e.organisers,l),[]}(t,e,f);default:return[]}}));return[function(){var e=(0,n._)((function*({engine:e}){return{type:"EngineBatchReceived",variant:{kind:"FromEngine",next:yield e.poll()}}}));return function(t){return e.apply(this,arguments)}}(),...F]}function E(e,t){const s=new Map;for(const t of e){let e=s.get(t.peer_id);e||(e=new Map,s.set(t.peer_id,e)),e.set(t.conversation_message_id,t)}return{messages_legacy:new Map(e.map((e=>[e.id,e]))),messagesByPeerId:s,convos:new Map(t.map((e=>[e.peer.id,e])))}}function U(e){return function(t){var s;const n=h.findMessageByCmid(e,t);return"Normal"===(null==(s=n)?void 0:s.kind)?n:void 0}}function P(e,t){if(e.fwd&&!e.reply)return!0;if(e.reply){const s=JSON.parse(e.reply);if(!t(p.resolveCmid(s.conversation_message_id)))return!0}if(e.geo)return!0;if(e.attachments&&e.attach1_type&&!e.attach2_type)try{const t=JSON.parse(e.attachments);if(Array.isArray(t)&&t[0].type===e.attach1_type)return!1}catch(e){return!0}return!!e.attach1_type}function A(e,t,s){const[r,a,o,i]=t,d=p.resolveCmid(a),l=u.resolveId(i),m=e.convos.get(l);if(!m)return[];const f=p.convertFlags(o);if(10003===r){const{isDeleted:e,isSpam:t}=f;if((e||t)&&a){var g,v;const e=null==(v=s)||null==(g=v.messagesByPeerId.get(i))?void 0:g.get(a);if(e){const t=(0,c.fromApiMessage)(e);h.restoreMessage(m,t.message,t.mentions.hasDirect||t.mentions.hasMass)}}}const _={10001:"replace",10002:"set",10003:"unset"}[r],{status:C}=h.findHistoryNodeByCmid(m,d);return"NotLoaded"===C?[]:(h.updateMessageFlags(m,d,_,o),[(0,n._)((function*(){if(10002!==r)return{type:"Noop"};const{isDeleted:e,isDeletedForAll:t}=f;return e||t?{type:"ComposerDraftsUpdateNeeded",peerId:l,foreignKind:"message",itemsToDelete:[{peerId:l,cmid:d}]}:{type:"Noop"}}))])}function T(e,t,s){var r,a;const[,l]=t;let m;switch(t[0]){case 10004:m=t[4];break;case 10005:case 10018:m=t[3];break;case 10019:m=t[2];break;default:(0,_.exhaustivenessCheck)(t)}const g=u.resolveId(m),v=e.convos.get(g);if(!v)return[];const C=null==(a=s)||null==(r=a.messagesByPeerId.get(m))?void 0:r.get(l);let y,I,w;if(C){var M,R;const e=(0,c.fromApiMessage)(C);y=e.message,I=e.mentions;const t=null==(R=s)||null==(M=R.convos.get(g))?void 0:M.current_keyboard;if(t){const e=(0,k.fromApiKeyboard)(t,g);if("InputKeyboard"===e.kind){JSON.stringify(v.currentKeyboard)!==JSON.stringify(e)&&(w={kind:"InputKeyboardUpsertEvent",keyboard:e})}}else w={kind:"InputKeyboardDeleteEvent"}}else{if(i.IEngine.isIncompleteUpdate(t)||10019===t[0])return[];const s=(0,c.fromEngineMessage)(t,e.ownerId,U(v));y=s.message,I=s.mentions,w=s.keyboardEvent}switch(t[0]){case 10004:{var b,S;const s=e.typings.get(v.peerId);if(s)for(const t of o.TypingVariants){const n=s[t];n&&n.peerIds.has(y.authorId)&&(n.peerIds.delete(y.authorId),n.totalCount--,0===n.totalCount&&delete s[t],0===Object.keys(s).length&&e.typings.delete(v.peerId))}const r=t[3],a=I.hasDirect||I.hasMass;"ChatConvo"===v.kind?h.appendMessage(v,y,r,a,w):h.appendMessage(v,y,r,!1,w),d.refresh(e.organisers,v),e.locks.convosCleanup.has(v.peerId)||h.cleanup(v),"InputKeyboardUpsertEvent"===(null==(b=w)?void 0:b.kind)&&e.hiddenBotKeyboards.delete(v.peerId);const i=p.convertFlags(t[2]),c=h.isMessageUnread(v,y),{browserNotifications:l,soundNotifications:m,push:_}=e.viewer.settings,C=!y.isOut&&!i.noPush&&c&&!h.isMuted(v)&&m&&!y.isSilent;let k,M=null;switch(v.kind){case"UserConvo":M=_.userConvo;break;case"ChatConvo":M=_.chatConvo;break;case"GroupConvo":M=_.groupConvo}switch(!0){case y.isOut:case!c:case"nothing"===v.push.mode||"nothing"===_.mention:case null!==M&&!M.isEnabled:case!l:case i.noPush:k=!1;break;case!h.isMuted(v):k=!0;break;case"direct-mention"===v.push.mode||"direct-mention"===_.mention:k=I.hasDirect;break;case"every-mention"===v.push.mode&&"every-mention"===_.mention:k=a;break;default:k=!0}const R=u.isMarusia(g)&&"Normal"===y.kind&&{type:"add_message",payload:{randomId:Number(y.randomId),text:p.toRawText(y),isOutbound:y.isOut,local:!1,payload:null==(S=t[7])?void 0:S.payload,attachIds:f.ids(y.attaches)}},U=v.unreadCount,T=v.inReadBy;return[(A=(0,n._)((function*({notification:e}){return k&&e.notify({kind:"message",message:y},g),C&&e.playSound(),{type:"Noop"}})),function(e){return A.apply(this,arguments)}),"ChatConvo"===v.kind&&v.activeCall&&(P=(0,n._)((function*({calls:e}){var t;return null==(t=e)||t.updateConvoCounter(g,T,U),{type:"Noop"}})),function(e){return P.apply(this,arguments)}),R&&(E=(0,n._)((function*({marusia:e}){var t;return null==(t=e)||t.handleAction(R),{type:"Noop"}})),function(e){return E.apply(this,arguments)})]}case 10005:case 10018:case 10019:return h.replaceMessage(v,y,I.hasDirect||I.hasMass),"Expired"===y.kind&&h.replaceExpiredReplies(v,y.cmid),[(0,n._)((function*(){return{type:"ComposerDraftsUpdateNeeded",peerId:g,foreignKind:"message",itemsToDelete:"Expired"===y.kind?[{peerId:g,cmid:y.cmid}]:void 0,itemsToReplace:"Normal"===y.kind?[y]:void 0}}))];default:return(0,_.exhaustivenessCheck)(t)}var E,P,A}},553977:(e,t,s)=>{s.d(t,{handler:()=>r});var n=s(991792);const r=(e,t)=>((0,n.insertPeers)(e,{apiUsers:t.profile?[t.profile]:[],apiContacts:[t.contact],apiGroups:[]},{dangerouslyOverwrite:!0}),(0,n.insertContacts)(e,[t.contact]),[])},972284:(e,t,s)=>{s.d(t,{handler:()=>c});var n=s(11010),r=s(434788),a=s(89131),o=s(651285);const i=864e5,c=(e,t)=>{switch(t.type){case"InvalidateMessageReactions":{const{force:r}=t,{locks:{invalidateMessageReactions:a}}=e;return a?[]:(e.locks.invalidateMessageReactions=!0,[(s=(0,n._)((function*({api:e,storage:t}){try{const s=yield function(e){return d.apply(this,arguments)}({api:e,storage:t,force:Boolean(r)});return{type:"InvalidateMessageReactions_RequestCompleted",hasFailed:null===s,response:s}}catch(e){return{type:"InvalidateMessageReactions_RequestCompleted",hasFailed:!0,response:null}}})),function(e){return s.apply(this,arguments)})])}case"InvalidateMessageReactions_RequestCompleted":{const{response:s,hasFailed:n}=t;return n||!s||(e.locks.invalidateMessageReactions=!1,e.messageReactions=s.assets.reduce(((e,t)=>{var n,r;const a=null!=(r=null==(n=s.override_assets)?void 0:n.find((e=>e.reaction_id===t.reaction_id)))?r:t;return e.set(o.resolveId(a.reaction_id),{id:o.resolveId(a.reaction_id),image:a.links.static,animationSmall:a.links.small_animation,animationBig:a.links.big_animation,name:""}),e}),new Map)),[]}default:(0,a.exhaustivenessCheck)(t)}var s};function d(){return(d=(0,n._)((function*({api:e,storage:t,force:s=!1}){var n;const a=t.get("message-reactions-assets"),o=(new Date).getTime(),c=!a||a.expiresAt<o;let d=null;var l;if(c||s)try{var u,h;d=yield e.fetch("messages.getReactionsAssets",{client_version:null!=(h=null==(u=a)?void 0:u.response.version)?h:void 0},{retries:3})}catch(e){var p;d=(null==(p=a)?void 0:p.response)||null}else d=(null==(l=a)?void 0:l.response)||null;const m=d?(0,r._)({},d,{assets:[...(null==(n=a)?void 0:n.response.assets)||[],...d.assets],override_assets:d.override_assets||[]}):null;return(c||s)&&m&&t.set("message-reactions-assets",{response:m,expiresAt:o+i}),m}))).apply(this,arguments)}},735130:(e,t,s)=>{s.d(t,{handler:()=>d});var n=s(11010),r=s(434788),a=s(89131),o=s(185327),i=s(991792),c=s(954811);const d=(e,t)=>{switch(t.type){case"LoadChatInfo":{const{peerId:s}=t,r=(0,i.getOwnerGroupId)(e.ownerId);return e.locks.getConversationInfo.has(s)?[]:(e.locks.getConversationInfo.add(s),[(l=(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.getConversationsById",{peer_ids:s.toString(),group_id:r,extended:0});return{type:"LoadChatInfo_RequestComplete",peerId:s,convo:t.items[0],hasFailed:!t.items[0]}}catch(e){return{type:"LoadChatInfo_RequestComplete",peerId:s,hasFailed:!0}}})),function(e){return l.apply(this,arguments)})])}case"LoadChatInfo_RequestComplete":{var s,d;const{peerId:n,convo:a,hasFailed:i}=t;e.locks.getConversationInfo.delete(n);const l=e.convos.get(n);if("ChatConvo"!==(null==(s=l)?void 0:s.kind)||i||!a)return[];const u=(0,c.fromApiConvo)(a);return"ChatConvo"!==(null==(d=u)?void 0:d.convo.kind)||(o.updateAcl(l,(0,r._)({},u.convo.acl)),o.updateMembersCount(l,u.convo.membersCount)),[]}default:(0,a.exhaustivenessCheck)(t)}var l}},339962:(e,t,s)=>{s.d(t,{handler:()=>c});var n=s(11010),r=s(89131),a=s(185327),o=s(991792),i=s(698057);const c=(e,t)=>{switch(t.type){case"LoadChatMembers":{var s,c;const{peerId:r,offset:a}=t,i=(0,o.getOwnerGroupId)(e.ownerId),d=e.convos.get(r),l="ChatConvo"!==(null==(s=d)?void 0:s.kind)||null==(c=d.members)?void 0:c.size;return[(h=(0,n._)((function*({api:e}){try{return{type:"LoadChatMembers_RequestComplete",peerId:r,response:yield e.fetch("messages.getConversationMembers",{peer_id:r,extended:1,group_id:i,count:1e3,offset:a||l},{retries:1}),hasFailed:!1}}catch(e){return{type:"LoadChatMembers_RequestComplete",peerId:r,hasFailed:!0}}})),function(e){return h.apply(this,arguments)})]}case"LoadChatMembers_RequestComplete":{var d,l;const{peerId:s,response:r,hasFailed:c}=t;e.locks.getConversationMembers.delete(s);const h=e.convos.get(s);if("ChatConvo"!==(null==(d=h)?void 0:d.kind)||c||!r)return[];const{members:p,adminIds:m,ownerId:f}=(0,i.fromApiChatMembers)(r.items);return a.addMembers(h,p,r.count),m.forEach((e=>{a.addAdmin(h,e)})),f&&a.setOwner(h,f),(0,o.insertPeers)(e,{apiUsers:r.profiles||[],apiGroups:r.groups||[],apiContacts:r.contacts||[]}),((null==(l=h.members)?void 0:l.size)||0)<r.count?[(u=(0,n._)((function*(){return{type:"LoadChatMembers",peerId:s}})),function(){return u.apply(this,arguments)})]:[]}default:(0,r.exhaustivenessCheck)(t)}var u,h}},427418:(e,t,s)=>{s.d(t,{handler:()=>o});var n=s(11010),r=s(89131),a=s(991792);const o=(e,t)=>{switch(t.type){case"LoadContactList":return e.locks.contactList?[]:(e.locks.contactList=!0,[(s=(0,n._)((function*({api:e}){try{const s=yield e.fetch("account.getContactList",{extended:1,offset:t.offset},{retries:1});return{type:"LoadContactList_RequestCompleted",contacts:s.contacts||[],profiles:s.profiles||[],items:s.items||[]}}catch(e){return{type:"LoadContactList_RequestCompleted",contacts:[],profiles:[],items:[]}}})),function(e){return s.apply(this,arguments)})]);case"LoadContactList_RequestCompleted":return e.locks.contactList=!1,(0,a.insertContacts)(e,t.contacts),(0,a.insertContactItems)(e,t.items,t.profiles),e.contacts.hasMore=!1,[];default:(0,r.exhaustivenessCheck)(t)}var s}},61448:(e,t,s)=>{s.d(t,{getImportantMessageKey:()=>c,handler:()=>i});var n=s(11010),r=s(89131),a=s(481186),o=s(991792);const i=(e,t)=>{switch(t.type){case"LoadImportantMessages":{const t=20*Math.floor(e.importantMessages.messages.size/20),s=e.ownerId;return[(d=(0,n._)((function*({api:e}){try{return{type:"LoadImportantMessages_RequestCompleted",hasFailed:!1,response:yield e.fetch("messages.getImportantMessages",{count:20,offset:t,extended:1,group_id:(0,o.getOwnerGroupId)(s)})}}catch(e){return{type:"Noop"}}})),function(e){return d.apply(this,arguments)})]}case"LoadImportantMessages_RequestCompleted":{var s,i;const{response:{messages:n,profiles:r,groups:d,conversations:l}}=t;return((null==(s=n.items)?void 0:s.length)||0)<20&&(e.importantMessages.hasMore=!1),(0,o.insertConvos)(e,l||[]),(0,o.insertPeers)(e,{apiUsers:r||[],apiGroups:d||[],apiContacts:[]}),null==(i=n.items)||i.forEach((t=>{const{message:s}=(0,a.fromApiMessage)(t);"Normal"===s.kind&&e.importantMessages.messages.set(c(s.peerId,s.cmid),s)})),[]}case"UserClosedImportantMessages":return e.importantMessages.messages.clear(),e.importantMessages.hasMore=!0,[];default:return(0,r.exhaustivenessCheck)(t)}var d},c=(e,t)=>`${e}-${t}`},228153:(e,t,s)=>{s.d(t,{handler:()=>o});var n=s(11010),r=s(89131),a=s(986727);const o=(e,t)=>{switch(t.type){case"LoadStickers":{const{stickers:s,locks:{loadStickers:r}}=e,a=t.stickerIds.filter((e=>!r.has(e)&&!s.has(e)));return a.length?(e.locks.loadStickers=new Set([...r,...a]),[(0,n._)((function*({api:e}){try{return{type:"LoadStickers_RequestCompleted",response:yield e.fetch("store.getStickers",{sticker_ids:a.join()})}}catch(e){}return{type:"LoadStickers_RequestCompleted",hasFailed:!0}}))]):[]}case"LoadStickers_RequestCompleted":{const{response:s,hasFailed:n}=t;if(n||!s)return[];const{stickers:r}=e;return s.forEach((e=>{const t=(0,a.fromApiSticker)(e);t&&r.set(t.id,t)})),[]}default:(0,r.exhaustivenessCheck)(t)}}},382379:(e,t,s)=>{s.d(t,{handler:()=>d});var n=s(11010),r=s(434788),a=s(991792),o=s(95154),i=s(452788),c=s(89131);const d=(e,t)=>{switch(t.type){case"MoreChannelsNeeded":{const{organiser:a}=t,{filter:c}=a,d=i.getLockId(c);if(e.locks.getChannels[d]||!e.organisers.channelFilters[c].hasMore)return[];const{minorSortId:l,channelId:u}=e.organisers.channelFilters[c].boundary;e.locks.getChannels[d]=!0;const h=o.CHANNELS_PER_PAGE+1,p=i.isLoaded(e.organisers.channelFilters[c])?l:void 0;return[(s=(0,n._)((function*({api:e}){try{var s;const n=yield e.fetch("channels.get",{count:h,offset_minor_sort_id:p,offset_channel_id:u,filter:i.snakeCaseId(a.filter),extended:1},{retries:3});return(0,r._)({},t,{type:"MoreChannelsNeeded_RequestCompleted",hasFailed:!1,response:n,hasMore:((null==(s=n.items)?void 0:s.length)||0)>=h})}catch(e){return(0,r._)({},t,{type:"MoreChannelsNeeded_RequestCompleted",hasFailed:!0,hasMore:!1})}})),function(e){return s.apply(this,arguments)})]}case"MoreChannelsNeeded_RequestCompleted":{const{hasFailed:s,organiser:n,hasMore:r}=t;let o="";if("channelFilters"===n.kind)o=i.getLockId(n.filter);else(0,c.exhaustivenessCheck)(n.kind);if(e.locks.getChannels[o]=!1,s)return[];const{response:d}=t;if(d){const t=(0,a.insertChannels)(e,{apiChannels:d.items||[],apiGroups:d.groups||[]});if((0,a.insertPeers)(e,{apiUsers:d.profiles||[],apiGroups:d.groups||[],apiContacts:[]}),"channelFilters"===n.kind)i.push(e.organisers.channelFilters,n.filter,t,r);else(0,c.exhaustivenessCheck)(n.kind)}return[]}default:(0,c.exhaustivenessCheck)(t)}var s}},203677:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(434788),a=s(991792),o=s(95154),i=s(498928),c=s(89131),d=s(999504);const l=(e,t)=>{switch(t.type){case"MoreConvosNeeded":{const{organiser:l}=t,u=e.ownerId;let h,p="";switch(l.kind){case"filters":{const{filter:t}=l;if(p=i.getLockId(t),e.locks.getConversations[p]||!e.organisers.filters[t].hasMore)return[];h={start_message_id:i.isLoaded(e.organisers.filters[t])?e.organisers.filters[t].boundary.minorSortId:void 0,filter:i.snakeCaseId(t),extended:1,group_id:(0,a.getOwnerGroupId)(u)};break}case"folders":{const{id:t,filter:s}=l;p=d.getLockId(t,s);const n=e.organisers.folders.find((e=>e.id===t));if(!n)throw new Error("Не найдена папка");if(e.locks.getConversations[p]||d.isLoaded(n,s)&&!n[s].hasMore)return[];h={start_message_id:d.isLoaded(n,s)?n[s].boundaryMinorId:void 0,folder_id:n.id,filter:s,extended:1,group_id:(0,a.getOwnerGroupId)(u)};break}default:(0,c.exhaustivenessCheck)(l)}return e.locks.getConversations[p]=!0,[(s=(0,n._)((function*({api:e}){try{if(!h)throw new Error("Нет параметров запроса");const s=o.CONVOS_PER_PAGE,n=yield e.fetch("messages.getConversations",(0,r._)({},h,{count:s}),{retries:3});return(0,r._)({},t,{type:"MoreConvosNeeded_RequestCompleted",hasFailed:!1,requestedCount:s,hasMore:n.items.length>=s,response:n})}catch(e){return(0,r._)({},t,{type:"MoreConvosNeeded_RequestCompleted",hasMore:!1,hasFailed:!0})}})),function(e){return s.apply(this,arguments)})]}case"MoreConvosNeeded_RequestCompleted":{const{hasFailed:s,organiser:n,hasMore:r}=t;let o="";switch(n.kind){case"filters":o=i.getLockId(n.filter);break;case"folders":o=d.getLockId(n.id,n.filter);break;default:(0,c.exhaustivenessCheck)(n)}if(e.locks.getConversations[o]=!1,s)return[];const{response:l}=t;if(l){const t=(0,a.insertConvos)(e,l.items,{dangerouslyMerge:!0});switch((0,a.insertPeers)(e,{apiUsers:l.profiles||[],apiGroups:l.groups||[],apiContacts:l.contacts||[]}),n.kind){case"filters":i.push(e.organisers.filters,n.filter,t,r);break;case"folders":if(!e.organisers.folders.find((e=>e.id===n.id)))return[];d.push(e.organisers.folders,n.id,n.filter,t,r);break;default:(0,c.exhaustivenessCheck)(n)}}return[]}default:(0,c.exhaustivenessCheck)(t)}var s}},628010:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(434788),a=s(839963),o=s(86144),i=s(168465),c=s(434425),d=s(89131);const l=(e,t)=>{switch(t.type){case"PollChannelPosts":{const{channelId:s,fromCmid:a,toCmid:o}=t,c=e.channels.get(s);if(!c||"Channel"!==c.kind)return[];const d=null!=o?o:i.lastCmid(c.history);if(!d)return[];const l=i.around(c.history,a);if(void 0===l)return[];const u=l.nodes.reduce(((e,t)=>{const s=i.nodeCmid(t);return void 0!==s&&s>=a&&s<=d&&e.push(s),e}),[]).slice(-200);return[(r=(0,n._)((function*({api:e}){try{const t=yield e.fetch("channels.getChannelMessagesCounters",{channel_id:s,cmids:u.join(",")});return{type:"PollChannelPosts_RequestSucceed",channelId:s,response:t}}catch(e){console.error(e)}return{type:"Noop"}})),function(e){return r.apply(this,arguments)})]}case"PollChannelPosts_RequestSucceed":{var s;const{channelId:n,response:r}=t,i=e.channels.get(n);return i&&"Channel"===i.kind?(null==(s=r.items)||s.forEach((e=>{const t=a.findPostByCmid(i,o.resolveCmid(e.message_id));t&&"Node"===t.kind&&u(t.item,e)})),[]):[]}default:(0,d.exhaustivenessCheck)(t)}var r},u=(e,t)=>{var s,n,a,o,i,d;t.comments&&(e.comments=(0,r._)({},e.comments,{canPost:!!(null!=(n=t.comments.can_post)?n:e.comments.canPost),canView:!!(null!=(a=t.comments.can_view)?a:e.comments.canView),count:null!=(o=t.comments.count)?o:e.comments.count}));(t.reactions?e.likes=(0,r._)({},e.likes,{count:t.reactions.count,reactionId:void 0!==t.reactions.user_reaction?c.resolveId(t.reactions.user_reaction):void 0}):(e.likes.count=0,e.likes.reactionId=void 0),t.reposts)&&(e.reposts={count:t.reposts.count,isReposted:!!(null!=(i=t.reposts.user_reposted)?i:e.reposts.isReposted)});e.views=null!=(d=null==(s=t.views)?void 0:s.count)?d:e.views}},565321:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(89131),a=s(777634),o=s(185327),i=s(168465),c=s(991792),d=s(858289);const l=(e,t,s)=>{if(!s.vkm_reactions)return[];switch(t.type){case"PollConvoReactions":{const{peerId:s,fromCmid:r,toCmid:a}=t,o=e.convos.get(s);if(!o)return[];const d=i.around(o.history,r);if(void 0===d)return[];const l=d.nodes.reduce(((e,t)=>{const s="Node"===t.kind?t.item.cmid:void 0;return void 0!==s&&s>=r&&s<=a&&e.push(s),e}),[]).slice(-100),h=e.ownerId;return[(u=(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.getMessagesReactions",{peer_id:s,cmids:l.join(","),extended:1,group_id:(0,c.getOwnerGroupId)(h)});return{type:"PollConvoReactions_RequestSucceed",peerId:s,cmids:l,apiResponse:t}}catch(e){}return{type:"Noop"}})),function(e){return u.apply(this,arguments)})]}case"PollConvoReactions_RequestSucceed":{const{peerId:s,apiResponse:r,cmids:i}=t;(0,c.insertPeers)(e,{apiUsers:r.profiles||[],apiGroups:r.groups||[],apiContacts:r.contacts||[]});const u=e.convos.get(s);if(!u)return[];const h=new Set(r.items.map((e=>a.resolveCmid(e.cmid))));let p=!1;i.filter((e=>!h.has(e))).forEach((e=>{var t;const s=o.findMessageByCmid(u,a.resolveCmid(e));"Normal"===(null==(t=s)?void 0:t.kind)&&0!==s.reactions.size&&a.setReactions(s,[])}));for(const{cmid:t,counters:s}of r.items){var l;const n=o.findMessageByCmid(u,a.resolveCmid(t));if("Normal"!==(null==(l=n)?void 0:l.kind))continue;const r=(0,d.fromApiMessageReactions)(s);a.setReactions(n,Array.from(r.values())),p||(p=Array.from(r.keys()).some((t=>!e.messageReactions.has(t))))}return p?[(0,n._)((function*(){return{type:"InvalidateMessageReactions",force:!0}}))]:[]}default:(0,r.exhaustivenessCheck)(t)}var u}},192241:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(434788),a=s(96190),o=s(882670);const i=(e,t)=>{const{next:s}=t;if("Reconnecting"===s.kind)return[(i=(0,n._)((function*({queue:e}){return{type:"QueueBatchReceived",next:yield e.poll()}})),function(e){return i.apply(this,arguments)})];var i;if("Disconnected"===s.kind){if("manual"===s.reason)return[];const t=e.viewer.id;return[function(){var e=(0,n._)((function*({queue:e,api:s}){const n=yield s.fetch("queue.subscribe",{queue_ids:`onlfriends_${t},accountcounters_${t}`},{retries:1/0});return e.connect((0,r._)({user_id:a.toRealId(t)},n)),{type:"QueueBatchReceived",next:yield e.poll()}}));return function(t){return e.apply(this,arguments)}}()]}for(const t of s.events)switch(t.entity_type){case"online":const s=a.resolveId(t.data.user_id);if(!a.isUserPeerId(s))break;e.lastSeens.set(s,{isOnline:!!t.data.online,at:1e3*t.data.last_seen,platform:(0,o.convertPlatform)(t.data.platform,t.data.app_id)});break;case"accountcounters":if("calls"===t.data.type)e.activeCallsCount=t.data.count;else{t.data.type}break;default:}return[function(){var e=(0,n._)((function*({queue:e}){return{type:"QueueBatchReceived",next:yield e.poll()}}));return function(t){return e.apply(this,arguments)}}()]}},939903:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(89131),a=s(498928),o=s(991792);const i=(e,t)=>{switch(t.type){case"ResetUpdatesCounter":{const t=e.ownerId;return[(0,n._)((function*({api:e}){try{return{type:"ResetUpdatesCounter_RequestCompleted",hasFailed:!(yield e.fetch("messages.resetUpdatesCounter",{group_id:(0,o.getOwnerGroupId)(t)}))}}catch(e){return{type:"ResetUpdatesCounter_RequestCompleted",hasFailed:!0}}}))]}case"ResetUpdatesCounter_RequestCompleted":{const{hasFailed:r}=t;return r?[]:(a.updateCounters(e.organisers.filters,{headerNotMutedUnread:0}),[(s=(0,n._)((function*({notification:e}){return e.setCounters({unreadIdle:0}),{type:"Noop"}})),function(e){return s.apply(this,arguments)})])}default:(0,r.exhaustivenessCheck)(t)}var s}},619444:(e,t,s)=>{s.d(t,{handler:()=>a});var n=s(11010),r=s(89131);const a=(e,t)=>{const{type:s}=t;switch(s){case"SettingExperimentalUpdated":return e.viewer.settings.messageSelfMentionHighlighting=t.messageMentionHighlighting,[(a=(0,n._)((function*(e){try{e.storage.set("settings-message-self-mention-highlighting",t.messageMentionHighlighting)}finally{return{type:"SettingExperimentalUpdated_RequestCompleted"}}})),function(e){return a.apply(this,arguments)})];case"SettingExperimentalUpdated_RequestCompleted":return[];default:(0,r.exhaustivenessCheck)(s)}var a}},526025:(e,t,s)=>{s.d(t,{handler:()=>a});var n=s(11010),r=s(89131);const a=(e,t)=>{const{type:s}=t;switch(s){case"SettingThemeUpdated":{e.locks.settings.add("theme");const s=e.viewer.settings.theme;return e.viewer.settings.theme=t.value,[(a=(0,n._)((function*(e){try{return e.storage.set("theme",t.value),{type:"SettingThemeUpdated_RequestCompleted",hasFailed:!1,previousValue:s}}catch(e){return{type:"SettingThemeUpdated_RequestCompleted",hasFailed:!0,previousValue:s}}})),function(e){return a.apply(this,arguments)})]}case"SettingThemeUpdated_RequestCompleted":return e.locks.settings.delete("theme"),t.hasFailed&&(e.viewer.settings.theme=t.previousValue),[];default:(0,r.exhaustivenessCheck)(s)}var a}},695247:(e,t,s)=>{s.d(t,{handler:()=>a});var n=s(11010),r=s(89131);const a=(e,t)=>{const{type:s}=t;switch(s){case"UserChangedBrowserNotifications":{e.locks.settings.add("browserNotifications");const s=e.viewer.settings.browserNotifications;return e.viewer.settings.browserNotifications=t.value,[(a=(0,n._)((function*(e){try{return e.storage.set("settings-browser-notifications-on",t.value),{type:"UserChangedBrowserNotifications_RequestCompleted",hasFailed:!1,previousValue:s}}catch(e){return{type:"UserChangedBrowserNotifications_RequestCompleted",hasFailed:!0,previousValue:s}}})),function(e){return a.apply(this,arguments)})]}case"UserChangedBrowserNotifications_RequestCompleted":return e.locks.settings.delete("browserNotifications"),t.hasFailed&&(e.viewer.settings.browserNotifications=t.previousValue),[];default:(0,r.exhaustivenessCheck)(s)}var a}},584781:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(89131),a=s(839963),o=s(83062),i=s(197934);const c={archive:"archive",unarchive:"unarchive",join:"join",leave:"join",mute:"mute",unmute:"unmute",mark_read:"mark_read"},d={archive:"unarchive",unarchive:"archive",join:"leave",leave:"join",mute:"unmute",unmute:"mute"},l=(e,t,s)=>{const{type:c}=t;switch(c){case"UserChangedChannel":{const{channelId:s,userAction:i}=t,c=u(t.userAction,s);if(e.locks.channelActions.has(c))return[];e.locks.channelActions.add(c);const d=e.channels.get(s);if(!d)return[];if("ChannelRestricted"===d.kind)return[];let l;switch(i){case"archive":a.setArchived(d,!0),o.refreshChannels(e.organisers,d),l=e=>e.fetch("channels.archive",{channel_ids:String(s)}).then((e=>Boolean(e)));break;case"unarchive":a.setArchived(d,!1),o.refreshChannels(e.organisers,d),l=e=>e.fetch("channels.unarchive",{channel_ids:String(s),extended:1}).then((e=>Boolean(e)));break;case"join":a.setMembership(d,!0),o.refreshChannels(e.organisers,d),l=e=>e.fetch("channels.join",{channel_id:s,extended:1}).then((e=>Boolean(e)));break;case"leave":a.setMembership(d,!1),o.refreshChannels(e.organisers,d),l=e=>e.fetch("channels.leave",{channel_id:s});break;case"mute":a.setMuted(d,!0),l=e=>e.fetch("channels.setNotificationMode",{channel_id:s,mode:"disabled"}).then((e=>Boolean(e)));break;case"unmute":a.setMuted(d,!1),l=e=>e.fetch("channels.setNotificationMode",{channel_id:s,mode:"enabled"}).then((e=>Boolean(e)));break;case"mark_read":{const e=a.lastPost({channel:d,withPending:!1});if(e){const t=e.cmid;d.inReadCmid=t,l=e=>e.fetch("channels.markAsRead",{last_read_cmid:t,channel_id:s})}break}default:(0,r.exhaustivenessCheck)(i)}return[(m=(0,n._)((function*({api:e}){try{let t=!1;return l&&(t=!(yield l(e))),{type:"UserChangedChannel_RequestCompleted",channelId:s,hasFailed:t,userAction:i}}catch(e){return{type:"UserChangedChannel_RequestCompleted",channelId:s,hasFailed:!0,userAction:i}}})),function(e){return m.apply(this,arguments)})]}case"UserChangedChannel_RequestCompleted":{const{channelId:n,userAction:r,hasFailed:a}=t,o=u(r,n);e.locks.channelActions.delete(o);const i=d[r];return a&&i&&(l(e,{type:"UserChangedChannel",userAction:i,channelId:n},s),e.locks.channelActions.delete(o)),[]}case"UserSetChannelPhoto":{var h,p;const{channelId:s,photo:n}=t,r=e.channels.get(s);return r&&"Channel"===r.kind?(a.setPhotos(r,{photo50:null==(h=i.preview(n,50,50,!0))?void 0:h.url,photo100:null==(p=i.preview(n,100,100,!0))?void 0:p.url}),[]):[]}case"UserUpdateChannelInfo":{const{channelId:s,name:n,description:r}=t,a=e.channels.get(s);return a&&"Channel"===a.kind?(n&&(a.name=n),void 0!==r&&(a.description=r),[]):[]}default:(0,r.exhaustivenessCheck)(c)}var m},u=(e,t)=>`${c[e]}-${t.toString()}`},637467:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(434788),a=s(559360),o=s(86144),i=s(89131),c=s(453934),d=s(29064);const l=(e,t)=>{const{channelId:s}=t;var l;const u=null!=(l=e.channelComposerDrafts[s])?l:a.empty();let h=a.empty();switch(t.type){case"UserChangedChannelComposerDraft":switch(t.kind){case"text":{const{text:e,visibility:s,donutDelay:n,topic:a,date:o,sendOptions:i,resetSendOptions:c}=t;h=(0,r._)({},u,{text:null!=e?e:u.text,visibility:s||u.visibility,donutDelay:n||u.donutDelay,topic:a||u.topic,date:o,sendOptions:i||u.sendOptions,resetSendOptions:c||u.resetSendOptions});break}case"addAttaches":case"removeAttach":case"removeVoice":case"startUploading":case"removeUploads":case"rearrangeAttaches":const e=(0,d.applyAttachmentActions)(u,t);h=(0,r._)({},u,e);break;case"editing":{var p;const{editing:e}=t,s=[],n=["mute_notifications"];e.comments.canPost&&e.comments.canView||s.push("close_comments"),e.signerId&&s.push("signed"),e.markedAsAds&&s.push("mark_as_ads"),h={editing:e,text:o.toRawText(e),attaches:e.attaches,uploadsTrackIds:u.uploadsTrackIds,visibility:o.isDonut(e)?"donut":"all",donutDelay:(null==(p=e.donut)?void 0:p.duration)||-1,topic:a.getPostThemeKeyFromId(e.topicId),sendOptions:{selected:s,disabled:n},resetSendOptions:[]};break}default:(0,i.exhaustivenessCheck)(t)}break;case"UserClearedChannelComposerDraft":break;default:(0,i.exhaustivenessCheck)(t)}!h.text&&0===Object.keys(h.attaches).length&&0===h.uploadsTrackIds.size&&"all"===h.visibility&&"no_theme"===h.topic&&void 0===h.date&&-1===h.donutDelay&&0===h.sendOptions.selected.length&&0===h.sendOptions.disabled.length&&0===h.resetSendOptions.length?delete e.channelComposerDrafts[s]:e.channelComposerDrafts[s]=h;const m=(0,c.current)(e.channelComposerDrafts);return[(0,n._)((function*({storage:e}){return e.set("channels-drafts",m),{type:"Noop"}}))]}},12190:(e,t,s)=>{s.d(t,{handler:()=>d});var n=s(11010),r=s(89131),a=s(839963),o=s(168465);const i={delete:"delete",restore:"restore"},c={restore:"delete",delete:"restore"},d=(e,t,s)=>{const{type:i}=t;switch(i){case"UserChangedChannelPost":{const{channelId:s,cmid:i,userAction:c}=t,d=l(t.userAction,s,i);if(e.locks.channelPostActions.has(d))return[];e.locks.channelPostActions.add(d);const h=e.channels.get(s);if(!h)return[];if("ChannelRestricted"===h.kind)return[];const p=o.findNodeByCmid(h.history,i);if("NotLoaded"===p.status)return[];let m;switch(c){case"delete":if("Deleted"===p.status)break;a.deletePost(h,i,!0),m=e=>e.fetch("wall.delete",{owner_id:s,post_id:i}).then((e=>Boolean(e)));break;case"restore":if("Deleted"!==p.status)break;a.restorePost(h,i),m=e=>e.fetch("wall.restore",{owner_id:s,post_id:i}).then((e=>Boolean(e)));break;default:(0,r.exhaustivenessCheck)(c)}return[(u=(0,n._)((function*({api:e}){try{let t=!1;return m&&(t=!(yield m(e))),{type:"UserChangedChannelPost_RequestCompleted",channelId:s,cmid:i,hasFailed:t,userAction:c}}catch(e){return{type:"UserChangedChannelPost_RequestCompleted",channelId:s,cmid:i,hasFailed:!0,userAction:c}}})),function(e){return u.apply(this,arguments)})]}case"UserChangedChannelPost_RequestCompleted":{const{channelId:n,cmid:r,userAction:a,hasFailed:o}=t,i=l(a,n,r);e.locks.channelPostActions.delete(i);const u=c[a];return o&&u&&(d(e,{type:"UserChangedChannelPost",userAction:u,channelId:n,cmid:r},s),e.locks.channelPostActions.delete(i)),[]}default:(0,r.exhaustivenessCheck)(i)}var u},l=(e,t,s)=>`${i[e]}-${t.toString()}-${s}`},623022:(e,t,s)=>{s.d(t,{handler:()=>d});var n=s(11010),r=s(89131),a=s(96190),o=s(185327),i=s(197934),c=s(991792);const d=(e,t)=>{const{type:s}=t;switch(s){case"UserChangedChatTitle":{const{peerId:s,title:r}=t,o=a.toRealId(s),i=e.peers.get(s),d=e.ownerId;if(!i||"Chat"!==i.kind)return[];const l=i.title;return a.updateChatInfo(i,{title:r}),[(h=(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.editChat",{chat_id:o,title:r,group_id:(0,c.getOwnerGroupId)(d)},{retries:1});return{type:"UserChangedChatTitle_RequestCompleted",hasFailed:1!==t,peerId:s,title:1!==t?l:r}}catch(e){return{type:"UserChangedChatTitle_RequestCompleted",hasFailed:!0,peerId:s,title:l}}})),function(e){return h.apply(this,arguments)})]}case"UserChangedChatTitle_RequestCompleted":{const{peerId:s,title:n,hasFailed:r}=t,o=e.peers.get(s);return o&&"Chat"===o.kind&&r?(a.updateChatInfo(o,{title:n}),[]):[]}case"UserChangedChatDescription":{const{peerId:s,description:r}=t,i=a.toRealId(s),d=e.convos.get(s),l=e.ownerId;if(!d||"ChatConvo"!==d.kind&&"GroupConvo"!==d.kind)return[];const u=d.description;return o.setDescription(d,r),[function(){var e=(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.editChat",{chat_id:i,description:r,group_id:(0,c.getOwnerGroupId)(l)},{retries:1});return{type:"UserChangedChatDescription_RequestCompleted",hasFailed:1!==t,peerId:s,description:1!==t?u:r}}catch(e){return{type:"UserChangedChatDescription_RequestCompleted",hasFailed:!0,peerId:s,description:u}}}));return function(t){return e.apply(this,arguments)}}()]}case"UserChangedChatDescription_RequestCompleted":{const{peerId:s,description:n,hasFailed:r}=t,a=e.convos.get(s);return!a||"ChatConvo"!==a.kind&&"GroupConvo"!==a.kind?[]:r?(o.setDescription(a,n),[]):[]}case"UserSetChatPhoto":{var d,l,u;const{peerId:s,photo:n}=t,r=e.peers.get(s);return r&&"Chat"===r.kind?(a.updateChatInfo(r,{photo50:null==(d=i.preview(n,50,50))?void 0:d.url,photo100:null==(l=i.preview(n,100,100))?void 0:l.url,photo200:null==(u=i.preview(n,200,200))?void 0:u.url}),[]):[]}case"UserRemovedChatPhoto":{const{peerId:s}=t,r=e.ownerId,o=a.toRealId(s),i=e.peers.get(s);return i&&"Chat"===i.kind?(a.updateChatInfo(i,{photo50:void 0,photo100:void 0,photo200:void 0}),[function(){var e=(0,n._)((function*({api:e}){try{return yield e.fetch("messages.deleteChatPhoto",{chat_id:o,group_id:(0,c.getOwnerGroupId)(r)},{retries:1}),{type:"UserRemovedChatPhoto_RequestCompleted",hasFailed:!1,peerId:s}}catch(e){return{type:"UserRemovedChatPhoto_RequestCompleted",hasFailed:!0,peerId:s}}}));return function(t){return e.apply(this,arguments)}}()]):[]}case"UserRemovedChatPhoto_RequestCompleted":return[];case"UserChangedChatSettings":{const{peerId:s,isService:r,permissions:o}=t,i=a.toRealId(s),d=e.ownerId;return[function(){var e=(0,n._)((function*({api:e}){try{return{type:"UserChangedChatSettings_RequestCompleted",hasFailed:1!==(yield e.fetch("messages.editChat",{chat_id:i,is_service:r?1:0,permissions:JSON.stringify(o),group_id:(0,c.getOwnerGroupId)(d)},{retries:1})),permissions:o,peerId:s,isService:r}}catch(e){return{type:"UserChangedChatSettings_RequestCompleted",hasFailed:!0,permissions:o,peerId:s,isService:r}}}));return function(t){return e.apply(this,arguments)}}()]}case"UserChangedChatSettings_RequestCompleted":{const{peerId:s,isService:n,permissions:r,hasFailed:a}=t;if(a)return[];const i=e.convos.get(s);return i&&"ChatConvo"===i.kind?(o.setChatPermissions(i,r,n),[]):[]}default:(0,r.exhaustivenessCheck)(s)}var h}},541222:(e,t,s)=>{s.d(t,{handler:()=>c});var n=s(11010),r=s(89131),a=s(96190),o=s(185327),i=s(991792);const c=(e,t)=>{switch(t.type){case"UserChangedChatMember":{const{peerId:s,memberId:o,userAction:d}=t;if(!e.convos.get(s))return[];const l=function(e,t){const{userAction:s,peerId:n,memberId:o}=t;switch(s){case"promote":return({api:e})=>e.fetch("messages.setMemberRole",{member_id:o,peer_id:n,role:"admin"});case"demote":return({api:e})=>e.fetch("messages.setMemberRole",{member_id:o,peer_id:n,role:"member"});case"cancel_invitation":case"remove":return({api:t})=>t.fetch("messages.removeChatUser",{chat_id:a.toRealId(n),member_id:o,group_id:(0,i.getOwnerGroupId)(e)});default:return(0,r.exhaustivenessCheck)(s)}}(e.ownerId,t);return[(c=(0,n._)((function*(e){try{return{type:"UserChangedChatMember_RequestCompleted",hasFailed:1!==(yield l(e)),peerId:s,memberId:o,userAction:d}}catch(e){return{type:"UserChangedChatMember_RequestCompleted",hasFailed:!0,peerId:s,memberId:o,userAction:d}}})),function(e){return c.apply(this,arguments)})]}case"UserChangedChatMember_RequestCompleted":{var s;const{peerId:n,memberId:r,userAction:i,hasFailed:c}=t,d=e.convos.get(n);return c||"ChatConvo"!==(null==(s=d)?void 0:s.kind)?[]:("cancel_invitation"===i&&o.removeMember(d,r),a.isContactPeerId(r)||("promote"===i&&o.addAdmin(d,r),"demote"===i&&o.removeAdmin(d,r),"remove"===i&&o.removeMember(d,r)),[])}default:return(0,r.exhaustivenessCheck)(t)}var c}},601289:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(434788),a=s(89131),o=s(86144),i=s(866358),c=s(168465);const d={delete:"delete",restore:"delete"},l=(e,t,s)=>{var d,h;const{type:p,channelId:m,postCmid:f,commentCmid:g,replyCmid:v,userAction:_}=t,C=u(_,m,f,v||g);let y;const k=e.channels.get(m);if("ChannelRestricted"===(null==(d=k)?void 0:d.kind))return[];const I=k&&c.findNodeByCmid(k.history,f).node,w="Node"===(null==(h=I)?void 0:h.kind)&&I.item,M=w&&o.findCommentByCmid(w,g);if(!M)return[];if(v){const e=i.findReplyByCmid(M,v);if(!e||"Deleted"===e.kind)return[];y=e}else y=M;switch(p){case"UserDeleteComment":{if(e.locks.commentActions.has(C)||"Normal"!==y.kind)return[];e.locks.commentActions.add(C);const s=i.markDeleted(y);return v?i.replaceReply(M,s):o.replaceComment(w,s),[(b=(0,n._)((function*({api:e}){try{const n=yield e.fetch("wall.deleteComment",{owner_id:m,comment_id:s.cmid});return(0,r._)({},t,{type:"UserDeleteComment_RequestCompleted",hasFailed:!Boolean(n),deletedComment:s})}catch(e){return(0,r._)({},t,{type:"UserDeleteComment_RequestCompleted",hasFailed:!0,deletedComment:s})}})),function(e){return b.apply(this,arguments)})]}case"UserRestoreComment":{if(e.locks.commentActions.has(C)||"MarkedDeleted"!==y.kind)return[];e.locks.commentActions.add(C);const s=i.restoreDeleted(y);return v?i.replaceReply(M,s):o.replaceComment(w,s),[(R=(0,n._)((function*({api:e}){try{const n=yield e.fetch("wall.restoreComment",{owner_id:m,comment_id:s.cmid});return(0,r._)({},t,{type:"UserRestoreComment_RequestCompleted",hasFailed:!Boolean(n)})}catch(e){return(0,r._)({},t,{type:"UserRestoreComment_RequestCompleted",hasFailed:!0})}})),function(e){return R.apply(this,arguments)})]}case"UserDeleteComment_RequestCompleted":case"UserRestoreComment_RequestCompleted":{const{hasFailed:n}=t;return e.locks.commentActions.delete(C),n&&l(e,(0,r._)({},t,"delete"===_?{type:"UserRestoreComment",userAction:"restore"}:{type:"UserDeleteComment",userAction:"delete"}),s),e.locks.commentActions.delete(C),[]}default:(0,a.exhaustivenessCheck)(t)}var R,b},u=(e,t,s,n)=>`${d[e]}-${t}-${s}-${n}`},29064:(e,t,s)=>{s.d(t,{applyAttachmentActions:()=>f,handler:()=>m});var n=s(11010),r=s(434788),a=s(400681),o=s(777634),i=s(197934),c=s(89131),d=s(453934),l=s(991792),u=s(481186),h=s(54965),p=s(851828);const m=(e,t)=>{const{peerId:s}=t;var i;const m=void 0!==s&&null!=(i=e.composerDrafts[s])?i:[];var C;const y=null!=(C=m[m.length-1])?C:(0,d.castDraft)(a.empty());let k=(0,d.castDraft)(m.slice(0,-1));switch(t.type){case"UserChangedComposerDraft":switch(t.kind){case"text":{const{text:e}=t;k.push((0,r._)({},y,{text:null!=e?e:y.text}));break}case"addAttaches":case"removeAttach":case"removeVoice":case"startUploading":case"removeUploads":case"rearrangeAttaches":const e=f(y,t);k.push((0,r._)({},y,e));break;case"editing":{const{editing:e}=t;k.push(y,{editing:e,text:o.toRawText(e),attaches:e.attaches,uploadsTrackIds:y.uploadsTrackIds,forward:e.forwardedMessages&&{kind:"message",items:e.forwardedMessages},reply:e.replyMessage});break}case"forward":{const{forward:e,isForwardAuthorHidden:s}=t;k.push((0,r._)({},e&&y.editing?a.empty():y,{reply:void 0,forward:e,isForwardAuthorHidden:null!=s?s:a.DEFAULT_FORWARD_AUTHOR_HIDDEN}));break}case"reply":{const{reply:e}=t;k.push((0,r._)({},e&&y.editing?a.empty():y,{forward:void 0,reply:e}));break}default:(0,c.exhaustivenessCheck)(t)}break;case"UserClearedComposerDraft":break;case"ComposerDraftsUpdateNeeded":{const{itemsToDelete:s,itemsToReplace:n,foreignKind:r}=t;k.push(y),k=k.reduce(((e,t)=>{const{editing:a,reply:o}=t;if("message"===r){if(void 0!==a&&g(s,a))return e;if(void 0===a&&void 0!==o)if(g(s,o))t.reply=void 0;else{const e=g(n,o);void 0!==e&&(t.reply=e)}}return e.push(t),e}),[]);const a=Object.values(e.composerDrafts).reduce(((e,t)=>(t.forEach((t=>e.push(t))),e)),[y]);a.forEach((e=>{const{forward:t,editing:a}=e;if(void 0===a&&void 0!==t){if("message"===r&&"message"===t.kind){const r=(0,c.toNonEmpty)([...t.items].reduce(((e,t)=>{const r=g(n,t);return void 0!==r?(e.push(r),e):(g(s,t)||e.push(t),e)}),[]));e.forward=null!==r?{kind:"message",items:r}:void 0}if("post"===r&&"post"===t.kind){const r=(0,c.toNonEmpty)([...t.items].reduce(((e,t)=>{const r=v(n,t);return void 0!==r?(e.push(r),e):(v(s,t)||e.push(t),e)}),[]));e.forward=null!==r?{kind:"post",items:r}:void 0}if("comment"===t.kind&&"comment"===r){const r=(0,c.toNonEmpty)([...t.items].reduce(((e,t)=>{const r=_(n,t);return void 0!==r?(e.push(r),e):(_(s,t)||e.push(t),e)}),[]));e.forward=null!==r?{kind:"comment",items:r}:void 0}}}));break}case"ActualizeComposerDraft":{const t=e.ownerId;return k.push(y),k.map((e=>{const r=(0,d.isDraft)(e)?(0,d.current)(e):e;return(0,n._)((function*({api:e}){var n,a,o;const{reply:i,forward:d,editing:u}=r,h=[...u?[u]:[],...i?[i]:[],..."message"===(null==(n=d)?void 0:n.kind)?d.items:[]].reduce(((e,t)=>("Foreign"!==t.kind&&"ForeignExpired"!==t.kind&&e.push(t),e)),[]);if(h.length>0&&h[0]){const s=h[0].peerId,n=h.reduce(((e,t)=>{if(t.peerId!==s){if(c.isDev)throw new Error("Перессылаемые сообщения не из одного чата");return e}return e.push(t.cmid),e}),[]);try{const r=yield e.fetch("messages.getByConversationMessageId",{peer_id:s,conversation_message_ids:n.join(","),extended:1,group_id:(0,l.getOwnerGroupId)(t)});return{type:"ActualizeComposerDraft_RequestCompleted",peerId:s,foreignKind:"message",foreignItems:h,response:r}}catch(e){}}if("post"===(null==(a=d)?void 0:a.kind)){const{channelId:t}=d.items[0],n=d.items.reduce(((e,s)=>{if(s.channelId!==t){if(c.isDev)throw new Error("Перессылаемые посты не из одного канала");return e}return e.push(s.cmid),e}),[]);try{const r=yield e.fetch("channels.getMessagesById",{channel_id:t,cmids:n.join(","),extended:1});return{type:"ActualizeComposerDraft_RequestCompleted",peerId:s,foreignKind:"post",foreignItems:d.items,response:r}}catch(e){}}if("comment"===(null==(o=d)?void 0:o.kind)){const{channelId:t,postCmid:n}=d.items[0],r=[...d.items].reduce(((e,s)=>{if(s.channelId!==t||s.postCmid!==n){if(c.isDev)throw new Error("Пересылаемые комменты не из одного поста или даже не из одного канала");return e}return e.push(s.cmid),e}),[]);try{const a=yield e.fetchMany(r.map((e=>({method:"wall.getComments",params:{owner_id:t,post_id:n,start_comment_id:e,count:1,offset:0,extended:1}}))));return{type:"ActualizeComposerDraft_RequestCompleted",peerId:s,foreignKind:"comment",foreignItems:d.items,response:a}}catch(e){}}return{type:"Noop"}}))}))}case"ActualizeComposerDraft_RequestCompleted":{const{response:r,foreignKind:a,foreignItems:o}=t;switch(a){case"message":{const{profiles:t,groups:a,contacts:i,items:c}=r;(0,l.insertPeers)(e,{apiUsers:t||[],apiGroups:a||[],apiContacts:i||[]});const d=c.reduce(((e,t)=>{if(t.deleted)return e;const s=(0,u.fromApiMessage)(t).message;return"Normal"===s.kind&&e.push(s),e}),[]),h=o.filter((e=>!g(d,e)));return h.length>0||d.length>0?[(0,n._)((function*(){return{type:"ComposerDraftsUpdateNeeded",foreignKind:"message",itemsToDelete:h,itemsToReplace:d,peerId:s}}))]:[]}case"post":{var I;const{profiles:t,groups:a,items:i}=r;var w;(0,l.insertPeers)(e,{apiUsers:t||[],apiGroups:a||[],apiContacts:[]});const c=null!=(w=null==(I=i)?void 0:I.map((e=>(0,h.fromApiPost)(e).post)))?w:[],d=o.filter((e=>!v(c,e)));return d.length>0||c.length>0?[(0,n._)((function*(){return{type:"ComposerDraftsUpdateNeeded",foreignKind:"post",itemsToDelete:d,itemsToReplace:c,peerId:s}}))]:[]}case"comment":{const t=r.reduce(((t,s)=>{const{profiles:n,groups:r,items:a}=s;return(0,l.insertPeers)(e,{apiUsers:n||[],apiGroups:r||[],apiContacts:[]}),a.forEach((e=>{const s=(0,p.fromApiComment)(e);"Normal"===s.kind&&t.push(s)})),t}),[]),a=o.filter((e=>!_(t,e)));return a.length>0||t.length>0?[(0,n._)((function*(){return{type:"ComposerDraftsUpdateNeeded",foreignKind:"comment",itemsToDelete:a,itemsToReplace:t,peerId:s}}))]:[]}default:return(0,c.exhaustivenessCheck)(a)}}default:(0,c.exhaustivenessCheck)(t)}void 0!==s&&(k=k.filter((e=>!(e=>!(e.text||e.forward||e.reply||e.editing||0!==Object.keys(e.attaches).length||0!==e.uploadsTrackIds.size))(e))),0===k.length?delete e.composerDrafts[s]:e.composerDrafts[s]=k);const M=(0,d.current)(e.composerDrafts);return[(0,n._)((function*({storage:e}){return e.set("drafts",M),{type:"Noop"}}))]};function f(e,t){switch(t.kind){case"addAttaches":{var s;const{attaches:n,trackIds:r}=t;let a=e.attaches;n&&(a=(0,d.produce)(a,(e=>{i.addAttach(e,n)})));let o=e.uploadsTrackIds;return(null==(s=r)?void 0:s.length)&&(o=(0,d.produce)(o,(e=>{r.forEach((t=>{e.delete(t)}))}))),{attaches:a,uploadsTrackIds:o}}case"removeAttach":{const{attach:s}=t;let n=e.attaches;return s&&(n=(0,d.produce)(n,(e=>{i.removeAttach(e,s)}))),{attaches:n}}case"removeVoice":return{attaches:(0,d.produce)(e.attaches,(e=>{e.voice&&delete e.voice}))};case"startUploading":{const{trackIds:s}=t;return{uploadsTrackIds:new Set([...e.uploadsTrackIds,...s])}}case"removeUploads":{const{trackIds:s}=t;return{uploadsTrackIds:(0,d.produce)(e.uploadsTrackIds,(e=>{s.forEach((t=>{e.delete(t)}))}))}}case"rearrangeAttaches":{const{key:s,currentPosition:n,newPosition:r}=t;let a=e.attaches;return-1!==r&&r!==n&&(a=(0,d.produce)(a,(e=>{i.rearrangeAttaches(e,{currentPosition:n,newPosition:r},s)}))),{attaches:a}}default:(0,c.exhaustivenessCheck)(t)}}function g(e=[],t){return e.find((e=>t.peerId===e.peerId&&t.cmid===e.cmid))}function v(e=[],t){return e.find((e=>t.channelId===e.channelId&&t.cmid===e.cmid))}function _(e=[],t){return e.find((e=>t.channelId===e.channelId&&t.postCmid===e.postCmid&&t.cmid===e.cmid))}},598801:(e,t,s)=>{s.d(t,{handler:()=>p});var n=s(11010),r=s(185327),a=s(96190),o=s(83062),i=s(777634),c=s(89131),d=s(453934),l=s(991792);const u={mute:"mute",unmute:"mute",mute_until:"mute_until",pin:"pin",unpin:"pin",mark_read:"mark_read",mark_unread:"mark_read",archive:"archive",unarchive:"archive",clear:"clear",leave:"leave",leave_and_clear:"leave_and_clear",show_pinned_message:"show_pinned_message",hide_pinned_message:"show_pinned_message",show_bot_keyboard:"show_bot_keyboard",hide_bot_keyboard:"hide_bot_keyboard",pin_message_for_all:"pin_message_for_all",unpin_message_for_all:"pin_message_for_all",ban:"ban",unban:"unban",return_to_chat:"return_to_chat",business_notify_enable:"business_notify_enable",business_notify_disable:"business_notify_enable",forbid_writing_all:"forbid_writing_all",allow_writing_all:"allow_writing_all",forbid_writing_all_until:"forbid_writing_all_until"},h={pin:"unpin",unpin:"pin",mark_read:"mark_unread",mark_unread:"mark_read",archive:"unarchive",unarchive:"archive",show_pinned_message:"hide_pinned_message",hide_pinned_message:"show_pinned_message",show_bot_keyboard:"hide_bot_keyboard",hide_bot_keyboard:"show_bot_keyboard"},p=(e,t,s)=>{const{type:u}=t;switch(u){case"UserChangedConvo":{const{peerId:s,userAction:i}=t,{organisers:d}=e,u=e.viewer.id,h=m(t.userAction,s);if(e.locks.convoActions.has(h))return[];e.locks.convoActions.add(h);const p=e.convos.get(s),f=e.peers.get(s),g=e.ownerId;if(!p||!f)return[];let v;switch(i){case"pin":v=e=>e.fetch("messages.pinConversation",{peer_id:s});break;case"unpin":v=e=>e.fetch("messages.unpinConversation",{peer_id:s});break;case"mark_read":p.isMarkedUnread=!1,v=e=>e.fetch("messages.markAsRead",{peer_id:s,mark_conversation_as_read:1,group_id:(0,l.getOwnerGroupId)(g)});break;case"mark_unread":p.isMarkedUnread=!0,v=e=>e.fetch("messages.markAsUnreadConversation",{peer_id:s,group_id:0});break;case"archive":case"unarchive":p.isArchived="archive"===i,o.refresh(d,p),v=e=>e.fetch("archive"===i?"messages.archiveConversation":"messages.unarchiveConversation",{peer_id:s});break;case"hide_pinned_message":"ChatConvo"===p.kind&&p.pinnedMessage&&e.hiddenPinnedMessages.set(t.peerId,p.pinnedMessage.cmid);break;case"show_pinned_message":e.hiddenPinnedMessages.delete(t.peerId);break;case"hide_bot_keyboard":e.hiddenBotKeyboards.add(t.peerId);break;case"show_bot_keyboard":e.hiddenBotKeyboards.delete(t.peerId);break;case"clear":v=e=>e.fetch("messages.deleteConversation",{peer_id:s,group_id:(0,l.getOwnerGroupId)(g)}).then((({last_deleted_id:e})=>Boolean(e)));break;case"leave":case"leave_and_clear":{if("ChatConvo"!==p.kind)break;v=e=>e.fetch("messages.removeChatUser",{chat_id:a.toRealId(s),user_id:a.toRealId(u),group_id:(0,l.getOwnerGroupId)(g)});const t=e.peers.get(s);if(!t||"Chat"!==t.kind)break;r.clearChatDataOnLeave(p),a.clearChatDataOnLeave(t);break}case"ban":if(!("User"===f.kind&&"UserConvo"===p.kind||"Group"===f.kind&&"GroupConvo"===p.kind))break;a.updateIsPeerBlacklistedByMe(f,!0),"UserConvo"===p.kind&&r.restrictWrite(p,"peer_blacklisted_by_me"),v=a.isGroupPeerId(g)?e=>e.fetch("groups.ban",{owner_id:s,group_id:(0,l.getOwnerGroupId)(g)}):a.isGroupPeerId(s)?e=>e.fetch("messages.denyMessagesFromGroup",{group_id:a.toRealId(s)}):e=>e.fetch("account.ban",{owner_id:s});break;case"unban":if(!("User"===f.kind&&"UserConvo"===p.kind||"Group"===f.kind&&"GroupConvo"===p.kind))break;a.updateIsPeerBlacklistedByMe(f,!1),"UserConvo"===p.kind&&r.allowWrite(p),v=a.isGroupPeerId(g)?e=>e.fetch("groups.unban",{owner_id:s,group_id:(0,l.getOwnerGroupId)(g)}):a.isGroupPeerId(s)?e=>e.fetch("messages.allowMessagesFromGroup",{group_id:a.toRealId(s)}):e=>e.fetch("account.unban",{owner_id:s});break;case"return_to_chat":v=e=>e.fetch("messages.addChatUser",{chat_id:a.toRealId(s),user_id:a.toRealId(u)}).then((({result:e})=>Boolean(e)));break;default:(0,c.exhaustivenessCheck)(i)}return[(I=(0,n._)((function*({api:e}){try{let t=!1;return v&&(t=!(yield v(e))),{type:"UserChangedConvo_RequestCompleted",hasFailed:t,userAction:i,peerId:s}}catch(e){return{type:"UserChangedConvo_RequestCompleted",hasFailed:!0,userAction:i,peerId:s}}})),function(e){return I.apply(this,arguments)})]}case"UserChangedConvo_RequestCompleted":{const{peerId:a,userAction:o,hasFailed:d}=t,l=m(o,a);e.locks.convoActions.delete(l);const u=h[o];if(d&&u)return p(e,{type:"UserChangedConvo",userAction:u,peerId:a},s),[];if(d)return[];switch(o){case"clear":case"pin":case"unpin":case"mark_read":case"mark_unread":case"unarchive":case"show_pinned_message":case"hide_pinned_message":case"show_bot_keyboard":case"hide_bot_keyboard":case"ban":case"unban":return[];case"archive":{const t=e.convos.get(a);if(!t||"ChatConvo"!==t.kind||!t.unreadMentions.size)return[];const s=i.resolveCmid(Math.max(...t.unreadMentions));return[(k=(0,n._)((function*({storage:e}){const t=e.get("archive-mentions-map");return t&&s?(t[a]=s,e.set("archive-mentions-map",t),{type:"Noop"}):{type:"Noop"}})),function(e){return k.apply(this,arguments)})]}case"leave":{var f;const t=e.convos.get(a);return"ChatConvo"===(null==(f=t)?void 0:f.kind)&&r.setConvoState(t,"left"),[]}case"leave_and_clear":{var g;const t=e.convos.get(a);return"ChatConvo"!==(null==(g=t)?void 0:g.kind)?[]:(r.setConvoState(t,"left"),p(e,{type:"UserChangedConvo",userAction:"clear",peerId:a},s))}case"return_to_chat":{var v;const t=e.convos.get(a);return"ChatConvo"===(null==(v=t)?void 0:v.kind)&&r.setConvoState(t,"in"),[]}default:return(0,c.exhaustivenessCheck)(t)}}case"UserChangedMute":{const{peerId:s,timer:r,userAction:a}=t,o=m(t.userAction,s);if(e.locks.convoActions.has(o))return[];const i=e.convos.get(s);if(!i)return[];let d;switch(a){case"mute":i.push={mode:"every-mention",disabledUntil:1/0},d=-1;break;case"unmute":i.push={mode:"everything",disabledUntil:0},d=0;break;case"mute_until":i.push={mode:"every-mention",disabledUntil:Date.now()+1e3*r},d=r;break;default:(0,c.exhaustivenessCheck)(a)}return[function(){var e=(0,n._)((function*({api:e}){try{return{type:"UserChangedMute_RequestCompleted",hasFailed:1!==(yield e.fetch("account.setSilenceMode",{time:d,peer_id:s,sound:"unmute"===a?1:0})),userAction:a,peerId:s}}catch(e){return{type:"UserChangedMute_RequestCompleted",hasFailed:!0,userAction:a,peerId:s}}}));return function(t){return e.apply(this,arguments)}}()]}case"UserChangedMute_RequestCompleted":{const{peerId:n,userAction:r,hasFailed:a}=t,o=m(r,n);e.locks.convoActions.delete(o);const i={mute:"unmute",unmute:"mute",mute_until:"unmute"}[r];return a&&i?(p(e,{type:"UserChangedMute",userAction:i,peerId:n,timer:0},s),[]):[]}case"UserPinMessage":{var _;const{peerId:s,cmid:a,userAction:o}=t,c=m(t.userAction,s);if(e.locks.convoActions.has(c))return[];e.locks.convoActions.add(c);const u=e.convos.get(s),h=e.ownerId;if(!u||"ChatConvo"!==u.kind)return[];const p=u.pinnedMessage&&(0,d.current)(u.pinnedMessage),f=r.findMessageByCmid(u,a);return"Normal"===(null==(_=f)?void 0:_.kind)&&r.pinMessage(u,i.toPinned(f)),[function(){var e=(0,n._)((function*({api:e}){try{return yield e.fetch("messages.pin",{peer_id:s,cmid:a,group_id:(0,l.getOwnerGroupId)(h)}),{type:"UserPinMessage_RequestCompleted",hasFailed:!1,userAction:o,peerId:s,cmid:a}}catch(e){return{type:"UserPinMessage_RequestCompleted",hasFailed:!0,userAction:o,pinnedMessage:p,peerId:s,cmid:a}}}));return function(t){return e.apply(this,arguments)}}()]}case"UserPinMessage_RequestCompleted":{const{peerId:s,hasFailed:n,pinnedMessage:a,userAction:o}=t,i=m(o,s);e.locks.convoActions.delete(i);const c=e.convos.get(s);return c&&"ChatConvo"===c.kind?(n&&(r.unpinMessage(c),a&&r.pinMessage(c,a)),[]):[]}case"UserUnpinMessage":{const{peerId:s,userAction:a}=t,o=m(t.userAction,s);if(e.locks.convoActions.has(o))return[];const i=e.convos.get(s),c=e.ownerId;if(!i||"ChatConvo"!==i.kind)return[];const u=(0,d.current)(r.unpinMessage(i));return[function(){var e=(0,n._)((function*({api:e}){try{return yield e.fetch("messages.unpin",{peer_id:s,group_id:(0,l.getOwnerGroupId)(c)}),{type:"UserUnpinMessage_RequestCompleted",hasFailed:!1,userAction:a,peerId:s}}catch(e){return{type:"UserUnpinMessage_RequestCompleted",hasFailed:!0,userAction:a,prevPinnedMessage:u,peerId:s}}}));return function(t){return e.apply(this,arguments)}}()]}case"UserUnpinMessage_RequestCompleted":{const{peerId:s,hasFailed:n,prevPinnedMessage:a,userAction:o}=t,i=m(o,s);e.locks.convoActions.delete(i);const c=e.convos.get(s);return c&&"ChatConvo"===c.kind?(n&&a&&r.pinMessage(c,a),[]):[]}case"UserChangedBusinessNotify":{var C;const{userAction:s,peerId:r}=t,o=m(t.userAction,r);if(e.locks.convoActions.has(o))return[];const i=e.peers.get(r);return"Group"!==(null==(C=i)?void 0:C.kind)||i.isBlacklistedByMe&&"business_notify_disable"===s||!i.isBlacklistedByMe&&"business_notify_enable"===s?[]:(a.updateIsPeerBlacklistedByMe(i,"business_notify_disable"===s),[function(){var e=(0,n._)((function*({api:e}){try{return{type:"UserChangedBusinessNotify_RequestCompleted",hasFailed:1!==(yield e.fetch("business_notify_disable"===s?"messages.denyMessagesFromGroup":"messages.allowMessagesFromGroup",{group_id:a.toRealId(r)})),userAction:s,peerId:r}}catch(e){return{type:"UserChangedBusinessNotify_RequestCompleted",hasFailed:!0,userAction:s,peerId:r}}}));return function(t){return e.apply(this,arguments)}}()])}case"UserChangedBusinessNotify_RequestCompleted":{var y;const{userAction:s,peerId:n,hasFailed:r}=t,o=m(s,n);e.locks.convoActions.delete(o);const i=e.peers.get(n);return"Group"!==(null==(y=i)?void 0:y.kind)||r&&a.updateIsPeerBlacklistedByMe(i,!i.isBlacklistedByMe),[]}case"UserChangeForbidWritingAll":{const{peerId:s,duration:r,userAction:a}=t,o=m(t.userAction,s);if(e.locks.convoActions.has(o))return[];const i=e.convos.get(s);if(!i||"ChatConvo"!==i.kind)return[];switch(a){case"forbid_writing_all":i.forbidedWritingForAllUntil=r;break;case"allow_writing_all":i.forbidedWritingForAllUntil=void 0;break;case"forbid_writing_all_until":i.forbidedWritingForAllUntil=Date.now()+1e3*r;break;default:(0,c.exhaustivenessCheck)(a)}return[function(){var e=(0,n._)((function*(){try{return{type:"UserChangeForbidWritingAll_RequestCompleted",hasFailed:1!==1,userAction:a,peerId:s}}catch(e){return{type:"UserChangeForbidWritingAll_RequestCompleted",hasFailed:!0,userAction:a,peerId:s}}}));return function(){return e.apply(this,arguments)}}()]}case"UserChangeForbidWritingAll_RequestCompleted":{const{peerId:n,userAction:r,hasFailed:a}=t,o=m(r,n);e.locks.convoActions.delete(o);const i={forbid_writing_all:"allow_writing_all",allow_writing_all:"forbid_writing_all",forbid_writing_all_until:"allow_writing_all"}[r];return a&&i?(p(e,{type:"UserChangeForbidWritingAll",userAction:i,peerId:n,duration:1/0},s),[]):[]}default:(0,c.exhaustivenessCheck)(t)}var k,I},m=(e,t)=>`${u[e]}-${t.toString()}`},708807:(e,t,s)=>{s.d(t,{handler:()=>o});var n=s(11010),r=s(96190),a=s(89131);const o=(e,t)=>{switch(t.type){case"UserChangedFriendship":{var s;const a=e.peers.get(t.userId);if("User"!==(null==(s=a)?void 0:s.kind)||e.locks.updateFriendshipOrMembership.has(a.id))return[];const o=a.friendship;return r.updateFriendship(a,t.change),o===a.friendship?[]:(e.locks.updateFriendshipOrMembership.add(a.id),[(i=(0,n._)((function*({api:e}){let s=!1;try{yield e.fetch(`friends.${t.change}`,{user_id:r.toRealId(t.userId)})}catch(e){s=!0}return{type:"UserChangedFriendship_RequestCompleted",userId:t.userId,change:t.change,hasFailed:s}})),function(e){return i.apply(this,arguments)})])}case"UserChangedFriendship_RequestCompleted":{var o;e.locks.updateFriendshipOrMembership.delete(t.userId);const s=e.peers.get(t.userId);return"User"!==(null==(o=s)?void 0:o.kind)||t.hasFailed&&r.updateFriendship(s,{add:"delete",delete:"add"}[t.change]),[]}default:return(0,a.exhaustivenessCheck)(t)}var i}},959630:(e,t,s)=>{s.d(t,{handler:()=>o});var n=s(11010),r=s(96190),a=s(89131);const o=(e,t)=>{switch(t.type){case"UserChangedGroupMembership":{var s;const a=e.peers.get(t.groupId);if("Group"!==(null==(s=a)?void 0:s.kind)||e.locks.updateFriendshipOrMembership.has(a.id))return[];const o=a.membership;return r.updateMembership(a,t.change),o===a.membership?[]:(e.locks.updateFriendshipOrMembership.add(a.id),[(i=(0,n._)((function*({api:e}){const s=`groups.${t.change}`;let n=!1;try{yield e.fetch(s,{group_id:-t.groupId})}catch(e){n=!0}return{type:"UserChangedGroupMembership_RequestCompleted",groupId:t.groupId,change:t.change,hasFailed:n}})),function(e){return i.apply(this,arguments)})])}case"UserChangedGroupMembership_RequestCompleted":{var o;e.locks.updateFriendshipOrMembership.delete(t.groupId);const s=e.peers.get(t.groupId);return"Group"!==(null==(o=s)?void 0:o.kind)||t.hasFailed&&r.updateMembership(s,{join:"leave",leave:"join"}[t.change]),[]}default:return(0,a.exhaustivenessCheck)(t)}var i}},115804:(e,t,s)=>{s.d(t,{handler:()=>p});var n=s(11010),r=s(777634),a=s(185327),o=s(168465),i=s(89131),c=s(61448),d=s(991792),l=s(453934);const u={mark_important:"unmark_important",unmark_important:"mark_important"},h={delete:"delete",restore:"restore",mark_important:"mark_important",unmark_important:"mark_important"},p=(e,t,s)=>{const{type:h}=t;switch(h){case"UserChangedMessage":{const{peerId:s,userAction:r,cmids:o}=t;for(let t=0;t<o.length;t+=1){const n=o[t];if(!n)return[];const a=m(r,s,n);if(e.locks.messageActions.has(a))return[];e.locks.messageActions.add(a)}const d=e.convos.get(s);let u;switch(r){case"mark_important":case"unmark_important":o.forEach((t=>{if(d){var n;const e=(0,l.castDraft)(a.findMessageByCmid(d,t));"Normal"===(null==(n=e)?void 0:n.kind)&&(e.isImportant="mark_important"===r)}const o=e.importantMessages.messages.get((0,c.getImportantMessageKey)(s,t));o&&(o.isImportant="mark_important"===r)})),u=e=>e.fetch("messages.markAsImportant",{peer_id:s,cmids:o.join(","),important:"mark_important"===r?1:0}).then((e=>Boolean(e.marked.length)));break;default:(0,i.exhaustivenessCheck)(r)}return[(v=(0,n._)((function*({api:e}){try{let t=!1;return u&&(t=!(yield u(e))),{type:"UserChangedMessage_RequestCompleted",hasFailed:t,userAction:r,cmids:o,peerId:s}}catch(e){return{type:"UserChangedMessage_RequestCompleted",hasFailed:!0,userAction:r,cmids:o,peerId:s}}})),function(e){return v.apply(this,arguments)})]}case"UserChangedMessage_RequestCompleted":{const{peerId:n,userAction:r,hasFailed:a,cmids:o}=t;o.forEach((t=>{const s=m(r,n,t);e.locks.messageActions.delete(s)}));const i=u[r];return a&&i&&p(e,{type:"UserChangedMessage",userAction:i,peerId:n,cmids:o},s),[]}case"UserDeleteMessage":{const{deleteType:s,peerId:o,userAction:c,messages:l}=t,u=e.ownerId,h=e.convos.get(o);if(!h)return[];const p=[];for(let t=0;t<l.length;t+=1){const n=l[t];if(!n||"Normal"!==n.kind)return[];const d=m(c,o,n.cmid);if(e.locks.messageActions.has(d))return[];e.locks.messageActions.add(d),p.push(n);const u=a.isCasper(h)||r.isCall(n);switch(s){case"local":case"spam":if(u){a.deleteMessage(h,n,{isRestorable:!1});break}a.deleteMessage(h,n,{isRestorable:!0,isSpam:"spam"===s});break;case"for_all":a.deleteMessage(h,n,{isRestorable:!1});break;default:(0,i.exhaustivenessCheck)(s)}}return[function(){var e=(0,n._)((function*({api:e}){try{var t;const n=yield e.fetch("messages.delete",{peer_id:o,cmids:l.map((e=>e.cmid)).join(","),delete_for_all:"for_all"===s?1:0,spam:"spam"===s?1:0,group_id:(0,d.getOwnerGroupId)(u)});return{type:"UserDeleteMessage_RequestCompleted",hasFailed:!Boolean(null==(t=n[0])?void 0:t.response),userAction:c,deleteType:s,peerId:o,messages:l,deletedMessages:p}}catch(e){return{type:"UserDeleteMessage_RequestCompleted",hasFailed:!0,userAction:c,deleteType:s,peerId:o,messages:l,deletedMessages:p}}}));return function(t){return e.apply(this,arguments)}}()]}case"UserDeleteFailedMessage":{const{peerId:s,randomId:n}=t,r=e.convos.get(s);return r?(a.removePending(r,n),[]):[]}case"UserDeleteAllFailedMessage":{const{peerId:s}=t,n=e.convos.get(s);if(!n)return[];return a.allQueuedMessages(n).filter((e=>e.hasFailed)).forEach((e=>{a.removePending(n,e.randomId)})),[]}case"UserDeleteMessage_RequestCompleted":{const{peerId:s,userAction:r,messages:o,hasFailed:i,deletedMessages:c}=t,d=e.convos.get(s);return i&&d&&c.forEach((e=>{a.restoreMessage(d,e,!1)})),o.forEach((({cmid:t})=>{const n=m(r,s,t);e.locks.messageActions.delete(n)})),[(0,n._)((function*(){return{type:"Noop"}}))]}case"UserRestoreMessage":{var f;const{peerId:s,userAction:r,cmid:i}=t,c=m(r,s,i);if(e.locks.messageActions.has(c))return[];e.locks.messageActions.add(c);const l=e.convos.get(s);if(!l)return[];const u=e.ownerId,h=o.findNodeByCmid(l.history,i).node;return"DeletedNode"===(null==(f=h)?void 0:f.kind)&&a.restoreMessage(l,h.restorable,!1),[function(){var e=(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.restore",{peer_id:s,cmid:i,group_id:(0,d.getOwnerGroupId)(u)});return{type:"UserRestoreMessage_RequestCompleted",hasFailed:!Boolean(t),userAction:r,peerId:s,cmid:i}}catch(e){return{type:"UserRestoreMessage_RequestCompleted",hasFailed:!0,userAction:r,peerId:s,cmid:i}}}));return function(t){return e.apply(this,arguments)}}()]}case"UserRestoreMessage_RequestCompleted":{var g;const{peerId:n,userAction:r,cmid:o,hasFailed:i}=t,c=m(r,n,o);e.locks.messageActions.delete(c);const d=e.convos.get(n);if(void 0===d)return[];const l=a.findMessageByCmid(d,o);return i&&"Normal"===(null==(g=l)?void 0:g.kind)&&p(e,{type:"UserDeleteMessage",messages:[l],deleteType:"local",peerId:n,userAction:"delete"},s),[]}default:(0,i.exhaustivenessCheck)(t)}var v},m=(e,t,s)=>`${h[e]}-${t.toString()}-${s.toString()}`},623267:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(481186),a=s(89131),o=s(185327);const i=(e,t)=>{switch(t.type){case"UserChangedMessageAttachment":return[(0,n._)((function*({api:e}){try{const s=(yield e.fetch("messages.getByConversationMessageId",{peer_id:t.peerId,conversation_message_ids:t.cmid.toString(),extended:1,group_id:t.groupId||0},{retries:3})).items[0];return s?{type:"UserChangedMessageAttachment_RequestCompleted",hasFailed:!1,peerId:t.peerId,apiMessage:s}:{type:"UserChangedMessageAttachment_RequestCompleted",hasFailed:!0}}catch(e){return{type:"UserChangedMessageAttachment_RequestCompleted",hasFailed:!0}}}))];case"UserChangedMessageAttachment_RequestCompleted":{if(t.hasFailed)return[];const{message:s,mentions:n}=(0,r.fromApiMessage)(t.apiMessage),a=e.convos.get(t.peerId);return a?(o.replaceMessage(a,s,n.hasDirect||n.hasMass),[]):[]}default:(0,a.exhaustivenessCheck)(t)}}},395911:(e,t,s)=>{s.d(t,{handler:()=>d});var n=s(11010),r=s(89131),a=s(96190),o=s(185327),i=s(83062),c=s(453934);const d=(e,t)=>{const{type:s}=t,{viewer:d}=e,l=d.id;switch(s){case"UserAcceptedChatMessageRequest":{const{peerId:s}=t;return e.locks.changeMessageRequest.has(s)?[]:(e.locks.changeMessageRequest.add(s),[(0,n._)((function*({api:e}){try{return yield e.fetch("messages.acceptMessageRequest",{peer_id:s,user_id:a.toRealId(l)}),{type:"UserAcceptedChatMessageRequest_RequestCompleted",peerId:s}}catch(e){return{type:"UserAcceptedChatMessageRequest_RequestCompleted",peerId:s}}}))])}case"UserRejectedMessageRequest":{const{peerId:s,isSpam:r}=t;if(e.locks.changeMessageRequest.has(s))return[];e.locks.changeMessageRequest.add(s);const d=e.convos.get(s),u=(0,c.current)(d);if(void 0!==d&&("MessageRequestChatConvo"===d.kind||"MessageRequestUserConvo"===d.kind||"UserConvo"===d.kind)){const t=o.fromRejectedMessageRequest(d);e.convos.set(s,t),i.refresh(e.organisers,t)}return[(0,n._)((function*({api:e}){try{return{type:"UserRejectedChatMessageRequest_RequestCompleted",hasFailed:1!==(yield e.fetch("messages.rejectMessageRequest",{peer_id:s,user_id:a.toRealId(l),spam:r?1:0})),peerId:s,prevConvo:u}}catch(e){return{type:"UserRejectedChatMessageRequest_RequestCompleted",hasFailed:!0,peerId:s,prevConvo:u}}}))]}case"UserAcceptedChatMessageRequest_RequestCompleted":{const{peerId:s}=t;return e.locks.changeMessageRequest.delete(s),[]}case"UserRejectedChatMessageRequest_RequestCompleted":{const{prevConvo:s,hasFailed:n,peerId:r}=t;return e.locks.changeMessageRequest.delete(r),n&&void 0!==s&&(e.convos.set(r,s),i.refresh(e.organisers,s)),[]}default:(0,r.exhaustivenessCheck)(s)}}},573610:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(89131),a=s(839963),o=s(54965);const i=(e,t)=>{switch(t.type){case"UserChangedPostAttachment":{const{channelId:e,cmid:r}=t;return[(s=(0,n._)((function*({api:t}){try{var s;const n=null==(s=(yield t.fetch("channels.getMessagesById",{channel_id:e,cmids:r.toString(),extended:1},{retries:3})).items)?void 0:s[0];return n?{type:"UserChangedPostAttachment_RequestCompleted",hasFailed:!1,channelId:e,apiPost:n}:{type:"UserChangedPostAttachment_RequestCompleted",hasFailed:!0}}catch(e){return{type:"UserChangedPostAttachment_RequestCompleted",hasFailed:!0}}})),function(e){return s.apply(this,arguments)})]}case"UserChangedPostAttachment_RequestCompleted":{if(t.hasFailed)return[];const{apiPost:s,channelId:n}=t,r=e.channels.get(n);if(!r)return[];if("ChannelRestricted"===r.kind)return[];const{post:i,reactions:c}=(0,o.fromApiPost)(s);for(const t of c)e.reactions.set(t.id,t);return a.replacePost(r,i),[]}default:(0,r.exhaustivenessCheck)(t)}var s}},446869:(e,t,s)=>{s.d(t,{handler:()=>o});var n=s(11010),r=s(89131),a=s(453934);const o=(e,t)=>{switch(t.type){case"UserChangedPushSetting":{const{setting:r,value:o}=t;e.viewer.settings.push[r]=o;const i=(0,a.current)(e.viewer.settings.push);return[(s=(0,n._)((function*({storage:e}){return e.set("settings-push",i),{type:"UserChangedPushSetting_RequestCompleted",hasFailed:!1,setting:r,value:o}})),function(e){return s.apply(this,arguments)})]}case"UserChangedPushSetting_RequestCompleted":return t.hasFailed,[];default:(0,r.exhaustivenessCheck)(t)}var s}},490469:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(89131),a=s(927411),o=s(709646);const i=(e,t)=>{const{type:s}=t;switch(s){case"UserChangedSetting":{const s=t.setting;e.locks.settings.add(s);const o=e.viewer.settings[t.setting];return e.viewer.settings[t.setting]=t.value,[(c=(0,n._)((function*(e){try{const s=yield function(e,t,s){const{api:n,storage:o}=e;switch(t){case"ctrSubmit":{const e=a.IApi.resolveTrackId("account.setInfo","messages_multiline_input");return n.dangerouslyAbort(e),n.fetch("account.setInfo",{name:"messages_multiline_input",value:String(Number(s))},{trackId:e})}case"soundNotifications":return o.set("settings-sound-notifications-on",s),Promise.resolve(1);case"eduAccountSwitchBanner":return o.set("settings-edu-account-switch-banner-on",s),Promise.resolve(1);case"showRecommendations":{const e=a.IApi.resolveTrackId("account.setInfo","messages_recommendation_list_hidden");return n.dangerouslyAbort(e),n.fetch("account.setInfo",{name:"messages_recommendation_list_hidden",value:String(Number(!s))},{trackId:e})}case"countOnlyNotMuted":{const e=a.IApi.resolveTrackId("account.setInfo","show_only_not_muted_messages");return n.dangerouslyAbort(e),n.fetch("account.setInfo",{name:"show_only_not_muted_messages",value:String(Number(s))},{trackId:e})}case"autoUnarchive":{const e=a.IApi.resolveTrackId("account.setInfo","messages_auto_unarchive");return n.dangerouslyAbort(e),n.fetch("account.setInfo",{name:"messages_auto_unarchive",value:String(Number(s))},{trackId:e})}case"transcriptAutoShow":{const e=a.IApi.resolveTrackId("account.setInfo","messages_transcript_auto_show");return n.dangerouslyAbort(e),n.fetch("account.setInfo",{name:"messages_transcript_auto_show",value:String(Number(s))},{trackId:e})}case"verticalFoldersView":return o.set("folders-view-vertical",s),Promise.resolve(1);case"messageReactionAnimation":return o.set("message-reactions-animation",s),Promise.resolve(1);case"rightClickActionsEnabled":return o.set("settings-right-click-actions-enabled",s),Promise.resolve(1);case"autoExtendReactionPicker":return o.set("settings-auto-extend-reaction-picker",s),Promise.resolve(1);default:(0,r.exhaustivenessCheck)(t)}}(e,t.setting,t.value);return"transcriptAutoShow"===t.setting&&1===s&&e.stats.logEvent({type:"type_action",type_action:{type:"type_settings_changes_item",type_settings_changes_item:{type:"general",name:"voice_transcription_autoshow",value_old:String(Number(o)),value_new:String(Number(t.value)),screen:"im_web_settings"}}}),{type:"UserChangedSetting_RequestCompleted",hasFailed:1!==s,setting:t.setting,value:t.value,previousValue:o}}catch(e){return{type:"UserChangedSetting_RequestCompleted",hasFailed:!0,setting:t.setting,value:t.value,previousValue:o}}})),function(e){return c.apply(this,arguments)})]}case"UserChangedSetting_RequestCompleted":{const s=t.setting;if(e.locks.settings.delete(s),t.hasFailed)e.viewer.settings[t.setting]=t.previousValue;else if("eduAccountSwitchBanner"===t.setting){const s=e.viewer,r=o.isEdu(s.profileType);return[(i=(0,n._)((function*(e){return e.stats.logEvent({type:"general",name:r?"go_to_messenger_banner":"go_to_sferum_banner",value_new:t.value?"enable":"disable",value_old:t.value?"disable":"enable"}),{type:"Noop"}})),function(e){return i.apply(this,arguments)})]}return[]}default:(0,r.exhaustivenessCheck)(s)}var i,c}},694598:(e,t,s)=>{s.d(t,{handler:()=>c});var n=s(11010),r=s(999504),a=s(89131),o=s(991792),i=s(927411);const c=(e,t)=>{switch(t.type){case"UserCreatedFolder":{const{name:a,peerIds:o}=t;return e.locks.newFolder?[]:(e.locks.newFolder=!0,[(s=(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.createFolder",{name:a,included_peer_ids:o.join(",")});return{type:"UserCreatedFolder_CreateRequestCompleted",hasFailed:!1,peerIds:o,name:a,folderId:r.resolveId(t.folder_id)}}catch(e){let t;return e instanceof i.IApi.RequestError&&(t=e.code),{type:"UserCreatedFolder_CreateRequestCompleted",hasFailed:!0,name:a,error:t}}})),function(e){return s.apply(this,arguments)})])}case"UserCreatedFolder_CreateRequestCompleted":{const{hasFailed:s}=t;if(e.locks.newFolder=!1,s){if(t.error);else if(a.isDev)throw new Error("Не удалось создать папку");return[]}const n=(0,o.insertFolders)(e,[{id:t.folderId,name:t.name}]),i=(0,o.getConvosByIds)(e,t.peerIds);return(0,o.addConvosToFolder)(e,t.folderId,i),n[0]&&r.setHasMore(n[0],"all",!1),[]}default:(0,a.exhaustivenessCheck)(t)}var s}},351447:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(999504),a=s(185327),o=s(89131);const i=(e,t)=>{switch(t.type){case"UserDeletedFolder":{const{folderId:o}=t;if(e.locks.deleteFolder.has(o))return[];e.locks.deleteFolder.add(o),r.deleteFolder(e.organisers.folders,o);for(const t of e.convos.values())a.removeFolder(t,o);return[(s=(0,n._)((function*({api:e}){try{return{type:"UserDeletedFolder_DeleteRequestCompleted",hasFailed:1!==(yield e.fetch("messages.deleteFolder",{folder_id:o})),folderId:o}}catch(e){return{type:"UserDeletedFolder_DeleteRequestCompleted",hasFailed:!0,folderId:o}}})),function(e){return s.apply(this,arguments)})]}case"UserDeletedFolder_DeleteRequestCompleted":{const{hasFailed:s,folderId:n}=t;if(e.locks.deleteFolder.delete(n),s&&o.isDev)throw new Error("Не удалось удалить папку");return[]}default:(0,o.exhaustivenessCheck)(t)}var s}},791175:(e,t,s)=>{s.d(t,{handler:()=>o});var n=s(11010),r=s(498928),a=s(89131);const o=(e,t)=>{switch(t.type){case"UserHideFilter":return"businessNotify"===t.kind?e.organisers.filters.businessNotify.unreadCount>0?[]:[(s=(0,n._)((function*({storage:e}){return e.set("business-notify-manually-hidden",!0),{type:"UserHideFilter_Completed",kind:"businessNotify"}})),function(e){return s.apply(this,arguments)})]:"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind||"archive"===t.kind?[]:(0,a.exhaustivenessCheck)(t.kind);case"UserHideFilter_Completed":return"businessNotify"===t.kind?(r.toggleBusinessNotifyVisibility(e.organisers.filters,!1),[]):"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind||"archive"===t.kind?[]:(0,a.exhaustivenessCheck)(t.kind);case"UserUndoHideFilter":return"businessNotify"===t.kind?(r.toggleBusinessNotifyVisibility(e.organisers.filters,!0),[(0,n._)((function*({storage:e}){return e.set("business-notify-manually-hidden",!1),{type:"Noop"}}))]):"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind||"archive"===t.kind?[]:(0,a.exhaustivenessCheck)(t.kind);case"UserActualizeHideFilter":if("businessNotify"===t.kind){const t=e.organisers.filters.businessNotify.unreadCount,{isHidden:s}=e.organisers.filters.businessNotify;return[(0,n._)((function*({storage:e}){const n=e.get("business-notify-manually-hidden");return n&&!s?{type:"UserHideFilter",kind:"businessNotify"}:!n&&s?{type:"UserUndoHideFilter",kind:"businessNotify"}:0===t?{type:"Noop"}:{type:"UserUndoHideFilter",kind:"businessNotify"}}))]}return"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind||"archive"===t.kind?[]:(0,a.exhaustivenessCheck)(t.kind);default:(0,a.exhaustivenessCheck)(t)}var s}},109424:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(89131),a=s(197934),o=s(991792);const i=(e,t)=>{switch(t.type){case"UserHitEdit":{const{cmid:r,text:i,attaches:c,peerId:d,keepForwarded:l,keepSnippets:u}=t,h=e.convos.get(d),p=e.ownerId;if(!h)return[];e.locks.edit.add(d);const m=a.ids(c).join(",");return[(s=(0,n._)((function*({api:e}){let t=!1;try{var s,n;yield e.fetch("messages.edit",{cmid:r,peer_id:d,message:i,attachment:0===m.length?void 0:m,group_id:(0,o.getOwnerGroupId)(p),keep_forward_messages:l?1:0,keep_snippets:u?1:0,lat:null==(s=c.geo)?void 0:s.coordinates.latitude,long:null==(n=c.geo)?void 0:n.coordinates.longitude})}catch(e){t=!0}return{type:"UserHitEdit_RequestCompleted",peerId:d,hasFailed:t}})),function(e){return s.apply(this,arguments)})]}case"UserHitEdit_RequestCompleted":{const{peerId:s,hasFailed:n}=t;e.locks.edit.delete(s);e.convos.get(s);return[]}default:return(0,r.exhaustivenessCheck)(t)}var s}},978758:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(434788),a=s(197934),o=s(168465),i=s(86144),c=s(559360),d=s(89131);const l=(e,t)=>{switch(t.type){case"UserHitPostSend":{const{text:s,attaches:d,channelId:l,publishAt:h,topic:p,options:m,visibility:f,donutDelay:g,onComplete:v,onFail:_,editingPost:C}=t,y=e.channels.get(l);if(!y)return[];if("ChannelRestricted"===y.kind)return[];const k=a.ids(d).join(",");if(!s&&!k)return[];let I;return void 0!==h||C||(I=i.newPending({channelId:l,attaches:d,sentAt:+new Date},s),o.appendPending(y.history,I)),[(0,n._)((function*({api:e}){try{var t;v();const n={channel_id:l,message:s,attachments:k,publish_date:h&&Math.floor(h.getTime()/1e3),topic_id:c.getPostThemeIdFromKey(p),close_comments:u(m.has("close_comments")),mark_as_ads:u(m.has("mark_as_ads")),mute_notifications:u(m.has("mute_notifications")),signed:u(m.has("signed")),donut_paid_duration:"all"===f?void 0:-1===g?g:86400*g},a=C?yield e.fetch("channels.editMessage",(0,r._)({},n,{cmid:C.cmid})):yield e.fetch("channels.sendMessage",(0,r._)({},n,{from_group:1}));return{type:"UserHitPostSend_RequestCompleted",hasFailed:!1,randomId:null==(t=I)?void 0:t.randomId,cmid:i.resolveCmid(a),channelId:l}}catch(e){var n;return _(e),{type:"UserHitPostSend_RequestCompleted",hasFailed:!0,randomId:null==(n=I)?void 0:n.randomId,channelId:l}}}))]}case"UserHitPostSend_RequestCompleted":{const{hasFailed:s,randomId:n,channelId:r}=t,a=e.channels.get(r);if(!a)return[];if("ChannelRestricted"===a.kind)return[];if(s)return void 0!==n&&o.removePending(a.history,n),[];if(void 0!==n){const e=o.findPendingNode(a.history,n);void 0!==e&&(e.item.cmid=t.cmid)}return[]}default:(0,d.exhaustivenessCheck)(t)}},u=e=>void 0!==e?Number(e)&&1:e},273971:(e,t,s)=>{s.d(t,{handler:()=>m});var n=s(11010),r=s(434788),a=s(453934),o=s(89131),i=s(777634),c=s(96190),d=s(185327),l=s(168465),u=s(197934),h=s(991792),p=s(95154);const m=(e,t,s)=>{switch(t.type){case"UserHitSend":{const{peerId:s}=t,r=e.convos.get(s);return r?function(e,t){const{text:s,attaches:n,peerId:r,timestamp:a,expireTTL:o,deleteTTL:c,entrypoint:d,extra:l,reply:u,forwarded:h}=e,m=function(e){const t=e.length;if(t<p.MAX_MESSAGE_SIZE)return[e];const s=[];let n=0;for(let r=0;r<Math.ceil(t/p.MAX_MESSAGE_SIZE);r++){const r=e.substring(n,n+p.MAX_MESSAGE_SIZE).lastIndexOf(" "),a=-1===r?p.MAX_MESSAGE_SIZE:r,o=t-n<=p.MAX_MESSAGE_SIZE?e.substring(n):e.substring(n,n+a);n+=o.length,s.push(o)}return s.map((e=>e.trim()))}(s),f=function(e){const t=Object.values(e).flat(),s=Object.fromEntries(Object.entries(e).map((([e,t])=>Array.isArray(t)?[t[0].kind,{key:e,isArray:!0}]:[t.kind,{key:e,isArray:!1}])));if(t.length<=p.MAX_MESSAGE_ATTACHES)return[e];return t.reduce(((e,t,n)=>{var r;const a=Math.floor(n/p.MAX_MESSAGE_ATTACHES),o=s[t.kind];return o?(e[a][o.key]=o.isArray?(null==(r=e[a][o.key])?void 0:r.concat(t))||[t]:t,e):e}),Array.from({length:Math.ceil(t.length/p.MAX_MESSAGE_ATTACHES)},(()=>Object())))}(n),g=m.length+f.length-1,v=[];for(let e=0;e<g;e++){const s=m[e]||"",n=f[e-m.length+1]||{},p=i.newQueued({peerId:r,text:s,isOut:!0,sentAt:a+e,authorId:t,attaches:n,expireTTL:o,deleteTTL:c,extra:l,entrypoint:d},0===e?u:void 0,e===g-1?h:void 0);v.push(p)}return v}(t,e.ownerId).flatMap((t=>{d.appendQueuedMessage(r,t);const s=e.locks.sendQueue.get(r.peerId);return s?(s.add(t.randomId),[]):(e.locks.sendQueue.set(r.peerId,new Set([t.randomId])),[f(t.peerId,t.randomId,t.text,u.ids(t.attaches),t.extra,t.entrypoint,t.attaches.geo,(0,h.getOwnerGroupId)(e.ownerId),g(t)),c.isMarusia(t.peerId)&&(a=(0,n._)((function*({marusia:e}){var s;return null==(s=e)||s.handleAction({type:"add_message",payload:{randomId:Number(t.randomId),text:i.toRawText(t),isOutbound:t.isOut,local:!0,payload:t.extra.botPayload,attachIds:u.ids(t.attaches)}}),{type:"Noop"}})),function(e){return a.apply(this,arguments)})]);var a})):[]}case"UserHitSend_RequestCompleted":{var r;const{peerId:s,randomId:n,response:o}=t,c=e.convos.get(s),d=e.ownerId;if(!c)return e.locks.sendQueue.delete(s),[];const p=l.findPendingNode(c.history,n);var v;if(p)o?(null==(v=o)?void 0:v.cmid)&&i.updateCmid(p.item,i.resolveCmid(o.cmid)):i.updateFail(p.item,!0);const m=e.locks.sendQueue.get(c.peerId);if(!m)return[];m.delete(n);const _=[...m][0];if(!_)return e.locks.sendQueue.delete(s),[];const C=null==(r=l.findPendingNode(c.history,_))?void 0:r.item;if(!C)return[];const y=(0,a.current)(C);return[f(s,y.randomId,y.text,u.ids(y.attaches),y.extra,y.entrypoint,y.attaches.geo,(0,h.getOwnerGroupId)(d),g(y))]}case"UserHitResendFailedMessage":{var _;const{randomId:s,peerId:n,entrypoint:r}=t,o=e.convos.get(n),i=e.ownerId;if(!o)return[];const c=null==(_=l.findPendingNode(o.history,s))?void 0:_.item;if(!c)return[];d.updateSendingFail(o,s,!1),d.changeQueuedMessageEntrypoint(o,s,r);const p=e.locks.sendQueue.get(o.peerId);if(p)return p.add(c.randomId),[];e.locks.sendQueue.set(o.peerId,new Set([c.randomId]));const m=(0,a.current)(c);return[f(n,m.randomId,m.text,u.ids(m.attaches),m.extra,r,m.attaches.geo,(0,h.getOwnerGroupId)(i),g(m))]}case"UserHitResendAllFailedMessages":{const{peerId:n,entrypoint:r}=t,a=e.convos.get(n);if(!a)return[];return d.allQueuedMessages(a).filter((e=>e.hasFailed)).flatMap((t=>m(e,{type:"UserHitResendFailedMessage",peerId:n,randomId:t.randomId,entrypoint:r||t.entrypoint},s)))}case"ResendAllFailedMessages":return Array.from(e.convos.values()).flatMap((t=>m(e,{type:"UserHitResendAllFailedMessages",peerId:t.peerId},s)));case"UserHitSendWidget":{const{peerId:n,text:r,timestamp:a,entrypoint:o,extra:c}=t;if(e.convos.get(n))return m(e,{type:"UserHitSend",attaches:{},extra:c,entrypoint:o,text:r,peerId:n,timestamp:a},s);const d=i.newQueued({peerId:n,text:r,isOut:!0,sentAt:a,authorId:e.ownerId,attaches:{},extra:c,entrypoint:o});return[f(d.peerId,d.randomId,d.text,u.ids(d.attaches),d.extra,d.entrypoint,d.attaches.geo,(0,h.getOwnerGroupId)(e.ownerId),null)]}default:return(0,o.exhaustivenessCheck)(t)}};function f(e,t,s,a,o,i,c,d,l){return u=(0,n._)((function*({api:n}){let u={};o.sticker&&(u.sticker_id=o.sticker.id,u.sticker_referrer=o.sticker.referrer),o.botPayload&&(u.payload=o.botPayload),o.silent&&(u.silent=1),o.expiresIn&&(u.expire_ttl=o.expiresIn),c&&(u.lat=c.coordinates.latitude,u.long=c.coordinates.longitude);try{const o=yield n.fetch("messages.send",(0,r._)({},u,{peer_id:e,random_id:t,message:s,forward:l?JSON.stringify(l):void 0,attachment:0===a.length?void 0:a.join(","),entrypoint:i,group_id:d}));return{type:"UserHitSend_RequestCompleted",peerId:e,randomId:t,response:o}}catch(s){return{type:"UserHitSend_RequestCompleted",peerId:e,randomId:t}}})),function(e){return u.apply(this,arguments)};var u}function g(e){let t=null;return e.replyMessage&&(t={peer_id:e.replyMessage.peerId,conversation_message_ids:[e.replyMessage.cmid],is_reply:!0}),e.forwardedMessages&&(t={peer_id:e.forwardedMessages[0].peerId,conversation_message_ids:e.forwardedMessages.map((e=>e.cmid))}),t}},43109:(e,t,s)=>{s.d(t,{handler:()=>p});var n=s(11010),r=s(434788),a=s(89131),o=s(86144),i=s(866358),c=s(96190),d=s(168465),l=s(95154),u=s(991792);const h={UserChangedLike:"UserChangedLike",UserChangedLike_RequestCompleted:"UserChangedLike",UserLoadedLikes:"UserLoadedLikes",UserLoadedLikes_RequestCompleted:"UserLoadedLikes"},p=(e,t,s)=>{let f,g,v;switch(t.kind){case"comment":{var _,C;const{channelId:s,postCmid:n,commentCmid:r,replyCmid:a}=t,c=e.channels.get(s);if("ChannelRestricted"===(null==(_=c)?void 0:_.kind))break;const l=c&&d.findNodeByCmid(c.history,n).node,u="Node"===(null==(C=l)?void 0:C.kind)&&o.findCommentByCmid(l.item,r);if(!u||"Normal"!==u.kind)break;if(f=u.channelId,a){const e=i.findReplyByCmid(u,a);if(!e||"Normal"!==e.kind)break;v=e,g=e.cmid;break}v=u,g=u.cmid;break}case"post":{var y,k;const{channelId:s,postCmid:n}=t,r=e.channels.get(s);if("ChannelRestricted"===(null==(y=r)?void 0:y.kind))break;const a=r&&d.findNodeByCmid(r.history,n).node,o="Node"===(null==(k=a)?void 0:k.kind)&&a.item;if(!o)break;f=o.channelId,g=o.cmid,v=o;break}default:(0,a.exhaustivenessCheck)(t)}if(!v||!f||!g)return[];const I=m(h[t.type],t.kind,f,g);switch(t.type){case"UserLoadedLikes":{if(e.locks.likeActions.has(I))return[];let s;switch(e.locks.likeActions.add(I),t.kind){case"comment":case"post":s=v.likes.peerIds.size;break;default:(0,a.exhaustivenessCheck)(t)}const o=0===v.likes.peerIds.size?l.LIKE_PEERS_FIRST_LOAD:l.LIKE_PEERS_PER_PAGE;return[(M=(0,n._)((function*({api:e}){try{const n=yield e.fetch("likes.getList",{type:t.kind,owner_id:f,item_id:g,extended:1,skip_own:1,count:o,offset:s});return(0,r._)({},t,{type:"UserLoadedLikes_RequestCompleted",response:n,hasFailed:!1})}catch(e){return(0,r._)({},t,{type:"UserLoadedLikes_RequestCompleted",hasFailed:!0})}})),function(e){return M.apply(this,arguments)})]}case"UserLoadedLikes_RequestCompleted":{const{hasFailed:s,response:n}=t;if(e.locks.likeActions.delete(I),s||!n)return[];const r=n.items.filter((e=>"profile"===e.type)),o=n.items.filter((e=>"group"===e.type)),i=n.items.map((e=>c.resolveId(e.id)));switch((0,u.insertPeers)(e,{apiUsers:r,apiGroups:o,apiContacts:[]}),t.kind){case"comment":case"post":i.forEach((e=>{var t;return null==(t=v)?void 0:t.likes.peerIds.add(e)}));break;default:(0,a.exhaustivenessCheck)(t)}return[]}case"UserChangedLike":{const{reactionId:s}=t;let a=v.likes.reactionId;if(a===s)return[];const o=void 0!==a;return e.locks.likeActions.has(I)?[]:(e.locks.likeActions.add(I),void 0===s?v.likes.count-=1:o||(v.likes.count+=1),v.likes.reactionId=s,[(w=(0,n._)((function*({api:e}){try{const n=yield e.fetch(o&&void 0===s?"likes.delete":"likes.add",{type:t.kind,owner_id:f,item_id:g||0,reaction_id:s});return(0,r._)({},t,{type:"UserChangedLike_RequestCompleted",response:n,hasFailed:!1})}catch(e){return(0,r._)({},t,{type:"UserChangedLike_RequestCompleted",hasFailed:!0,prevReactionId:a})}})),function(e){return w.apply(this,arguments)})])}case"UserChangedLike_RequestCompleted":{const{hasFailed:n,response:a,prevReactionId:o}=t;return e.locks.likeActions.delete(I),n||!a?(p(e,(0,r._)({},t,{type:"UserChangedLike",reactionId:o}),s),e.locks.likeActions.delete(I),[]):(v.likes.count=a.likes,[])}default:(0,a.exhaustivenessCheck)(t)}var w,M},m=(e,t,s,n)=>`${e}-${t}-${s}-${n}`},464474:(e,t,s)=>{s.d(t,{getCommentsHistoryLockKey:()=>p,handler:()=>h});var n=s(11010),r=s(89131),a=s(86144),o=s(866358),i=s(168465),c=s(991792),d=s(95154),l=s(851828),u=s(453934);const h=(e,t)=>{switch(t.type){case"UserLoadedCommentsHistory":{var s;const{channelId:o,postCmid:c,startCmid:l,commentCmid:u,order:h}=t,f=p(o,c,u);if(e.locks.getPostCommentsHistory.has(f))return[];e.locks.getPostCommentsHistory.add(f);const g=e.channels.get(o);if(!g)return[];if("ChannelRestricted"===g.kind)return[];const v=i.findNodeByCmid(g.history,c).node,_="Node"===(null==(s=v)?void 0:s.kind)&&v.item;if(!_)return[];if(u&&!a.findCommentByCmid(_,u))return[];let C;switch(h){case"interesting":C="smart";break;case"new":C="desc";break;case"old":C="asc";break;default:(0,r.exhaustivenessCheck)(h)}return[(m=(0,n._)((function*({api:e}){try{const t=yield e.fetch("wall.getComments",{owner_id:o,post_id:c,count:d.COMMENTS_PER_PAGE,sort:C,thread_items_count:d.THREAD_COMMENTS_COUNT,need_likes:1,extended:1,start_comment_id:l,comment_id:u||void 0,offset:l?1:0});return{type:"UserLoadedCommentsHistory_RequestSucceed",channelId:o,response:t,postCmid:c,order:h,commentCmid:u}}catch(e){return{type:"UserLoadedCommentsHistory_RequestFailed",channelId:o,postCmid:c,commentCmid:u,hasFailed:!0}}})),function(e){return m.apply(this,arguments)})]}case"UserLoadedCommentsHistory_RequestSucceed":{var h;const{response:s,channelId:n,postCmid:r,commentCmid:d,order:m}=t;e.locks.getPostCommentsHistory.delete(p(n,r,d));const f=e.channels.get(n);if(!f)return[];if("ChannelRestricted"===f.kind)return[];const g=(0,u.castDraft)(i.findNodeByCmid(f.history,r).node),v="Node"===(null==(h=g)?void 0:h.kind)&&g.item;if(!v)return[];const _=s.items.map((e=>(0,l.fromApiComment)(e)));if(m!==v.comments.order&&a.changeCommentsOrder(v,m),d){const e=a.findCommentByCmid(v,d);if(!e)return[];o.insertReplies(e,_),e.replies.count=s.current_level_count||e.replies.count}else a.insertComments(v,_,s.current_level_count||0),v.comments.count=s.count,v.comments.oneLevelCount=s.current_level_count||v.comments.oneLevelCount;return(0,c.insertPeers)(e,{apiUsers:s.profiles||[],apiGroups:s.groups||[],apiContacts:[]}),[]}case"UserLoadedCommentsHistory_RequestFailed":{const{channelId:s,postCmid:n,commentCmid:r}=t;return e.locks.getPostCommentsHistory.delete(p(s,n,r)),[]}default:return(0,r.exhaustivenessCheck)(t)}var m},p=(e,t,s)=>`${e}-${t}-${s||""}`},708315:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(906978),a=s(839963),o=s(83062),i=s(89131),c=s(927411),d=s(991792);const l=(e,t)=>{switch(t.type){case"UserOpenedChannel":{const{channelId:s}=t,r=e.locks.channelsCleanup.get(s)||0;e.locks.channelsCleanup.set(s,r+1);return e.channels.get(s)?[]:[(0,n._)((function*({api:e}){try{const t=yield e.fetch("channels.getById",{channel_ids:s.toString(),extended:1},{retries:2});return{type:"UserOpenedChannel_ChannelRequestCompleted",channelId:s,response:t,hasFailed:!1}}catch(e){return{type:"UserOpenedChannel_ChannelRequestCompleted",channelId:s,hasFailed:!0,errCode:e instanceof c.IApi.RequestError?e.code:void 0}}}))]}case"UserOpenedChannel_ChannelRequestCompleted":{const{hasFailed:s,channelId:n,response:a,errCode:c}=t;if(s&&c===r.API_ERROR_ACCESS)return e.channels.set(n,{id:n,kind:"ChannelRestricted"}),[];if(!a)return[];(0,d.insertChannels)(e,{apiChannels:a.items||[],apiGroups:a.groups||[]});const l=e.channels.get(n);if(!l){if(i.isDev)throw new Error("Диалог не был найден");return[]}return"ChannelRestricted"===l.kind||l.isMember&&o.refreshChannels(e.organisers,l),[]}case"UserClosedChannel":{const{channelId:s}=t,n=e.locks.channelsCleanup.get(s);if(n&&n>1)return e.locks.channelsCleanup.set(s,n-1),[];e.locks.channelsCleanup.delete(s);const r=e.channels.get(s);return r?("ChannelRestricted"===r.kind||a.cleanup(r),[]):[]}default:return(0,i.exhaustivenessCheck)(t)}}},733835:(e,t,s)=>{s.d(t,{handler:()=>u});var n=s(11010),r=s(991792),a=s(96190),o=s(185327),i=s(83062),c=s(71568),d=s(89131),l=s(986727);const u=(e,t,s)=>{switch(t.type){case"LoadChatMembers":case"LoadStickers":case"ActualizeComposerDraft":return[];case"UserOpenedConvo":{e.convoLoadingFailed=void 0;const{peerId:a}=t,o=e.convos.get(a),i=e.locks.convosCleanup.get(a)||0;e.locks.convosCleanup.set(a,i+1);const c=(0,r.getOwnerGroupId)(e.ownerId);return o?u(e,{type:"UserOpenedConvo_ConvoRequestCompleted",peerId:a,hasFailed:!1},s):[(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.getConversationsById",{peer_ids:a.toString(),group_id:c,extended:1},{retries:3});return{type:"UserOpenedConvo_ConvoRequestCompleted",peerId:a,hasFailed:!1,profiles:t.profiles,groups:t.groups,conversations:t.items,contacts:t.contacts}}catch(e){return{type:"UserOpenedConvo_ConvoRequestCompleted",peerId:a,hasFailed:!0}}}))]}case"UserOpenedConvo_ConvoRequestCompleted":{const{peerId:l,conversations:u,profiles:p,groups:y,contacts:k,hasFailed:I}=t;if(I){if(d.isDev)throw new Error("Не удалось загрузить диалог");return e.convoLoadingFailed=l,[]}(0,r.insertConvos)(e,u||[]),(0,r.insertPeers)(e,{apiUsers:p||[],apiGroups:y||[],apiContacts:k||[]});const w=e.convos.get(l);if(!w){if(d.isDev)throw new Error("Диалог не был найден");return[]}const M=w.isMarkedUnread&&0===w.unreadCount;M&&o.markRead(w),i.refresh(e.organisers,w);const R="ChatConvo"===w.kind&&void 0===w.members&&o.canReadMembers(w)&&!e.locks.getConversationMembers.has(l);R&&e.locks.getConversationMembers.add(l);const b=(0,r.getOwnerGroupId)(e.ownerId),S=Object.values(s.me_sticker_packs).flat().map((e=>c.resolveStickerId(e))).filter((t=>!e.stickers.has(t))),E=S.length>0,U=!e.locks.loadStickerPacks;return U&&(e.locks.loadStickerPacks=!0),[R&&a.isChatPeerId(l)&&(C=(0,n._)((function*(){return{type:"LoadChatMembers",peerId:l}})),function(){return C.apply(this,arguments)}),E&&(_=(0,n._)((function*(){return{type:"LoadStickers",stickerIds:S}})),function(){return _.apply(this,arguments)}),U&&(v=(0,n._)((function*({api:e}){try{return{type:"UserOpenedConvo_StickerPacksRequestCompleted",response:yield e.fetch("store.getProducts",{type:"stickers",filters:"active",extended:1},{retries:10})}}catch(e){return{type:"UserOpenedConvo_StickerPacksRequestCompleted"}}})),function(e){return v.apply(this,arguments)}),(g=(0,n._)((function*({api:e,storage:t}){try{const n=yield function(e){return h.apply(this,arguments)}({api:e,storage:t,featureFlags:s});return{type:"UserOpenedConvo_StickersKeywordsRequestCompleted",response:n}}catch(e){return{type:"UserOpenedConvo_StickersKeywordsRequestCompleted"}}})),function(e){return g.apply(this,arguments)}),M&&(f=(0,n._)((function*({api:e}){try{yield e.fetch("messages.markAsRead",{peer_id:l,mark_conversation_as_read:1,group_id:b})}catch(e){}return{type:"Noop"}})),function(e){return f.apply(this,arguments)}),(m=(0,n._)((function*(){return{type:"ActualizeComposerDraft",peerId:l}})),function(){return m.apply(this,arguments)})]}case"UserClosedConvo":{const s=e.locks.convosCleanup.get(t.peerId);if(s&&s>1)return e.locks.convosCleanup.set(t.peerId,s-1),[];e.locks.convosCleanup.delete(t.peerId);const n=e.convos.get(t.peerId);return n?(o.cleanup(n),[]):[]}case"UserOpenedConvo_StickersKeywordsRequestCompleted":{const{response:s}=t;return s&&(e.stickersKeywords=(0,l.fromApiStickersKeywords)(s)),[]}case"UserOpenedConvo_StickerPacksRequestCompleted":{var p;const{response:s}=t;return s?(null==(p=s.items)||p.forEach((t=>{var s;null==(s=t.stickers)||s.forEach((t=>{e.stickers.set(c.resolveStickerId(t.sticker_id),(0,l.fromApiSticker)(t))}))})),[]):[]}default:return(0,d.exhaustivenessCheck)(t)}var m,f,g,v,_,C};function h(){return(h=(0,n._)((function*({api:e,storage:t,featureFlags:s}){const n=yield t.getIDB("stickers-keywords"),r=Math.round((new Date).getTime()/1e3),a=n&&n.expiresAt>r,o=a?n.response:yield e.fetch("store.getStickersKeywords",{need_stickers:0,all_products:s.vkm_send_promoted_stickers?1:0},{retries:3,timeout:3e4});return a||(yield t.setIDB("stickers-keywords",{response:o,expiresAt:r+86400}).catch((()=>{}))),o}))).apply(this,arguments)}},666840:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(434788),a=s(96190),o=s(89131),i=s(991792),c=s(185327),d=s(863536);const l=(e,t,s)=>{switch(t.type){case"LoadChatMembers":return[];case"UserOpenedConvoProfile":{const{peerId:r,isLinkWithHistory:a}=t,o=e.convos.get(r),c=e.ownerId;return o?l(e,{type:"UserOpenedConvoProfile_ConvoRequestCompleted",peerId:r,hasFailed:!1,isLinkWithHistory:a},s):[(0,n._)((function*({api:e}){try{let t;return o||(t=yield e.fetch("messages.getConversationsById",{peer_ids:r.toString(),extended:1,group_id:(0,i.getOwnerGroupId)(c)},{retries:3})),{type:"UserOpenedConvoProfile_ConvoRequestCompleted",peerId:r,hasFailed:!1,convoResponse:t,isLinkWithHistory:a}}catch(e){return{type:"UserOpenedConvoProfile_ConvoRequestCompleted",peerId:r,hasFailed:!0,isLinkWithHistory:a}}}))]}case"UserOpenedConvoProfile_ConvoRequestCompleted":{const{peerId:s,convoResponse:r,hasFailed:l,isLinkWithHistory:p}=t,m=e.ownerId;if(l){if(o.isDev)throw new Error("Не удалось загрузить диалог");return[(0,n._)((function*(){return{type:"Noop"}}))]}r&&((0,i.insertConvos)(e,r.items||[]),(0,i.insertPeers)(e,{apiUsers:r.profiles||[],apiGroups:r.groups||[],apiContacts:r.contacts||[]}));const f=e.convos.get(s);if(!f){if(o.isDev)throw new Error("Диалог не был найден");return[]}const g="ChatConvo"===f.kind&&void 0===f.members&&c.canReadMembers(f)&&!e.locks.getConversationMembers.has(s);g&&e.locks.getConversationMembers.add(s);const v="ChatConvo"===f.kind&&f.acl.canSeeInviteLink;return[g&&a.isChatPeerId(s)&&(h=(0,n._)((function*(){return{type:"LoadChatMembers",peerId:s}})),function(){return h.apply(this,arguments)}),v&&a.isChatPeerId(s)&&(u=(0,n._)((function*({api:e}){try{return{type:"UserOpenedConvoProfile_InviteLinksCompleted",peerId:s,isLinkWithHistory:p,response:yield e.fetch("messages.getInviteLink",{peer_id:s,visible_messages_count:p?d.VISIBLE_MESSAGES_COUNT:0,reset:0,group_id:(0,i.getOwnerGroupId)(m)},{retries:1})}}catch(e){}return{type:"Noop"}})),function(e){return u.apply(this,arguments)})]}case"UserOpenedConvoProfile_InviteLinksCompleted":{const{peerId:s,response:{link:n},isLinkWithHistory:a}=t,o=e.convos.get(s);return o&&"ChatConvo"===o.kind&&n?(c.replaceInviteLinks(o,(0,r._)({},o.inviteLinks,a?{withHistory:n}:{noHistory:n})),[]):[]}default:(0,o.exhaustivenessCheck)(t)}var u,h}},475881:(e,t,s)=>{s.d(t,{handler:()=>d});var n=s(11010),r=s(185327),a=s(777634),o=s(89131),i=s(991792),c=s(453934);const d=(e,t)=>{switch(t.type){case"UserPlayedMessage":{var s;const{cmid:o,peerId:c}=t,d=e.convos.get(c),l=d&&r.findMessageByCmid(d,o),u=e.ownerId;return"Normal"===(null==(s=l)?void 0:s.kind)&&a.canChangeMessagePlayedStatus(l)?[(0,n._)((function*({api:e}){try{return{type:"UserPlayedMessage_RequestCompleted",hasFailed:1!==(yield e.fetch("messages.markAsPlayed",{peer_id:c,cmid:o,group_id:(0,i.getOwnerGroupId)(u)},{retries:1})),cmid:o,peerId:c}}catch(e){return{type:"UserPlayedMessage_RequestCompleted",hasFailed:!0,cmid:o,peerId:c}}}))]:[]}case"UserPlayedMessage_RequestCompleted":if(!t.hasFailed){var d;const{cmid:s,peerId:n}=t,o=e.convos.get(n),i=o&&(0,c.castDraft)(r.findMessageByCmid(o,s));if("Normal"!==(null==(d=i)?void 0:d.kind)||!a.canChangeMessagePlayedStatus(i))return[];i.isPlayed=!0}return[];default:(0,o.exhaustivenessCheck)(t)}}},807331:(e,t,s)=>{s.d(t,{handler:()=>r});var n=s(89131);const r=(e,t)=>{if("UserProfileInfo_Update"===t.type){const{user:s,profileInfo:n}=t;return n&&(e.viewer.profileInfo=n),s&&e.peers.set(s.id,s),[]}(0,n.exhaustivenessCheck)(t.type)}},957046:(e,t,s)=>{s.d(t,{handler:()=>o});var n=s(11010),r=s(89131),a=s(991792);const o=(e,t)=>{switch(t.type){case"UserReadAllReactions":{const{peerId:r}=t;if(e.locks.readAllReactions.has(r))return[];e.locks.readAllReactions.add(r);const o=(0,a.getOwnerGroupId)(e.ownerId),i=e.convos.get(r);let c=new Map;return i&&(c=new Map(i.unreadReactions.entries()),i.unreadReactions.clear()),[(s=(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.markReactionsAsRead",{peer_id:r,cmids:Array.from(c.keys()).join(","),group_id:o});return{type:"UserReadAllReactions_RequestCompleted",peerId:r,hasFailed:1!==t,unreadReactions:c}}catch(e){return{type:"UserReadAllReactions_RequestCompleted",peerId:r,hasFailed:!0,unreadReactions:c}}})),function(e){return s.apply(this,arguments)})]}case"UserReadAllReactions_RequestCompleted":{const{hasFailed:s,peerId:n,unreadReactions:r}=t;if(e.locks.readAllReactions.delete(n),!s)return[];const a=e.convos.get(n);return a&&(a.unreadReactions=new Map([...r,...a.unreadReactions])),[]}default:return(0,r.exhaustivenessCheck)(t)}var s}},262641:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(89131),a=s(83062),o=s(839963);const i=(e,t)=>{switch(t.type){case"UserReadPost":{const{cmid:s,channelId:n}=t,r=e.channels.get(n);if(!r)return[];if("ChannelRestricted"===r.kind)return[];if(s<=r.inReadCmid)return[];o.readUntil(r,s),a.refreshChannels(e.organisers,r);const i=e.channelReadQueues.has(n);return e.channelReadQueues.set(n,r.inReadCmid),i?[]:[c(n)]}case"UserReadPost_ThrottleTimedOut":{const{channelId:r}=t,a=e.channelReadQueues.get(r);return a?[(s=(0,n._)((function*({api:e}){try{yield e.fetch("channels.markAsRead",{channel_id:r,last_read_cmid:a})}catch(e){}return{type:"UserReadPost_RequestCompleted",channelId:r,readUntilCmid:a}})),function(e){return s.apply(this,arguments)})]:[]}case"UserReadPost_RequestCompleted":{const{channelId:s,readUntilCmid:n}=t,r=e.channelReadQueues.get(s);return r?n>=r?(e.channelReadQueues.delete(s),[]):[c(s)]:[]}default:return(0,r.exhaustivenessCheck)(t)}var s};function c(e){return t=(0,n._)((function*(){return yield(0,r.sleep)(300),{type:"UserReadPost_ThrottleTimedOut",channelId:e}})),function(){return t.apply(this,arguments)};var t}},328079:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(999504),a=s(89131),o=s(927411);const i=(e,t)=>{switch(t.type){case"UserReorderedFolders":{const{order:a}=t;return e.locks.reorderFolders?[]:(e.locks.reorderFolders=!0,r.reorderFolders(e.organisers.folders,a),[(s=(0,n._)((function*({api:e}){try{return{type:"UserReorderedFolders_ReorderRequestCompleted",hasFailed:1!==(yield e.fetch("messages.reorderFolders",{folder_ids:a.join(",")})),order:a}}catch(e){let t;return e instanceof o.IApi.RequestError&&(t=e.code),{type:"UserReorderedFolders_ReorderRequestCompleted",hasFailed:!0,error:t,order:a}}})),function(e){return s.apply(this,arguments)})])}case"UserReorderedFolders_ReorderRequestCompleted":{const{hasFailed:s}=t;if(e.locks.reorderFolders=!1,s){if(t.error);else if(a.isDev)throw new Error("Не удалось изменить порядок папок");return[]}return[]}default:(0,a.exhaustivenessCheck)(t)}var s}},863536:(e,t,s)=>{s.d(t,{VISIBLE_MESSAGES_COUNT:()=>c,handler:()=>d});var n=s(11010),r=s(434788),a=s(89131),o=s(185327),i=s(991792);const c=250,d=(e,t)=>{switch(t.type){case"UserRequestChatInvitationLink":{const{peerId:s,isLinkWithHistory:r}=t,a=e.ownerId;return[(d=(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.getInviteLink",{peer_id:s,reset:0,visible_messages_count:r?c:0,group_id:(0,i.getOwnerGroupId)(a)},{retries:1});return{type:"UserRequestChatInvitationLink_RequestCompleted",hasFailed:!t.link,link:t.link,isLinkWithHistory:r,peerId:s}}catch(e){return{type:"UserRequestChatInvitationLink_RequestCompleted",hasFailed:!0,isLinkWithHistory:r,peerId:s}}})),function(e){return d.apply(this,arguments)})]}case"UserRequestChatInvitationLink_RequestCompleted":{const{peerId:s,link:n,isLinkWithHistory:a,hasFailed:i}=t,c=e.convos.get(s);return!i&&c&&"ChatConvo"===c.kind&&n?(o.replaceInviteLinks(c,(0,r._)({},c.inviteLinks,a?{withHistory:n}:{noHistory:n})),[]):[]}case"UserResetChatInvitationLink":{const{peerId:s}=t,r=e.ownerId;return[function(){var e=(0,n._)((function*({api:e}){try{const t=yield e.fetch("messages.getInviteLink",{peer_id:s,reset:1,visible_messages_count:c,group_id:(0,i.getOwnerGroupId)(r)},{retries:1}),n=yield e.fetch("messages.getInviteLink",{peer_id:s,reset:0,visible_messages_count:0,group_id:(0,i.getOwnerGroupId)(r)},{retries:1});return{type:"UserResetChatInvitationLink_RequestCompleted",hasFailed:!t.link||!n.link,links:{withHistory:t.link,noHistory:n.link},peerId:s}}catch(e){return{type:"UserResetChatInvitationLink_RequestCompleted",hasFailed:!0,peerId:s,links:{}}}}));return function(t){return e.apply(this,arguments)}}()]}case"UserResetChatInvitationLink_RequestCompleted":{var s;const{peerId:n,links:r,hasFailed:a}=t,i=e.convos.get(n);return a||"ChatConvo"!==(null==(s=i)?void 0:s.kind)?[]:r.noHistory&&r.withHistory?(o.replaceInviteLinks(i,r),[]):[]}default:return(0,a.exhaustivenessCheck)(t)}var d}},741497:(e,t,s)=>{s.d(t,{handler:()=>u});var n=s(11010),r=s(89131),a=s(95154),o=s(839963),i=s(86144),c=s(168465),d=s(54965),l=s(991792);const u=(e,t)=>{switch(t.type){case"UserScrolledChannelHistory":{const{channelId:o,direction:i,startCmid:c,possibleSkipped:d}=t,l=e.channels.get(o);if(!l)return[];if("ChannelRestricted"===l.kind)return[];if(e.locks.getChannelHistory.has(o))return[];e.locks.getChannelHistory.add(o);let u,h=Math.min(a.POSTS_PER_PAGE,d||a.POSTS_PER_PAGE)+2;switch(i){case"backward":u=-1;break;case"forward":u=1-h;break;case"around":h=a.POSTS_PER_PAGE,u=-Math.floor(.8*h),l.inReadCmid===c&&(u=Math.max(-l.unreadCount,u));break;default:(0,r.exhaustivenessCheck)(i)}return[(s=(0,n._)((function*({api:e}){try{const t=yield e.fetch("channels.getHistory",{channel_id:o,start_cmid:Math.max(c,1),count:h,offset:u,extended:1},{retries:5});let s,n;switch(i){case"backward":s=h===t.items.length,n=!0;break;case"around":{const e=t.items.filter((({cmid:e})=>e<=c)).length;s=e===h+u;const r=t.items.length-e;n=r===-u;break}case"forward":s=!0,n=h===t.items.length;break;default:(0,r.exhaustivenessCheck)(i)}return{type:"UserScrolledChannelHistory_RequestSucceed",channelId:o,response:t,hasMoreBackward:s,hasMoreForward:n}}catch(e){return{type:"UserScrolledChannelHistory_RequestFailed",channelId:o}}})),function(e){return s.apply(this,arguments)})]}case"UserScrolledChannelHistory_RequestSucceed":{const{channelId:s,response:n,hasMoreBackward:r,hasMoreForward:a}=t;e.locks.getChannelHistory.delete(s);const u=e.channels.get(s);if(!u)return[];if("ChannelRestricted"===u.kind)return[];const h=[];return n.items.reverse().forEach(((t,s,n)=>{const{post:o,reactions:l}=(0,d.fromApiPost)(t);l.forEach((t=>{e.reactions.set(t.id,t)})),0===s&&o.cmid>1&&r&&h.push({kind:"GapNode",fromCmid:i.resolveCmid(1),toCmid:i.resolveCmid(o.cmid-1)}),h.push({kind:"Node",item:o});const p=c.lastCmid(u.history);s===n.length-1&&void 0!==p&&a&&o.cmid<p&&h.push({kind:"GapNode",fromCmid:i.resolveCmid(o.cmid+1),toCmid:i.resolveCmid(p)})})),o.insertPosts(u,h),(0,l.insertPeers)(e,{apiUsers:n.profiles||[],apiGroups:n.groups||[],apiContacts:[]}),[]}case"UserScrolledChannelHistory_RequestFailed":{const{channelId:s}=t;return e.locks.getChannelHistory.delete(s),[]}default:return(0,r.exhaustivenessCheck)(t)}var s}},527600:(e,t,s)=>{s.d(t,{handler:()=>l});var n=s(11010),r=s(89131),a=s(185327),o=s(777634),i=s(95154),c=s(991792),d=s(481186);const l=(e,t)=>{switch(t.type){case"UserScrolledConvoHistory":{const{peerId:a,direction:d,startCmid:l,possibleSkipped:h}=t,p=e.ownerId,m=e.convos.get(a);if(!m)return[];const f=u(a,l);if(e.locks.getHistory.has(f))return[];e.locks.getHistory.add(f);let g,v=Math.min(i.MESSAGES_PER_PAGE,h||i.MESSAGES_PER_PAGE)+2;switch(d){case"backward":g=-1;break;case"forward":g=1-v;break;case"around":v=i.MESSAGES_PER_PAGE,g=-Math.floor(.8*v),m.inReadBy===l&&(g=Math.max(-m.unreadCount,g));break;default:(0,r.exhaustivenessCheck)(d)}return[(s=(0,n._)((function*({api:e,logger:t}){try{var s,n;const i=yield e.fetch("messages.getHistory",{peer_id:a,start_cmid:l,count:v,offset:g,extended:1,group_id:(0,c.getOwnerGroupId)(p),fwd_extended:1},{retries:5});let u,h;switch(d){case"backward":u=v===i.items.length,h=!0;break;case"around":{const e=i.items.filter((({conversation_message_id:e})=>o.resolveCmid(e)<=l)).length;u=e===v+g;const t=i.items.length-e;h=t===-g;break}case"forward":u=!0,h=v===i.items.length;break;default:(0,r.exhaustivenessCheck)(d)}return t.info("load convo history, has more: ",u,h,d," cmids: start ",l,"boundaries: ",null==(s=i.items[0])?void 0:s.conversation_message_id,null==(n=i.items[i.items.length-1])?void 0:n.conversation_message_id),{type:"UserScrolledConvoHistory_RequestSucceed",response:i,peerId:a,startCmid:l,hasMoreBackward:u,hasMoreForward:h}}catch(e){return{type:"UserScrolledConvoHistory_RequestFailed",peerId:a,startCmid:l}}})),function(e){return s.apply(this,arguments)})]}case"UserScrolledConvoHistory_RequestSucceed":{const{peerId:s,startCmid:n,response:r,hasMoreBackward:o,hasMoreForward:i}=t;e.locks.getHistory.delete(u(s,n));const l=e.convos.get(s);if(!l)return[];const h=r.items.map((e=>(0,d.fromApiMessage)(e).message));return a.insertMessages(l,h,{backward:o,forward:i}),(0,c.insertPeers)(e,{apiUsers:r.profiles||[],apiGroups:r.groups||[],apiContacts:[]}),[]}case"UserScrolledConvoHistory_RequestFailed":{const{peerId:s,startCmid:n}=t;return e.locks.getHistory.delete(u(s,n)),[]}default:(0,r.exhaustivenessCheck)(t)}var s};function u(e,t){return`${e}-${t}`}},688088:(e,t,s)=>{s.d(t,{handler:()=>a});var n=s(11010),r=s(89131);const a=(e,t)=>{switch(t.type){case"UserSeenHelpHint":return e.helpHints.delete(t.hintId)?[(s=(0,n._)((function*({api:e}){try{return{type:"UserSeenHelpHint_RequestCompleted",hasFailed:1!==(yield e.fetch("account.hideHelpHint",{hint_id:t.hintId},{retries:1}))}}catch(e){return{type:"UserSeenHelpHint_RequestCompleted",hasFailed:!0}}})),function(e){return s.apply(this,arguments)})]:[];case"UserSeenHelpHint_RequestCompleted":return[];default:(0,r.exhaustivenessCheck)(t)}var s}},876107:(e,t,s)=>{s.d(t,{handler:()=>d});var n=s(11010),r=s(89131),a=s(185327),o=s(83062),i=s(168465),c=s(991792);const d=(e,t,s)=>{switch(t.type){case"UserSeenMessages":{const{fromCmid:s,toCmid:n,peerId:r}=t,c=e.convos.get(r);if(!c)return[];const d=i.around(c.history,s);if(void 0===d)return[];const u=d.nodes.reduce(((e,t)=>{const s="Node"===t.kind?t.item:void 0;return void 0!==s&&s.cmid>e&&s.cmid<=n&&!s.isOut&&(e=s.cmid),e}),s),h=c.inReadBy;a.readInUntil(c,u);const p=[...c.unreadReactions.keys()].filter((e=>e>=s&&e<=n));if(c.inReadBy===h&&0===p.length)return[];p.forEach((e=>a.readReactions(c,e))),o.refresh(e.organisers,c);const m=e.readQueues.get(r);return m?(m.inReadBy=c.inReadBy,p.forEach((e=>m.reactions.add(e))),[]):(e.readQueues.set(r,{inReadBy:c.inReadBy,reactions:new Set(p)}),[l(r,h)])}case"UserSeenMessages_ThrottleTimedOut":{const{peerId:r,prevInReadBy:a}=t;if(!e.convos.get(r))return e.readQueues.delete(r),[];const o=e.readQueues.get(r);if(!o)return[];const i=[];for(let e of o.reactions)if(i.push(e),o.reactions.delete(e),100===i.length)break;const l=o.inReadBy,h=e.ownerId,p=a<l,m=!1!==s.vkm_reactions&&i.length>0;return p||m?[(u=(0,n._)((function*({api:e}){try{yield e.fetchMany([p&&{method:"messages.markAsRead",params:{peer_id:r,up_to_cmid:l,mark_conversation_as_read:1,group_id:(0,c.getOwnerGroupId)(h)}},m&&{method:"messages.markReactionsAsRead",params:{peer_id:r,cmids:i.join(","),group_id:(0,c.getOwnerGroupId)(h)}}])}catch(e){}return{type:"UserSeenMessages_RequestCompleted",peerId:r,readUntilCmid:l}})),function(e){return u.apply(this,arguments)})]:d(e,{type:"UserSeenMessages_RequestCompleted",peerId:r,readUntilCmid:l},s)}case"UserSeenMessages_RequestCompleted":{const{peerId:s,readUntilCmid:n}=t;if(!e.convos.get(s))return[];const r=e.readQueues.get(s);return r?r.inReadBy<=n&&0===r.reactions.size?(e.readQueues.delete(s),[]):[l(s,n)]:[]}default:return(0,r.exhaustivenessCheck)(t)}var u};function l(e,t){return s=(0,n._)((function*(){return yield(0,r.sleep)(500),{type:"UserSeenMessages_ThrottleTimedOut",prevInReadBy:t,peerId:e}})),function(){return s.apply(this,arguments)};var s}},416947:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(89131),a=s(86144),o=s(839963);const i=(e,t)=>{switch(t.type){case"UserSeenPost":{const{posts:s,channelId:n}=t,r=e.channels.get(n);if(!r)return[];if("ChannelRestricted"===r.kind)return[];const i=0===e.seenPostsStatsQueues.posts.size&&0===e.seenPostsStatsQueues.reposts.size&&!e.locks.seenPostsStatsSend,d=(t,s,n)=>{e.seenPosts[n].has(t)||e.seenPosts[n].set(t,new Set);const r=e.seenPosts[n].get(t);var a;r&&!r.has(s)&&(r.add(s),e.seenPostsStatsQueues[n].has(t)||e.seenPostsStatsQueues[n].set(t,new Set),null==(a=e.seenPostsStatsQueues[n].get(t))||a.add(s),r.size>=60&&e.seenPosts[n].set(t,new Set(Array.from(r).slice(-30))))};return s.forEach((e=>{if(d(n,e.cmid,"posts"),e.attaches.wall&&o.isChannelId(e.attaches.wall.authorId)){const t=o.resolveId(e.attaches.wall.authorId),s=a.resolveCmid(e.attaches.wall.id);d(t,s,"reposts")}})),[i&&(0!==e.seenPostsStatsQueues.posts.size||0!==e.seenPostsStatsQueues.reposts.size)&&c()]}case"UserSeenPost_ThrottleTimedOut":{e.locks.seenPostsStatsSend=!0;const t=[];e.seenPostsStatsQueues.posts.forEach(((e,s)=>{t.push(...d(s,e))})),e.seenPostsStatsQueues.posts=new Map;const r=[];return e.seenPostsStatsQueues.reposts.forEach(((e,t)=>{r.push(...l(t,e))})),e.seenPostsStatsQueues.reposts=new Map,[(s=(0,n._)((function*({api:e}){try{yield e.fetch("stats.trackEvents",{events:JSON.stringify([{e:"view_post",post_ids:t,repost_ids:r}])})}catch(e){}return{type:"UserSeenPost_RequestCompleted"}})),function(e){return s.apply(this,arguments)})]}case"UserSeenPost_RequestCompleted":return 0===e.seenPostsStatsQueues.posts.size&&0===e.seenPostsStatsQueues.reposts.size?(e.locks.seenPostsStatsSend=!1,[]):[c()];default:return(0,r.exhaustivenessCheck)(t)}var s};function c(){return e=(0,n._)((function*(){return yield(0,r.sleep)(2e3),{type:"UserSeenPost_ThrottleTimedOut"}})),function(){return e.apply(this,arguments)};var e}const d=(e,t)=>Array.from(t).map((t=>`${e}_${t}|wall|im_channels|0`)),l=(e,t)=>Array.from(t).map((t=>`${e}_${t}`))},37425:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(89131),a=s(185327),o=s(991792);const i=(e,t)=>{switch(t.type){case"UserSetMessageReaction":{const{peerId:s,cmid:r,reactionId:d}=t,l=e.convos.get(s);if(!l)return[];const u=a.findMessageByCmid(l,r);if(!u||"Normal"!==u.kind)return[];const h=u.reactionId,p=e.ownerId;return c(u,d,e.ownerId),[(i=(0,n._)((function*({api:e}){try{return{type:"UserSetMessageReaction_RequestCompleted",hasFailed:1!==(yield e.fetch("messages.sendReaction",{cmid:r,peer_id:s,reaction_id:d,group_id:(0,o.getOwnerGroupId)(p)})),cmid:r,peerId:s,reactionId:d,prevReactionId:h}}catch(e){return{type:"UserSetMessageReaction_RequestCompleted",hasFailed:!0,cmid:r,peerId:s,reactionId:d,prevReactionId:h}}})),function(e){return i.apply(this,arguments)})]}case"UserSetMessageReaction_RequestCompleted":{const{hasFailed:s,peerId:n,cmid:r,prevReactionId:o}=t;if(!s)return[];const i=e.convos.get(n);if(!i)return[];const d=a.findMessageByCmid(i,r);return d&&"Normal"===d.kind?(c(d,o,e.ownerId),[]):[]}case"UserUnsetMessageReaction":{const{peerId:r,cmid:i}=t,d=e.convos.get(r);if(!d)return[];const l=a.findMessageByCmid(d,i);if(!l||"Normal"!==l.kind||!l.reactionId)return[];const u=l.reactionId,h=e.ownerId;return c(l,void 0,e.ownerId),[(s=(0,n._)((function*({api:e}){try{return{type:"UserUnsetMessageReaction_RequestCompleted",hasFailed:1!==(yield e.fetch("messages.deleteReaction",{cmid:i,peer_id:r,group_id:(0,o.getOwnerGroupId)(h)})),cmid:i,peerId:r,reactionId:u}}catch(e){return{type:"UserUnsetMessageReaction_RequestCompleted",hasFailed:!0,cmid:i,peerId:r,reactionId:u}}})),function(e){return s.apply(this,arguments)})]}case"UserUnsetMessageReaction_RequestCompleted":{const{hasFailed:s,peerId:n,cmid:r,reactionId:o}=t;if(!s)return[];const i=e.convos.get(n);if(!i)return[];const d=a.findMessageByCmid(i,r);return d&&"Normal"===d.kind?(c(d,o,e.ownerId),[]):[]}default:(0,r.exhaustivenessCheck)(t)}var s,i};function c(e,t,s){const n=e.reactionId;if(e.reactionId=t,n){const t=e.reactions.get(n);if(!t&&r.isDev)throw new Error("Реакция не найдена в списке реакций сообщения");t&&(t.count<=1?e.reactions.delete(n):(t.count-=1,t.peerIds.delete(s)))}if(t){const n=e.reactions.get(t);n?(n.count+=1,n.peerIds=new Set([s,...n.peerIds])):e.reactions.set(t,{reactionId:t,count:1,peerIds:new Set([s])})}}},166358:(e,t,s)=>{s.d(t,{handler:()=>i});var n=s(11010),r=s(999504),a=s(89131),o=s(991792);const i=(e,t)=>{switch(t.type){case"UserUpdatedFolder":{const{folderId:s,name:n,addPeerIds:a,removePeerIds:i}=t;if(e.locks.updateFolder.has(s))return[];if(function(e,t){if(new Set([...e].filter((e=>t.has(e)))).size)return!0;return!1}(a,i))throw new Error("Peer id не может одновременно находиться в списке на добавление и на удаление");e.locks.updateFolder.add(s);const d=e.organisers.folders.find((e=>e.id===s));if(!d)return[];const l=(0,o.getConvosByIds)(e,Array.from(i)),u=(0,o.getConvosByIds)(e,Array.from(a));return n&&r.setName(d,n),(0,o.removeConvosFromFolder)(e,d.id,l),(0,o.addConvosToFolder)(e,d.id,u),[c(s,n,a,i)]}case"UserUpdatedFolder_UpdateRequestCompleted":{const{hasFailed:s,folderId:n}=t;if(e.locks.updateFolder.delete(n),s&&a.isDev)throw new Error("Не удалось изменить папку");return[]}default:(0,a.exhaustivenessCheck)(t)}};function c(e,t,s,r){return a=(0,n._)((function*({api:n}){let a=!1;const o={folder_id:e};t&&(o.name=t),s.size&&(o.add_included_peer_ids=[...s].join(",")),r.size&&(o.remove_included_peer_ids=[...r].join(","));try{a=1!==(yield n.fetch("messages.updateFolder",o))}catch(e){a=!0}return{type:"UserUpdatedFolder_UpdateRequestCompleted",hasFailed:a,folderId:e,addPeerIds:s,removePeerIds:r,name:t}})),function(e){return a.apply(this,arguments)};var a}},296078:(e,t,s)=>{s.d(t,{handler:()=>a});var n=s(11010),r=s(89131);const a=(e,t)=>{switch(t.type){case"VideoMessageShapesGetById":{var s;const{shapeId:r}=t;return e.locks.getVideoMessageShapesById.has(r)||(null==(s=e.videoMessageShapes)?void 0:s.has(r))?[]:(e.locks.getVideoMessageShapesById.add(r),[(o=(0,n._)((function*({api:e,storage:t}){const s=t.get("videomessage-shapes");s&&(s.expiresAt=0);try{const t=yield e.fetch("messages.getVideoMessageShapesByIds",{ids:r.toString()});return{type:"VideoMessageShapesGetById__RequestCompleted",shapeId:r,response:t,hasFailed:!Boolean(t)}}catch(e){return{type:"VideoMessageShapesGetById__RequestCompleted",shapeId:r,response:null,hasFailed:!0}}})),function(e){return o.apply(this,arguments)})])}case"VideoMessageShapesGetById__RequestCompleted":{const{response:s,shapeId:n}=t;if(e.locks.getVideoMessageShapesById.delete(n),!s)return[];const r=s.shapes.reduce(((e,t)=>(e.set(t.id,t.raw_path),e)),new Map);var a;return e.videoMessageShapes=new Map([...null!=(a=e.videoMessageShapes)?a:[],...r]),[]}default:return(0,r.exhaustivenessCheck)(t)}var o}},378002:(e,t,s)=>{s.d(t,{createStore:()=>o});var n=s(136517),r=s(89131),a=s(733818);function o(e,t,s=a.initial,o,c,d,l){let u=!1;const h=r.isDev&&(0,n.devTools)();let p=[],[m,f]=s(t,o,c,d,l);h&&h.init(m);const g=s=>{if(!u)throw new Error("Стор еще не был активирован. Нужно вызвать store.start().");const[n,r]=(0,a.reducer)(m,s,t);h&&h.send(s,n);const o=m!==n;if(m=n,i(g,r,e),o)for(const e of p)e(n)};return{start:()=>{u||(u=!0,i(g,f,e))},dispatch:g,subscribe:e=>(p.push(e),()=>{p=p.filter((t=>t!==e))}),featureFlags:t,getState:()=>m}}function i(e,t,s){0!==t.length&&setTimeout((()=>{for(const n of t)"function"==typeof n&&n(s).then(e).catch((e=>{s.logger.error("Необработанная ошибка редьюсера",e)}))}))}},136517:(e,t,s)=>{function n(){return"undefined"!=typeof window&&"__REDUX_DEVTOOLS_EXTENSION__"in window?window.__REDUX_DEVTOOLS_EXTENSION__.connect({serialize:{options:{map:!0,set:!0}}}):null}s.d(t,{devTools:()=>n})},733818:(e,t,s)=>{s.d(t,{IMPORTANT_USERS_COUNT:()=>Be,initial:()=>Fe,reducer:()=>qe});var n=s(11010),r=s(434788),a=s(453934),o=s(474582),i=s(991792),c=s(89131),d=s(83062),l=s(498928),u=s(999504),h=s(452788),p=s(185327),m=s(96190),f=s(777634),g=s(400681),v=s(559360),_=s(839963),C=s(86144),y=s(821551),k=s(709646),I=s(504698),w=s(882670),M=s(95154),R=s(597990),b=s(273971),S=s(109424),E=s(876107),U=s(733835),P=s(500156),A=s(664061),T=s(490469),N=s(526025),x=s(619444),F=s(708807),q=s(959630),O=s(203677),L=s(382379),D=s(397384),B=s(192241),H=s(475881),G=s(688088),V=s(598801),z=s(115804),j=s(427418),K=s(395911),W=s(791175),$=s(623022),Q=s(666840),Z=s(61448),Y=s(694598),J=s(166358),X=s(351447),ee=s(328079),te=s(741497),se=s(708315),ne=s(541222),re=s(863536),ae=s(339962),oe=s(735130),ie=s(584781),ce=s(12190),de=s(416947),le=s(262641),ue=s(4854),he=s(807331),pe=s(464474),me=s(967819),fe=s(29064),ge=s(939903),ve=s(623267),_e=s(43109),Ce=s(601289),ye=s(695247),ke=s(296078),Ie=s(573610),we=s(228153),Me=s(37425),Re=s(565321),be=s(637467),Se=s(978758),Ee=s(553977),Ue=s(972284),Pe=s(446869),Ae=s(527600),Te=s(957046),Ne=s(954811),xe=s(628010);const Fe=(e,t,s,a,o)=>{var i,c;const l=m.resolveId(t),u=s?m.resolveId(s):void 0;if(!m.isUserPeerId(l))throw Error("Viewer может быть только пользователем");if(void 0!==u&&!m.isUserPeerId(u)&&!m.isGroupPeerId(u))throw Error("Owner может быть только пользователем или группой");const h=(0,R.fromApiProfileType)(a),p={convoConn:{status:"loading",pts:0},channelConn:{status:"running",ts:0},viewer:{id:l,profileType:h,settings:{ctrSubmit:!1,soundNotifications:!0,browserNotifications:!1,showRecommendations:!0,countOnlyNotMuted:!1,autoUnarchive:!0,transcriptAutoShow:!0,theme:"system",verticalFoldersView:!1,messageReactionAnimation:!0,businessNotify:!1,push:k.VIEWER_DEFAULT_PUSH_SETTINGS,teacherVerification:!1,rightClickActionsEnabled:!1,messageSelfMentionHighlighting:"none",eduAccountSwitchBanner:!0,autoExtendReactionPicker:!1},profileInfo:{id:l},accounts:[]},ownerId:m.resolveId(),organisers:d.empty(),channels:new Map([[_.resolveId(0),{kind:"Channel",id:_.resolveId(0),name:"",description:[],activity:"",adminLevel:0,isVerified:!1,photos:{},inReadCmid:C.resolveCmid(0),unreadCount:0,isArchived:!1,isRepostsDisabled:!1,isMuted:!1,notificationsDisabledUntil:0,majorSortId:0,minorSortId:0,membersCount:0,isMember:!1,canSendDonut:!1,pending:{},locks:{loading:!1,cleanUp:0},history:{confirmed:[],pending:[]}}]]),convos:new Map([[m.resolveId(),{kind:"UserConvo",peerId:m.resolveId(),unreadCount:0,majorSortId:0,minorSortId:0,inReadBy:f.resolveCmid(0),outReadBy:f.resolveCmid(0),isNew:!1,folderIds:new Set,isMarkedUnread:!1,isArchived:!1,canWrite:{allowed:!1,reason:"unknown"},push:{mode:"everything",disabledUntil:0},unreadExpireables:new Set,unreadReactions:new Map,entrypoint:null,history:{confirmed:[],pending:[]}}]]),composerDrafts:{},channelComposerDrafts:{},readQueues:new Map,seenPosts:{posts:new Map,reposts:new Map},seenPostsStatsQueues:{posts:new Map,reposts:new Map},channelReadQueues:new Map,peers:new Map([[m.resolveId(),{kind:"User",id:m.resolveId(),firstName:"...",firstNameGen:"...",firstNameAcc:"...",lastName:"...",lastNameGen:"...",lastNameAcc:"...",sex:"unknown",isVerified:!1,canCall:!0,followersCount:0,canChangeFriendship:!1,canMessage:!1,friendship:"unfamiliar",isBlacklisted:!1,isBlacklistedByMe:!1,isDeactivated:!1,canInviteToChats:!1}]]),lastSeens:new Map,typings:new Map,convosSearchIndex:y.create(),locks:{getConversations:{all:!1,unread:!1,archive:!1,messageRequest:!1},getChannels:{all:!1,unread:!1},hideFilter:{all:!1,unread:!1,chats:!1,archive:!1,messageRequest:!1,businessNotify:!1},getHistory:new Set,getConversationMembers:new Set,getConversationInfo:new Set,sendQueue:new Map,edit:new Set,convosCleanup:new Map,channelsCleanup:new Map,updateFriendshipOrMembership:new Set,convoActions:new Set,messageActions:new Set,channelActions:new Set,channelPostActions:new Set,settings:new Set,contactList:!1,newFolder:!1,deleteFolder:new Set,updateFolder:new Set,reorderFolders:!1,getChannelHistory:new Set,changeMessageRequest:new Set,getPostCommentsHistory:new Set,likeActions:new Set,commentActions:new Set,getVideoMessageShapesById:new Set,loadStickers:new Set,seenPostsStatsSend:!1,invalidateMessageReactions:!1,loadStickersKeywords:!1,loadStickerPacks:!1,readAllReactions:new Set},hiddenPinnedMessages:new Map,helpHints:new Set,stickers:new Map,stickersKeywords:{},contacts:{items:new Map,contacts:new Map,hasMore:!0},importantMessages:{messages:new Map,hasMore:!0},hiddenBotKeyboards:new Set,reactions:new Map,messageReactions:new Map,importantUsers:null,videoMessageShapes:null,activeCallsCount:0,messageReactedPeers:new Map};if(0===l)return[p,[]];const g=void 0!==o&&(null==(i=o.viewer)?void 0:i.id)===l&&(null==(c=o.viewer)?void 0:c.profileType)===h&&(void 0===u||o.ownerId===u);return[g?(0,r._)({},p,o):p,[(v=(0,n._)((function*({storage:e,stats:t}){return e.identify(l),t.init(),{type:"Noop"}})),function(e){return v.apply(this,arguments)}),()=>Promise.resolve({type:"InitialData",ownerId:u,withCache:g}),(0,n._)((function*({api:e,storage:t}){const s=yield function(e){return De.apply(this,arguments)}({api:e,storage:t});return{type:"LoadVideoMessageShapes_RequestCompleted",videoMessageShapes:s}})),(0,n._)((function*(){return e.vkm_reactions?{type:"InvalidateMessageReactions"}:{type:"Noop"}}))]];var v};function qe(e,t,s){if("TemporaryHackForResync"===t.type)return Fe(s,e.viewer.id,e.ownerId,"edu"===e.viewer.profileType?2:0);const r=(0,a.createDraft)(e);let o;switch(t.type){case"Noop":o=[];break;case"InitialData":case"InitialData_RequestCompleted":case"InitialDataWithCached_RequestCompleted":case"InitialData_ChannelsReadyForUse":case"QueueConfigAndUsersFromSearch_RequestCompleted":o=Oe(r,t,s);break;case"LoadVideoMessageShapes_RequestCompleted":o=Le(r,t,s);break;case"EngineBatchReceived":case"EngineBatchReceived_TypingsTimedOut":case"UpdateMessageRequestsCounter":case"UpdateMessageRequestsCounter_RequestCompleted":o=P.handler(r,t,s);break;case"ChannelEngineBatchReceived":o=A.handler(r,t,s);break;case"QueueBatchReceived":o=B.handler(r,t,s);break;case"MoreConvosNeeded":case"MoreConvosNeeded_RequestCompleted":o=O.handler(r,t,s);break;case"MoreChannelsNeeded":case"MoreChannelsNeeded_RequestCompleted":o=L.handler(r,t,s);break;case"CacheUpdateReceived":o=D.handler(r,t,s);break;case"UserSeenMessages":case"UserSeenMessages_ThrottleTimedOut":case"UserSeenMessages_RequestCompleted":o=E.handler(r,t,s);break;case"UserHitSend":case"UserHitSend_RequestCompleted":case"UserHitResendAllFailedMessages":case"ResendAllFailedMessages":case"UserHitResendFailedMessage":case"UserHitSendWidget":o=b.handler(r,t,s);break;case"UserHitEdit":case"UserHitEdit_RequestCompleted":o=S.handler(r,t,s);break;case"UserOpenedConvo":case"UserClosedConvo":case"UserOpenedConvo_ConvoRequestCompleted":case"UserOpenedConvo_StickersKeywordsRequestCompleted":case"UserOpenedConvo_StickerPacksRequestCompleted":o=U.handler(r,t,s);break;case"LoadStickers":case"LoadStickers_RequestCompleted":o=we.handler(r,t,s);break;case"UserChangedFriendship":case"UserChangedFriendship_RequestCompleted":o=F.handler(r,t,s);break;case"UserChangedGroupMembership":case"UserChangedGroupMembership_RequestCompleted":o=q.handler(r,t,s);break;case"UserChangedSetting":case"UserChangedSetting_RequestCompleted":o=T.handler(r,t,s);break;case"SettingThemeUpdated":case"SettingThemeUpdated_RequestCompleted":o=N.handler(r,t,s);break;case"SettingExperimentalUpdated":case"SettingExperimentalUpdated_RequestCompleted":o=x.handler(r,t,s);break;case"UserPlayedMessage":case"UserPlayedMessage_RequestCompleted":o=H.handler(r,t,s);break;case"UserSeenHelpHint":case"UserSeenHelpHint_RequestCompleted":o=G.handler(r,t,s);break;case"UserChangedConvo":case"UserChangedConvo_RequestCompleted":case"UserPinMessage":case"UserPinMessage_RequestCompleted":case"UserUnpinMessage":case"UserUnpinMessage_RequestCompleted":case"UserChangedMute":case"UserChangedMute_RequestCompleted":case"UserChangedBusinessNotify":case"UserChangedBusinessNotify_RequestCompleted":case"UserChangeForbidWritingAll":case"UserChangeForbidWritingAll_RequestCompleted":o=V.handler(r,t,s);break;case"UserChangedMessage":case"UserChangedMessage_RequestCompleted":case"UserDeleteMessage":case"UserDeleteMessage_RequestCompleted":case"UserDeleteFailedMessage":case"UserDeleteAllFailedMessage":case"UserRestoreMessage":case"UserRestoreMessage_RequestCompleted":o=z.handler(r,t,s);break;case"LoadContactList":case"LoadContactList_RequestCompleted":o=j.handler(r,t,s);break;case"UserHideFilter":case"UserHideFilter_Completed":case"UserUndoHideFilter":case"UserActualizeHideFilter":o=W.handler(r,t,s);break;case"UserAcceptedChatMessageRequest":case"UserRejectedMessageRequest":case"UserAcceptedChatMessageRequest_RequestCompleted":case"UserRejectedChatMessageRequest_RequestCompleted":o=K.handler(r,t,s);break;case"UserChangedChatTitle":case"UserChangedChatDescription":case"UserChangedChatTitle_RequestCompleted":case"UserChangedChatDescription_RequestCompleted":case"UserRemovedChatPhoto":case"UserSetChatPhoto":case"UserRemovedChatPhoto_RequestCompleted":case"UserChangedChatSettings":case"UserChangedChatSettings_RequestCompleted":o=$.handler(r,t,s);break;case"UserOpenedConvoProfile":case"UserOpenedConvoProfile_ConvoRequestCompleted":case"UserOpenedConvoProfile_InviteLinksCompleted":o=Q.handler(r,t,s);break;case"LoadImportantMessages":case"LoadImportantMessages_RequestCompleted":case"UserClosedImportantMessages":o=Z.handler(r,t,s);break;case"UserCreatedFolder":case"UserCreatedFolder_CreateRequestCompleted":o=Y.handler(r,t,s);break;case"UserUpdatedFolder":case"UserUpdatedFolder_UpdateRequestCompleted":o=J.handler(r,t,s);break;case"UserDeletedFolder":case"UserDeletedFolder_DeleteRequestCompleted":o=X.handler(r,t,s);break;case"UserReorderedFolders":case"UserReorderedFolders_ReorderRequestCompleted":o=ee.handler(r,t,s);break;case"UserScrolledChannelHistory":case"UserScrolledChannelHistory_RequestSucceed":case"UserScrolledChannelHistory_RequestFailed":o=te.handler(r,t,s);break;case"UserOpenedChannel":case"UserClosedChannel":case"UserOpenedChannel_ChannelRequestCompleted":o=se.handler(r,t,s);break;case"ConvoMediaViewerCacheRemoved":case"ConvoMediaViewerCacheInserted":case"ConvoMediaViewerCacheSetHasNext":case"ConvoMediaViewerCacheSetHasPrev":o=ue.handler(r,t,s);break;case"UserChangedChatMember":case"UserChangedChatMember_RequestCompleted":o=ne.handler(r,t,s);break;case"UserRequestChatInvitationLink":case"UserRequestChatInvitationLink_RequestCompleted":case"UserResetChatInvitationLink":case"UserResetChatInvitationLink_RequestCompleted":o=re.handler(r,t,s);break;case"LoadChatMembers":case"LoadChatMembers_RequestComplete":o=ae.handler(r,t,s);break;case"LoadChatInfo":case"LoadChatInfo_RequestComplete":o=oe.handler(r,t,s);break;case"UserChangedChannel":case"UserChangedChannel_RequestCompleted":case"UserSetChannelPhoto":case"UserUpdateChannelInfo":o=ie.handler(r,t,s);break;case"UserChangedChannelPost":case"UserChangedChannelPost_RequestCompleted":o=ce.handler(r,t,s);break;case"UserSeenPost":case"UserSeenPost_ThrottleTimedOut":case"UserSeenPost_RequestCompleted":o=de.handler(r,t,s);break;case"UserReadPost":case"UserReadPost_ThrottleTimedOut":case"UserReadPost_RequestCompleted":o=le.handler(r,t,s);break;case"UserLoadedCommentsHistory":case"UserLoadedCommentsHistory_RequestSucceed":case"UserLoadedCommentsHistory_RequestFailed":o=pe.handler(r,t,s);break;case"ChannelsOnboardingDone":case"ChannelsOnboardingDone_RequestSucceeded":case"ChannelsOnboardingDone_RequestFailed":o=me.handler(r,t,s);break;case"UserChangedComposerDraft":case"UserClearedComposerDraft":case"ComposerDraftsUpdateNeeded":case"ActualizeComposerDraft":case"ActualizeComposerDraft_RequestCompleted":o=fe.handler(r,t,s);break;case"ResetUpdatesCounter":case"ResetUpdatesCounter_RequestCompleted":o=ge.handler(r,t,s);break;case"UserProfileInfo_Update":o=he.handler(r,t,s);break;case"UserChangedMessageAttachment":case"UserChangedMessageAttachment_RequestCompleted":o=ve.handler(r,t,s);break;case"UserDeleteComment":case"UserDeleteComment_RequestCompleted":case"UserRestoreComment":case"UserRestoreComment_RequestCompleted":o=Ce.handler(r,t,s);break;case"UserLoadedLikes":case"UserLoadedLikes_RequestCompleted":case"UserChangedLike":case"UserChangedLike_RequestCompleted":o=_e.handler(r,t,s);break;case"UserChangedBrowserNotifications":case"UserChangedBrowserNotifications_RequestCompleted":o=ye.handler(r,t,s);break;case"UserSetMessageReaction":case"UserSetMessageReaction_RequestCompleted":case"UserUnsetMessageReaction":case"UserUnsetMessageReaction_RequestCompleted":o=Me.handler(r,t,s);break;case"ImportContact":o=Ee.handler(r,t,s);break;case"VideoMessageShapesGetById":case"VideoMessageShapesGetById__RequestCompleted":o=ke.handler(r,t,s);break;case"UserChangedPostAttachment":case"UserChangedPostAttachment_RequestCompleted":o=Ie.handler(r,t,s);break;case"PollConvoReactions":case"PollConvoReactions_RequestSucceed":o=Re.handler(r,t,s);break;case"UserChangedChannelComposerDraft":case"UserClearedChannelComposerDraft":o=be.handler(r,t,s);break;case"UserHitPostSend":case"UserHitPostSend_RequestCompleted":o=Se.handler(r,t,s);break;case"InvalidateMessageReactions":case"InvalidateMessageReactions_RequestCompleted":o=Ue.handler(r,t,s);break;case"UserChangedPushSetting":case"UserChangedPushSetting_RequestCompleted":o=Pe.handler(r,t,s);break;case"UserScrolledConvoHistory":case"UserScrolledConvoHistory_RequestSucceed":case"UserScrolledConvoHistory_RequestFailed":o=Ae.handler(r,t,s);break;case"UserReadAllReactions":case"UserReadAllReactions_RequestCompleted":o=Te.handler(r,t,s);break;case"PollChannelPosts":case"PollChannelPosts_RequestSucceed":o=xe.handler(r,t,s);break;default:(0,c.exhaustivenessCheck)(t)}r.convos.set(m.resolveId(),p.safeGet(e.convos,m.resolveId())),r.peers.set(m.resolveId(),m.safeGet(e.peers,m.resolveId())),r.channels.set(_.resolveId(0),_.safeGet(e.channels,_.resolveId(0)));const i=(0,a.finishDraft)(r);var d;if(e.hiddenPinnedMessages!==i.hiddenPinnedMessages&&o.push((d=(0,n._)((function*({storage:e}){return e.set("hidden-pinned-messages",Array.from(i.hiddenPinnedMessages.entries()).reduce(((e,[t,s])=>(e[t]=s,e)),{})),{type:"Noop"}})),function(e){return d.apply(this,arguments)})),e.hiddenBotKeyboards!==i.hiddenBotKeyboards&&o.push((0,n._)((function*({storage:e}){return e.set("hidden-bot-keyboards",i.hiddenBotKeyboards),{type:"Noop"}}))),i.organisers.filters.businessNotify.isHidden&&"Noop"!==t.type&&"UserUndoHideFilter"!==t.type&&"visible"===document.visibilityState){const e=i.organisers.filters.businessNotify.unreadCount;o.push((0,n._)((function*(){return 0===e?{type:"Noop"}:{type:"UserUndoHideFilter",kind:"businessNotify"}})))}return[i,o]}const Oe=(e,t,s)=>{switch(t.type){case"InitialData":{const{ownerId:a,withCache:c}=t,d=a?(0,i.getOwnerGroupId)(a):0,l=e.viewer.id,u=(0,n._)((function*({engine:e,api:t,storage:n}){var a,i,u,h,p;if(s.vkm_new_chunk_parser&&(I.dontUse__enableNewParser__hack(),yield(0,o.default)()),c){var m,f;const[e,s,n]=yield t.fetchMany([{method:"account.getInfo",params:{fields:M.API_GET_INFO_FIELDS.join(",")}},{method:"account.getMulti",params:{fields:"profile_type,photo_100"}},{method:"account.getProfileInfo",params:{}}],{retries:2,timeout:2e4});return{type:"InitialDataWithCached_RequestCompleted",responseMultiAccount:s,responseProfileInfo:n,serverUserSettings:{ctrSubmit:Boolean(e.messages_multiline_input),showRecommendations:!Boolean(e.messages_recommendation_list_hidden),countOnlyNotMuted:Boolean(e.show_only_not_muted_messages),autoUnarchive:Boolean(e.messages_auto_unarchive),transcriptAutoShow:Boolean(e.messages_transcript_auto_show),businessNotify:Boolean(e.business_notify_enabled),teacherVerification:Boolean("1"===(null==(f=e.settings)||null==(m=f.find((e=>"messages_show_banner_teacher_verification"===e.name)))?void 0:m.value))}}}const _=yield t.fetch("messages.getLongPollServer",{need_pts:1,lp_version:e.version,group_id:d},{retries:1/0,usePrefetch:!0});if(!_.pts)throw new Error("Отсутствует pts");e.connect((0,r._)({},_,{pts:_.pts}));const[C,y,w,R,b,S,E,U,P,A]=yield t.fetchMany([{method:"messages.getConversations",params:{count:M.CONVOS_PER_PAGE,group_id:d,extended:1}},{method:"messages.getConversationsById",params:{peer_ids:l.toString(),group_id:d,extended:1}},{method:"messages.getFolders",params:{}},{method:"users.get",params:{}},0!==d&&{method:"groups.getById",params:{group_ids:String(d)}},{method:"account.getCounters",params:{filter:"all"}},{method:"account.getInfo",params:{fields:M.API_GET_INFO_FIELDS.join(",")}},{method:"account.getHelpHints",params:{categories:"im"}},{method:"account.getMulti",params:{fields:"profile_type,photo_100"}},{method:"account.getProfileInfo",params:{}}],{retries:1/0,timeout:2e4,usePrefetch:!0}),T=null==(i=b)||null==(a=i.groups)?void 0:a[0],N=R[0];if(!N)throw new Error("Не удалось получить текущего пользователя");var x,F,q,O,L,D,B,H,G,V;return{type:"InitialData_RequestCompleted",responseViewer:N,responseMultiAccount:P,responseGroup:T,responseConvos:C,responseProfileInfo:A,responseViewerConvo:y,hasMoreConvos:C.items.length>=M.CONVOS_PER_PAGE,folders:w,activeCallsCount:S.calls||0,unreadCount:{messages:S.messages||0,messagesUnmuted:S.messages_unread_unmuted||0,archive:S.messages_archive_unread||0,archiveMentions:S.messages_archive_mentions_count||0,archiveTotal:S.messages_archive||0,messageRequest:S.message_requests||0,businessNotify:S.business_notify||0,businessNotifyTotal:S.business_notify_all||0,channelsTotal:(null==(u=S.channels)?void 0:u.total_count)||0,folders:S.messages_folders||[]},convoLp:{pts:_.pts},hiddenPinnedMessages:n.get("hidden-pinned-messages"),hiddenBotKeyboards:n.get("hidden-bot-keyboards"),composerDrafts:g.validateRequiredFields(n.get("drafts")||{}),channelComposerDrafts:v.validateRequiredFields(n.get("channels-drafts")||{}),businessNotifyManuallyHidden:!!n.get("business-notify-manually-hidden"),userSettings:{ctrSubmit:Boolean(E.messages_multiline_input),soundNotifications:null==(x=n.get("settings-sound-notifications-on"))||x,eduAccountSwitchBanner:null==(F=n.get("settings-edu-account-switch-banner-on"))||F,browserNotifications:null!=(q=n.get("settings-browser-notifications-on"))&&q,showRecommendations:!Boolean(E.messages_recommendation_list_hidden),countOnlyNotMuted:Boolean(E.show_only_not_muted_messages),autoUnarchive:Boolean(E.messages_auto_unarchive),transcriptAutoShow:Boolean(E.messages_transcript_auto_show),theme:null!=(O=n.get("theme"))?O:"system",verticalFoldersView:null!=(L=n.get("folders-view-vertical"))&&L,messageReactionAnimation:null==(D=n.get("message-reactions-animation"))||D,businessNotify:Boolean(E.business_notify_enabled),push:null!=(B=n.get("settings-push"))?B:k.VIEWER_DEFAULT_PUSH_SETTINGS,teacherVerification:Boolean("1"===(null==(p=E.settings)||null==(h=p.find((e=>"messages_show_banner_teacher_verification"===e.name)))?void 0:h.value)),rightClickActionsEnabled:null!=(H=n.get("settings-right-click-actions-enabled"))&&H,messageSelfMentionHighlighting:null!=(G=n.get("settings-message-self-mention-highlighting"))?G:"none",autoExtendReactionPicker:null!=(V=n.get("settings-auto-extend-reaction-picker"))&&V},helpHints:U.items.reduce(((e,t)=>(e.add(t.id),e)),new Set)}}));return c?[(D=(0,n._)((function*(){return{type:"EngineBatchReceived",variant:{kind:"FromEngine",next:{kind:"Failure"}}}})),function(){return D.apply(this,arguments)}),u]:[(L=(0,n._)((function*({storage:e}){var t;return{type:"SettingThemeUpdated",value:null!=(t=e.get("theme"))?t:"system"}})),function(e){return L.apply(this,arguments)}),u]}case"InitialDataWithCached_RequestCompleted":e.viewer.profileInfo=(0,R.fromApiViewerProfileInfo)(t.responseProfileInfo),e.viewer.accounts=t.responseMultiAccount.items.map(R.fromApiViewerAccount),e.viewer.settings=(0,r._)({},e.viewer.settings,t.serverUserSettings);return[He(e.viewer.id,e.ownerId,!0),(O=(0,n._)((function*({channelEngine:e}){return e&&s.me_channels?{type:"ChannelEngineBatchReceived",variant:{kind:"FromChannelEngine",next:{kind:"Failure"}}}:{type:"Noop"}})),function(e){return O.apply(this,arguments)})];case"InitialData_RequestCompleted":{var a;e.convoConn={status:"running",pts:t.convoLp.pts},e.activeCallsCount=t.activeCallsCount,e.hiddenPinnedMessages=new Map(Object.entries(t.hiddenPinnedMessages||{}).map((([e,t])=>[m.resolveId(parseInt(e)),f.resolveCmid(t)]))),e.hiddenBotKeyboards=t.hiddenBotKeyboards||new Set,e.composerDrafts=t.composerDrafts,e.channelComposerDrafts=t.channelComposerDrafts;const r=(0,i.insertConvos)(e,t.responseConvos.items);(0,i.insertConvos)(e,t.responseViewerConvo.items),e.organisers.filters.businessNotify.isHidden=!!t.businessNotifyManuallyHidden,l.push(e.organisers.filters,"all",r,t.hasMoreConvos),0===t.unreadCount.archiveTotal&&l.push(e.organisers.filters,"archive",[],!1),0===t.unreadCount.messageRequest&&l.push(e.organisers.filters,"messageRequest",[],!1),l.updateCounters(e.organisers.filters,{unread:t.unreadCount.messages,unreadUnmuted:t.unreadCount.messagesUnmuted,headerNotMutedUnread:0,archive:t.unreadCount.archive,archiveMentions:t.unreadCount.archiveMentions,archiveTotal:t.unreadCount.archiveTotal,messageRequests:t.unreadCount.messageRequest,businessNotify:t.unreadCount.businessNotify,businessNotifyTotal:t.unreadCount.businessNotifyTotal}),(0,i.insertFolders)(e,t.folders.items),null==(a=t.unreadCount.folders)||a.forEach((t=>{u.setUnreadCounters(e.organisers.folders,u.resolveId(t.folder_id),t.total_count,t.unmuted_count)})),h.updateCounters(e.organisers.channelFilters,{unread:t.unreadCount.channelsTotal,archiveTotal:0}),(0,i.insertPeers)(e,{apiUsers:[...t.responseConvos.profiles||[]],apiGroups:[...t.responseConvos.groups||[]],apiContacts:[...t.responseConvos.contacts||[]]}),e.viewer.profileInfo=(0,R.fromApiViewerProfileInfo)(t.responseProfileInfo);const{user:o}=(0,w.fromApiUser)(t.responseViewer);e.peers.set(o.id,o),e.viewer.id=o.id,e.viewer.accounts=t.responseMultiAccount.items.map(R.fromApiViewerAccount);const c=t.responseGroup?(0,w.fromApiGroup)(t.responseGroup):void 0;c&&e.peers.set(c.id,c);const d=c?c.id:o.id;return e.ownerId=d,e.viewer.settings=t.userSettings,e.helpHints=t.helpHints,[(q=(0,n._)((function*({engine:e}){return{type:"EngineBatchReceived",variant:{kind:"FromEngine",next:yield e.poll()}}})),function(e){return q.apply(this,arguments)}),He(o.id,d,!1),function(){var e=(0,n._)((function*({api:e,channelEngine:t}){if(!t||!s.me_channels)return{type:"Noop"};try{const[s,n]=yield e.fetchSeq([{method:"channels.getLongPollServer",params:{}},{method:"channels.get",params:{count:M.CHANNELS_PER_PAGE,extended:1}}],{retries:1/0});return t.connect(s),{type:"InitialData_ChannelsReadyForUse",channelLpTS:s.ts,channelsGetResponse:n}}catch(e){return{type:"Noop"}}}));return function(t){return e.apply(this,arguments)}}()]}case"QueueConfigAndUsersFromSearch_RequestCompleted":{var c,d,p,_;const{queueConfig:s,importantUsers:a,selectedFromSearchConvos:o}=t;var C,y,b,S,E,U,P;(0,i.insertConvos)(e,[...a.items,...null!=(C=null==(c=o)?void 0:c.items)?C:[]]),(0,i.insertPeers)(e,{apiUsers:[...null!=(y=a.profiles)?y:[],...null!=(b=null==(d=o)?void 0:d.profiles)?b:[]],apiGroups:[...null!=(S=a.groups)?S:[],...null!=(E=null==(p=o)?void 0:p.groups)?E:[]],apiContacts:[...null!=(U=a.contacts)?U:[],...null!=(P=null==(_=o)?void 0:_.contacts)?P:[]]});const l=a.items.reduce(((e,t)=>{const s=(0,Ne.fromApiConvo)(t);return s&&e.add(s.convo.peerId),e}),new Set);e.importantUsers=l;const u=e.viewer.id;return[(F=(0,n._)((function*({queue:e}){return e.connect((0,r._)({user_id:m.toRealId(u)},s)),{type:"QueueBatchReceived",next:yield e.poll()}})),function(e){return F.apply(this,arguments)})]}case"InitialData_ChannelsReadyForUse":{var A,T,N;e.channelConn={status:"running",ts:t.channelLpTS};const s=(0,i.insertChannels)(e,{apiChannels:t.channelsGetResponse.items||[],apiGroups:t.channelsGetResponse.groups||[]}),r=((null==(A=t.channelsGetResponse.items)?void 0:A.length)||0)>=M.CHANNELS_PER_PAGE;return h.push(e.organisers.channelFilters,"all",s,r),(0,i.insertPeers)(e,{apiUsers:[...(null==(T=t.channelsGetResponse)?void 0:T.profiles)||[]],apiGroups:[...(null==(N=t.channelsGetResponse)?void 0:N.groups)||[]],apiContacts:[]}),[(x=(0,n._)((function*({channelEngine:e}){return e?{type:"ChannelEngineBatchReceived",variant:{kind:"FromChannelEngine",next:yield e.poll()}}:{type:"Noop"}})),function(e){return x.apply(this,arguments)})]}default:return[]}var x,F,q,O,L,D},Le=(e,t)=>{var s,n;return"LoadVideoMessageShapes_RequestCompleted"===t.type?(e.videoMessageShapes=null!=(n=null==(s=t.videoMessageShapes)?void 0:s.shapes.reduce(((e,{id:t,raw_path:s})=>(e.set(t,s),e)),new Map))?n:new Map,[]):[]};function De(){return(De=(0,n._)((function*({api:e,storage:t}){var s;const n=t.get("videomessage-shapes"),a=Math.round((new Date).getTime()/1e3),o=n&&n.expiresAt>a;let i=null;if(o)i=n.response;else try{var c,d;i=yield e.fetch("messages.getVideoMessageShapes",{client_version:null!=(d=null==(c=n)?void 0:c.response.version)?d:0},{retries:3})}catch(e){}const l=i?(0,r._)({},i,{shapes:[...(null==(s=n)?void 0:s.response.shapes)||[],...i.shapes]}):null;return!o&&l&&t.set("videomessage-shapes",{response:l,expiresAt:a+86400}),l}))).apply(this,arguments)}const Be=10;function He(e,t,s){const r=(0,i.getOwnerGroupId)(t);return(0,n._)((function*({api:t,storage:n}){var a;const o=n.get("selected-convos-from-search"),[i,c,d]=yield t.fetchMany([{method:"queue.subscribe",params:{queue_ids:`onlfriends_${e},accountcounters_${e}`}},{method:"messages.searchConversations",params:{q:" ",count:Be,extended:1,group_id:r}},!s&&!!(null==(a=o)?void 0:a.length)&&{method:"messages.getConversationsById",params:{peer_ids:o.join(","),extended:1,group_id:r}}],{retries:1/0});return{type:"QueueConfigAndUsersFromSearch_RequestCompleted",queueConfig:i,importantUsers:c,selectedFromSearchConvos:d}}))}},247293:(e,t,s)=>{s.d(t,{createSnackbar:()=>i,snackbarStore:()=>o});var n=s(434788),r=s(53416),a=s(453934);const o=function(e=[]){let t=e;const s=new Set,i=e=>{t=e(t),s.forEach((e=>e(t)))};return{getState:()=>t,subscribe:e=>(s.add(e),()=>{s.delete(e)}),reset:()=>i((()=>e)),create:e=>{const t=e.id||(0,r.nanoid)(),s=(0,n._)({},e,{id:t,onRequestRemove:()=>o.remove(t),requestClose:!1});return i((0,a.produce)((e=>{e.push(s)}))),t},remove:e=>{i((t=>t.filter((t=>t.id!==e))))},update:(e,t)=>{i((0,a.produce)((s=>{const r=s.findIndex((t=>t.id===e)),a=s[r];a&&(s[r]=(0,n._)({},a,t))})))},closeAll:e=>{i((t=>{var s,r;return(null==(s=e)?void 0:s.length)?t.map((t=>(0,n._)({},t,{requestClose:null!=(r=e.includes(t.id))?r:t.requestClose}))):t.map((e=>(0,n._)({},e,{requestClose:!0})))}))},close:e=>{i((t=>t.map((t=>(0,n._)({},t,{requestClose:t.id===e})))))}}}();function i(){const e=e=>o.create(e);return e.update=(e,t)=>{o.update(e,t)},e.closeAll=o.closeAll,e.close=o.close,e}},812081:(e,t,s)=>{s.d(t,{initConfig:()=>r});var n=s(453934);function r(){(0,n.enableMapSet)()}},923562:(e,t,s)=>{e.exports=s.p+"27cd5b4a8c2a8a0e12d1.js"}}]);try{stManager.done("dist/d44a3dadec967cfec01768a41c432826.4e75b62ffd5391b73937.js")}catch(e){}