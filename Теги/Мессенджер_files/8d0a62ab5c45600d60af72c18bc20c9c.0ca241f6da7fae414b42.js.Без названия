"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[82198],{696023:(e,t,n)=>{n.d(t,{BrowserEnvProvider:()=>re,ChannelsProvider:()=>H,ConvosProvider:()=>B,ConvosSearchIndexProvider:()=>me,DispatchProvider:()=>w,FeatureFlagsProvider:()=>z,HelpHintsProvider:()=>S,InsertIntoCacheProvider:()=>le,LastSeenProvider:()=>b,OrganisersProvider:()=>G,OwnerProvider:()=>Y,PeersProvider:()=>q,TypingsProvider:()=>M,VideoMessageShapesProvider:()=>ne,ViewerProvider:()=>X,isDepsShallowEqual:()=>v,matchAddEventListener:()=>N,useActualEffectCleanup:()=>p,useBrowserEnv:()=>oe,useCallbackWithCustomCompare:()=>_,useCombinedRefs:()=>de,useConvos:()=>D,useConvosSearchIndex:()=>he,useDebounced:()=>h,useDidUpdate:()=>u,useDispatch:()=>y,useFeatureFlags:()=>V,useHelpHints:()=>C,useInsertIntoCache:()=>ue,useLastSeen:()=>g,useMemoWithCustomCompare:()=>f,useNow:()=>R,useOnChange:()=>m,useOrganisers:()=>L,useOwner:()=>$,usePeers:()=>U,usePixelDensity:()=>F,usePrevious:()=>l,useTypings:()=>P,useVideoMessageShapes:()=>ee,useViewer:()=>Q,useViewport:()=>ae});var o=n(434788),i=n(667294),r=n(96190),a=n(821551),s=n(83062),d=n(89131),c=n(991792);function l(e){const t=(0,i.useRef)();return(0,i.useEffect)((()=>{t.current=e}),[e]),t.current}function u(e,t){const n=(0,i.useRef)(!1);(0,i.useEffect)((()=>{if(n.current)return e()}),t),(0,i.useEffect)((()=>{n.current=!0}),[])}function p(e,t){const n=(0,i.useRef)(t);n.current=t,(0,i.useEffect)((()=>()=>{t.some(((e,t)=>e!==n.current[t]))&&e()}),[...t,e]);const o=(0,i.useRef)(e);o.current=e,(0,i.useEffect)((()=>()=>{o.current()}),[])}function m(e,t){const[n,o]=(0,i.useState)([]);t.some(((e,t)=>n[t]!==e))&&(o(t),e())}function h(e,t){const[n,r]=(0,i.useState)({debounced:e,debouncedUpdatesCount:0});return(0,i.useLayoutEffect)((()=>{if(0===t)return void r((t=>(0,o._)({},t,{debounced:e})));const n=setTimeout((()=>{r((({debouncedUpdatesCount:t})=>({debounced:e,debouncedUpdatesCount:t+1})))}),t);return()=>{clearTimeout(n)}}),[e,t]),n}function _(e,t,n){const o=(0,i.useRef)(e),r=(0,i.useRef)(t);return n(r.current,t)||(o.current=e,r.current=t),o.current}function f(e,t,n){const o=(0,i.useRef)(!1),r=(0,i.useRef)(!o.current&&e()),a=(0,i.useRef)(t);return n(a.current,t)||(r.current=e(),a.current=t),o.current=!0,r.current}function v(e,t){return t.every(((t,n)=>(0,d.isShallowEqual)(t,e[n])))}function g(e){const t=(0,i.useContext)(k);if(r.isUserPeerId(e))return t.get(e)}const k=i.createContext(new Map),b=k.Provider;function y(){const e=(0,i.useContext)(I);if(!e)throw new Error("DispatchProvider не добавлен в дерево Реакта!");return e}const I=i.createContext(null),w=I.Provider;function C(){const e=(0,i.useContext)(A);if(void 0===e)throw new Error("HelpHintsProvider не добавлен в дерево Реакта!");return e}const A=i.createContext(new Set),S=A.Provider;function P(e,t="full",n=3){const o=(0,i.useContext)(x),a=U(),{lang:s}=oe(),d=o.get(e);if(!d)return;const l=e=>"full"===t?r.name(e):r.shortName(e),u=[],p=new Set;for(const e of c.TypingVariants){const t=d[e];t&&(u.push(e),t.peerIds.forEach((e=>p.add(e))))}const m=u.length>1?"text":u[0]||"text";if(0===n)return{text:s.use(`me_typing_${m}`),type:m};const h=[];for(const e of p){const t=a.get(e);if(t&&(h.push(t),h.length===n))break}let _;const f=p.size-h.length;switch(!0){case 0===h.length&&f>0:_=s.use("me_typing_people",{num:f});break;case f>0:_=h.map(l).join(", "),_=s.use("me_typing_names_lots",{num:f,values:{names:_}});break;case h.length>1:{const e=h.length>n-1?h.slice(0,n-1).map(l).join(", "):h[0]?l(h[0]):"",t=h[h.length-1],o=t?l(t):"";_=s.use("me_typing_names_couple",{values:{before:e,after:o}});break}case 1===h.length:_=h[0]?r.name(h[0]):"";break;default:_=""}return{text:"compact"===t?_:s.use(`me_typing_${m}_named`,{num:h.length+f,values:{names:_}}),type:m}}const x=i.createContext(new Map),M=x.Provider,E=()=>window.devicePixelRatio>=1.25;function F(){const[e,t]=(0,i.useState)(E);return(0,i.useEffect)((()=>N(window.matchMedia("(resolution: 1.25dppx)"),(()=>{t(E)}))),[]),e}function N(e,t){try{return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}}catch(n){return e.addListener(t),()=>{e.removeListener(t)}}}function R(e=6e4){const[t,n]=(0,i.useState)(Date.now);return(0,i.useLayoutEffect)((()=>{const t=setInterval((()=>{n(Date.now())}),e);return()=>clearInterval(t)}),[e]),t}function U(){return(0,i.useContext)(T)}const T=i.createContext(new Map),q=T.Provider;function D(){return(0,i.useContext)(j)}const j=i.createContext(new Map),B=j.Provider;function L(){return(0,i.useContext)(K)}const K=i.createContext(s.empty()),G=K.Provider;const O=i.createContext(new Map),H=O.Provider;function V(){const e=(0,i.useContext)(W);if(!e)throw new Error("FeatureFlagsProvider не добавлен в дерево Реакта!");return e}const W=i.createContext(null),z=W.Provider;function $(){const e=(0,i.useContext)(J);if(!e)throw new Error("OwnerProvider не добавлен в дерево Реакта!");return e}const J=i.createContext(null),Y=J.Provider;function Q(){const e=(0,i.useContext)(Z);if(!e)throw new Error("ViewerProvider не добавлен в дерево Реакта!");return e}const Z=i.createContext(null),X=Z.Provider;function ee(){return(0,i.useContext)(te)}const te=i.createContext(new Map),ne=te.Provider;function oe(){const e=(0,i.useContext)(ie);if(!e)throw new Error("BrowserEnvProvider не добавлен в дерево Реакта!");return e}const ie=i.createContext(null),re=ie.Provider;function ae({debounced:e=!1}){const[t,n]=(0,i.useState)(se),o=(0,i.useRef)((0,d.debounce)(n,300,!1));return(0,i.useLayoutEffect)((()=>{const t=o.current,i=()=>{e?t(se()):n(se())};return window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i),e&&t.cancel()}}),[e]),t}function se(){return"undefined"==typeof window?[0,0]:[document.documentElement.clientWidth,document.documentElement.clientHeight]}function de(...e){const t=(0,i.useRef)(null);return i.useEffect((()=>{e.forEach((e=>{e&&("function"==typeof e?e(t.current):e.current=t.current)}))}),[e]),t}const ce=i.createContext(null),le=ce.Provider;function ue(){const e=(0,i.useContext)(ce);if(!e)throw new Error("InsertIntoCacheProvider не добавлен в дерево Реакта!");return e}const pe=i.createContext(a.create()),me=pe.Provider;function he(){return(0,i.useContext)(pe)}},859352:(e,t,n)=>{function o(e){return e}n.d(t,{resolveEventId:()=>o})},452788:(e,t,n)=>{n.d(t,{empty:()=>r,getLockId:()=>d,isLoaded:()=>c,push:()=>l,refresh:()=>u,snakeCaseId:()=>s,sorter:()=>m,updateCounters:()=>p});var o=n(434788),i=n(839963);function r(){const e={channelIds:new Set,hasMore:!0,unreadCount:0,totalCount:0,boundary:{channelId:i.resolveId(0),majorSortId:1/0,minorSortId:1/0}};return{all:(0,o._)({kind:"all"},e),unread:(0,o._)({kind:"unread"},e),archive:(0,o._)({kind:"archive",isHidden:!1},e)}}const a={all:"all",unread:"unread",archive:"archived"};function s(e){return a[e]}function d(e){return`filter_${e}`}function c(e){return e.boundary.minorSortId!==1/0&&e.boundary.majorSortId!==1/0}function l(e,t,n,o){for(const o of n)h(e,t,o),u(e,o);e[t].hasMore=o,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0,channelId:i.resolveId(0)})}function u(e,t){e.all.channelIds.delete(t.id),e.unread.channelIds.delete(t.id),e.archive.channelIds.delete(t.id),t.isMember&&(t.isArchived?_(e.archive,t)&&e.archive.channelIds.add(t.id):(_(e.all,t)&&e.all.channelIds.add(t.id),i.isUnread(t)&&_(e.unread,t)&&e.unread.channelIds.add(t.id)))}function p(e,{unread:t,archiveTotal:n}){void 0!==t&&(e.all.unreadCount=t,e.unread.unreadCount=t),void 0!==n&&(e.archive.totalCount=n)}function m(e,t){var n,o;if(e.majorSortId!==t.majorSortId)return t.majorSortId-e.majorSortId;const r=i.lastPost({channel:e,withPending:!0}),a=i.lastPost({channel:t,withPending:!0});var s,d,c,l;return"Pending"===(null==(n=r)?void 0:n.kind)||"Pending"===(null==(o=a)?void 0:o.kind)?(null!=(c=null==(s=a)?void 0:s.sentAt)?c:0)-(null!=(l=null==(d=r)?void 0:d.sentAt)?l:0):t.minorSortId!==e.minorSortId?t.minorSortId-e.minorSortId:e.id-t.id}function h(e,t,n){i.isHidden(n)||(n.majorSortId<e[t].boundary.majorSortId?e[t].boundary={channelId:n.id,majorSortId:n.majorSortId,minorSortId:n.minorSortId}:n.majorSortId===e[t].boundary.majorSortId&&n.minorSortId<e[t].boundary.minorSortId?(e[t].boundary.channelId=n.id,e[t].boundary.minorSortId=n.minorSortId):n.majorSortId===e[t].boundary.majorSortId&&n.minorSortId===e[t].boundary.minorSortId&&(e[t].boundary.channelId=n.id),"all"===t&&h(e,"unread",n))}function _(e,t){return!i.isHidden(t)&&(!(t.majorSortId<e.boundary.majorSortId)&&(t.majorSortId>e.boundary.majorSortId||!(t.minorSortId<e.boundary.minorSortId)&&(t.minorSortId>e.boundary.minorSortId||!(t.id>e.boundary.channelId))))}},498928:(e,t,n)=>{n.d(t,{empty:()=>s,getLockId:()=>u,isLoaded:()=>l,isVisible:()=>p,push:()=>m,refresh:()=>h,snakeCaseId:()=>c,sorter:()=>f,toggleBusinessNotifyVisibility:()=>v,updateCounters:()=>_});var o=n(434788),i=n(185327),r=n(168465),a=n(89131);function s(){const e={peerIds:new Set,hasMore:!0,unreadCount:0,unreadUnmutedCount:0,totalCount:0,boundary:{majorSortId:1/0,minorSortId:1/0}};return{all:(0,o._)({kind:"all"},e),unread:(0,o._)({kind:"unread",headerNotMutedUnread:0},e),chats:(0,o._)({kind:"chats"},e),archive:(0,o._)({kind:"archive",hasMentions:!1},e),messageRequest:(0,o._)({kind:"messageRequest"},e),businessNotify:(0,o._)({kind:"businessNotify",isHidden:!1},e)}}const d={all:"all",unread:"unread",chats:"chats",messageRequest:"message_request",businessNotify:"business_notify",archive:"archive"};function c(e){return d[e]}function l(e){return e.boundary.majorSortId!==1/0&&e.boundary.minorSortId!==1/0}function u(e){return`filter_${e}`}function p(e){switch(e.kind){case"all":case"unread":case"chats":case"archive":return!0;case"messageRequest":return e.peerIds.size>0||e.hasMore;case"businessNotify":return!e.isHidden&&(e.totalCount>0||e.unreadCount>0);default:(0,a.exhaustivenessCheck)(e)}}function m(e,t,n,o){for(const o of n)g(e,t,o),h(e,o);e[t].hasMore=o,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0})}function h(e,t){switch(t.kind){case"ChatConvo":case"GroupConvo":case"UserConvo":case"ContactConvo":case"MessageRequestUserConvo":case"MessageRequestChatConvo":case"BusinessNotify":return e.all.peerIds.delete(t.peerId),e.unread.peerIds.delete(t.peerId),e.archive.peerIds.delete(t.peerId),e.messageRequest.peerIds.delete(t.peerId),e.businessNotify.peerIds.delete(t.peerId),i.isBusinessNotify(t)?void(k(e.businessNotify,t)&&e.businessNotify.peerIds.add(t.peerId)):i.isMR(t)?void(i.isPendingMR(t)&&k(e.messageRequest,t)&&e.messageRequest.peerIds.add(t.peerId)):t.isArchived?void(k(e.archive,t)&&e.archive.peerIds.add(t.peerId)):(k(e.all,t)&&e.all.peerIds.add(t.peerId),i.isUnread(t)&&k(e.unread,t)&&e.unread.peerIds.add(t.peerId),void("ChatConvo"===t.kind&&k(e.chats,t)&&e.chats.peerIds.add(t.peerId)));default:return(0,a.exhaustivenessCheck)(t)}}function _(e,{unread:t,unreadUnmuted:n,headerNotMutedUnread:o,archive:i,archiveTotal:r,archiveMentions:a,messageRequests:s,businessNotify:d,businessNotifyTotal:c}){void 0!==t&&(e.all.unreadCount=t,e.unread.unreadCount=t),void 0!==n&&(e.all.unreadUnmutedCount=n,e.unread.unreadUnmutedCount=n),void 0!==o&&(e.unread.headerNotMutedUnread=o),void 0!==i&&(e.archive.unreadCount=i),void 0!==a&&(e.archive.hasMentions=!!a),void 0!==r&&(e.archive.totalCount=r),void 0!==s&&(e.messageRequest.totalCount=s),void 0!==d&&(e.businessNotify.unreadCount=d),void 0!==c&&(e.businessNotify.totalCount=c)}function f(e,t){var n,o,i,a;if(e.majorSortId!==t.majorSortId)return t.majorSortId-e.majorSortId;const s=null==(n=r.lastNode({history:e.history,withDeleted:!1,withPending:!0}))?void 0:n.item,d=null==(o=r.lastNode({history:t.history,withDeleted:!1,withPending:!0}))?void 0:o.item;var c,l,u,p;return"Queued"===(null==(i=s)?void 0:i.kind)||"Queued"===(null==(a=d)?void 0:a.kind)?(null!=(u=null==(c=d)?void 0:c.sentAt)?u:0)-(null!=(p=null==(l=s)?void 0:l.sentAt)?p:0):t.minorSortId-e.minorSortId}function v(e,t){e.businessNotify.isHidden=!t}function g(e,t,n){i.isHidden(n)||(n.majorSortId<e[t].boundary.majorSortId?e[t].boundary={majorSortId:n.majorSortId,minorSortId:n.minorSortId}:n.majorSortId===e[t].boundary.majorSortId&&n.minorSortId<e[t].boundary.minorSortId&&(e[t].boundary.minorSortId=n.minorSortId),"all"===t&&(g(e,"unread",n),g(e,"chats",n)))}function k(e,t){return!i.isHidden(t)&&(t.majorSortId>e.boundary.majorSortId||t.majorSortId===e.boundary.majorSortId&&t.minorSortId>=e.boundary.minorSortId)}},651285:(e,t,n)=>{function o(e){return!Number.isNaN(e)&&e||(e=0),e}n.d(t,{resolveId:()=>o})},83062:(e,t,n)=>{n.d(t,{canHavePinnedConvos:()=>u,empty:()=>c,filterToTab:()=>p,isEqual:()=>l,refresh:()=>s,refreshChannels:()=>d,tabToChannelFilter:()=>h,tabToFilter:()=>m});var o=n(89131),i=n(498928),r=n(452788),a=n(999504);function s(e,t){a.refresh(e.folders,t),i.refresh(e.filters,t)}function d(e,t){r.refresh(e.channelFilters,t)}function c(){return{filters:i.empty(),folders:a.empty(),channelFilters:r.empty()}}function l(e,t){if(e.kind!==t.kind)return!1;switch(e.kind){case"filters":return e.filter===t.filter;case"folders":return e.id===t.id;default:(0,o.exhaustivenessCheck)(e)}}function u(e){return"filters"===e.kind}function p(e){switch(e){case"archive":case"unread":case"businessNotify":case"messageRequest":return e;default:return}}function m(e){switch(e){case"archive":case"unread":case"businessNotify":case"messageRequest":return e;default:return"all"}}function h(e){switch(e){case"archive":case"unread":return e;default:return"all"}}},434425:(e,t,n)=>{function o(e){return!Number.isNaN(e)&&e||(e=0),e}n.d(t,{resolveId:()=>o})},71568:(e,t,n)=>{function o(e){return Number.isNaN(e)&&(e=0),e}n.d(t,{resolveStickerId:()=>o})},651041:(e,t,n)=>{n.d(t,{dictionaryLatinConvert:()=>d,toLocalCase:()=>l,toTranslit:()=>c});var o=n(434788);const i={u1072:"a",u1073:"b",u1074:"v",u1075:"g",u1076:"d",u1077:"e",u1105:"yo",u1078:"zh",u1079:"z",u1080:"i",u1081:"y",u1082:"k",u1083:"l",u1084:"m",u1085:"n",u1086:"o",u1087:"p",u1088:"r",u1089:"s",u1090:"t",u1091:"u",u1092:"f",u1093:"kh",u1094:"ts",u1095:"ch",u1096:"sh",u1097:"shch",u1098:"'",u1099:"y",u1100:"'",u1101:"e",u1102:"yu",u1103:"ya"},r=(0,o._)({},i,{u1093:"h",u1097:"sh",u1098:"",u1100:"",u1105:"e"}),a={u102:"а",u44:"б",u100:"в",u117:"г",u108:"д",u116:"е",u92:"ё",u59:"ж",u112:"з",u98:"и",u113:"й",u114:"к",u107:"л",u118:"м",u121:"н",u106:"о",u103:"п",u104:"р",u99:"с",u110:"т",u101:"у",u97:"ф",u91:"х",u119:"ц",u120:"ч",u105:"ш",u111:"щ",u93:"ъ",u109:"ь",u115:"ы",u39:"э",u46:"ю",u122:"я",u60:"б",u126:"ё",u58:"ж",u123:"х",u125:"ъ",u34:"э",u62:"ю",u64:'"',u35:"№",u36:";",u37:"%",u94:":",u38:"?",u63:",",u47:"."},s={yo:"ё",YO:"Ё",zh:"ж",ZH:"Ж",kh:"х",KH:"Х",ts:"ц",TS:"Ц",ch:"ч",CH:"Ч",sch:"щ",SCH:"Щ",shch:"щ",SHCH:"Щ",sh:"ш",SH:"Ш",eh:"э",EH:"Э",yu:"ю",YU:"Ю",ya:"я",YA:"Я","'":"ь",a:"а",A:"А",b:"б",B:"Б",v:"В",g:"г",G:"Г",d:"д",D:"Д",e:"е",E:"Е",z:"з",Z:"З",i:"и",I:"И",j:"й",J:"Й",k:"к",K:"К",l:"л",L:"Л",m:"м",M:"М",n:"н",N:"Н",o:"о",O:"О",p:"п",P:"Р",r:"р",R:"Р",s:"с",S:"С",t:"т",T:"Т",u:"у",U:"У",f:"ф",F:"Ф",h:"х",H:"Х",c:"ц",C:"Ц",y:"ы",Y:"Ы"};function d({value:e}){return function({dictionary:e,value:t}){return Object.entries(e).reduce(((e,[t,n])=>e.replace(new RegExp(t,"g"),n)),t)}({value:e,dictionary:s})}function c(e,t){e=e.toLowerCase().trim();const n=[i,r];return t&&n.push(a),n.reduce(((t,n)=>{const o=u(e,n);return o===e||t.includes(o)||t.push(o),t}),[])}function l(e){return u(e=e.toLowerCase().trim(),a)}function u(e,t){let n="";for(let o of e){const e=t["u"+o.codePointAt(0)];n+=void 0!==e?e:o}return n}},821551:(e,t,n)=>{n.d(t,{add:()=>s,create:()=>a,peerWords:()=>u,search:()=>d});var o=n(651041),i=n(89131),r=n(709420);function a(){return{items:new Set,branches:{}}}function s(e,t,n){if(Array.isArray(t))t.forEach((t=>s(e,t,n)));else{const{id:o,strings:i}=n(t);(0,r.getWordsVariants)(i).forEach((t=>{let n=e;n.items.add(o),Array.from(t.trim().toLowerCase()).forEach((e=>{let t=n.branches[e];t||(t=n.branches[e]=a()),t.items.add(o),n=t}))}))}return e}function d(e,t){const n=c(e,p(t)),i=c(e,p(o.toLocalCase(t))),r=c(e,o.toTranslit(t));return new Set([...n,...i,...r])}function c(e,t){let n=null;for(const o of t){const t=l(e,o);if(n)for(const e of n)t.has(e)||n.delete(e);else n=new Set([...t])}return n||new Set}function l(e,t){let n=e;const o=t.trim().toLowerCase();for(const e of o){let t=n.branches[e];if(!t)return new Set;n=t}return n.items}function u(e){let t=[];switch(e.kind){case"Chat":t.push(...p(e.title));break;case"Group":e.screenName&&t.push(e.screenName),t.push(...p(e.name));break;case"User":e.screenName&&t.push(e.screenName),t.push(...p(e.firstName)),t.push(...p(e.lastName));break;case"Contact":t.push(...p(e.name));break;default:(0,i.exhaustivenessCheck)(e)}return t}function p(e){return e.trim().toLowerCase().split(/\s+/g)}},709420:(e,t,n)=>{n.d(t,{getWordsVariants:()=>i});var o=n(651041);function i(e){let t=[];for(let n of e){const e=n.replace(/ё/g,"е").replace(/Ё/g,"Е");e!==n&&t.push(e),o.toTranslit(n,!0).forEach((e=>{e!==n&&t.push(e)})),t.push(n)}return t}},694788:(e,t,n)=>{n.d(t,{UNKNOWN_SHAPE_ID:()=>m,apiAttachWallOwnerId:()=>K,emptyPreview:()=>p,fromApiAttach:()=>h,fromApiAudio:()=>P,fromApiConvoAttach:()=>_,fromApiDoc:()=>k,fromApiPhoto:()=>b,fromApiPoll:()=>j,fromApiPollBackgroundGradient:()=>B,fromApiVideo:()=>y,fromApiVoice:()=>x,fromApiWallAttach:()=>f,fromApiWallReplyAttach:()=>v});var o=n(434788),i=n(820224),r=n(197934),a=n(96190),s=n(777634),d=n(504698),c=n(89131),l=n(986727);const u=200,p="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjYGBg+A8AAQQBAHAgZQsAAAAASUVORK5CYII=",m=-1;function h({apiAttaches:e,messageAccessKey:t,attachPositionOffset:n}){if(0===e.length)return{};const i={},s=e=>{i.unknown=[...i.unknown||[],{data:e,kind:"Unknown"}]};let c=n;for(const n of e)switch(void 0!==c&&c++,n.type){case"photo":{if(!n.photo){s(n);break}const e=b({apiPhoto:n.photo,messageAccessKey:t,position:c});if(!e){s(n);break}i.photos=[...i.photos||[],e];break}case"audio":{if(!n.audio){s(n);break}const e=P(n.audio);i.audios=[...i.audios||[],e];break}case"video":if(!n.video){s(n);break}const e=y({apiVideo:n.video,messageAccessKey:t,position:c});if(!e){s(n);break}i.videos=[...i.videos||[],e];break;case"doc":{if(!n.doc){s(n);break}const e=k(n.doc);if(!e){s(n);break}i.docs=[...i.docs||[],e];break}case"link":{if(!n.link){s(n);break}const e=g(n.link);if(!e){s(n);break}const t=e=>e.image&&(0,o._)({},e,{image:e.image,kind:"InviteLink"});if(r.isChatInviteLink(e.url)&&e.image){i.inviteLink=t(e);break}i.link=e;break}case"market":if(!n.market){s(n);break}i.market={kind:"Market",id:(M=n.market).id,ownerId:M.owner_id,isService:!!M.is_price_list_service,title:M.title,price:M.price.text,priceOld:M.price.old_amount_text,photo:M.thumb_photo};break;case"market_album":if(!n.market_market_album){s(n);break}i.marketAlbum={kind:"MarketAlbum"};break;case"gift":if(!n.gift){s(n);break}const N=S(n.gift);if(!N){s(n);break}i.gift=N;break;case"ugc_sticker":{if(!n.ugc_sticker){s(n);break}const e=(0,l.fromApiUgcSticker)(n.ugc_sticker);if(!e){s(n);break}i.ugcSticker=e;break}case"sticker":{if(!n.sticker){s(n);break}const e=(0,l.fromApiSticker)(n.sticker);if(!e){s(n);break}i.sticker=e;break}case"wall":{if(!n.wall||!n.wall.from_id||!n.wall.id){s(n);break}n.wall.geo&&(n.wall.attachments=[...n.wall.attachments||[],{type:"geo",geo:n.wall.geo}]);const e=K(n.wall);if(!e){s(n);break}i.wall={kind:"Wall",authorId:a.resolveId(n.wall.from_id),ownerId:a.resolveId(e),id:n.wall.id,date:1e3*(n.wall.date||0),chunks:d.fromServerText(n.wall.text||""),attaches:f(n.wall),isAds:"post_ads"===n.wall.post_type};break}case"wall_reply":{if(!(n.wall_reply&&n.wall_reply.from_id&&n.wall_reply.id&&n.wall_reply.post_id)){s(n);break}const e=K(n.wall_reply);if(!e){s(n);break}i.wallReply={kind:"WallReply",id:n.wall_reply.id,postId:n.wall_reply.post_id,authorId:a.resolveId(n.wall_reply.from_id),ownerId:a.resolveId(e),parentsStack:n.wall_reply.parents_stack,date:1e3*(n.wall_reply.date||0),chunks:d.fromServerText(n.wall_reply.text||""),attaches:v(n.wall_reply.attachments||[])};break}case"article":if(!n.article){s(n);break}i.article=w(n.article);break;case"poll":if(!n.poll){s(n);break}i.poll=j(n.poll);break;case"graffiti":if(!n.graffiti){s(n);break}i.graffiti={kind:"Graffiti",imageUrl:n.graffiti.url,width:n.graffiti.width,height:n.graffiti.height};break;case"audio_message":if(!n.audio_message){s(n);break}i.voice=x(n.audio_message);break;case"audio_playlist":{if(!n.audio_playlist){s(n);break}const e={kind:"AudioPlaylist",id:(C=n.audio_playlist).id,ownerId:C.owner_id,type:E[C.type],title:C.title,accessKey:C.access_key,image:A(C.photo,"photo")};i.audioPlaylists=[...i.audioPlaylists||[],e];break}case"podcast":if(!n.podcast){s(n);break}i.podcast=F(n.podcast);break;case"money_transfer":if(!n.money_transfer){s(n);break}i.moneyTransfer=(h=n.money_transfer,_=void 0,{kind:"MoneyTransfer",text:(null==(_=h.amount)?void 0:_.text)||""});break;case"money_request":if(!n.money_request){s(n);break}i.moneyRequest={kind:"MoneyRequest",id:(m=n.money_request).id,toId:m.to_id,fromId:m.from_id,text:m.amount.text,initUrl:m.init_url,isUserOwner:!!m.user_is_owner,isProcessed:!!m.processed};break;case"story":if(!n.story){s(n);break}i.story=I(n.story);break;case"geo":if(!n.geo||!n.geo.coordinates){s(n);break}i.geo={kind:"Geo",coordinates:n.geo.coordinates,place:n.geo.place};break;case"call":{if(!n.call){s(n);break}const e=T(n.call);if(!e){s(n);break}i.finishedCall=e;break}case"group_call_in_progress":if(!n.group_call_in_progress){s(n);break}i.activeCall=(u=n.group_call_in_progress,p=void 0,{kind:"ActiveCall",initiatorId:u.initiator_id,joinLink:u.join_link,participants:{list:null==(p=u.participants.list)?void 0:p.map(a.resolveId),count:u.participants.count||0,coverList:U(u)}});break;case"mini_app":if(!n.mini_app){s(n);break}const R=q(n.mini_app);if(!R){s(n);break}i.miniApps=[...i.miniApps||[],R];break;case"donut_link":if(!n.donut_link){s(n);break}const B=D(n.donut_link);if(!B){s(n);break}i.donutLink=B;break;case"video_message":if(!n.video_message){s(n);break}i.videoMessage=G(n.video_message);break;case"widget":if(!n.widget){s(n);break}i.widget=H(n.widget);break;case"narrative":case"artist":case"event":case"curator":case"group":case"link_curator":case"video_playlist":case"app_action":case"vkpay":s(n);break;default:n.type;s(n);break}var u,p,m,h,_,C,M;return i}function _(e){const t={};for(const n of e)switch(n.attachment.type){case"photo":{if(!n.attachment.photo)break;const e=b({apiPhoto:n.attachment.photo,messageAccessKey:n.attachment.photo.access_key,position:n.position});if(!e)break;const o={attach:e,cmid:s.resolveCmid(n.cmid),authorId:a.resolveId(n.from_id),date:n.date};t.photos=(t.photos||[]).concat(o);break}case"audio":{if(!n.attachment.audio)break;const e={attach:P(n.attachment.audio),cmid:s.resolveCmid(n.cmid),authorId:a.resolveId(n.from_id),date:n.date};t.audios=(t.audios||[]).concat(e);break}case"video":{if(!n.attachment.video)break;const e=y({apiVideo:n.attachment.video,messageAccessKey:n.attachment.video.access_key,position:n.position});if(!e)break;const o={attach:e,cmid:s.resolveCmid(n.cmid),authorId:a.resolveId(n.from_id),date:n.date};t.videos=(t.videos||[]).concat(o);break}case"doc":{if(!n.attachment.doc)break;const e=k(n.attachment.doc);if(!e)break;const o={attach:e,cmid:s.resolveCmid(n.cmid),authorId:a.resolveId(n.from_id),date:n.date};t.docs=(t.docs||[]).concat(o);break}case"link":{if(!n.attachment.link)break;const e=g(n.attachment.link);if(!e)break;const o={attach:e,cmid:s.resolveCmid(n.cmid),authorId:a.resolveId(n.from_id),date:n.date};t.links=(t.links||[]).concat(o);break}case"mini_app":{if(!n.attachment.mini_app)break;const e=q(n.attachment.mini_app);if(!e)break;const o={attach:e,cmid:s.resolveCmid(n.cmid),authorId:a.resolveId(n.from_id),date:n.date};t.links=(t.links||[]).concat(o);break}case"audio_message":case"app_action":case"graffiti":case"market":case"share":case"wall":break;default:n.attachment.type}return t}function f(e){var t;const{geo:n,attachments:i,copy_history:r,access_key:s}=e,d=[];var c;n&&(null==(c=i)||c.push({type:"geo",geo:n}));for(const e of i||[])switch(e.type){case"photo":case"audio":case"video":case"doc":case"link":case"mini_app":case"sticker":case"market":case"article":case"poll":case"audio_playlist":case"podcast":case"market_album":case"donut_link":case"graffiti":d.push({type:e.type,[e.type]:e[e.type]});break;case"geo":{var l,u,p;if(!e.geo)break;const t=null==(l=e.geo.coordinates)?void 0:l.split(" ").map((e=>parseFloat(e)));d.push({type:"geo",geo:(0,o._)({},e.geo,{place:{title:null==(u=e.geo.place)?void 0:u.title,address:null==(p=e.geo.place)?void 0:p.address},coordinates:t&&t[0]&&t[1]?{latitude:t[0],longitude:t[1]}:void 0})});break}case"textlive":case"textpost":case"textpost_publish":case"posted_photo":case"note":case"app":case"page":case"album":case"event":case"situational_theme":case"group":case"artist":case"curator":case"photos_list":case"pretty_cards":case"narrative":case"video_playlist":case"clip":case"rooms":break;default:e.type}const m=h({apiAttaches:d,messageAccessKey:s});if(null==(t=r)?void 0:t[0]){const e=K(r[0]);m.wallHistory={kind:"WallHistory",id:r[0].id||0,authorId:a.resolveId(r[0].from_id),ownerId:a.resolveId(e),date:1e3*(r[0].date||0),text:r[0].text||""}}return m}function v(e){const t=[];for(const n of e)switch(n.type){case"photo":case"audio":case"video":case"doc":case"link":case"sticker":case"market":case"graffiti":case"market_album":case"geo":t.push({type:n.type,[n.type]:n[n.type]});break;case"note":case"page":case"audio_playlist":case"album":case"app":case"article":case"curator":case"donut_link":case"event":case"group":case"mini_app":case"narrative":case"photos_list":case"poll":case"posted_photo":case"pretty_cards":case"video_playlist":case"situational_theme":case"textlive":case"textpost":case"textpost_publish":case"podcast":case"artist":case"rooms":case"clip":break;default:n.type}return h({apiAttaches:t})}function g(e){var t,n,o,i;if(!e.title)return;let r=e.url;const a=/^https:\/\/m\.vk\.com(.+)/;if(a.test(e.url)){const t=e.url.match(a);r=t&&t[1]?t[1]:r}let s;var d,c,l,u;((null==(t=e.seller_product)?void 0:t.owner_name)||(null==(n=e.rating)?void 0:n.stars)||(null==(o=e.rating)?void 0:o.reviews_count)||(null==(i=e.seller_product)?void 0:i.favicon_link))&&(s={ownerName:null==(d=e.seller_product)?void 0:d.owner_name,rating:null==(c=e.rating)?void 0:c.stars,reviews:null==(l=e.rating)?void 0:l.reviews_count,favicon:null==(u=e.seller_product)?void 0:u.favicon_link});return{kind:"Link",url:r,meta:s,title:e.title,subtitle:e.caption||r,image:e.photo?N(e.photo.sizes||[]):void 0}}function k(e){var t,n,i;if(!e.url)return;const r=!!(null==(i=e.preview)||null==(n=i.photo)||null==(t=n.sizes)?void 0:t.length)&&N(e.preview.photo.sizes.map((e=>(0,o._)({},e,{url:e.src}))));return(0,o._)({kind:"Doc",id:e.id,ownerId:e.owner_id,title:e.title,size:e.size,ext:e.ext,date:e.date,url:e.url,isUnsafe:Boolean(e.is_unsafe)},r&&{image:r})}function b({apiPhoto:e,messageAccessKey:t,position:n}){var i;if(e.sizes)return(0,o._)({kind:"Photo",accessKey:e.access_key,albumId:e.album_id,id:e.id,ownerId:e.owner_id,hasTags:e.has_tags,sizes:N(e.sizes),originalImage:null==(i=e.orig_photo)?void 0:i.url,messageAccessKey:t,uploadDate:1e3*e.date,vkcomWebViewToken:e.web_view_token},n&&{position:n})}function y({apiVideo:e,messageAccessKey:t,position:n}){if(!e.id||!e.owner_id)return;const i=R(e.image||[{url:p,height:1,width:1}]);return i?(0,o._)({kind:"Video",accessKey:e.access_key,id:e.id,ownerId:e.owner_id,duration:e.duration,width:e.width,height:e.height,image:i,title:e.title,views:e.views||0,restriction:e.restriction,files:"files"in e?e.files:void 0,type:e.type,messageAccessKey:t,player:e.player,platform:e.platform,canDownload:e.can_download,uploadDate:e.date&&1e3*e.date,addingDate:e.adding_date&&1e3*e.adding_date},n&&{position:n}):void 0}function I(e){const t=!!e.is_expired,n=!!e.is_restricted,o=!t&&0!==e.can_see;return{kind:"Story",id:e.id,ownerId:e.owner_id,date:void 0!==e.date?1e3*e.date:void 0,restricted:n,expired:t,available:o,photo:e.photo&&b({apiPhoto:e.photo}),video:e.video&&y({apiVideo:e.video})}}function w(e){let t,n;switch(e.state){case"available":case"banned":case"deleted":case"paid":case"protected":t=e.state;break;case void 0:t="unknown";break;default:e.state;t="unknown"}return e.photo?n=N(e.photo.sizes||[]):e.owner_photo&&(n=N([{type:"o",width:0,height:0,url:e.owner_photo}])),{kind:"Article",state:t,url:e.url||"",title:e.title||"",author:e.owner_name||"",meta:e.subtitle||"",image:n}}const C={thumb:[48,96,256,512],photo:[34,68,135,270,300,600,1200],unknown:[]};function A(e,t){if(!e)return;const[n,...o]=C[t].reduce(((n,o)=>{const i=e[`${t}_${o}`];return i?(n.push({url:i,width:o,height:o}),n):n}),[]);return n?[n,...o]:void 0}function S(e){const t=A(e,"thumb");if(t)return{kind:"Gift",id:e.id,isStickerStyle:!!e.is_stickers_style,image:t}}function P(e){var t,n;return{kind:"Audio",id:e.id,ownerId:e.owner_id,artist:e.artist,title:e.title,subtitle:e.subtitle,url:e.url,duration:e.duration,albumId:e.album_id,trackCode:e.track_code,contentRestricted:e.content_restricted,albumPartNumber:e.album_part_number,thumb:null==(t=e.album)?void 0:t.thumb,isExplicit:null==(n=e)?void 0:n.is_explicit,accessKey:e.access_key}}function x(e){return{kind:"Voice",duration:e.duration,id:e.id,linkMp3:e.link_mp3,linkOgg:e.link_ogg,ownerId:e.owner_id,waveform:e.waveform,isTranscriptPossible:e.duration/60/60<1,transcription:M(e)}}function M(e){switch(e.transcript_state){case"done":var t;return{state:"done",text:null==(t=e.transcript)?void 0:t.trim(),updatedAt:e.transcript_update_time?1e3*e.transcript_update_time:void 0};case"error":case"in_progress":return{state:e.transcript_state};case void 0:return;default:e.transcript_state;return}}const E={0:"playlist",1:"album",2:"playlist",3:"playlist",4:"playlist",5:"playlist"};function F(e){var t,n;const o=null==(n=e.podcast_info)||null==(t=n.cover)?void 0:t.sizes,i=o&&N(o).values(),r=i&&(0,c.toNonEmpty)([...i])||void 0;return{kind:"Podcast",id:e.id,ownerId:e.owner_id,title:e.title,image:r}}function N(e){return e.sort(((e,t)=>e.width-t.width)).reduce(((e,t)=>{var{type:n,src:r,url:a}=t,s=(0,i._)(t,["type","src","url"]);return void 0===a||"s"!==n&&"m"!==n&&"x"!==n&&"o"!==n&&"p"!==n&&"q"!==n&&"r"!==n&&"y"!==n&&"z"!==n&&"w"!==n||(s.width&&s.height?e.set(n,(0,o._)({url:a},s)):e.set(n,(0,o._)({},s,{url:a,width:u,height:u}))),e}),new Map)}function R(e){const t=e.sort(((e,t)=>e.width-t.width)).map((e=>({width:e.width,height:e.height,url:e.url}))),[n,...o]=t;if(n)return[n,...o]}function U(e){var t;const n=null==(t=e.participants)?void 0:t.list;if(!n)return[];return n.reduce(((e,t)=>{const n=a.resolveAnyId(t);return(a.isUserPeerId(n)||a.isGroupPeerId(n))&&e.push(n),e}),[]).slice(0,3)}function T(e){var t,n,o;const i=function(e){switch(e.state){case"reached":return"reached";case"canceled_by_initiator":return"canceledByInitiator";case"canceled_by_receiver":return"canceledByReceiver";default:return}}(e);if(i)return{kind:"FinishedCall",initiatorId:e.initiator_id,duration:e.duration,state:i,participants:{list:null==(n=e.participants)||null==(t=n.list)?void 0:t.map(a.resolveId),count:(null==(o=e.participants)?void 0:o.count)||0,coverList:U(e)}}}function q(e){if(!e.app||!e.app.share_url||!e.app.webview_url)return;const t=(0,c.toNonEmpty)(e.images.map((({url:e,height:t,width:n})=>({width:n,height:t,url:e}))));if(!t)return;t.sort(((e,t)=>e.width-t.width));const n=e.app.share_url.replace(/https:\/\/[a-z0-9_\-.]+\//,""),o=n.split("#").slice(1).join("#");return{kind:"MiniApp",title:e.title,appLink:n,images:t,id:r.resolveMiniAppId(e.app.id),url:e.app.webview_url,shareUrl:e.app.share_url,hash:o}}function D(e){var t,n;const o=a.resolveId(e.owner_id);if(a.isGroupPeerId(o)&&(null==(t=e.action)?void 0:t.url)&&(null==(n=e.button.action)?void 0:n.url)&&e.button.title)return{kind:"DonutLink",ownerId:o,button:{action:{target:"internal",type:"open_url",url:e.button.action.url},title:e.button.title},donorsCount:e.donors.count,text:e.text,action:{target:"internal",type:"open_url",url:e.action.url}}}function j(e){var t,n;return{kind:"Poll",id:e.id,ownerId:a.resolveId(e.owner_id),authorId:void 0!==e.author_id?a.resolveId(e.author_id):a.resolveId(e.owner_id),title:e.question,anonymous:!!e.anonymous,endDate:1e3*e.end_date,answers:e.answers.map((t=>{var n;return{id:t.id,text:t.text,votes:t.votes,rate:t.rate,selected:!!(null==(n=e.answer_ids)?void 0:n.includes(t.id))}})),voted:!!(null==(t=e.answer_ids)?void 0:t.length),canVote:e.can_vote,canChangeVote:!e.disable_unvote,canEdit:e.can_edit,multiple:e.multiple,votes:e.votes,friends:(null==(n=e.friends)?void 0:n.map((e=>a.resolveId(e.id))))||[],backgroundGradient:B(e.background),backgroundPhoto:L(e.photo)}}function B(e){if(!e||"gradient"!==e.type)return;const{points:t,angle:n}=e;return void 0!==t&&void 0!==n?{id:e.id||0,points:t.map((e=>"#"+e.color)),angle:n}:void 0}function L(e){if(!e||!e.color||!e.images)return;const t=(0,c.toNonEmpty)(e.images.map((e=>({url:e.url,width:e.width,height:e.height}))));return t?{kind:"PollBackgroundPhoto",image:t,color:"#"+e.color}:void 0}function K({owner_id:e,source_id:t,to_id:n}){var o;return null!=(o=null!=e?e:t)?o:n}function G(e){if(!e.id||!e.owner_id)return;const t=R(e.image||[{url:"",height:0,width:0}]);return t?{kind:"VideoMessage",id:e.id,ownerId:e.owner_id,duration:e.duration,shapeId:e.shape_id||m,image:t,files:e.files,transcription:O(e)}:void 0}function O(e){switch(e.transcript_state){case"done":var t;return{state:"done",text:null==(t=e.transcript)?void 0:t.trim(),updatedAt:e.transcript_update_time?1e3*e.transcript_update_time:void 0};case"error":case"in_progress":case"uninitialized":return{state:e.transcript_state};case void 0:return;default:(0,c.exhaustivenessCheck)(e.transcript_state)}}function H(e){if(e.item.widget_id)return{kind:"Widget",id:e.item.widget_id,data:e}}},233300:(e,t,n)=>{n.d(t,{convertButtons:()=>p,fromApiKeyboard:()=>c,fromApiMessageEvent:()=>h,fromEngineKeyboard:()=>l});var o=n(434788),i=n(659397),r=n(197934),a=n(859352),s=n(96190),d=n(95154);function c(e,t){const n=u(e.buttons,e.inline),o=s.resolveId(e.author_id||t);return e.inline?{kind:"InlineKeyboard",authorId:o,buttons:n}:{kind:"InputKeyboard",authorId:o,buttons:n,oneTime:e.one_time}}function l(e,t){if(e.inline)return e.buttons?{kind:"InlineKeyboard",buttons:u(e.buttons,e.inline),authorId:s.resolveId(e.author_id||t)}:void 0;var n;if(!(null==(n=e.buttons)?void 0:n.length))return{kind:"InputKeyboardDeleteEvent"};return{kind:"InputKeyboardUpsertEvent",keyboard:{kind:"InputKeyboard",buttons:u(e.buttons,e.inline),authorId:s.resolveId(e.author_id||t),oneTime:e.one_time}}}function u(e,t){return e.map((e=>p(e,t)))}function p(e,t){return e.map((e=>function(e,t){const n="positive"===(a=e.color)?{mode:"primary",appearance:"positive"}:"negative"===a?{mode:"primary",appearance:"negative"}:"primary"===a?{mode:"primary"}:{mode:"secondary"};var a;switch(e.action.type){case"text":case"callback":return(0,o._)({type:e.action.type,label:(0,i.unescape)(e.action.label||""),payload:e.action.payload||""},n);case"open_link":return(0,o._)({type:e.action.type,link:e.action.link,label:(0,i.unescape)(e.action.label||""),payload:e.action.payload||""},n);case"location":return(0,o._)({type:e.action.type,payload:e.action.payload||""},n);case"vkpay":return{type:e.action.type,payload:e.action.payload||"",appId:(0,r.resolveMiniAppId)(d.VK_PAY_APP_ID),hash:e.action.hash||""};case"open_app":return(0,o._)({type:e.action.type,payload:e.action.payload||"",label:(0,i.unescape)(e.action.label||""),hash:e.action.hash||"",appId:(0,r.resolveMiniAppId)(e.action.app_id),ownerId:e.action.owner_id?s.resolveId(e.action.owner_id):void 0},n);case"open_photo":case"open_modal_view":return;default:return void e.action}}(e))).filter(m)}function m(e){return void 0!==e}const h=(e,t,n)=>{const{event_id:o,action:i,owner_id:d}=n,c=a.resolveEventId(o),l=s.resolveId(d);if(i)switch(i.type){case"show_snackbar":return{type:i.type,id:c,ownerId:l,text:i.text,title:s.name(e),photo:t.photo50,peerId:e.id};case"open_link":case"open_modal_view":return{type:i.type,id:c,ownerId:l,link:i.link,title:s.name(e),peerId:e.id};case"open_app":return{type:i.type,id:c,ownerId:l,appId:(0,r.resolveMiniAppId)(i.app_id),hash:i.hash,peerId:e.id};default:}return{type:"null",id:c,ownerId:l,peerId:e.id}}},634263:(e,t,n)=>{n.d(t,{fromApiTemplate:()=>s});var o=n(434788),i=n(820224),r=n(233300),a=n(694788);function s(e,t){var n;return{kind:"carousel",elements:(null==(n=e.elements)?void 0:n.map((e=>function(e,t){var{buttons:n,photo:s,action:d}=e,c=(0,i._)(e,["buttons","photo","action"]);const l=s?(0,a.fromApiPhoto)({apiPhoto:s,messageAccessKey:t}):null,u=(0,o._)({buttons:n?(0,r.convertButtons)(n,!0):[]},l&&{photo:l},c),p=(0,o._)({},u,{kind:"simple"});if(!d)return p;switch(d.type){case"open_photo":return s&&l?(0,o._)({},u,{kind:"photo",photo:l}):p;case"open_link":case"open_modal_view":return(0,o._)({},u,{kind:"link",link:d.link});default:return p}}(e,t))))||[]}}},739361:(e,t,n)=>{n.d(t,{fromApiChannel:()=>s});var o=n(839963),i=n(86144),r=n(504698),a=n(54965);const s=(e,t)=>{var n,s,d,c;const{channel:l,last_message:u}=e,p=u&&(0,a.fromApiPost)(u).post,m={confirmed:[],pending:[]};p&&(m.confirmed=p.cmid>1?[{kind:"GapNode",fromCmid:i.resolveCmid(1),toCmid:i.resolveCmid(p.cmid-1)},{kind:"Node",item:p}]:[{kind:"Node",item:p}]);const h=!l.user_data.notification_settings.is_enabled||(l.user_data.notification_settings.disable_duration||0)>0,_=i.resolveCmid((null==(s=l.user_data)||null==(n=s.read_state)?void 0:n.read_up_to_cmid)||0);return{kind:"Channel",id:o.resolveId(l.channel_id),unreadCount:(null==(d=l.user_data.read_state)?void 0:d.unread_count)||0,isArchived:!!(null==(c=l.user_data)?void 0:c.is_archived),isMuted:h,notificationsDisabledUntil:l.user_data.notification_settings.disable_duration||0,inReadCmid:_,majorSortId:l.sort_id.major_id,minorSortId:l.sort_id.minor_id,membersCount:t.members_count||0,isMember:Boolean(t.is_member),adminLevel:t.admin_level||0,photos:{photo50:t.photo_50,photo100:t.photo_100},name:t.name||"",description:r.fromServerText(t.description||""),activity:t.activity||"",isVerified:!!t.verified,screenName:t.screen_name,history:m,canSendDonut:!!t.can_post_donut,pending:{},isRepostsDisabled:Boolean(t.reposts_disabled)}}},508047:(e,t,n)=>{n.d(t,{fromApiConvoBanner:()=>i});var o=n(504698);function i(e){var t,n;return{icon:null!=(t=e.icon)?t:"",name:e.name,title:null!=(n=e.title)?n:"",chunks:o.fromServerText(e.text),canHide:e.can_hide||!0,buttons:(e.buttons||[]).map((e=>{var t,n,o,i;return{callbackData:null!=(o=null==(t=e)?void 0:t.callback_data)?o:"",mode:e.layout,appearance:r(e.style),link:null!=(i=null==(n=e)?void 0:n.link)?i:"",text:e.text,hideOnAction:!!e.hide_on_action,type:e.type}}))}}function r(e){return"destructive"===e?"negative":"regular"===e?"accent":e}},954811:(e,t,n)=>{n.d(t,{fromApiConvo:()=>p,fromLongpollPushSettings:()=>m});var o=n(434788),i=n(96190),r=n(185327),a=n(999504),s=n(777634),d=n(481186),c=n(233300),l=n(508047);const u={18:"peer_deleted",900:"peer_blacklisted_by_me",901:"peer_blacklisted",902:"peer_blacklisted",915:"disabled_by_community",916:"disabled_by_peer",917:"kicked",918:"no_access",922:"no_access",925:"no_access",932:"no_access",945:"chat_unsupported",946:"chat_unsupported",203:"disabled_by_peer"};function p(e,t){var n,u,p,m;const v=t&&(0,d.fromApiMessage)(t).message,g={confirmed:[],pending:[]};v?g.confirmed=v.cmid>1?[{kind:"GapNode",fromCmid:s.resolveCmid(1),toCmid:s.resolveCmid(v.cmid-1)},{kind:"Node",item:v}]:[{kind:"Node",item:v}]:void 0!==e.last_conversation_message_id&&e.last_conversation_message_id>0&&(g.confirmed=[{kind:"GapNode",fromCmid:1,toCmid:e.last_conversation_message_id}]);const k=e.current_keyboard&&(0,c.fromApiKeyboard)(e.current_keyboard);if("InlineKeyboard"===(null==(n=k)?void 0:n.kind))throw new Error("Не может прийти инлайн клавиатура для сообщения");const b={majorSortId:(null==(u=e.sort_id)?void 0:u.major_id)||0,minorSortId:(null==(p=e.sort_id)?void 0:p.minor_id)||0,unreadCount:e.unread_count||0,isMarkedUnread:!!e.is_marked_unread,isArchived:!!e.is_archived,inReadBy:s.resolveCmid(e.in_read_cmid),outReadBy:s.resolveCmid(e.out_read_cmid),folderIds:new Set((null==(m=e.folder_ids)?void 0:m.map(a.resolveId))||[]),isNew:!!e.is_new,canWrite:_(e),currentKeyboard:k,push:h(e.push_settings),history:g,unreadExpireables:new Set((e.expire_cmids||[]).map(s.resolveCmid)),unreadReactions:new Map((e.unread_reactions||[]).map((e=>[s.resolveCmid(e),void 0]))),convoBanner:e.conversation_bar&&(0,l.fromApiConvoBanner)(e.conversation_bar)},y=i.resolveId(e.peer.id);switch(e.peer.type){case"user":if(!i.isUserPeerId(y))return null;if(void 0!==e.message_request_data){const{status:t}=e.message_request_data;return"pending"===t?{convo:(0,o._)({},b,{kind:"MessageRequestUserConvo",peerId:y,MRStatus:t})}:null}return{convo:(0,o._)({},b,{kind:"UserConvo",peerId:y})};case"chat":{var I,w,C,A,S,P;if(!i.isChatPeerId(y))return null;if(!e.chat_settings)throw new Error("TODO chat convo has to has chat settings");const t=e.chat_settings.owner_id&&0!==e.chat_settings.owner_id?i.resolveId(e.chat_settings.owner_id):void 0,n=t&&(i.isUserPeerId(t)||i.isGroupPeerId(t))?t:void 0,a=(0,o._)({},b,{peerId:y,ownerId:n,unreadMentions:new Set((e.mention_cmids||[]).map(s.resolveCmid)),membersCount:e.chat_settings.members_count||0,state:e.chat_settings.state,isCasper:!!e.chat_settings.is_disappearing,isCommunityChat:!!t&&i.isGroupPeerId(t),isDonut:!!e.chat_settings.is_donut,isGroupChannel:!!e.chat_settings.is_group_channel,activeCall:f(e.call_in_progress),pinnedMessage:e.chat_settings.pinned_message?(0,d.fromApiPinnedMessage)(e.chat_settings.pinned_message):void 0,acl:(M=e.chat_settings.acl,{canChangeInfo:M.can_change_info,canChangeInviteLink:M.can_change_invite_link,canChangePin:M.can_change_pin,canInvite:M.can_invite,canPromoteUsers:M.can_promote_users,canSeeInviteLink:M.can_see_invite_link,canModerate:M.can_moderate,canCopyChat:M.can_copy_chat,canCall:M.can_call,canUseMassMentions:M.can_use_mass_mentions,canChangeServiceType:Boolean(M.can_change_service_type),canChangeStyle:Boolean(M.can_change_style),canSendReactions:!0}),permissions:e.chat_settings.permissions?(x=e.chat_settings.permissions,(0,o._)({},r.DEFAULT_CHAT_PERMISSIONS,x)):void 0,description:e.chat_settings.description,isService:Boolean(e.chat_settings.is_service),adminIds:new Set([...[t]||0,...e.chat_settings.admin_ids||[]].map(i.resolveId)),memberIds:new Set([]),invitedIds:new Set([]),shouldShortPollReactions:Boolean(e.chat_settings.short_poll_reactions)}),c={kind:"Chat",id:y,title:(null==(I=e.chat_settings)?void 0:I.title)||"",photo50:null==(w=e.chat_settings.photo)?void 0:w.photo_50,photo100:null==(C=e.chat_settings.photo)?void 0:C.photo_100,photo200:null==(A=e.chat_settings.photo)?void 0:A.photo_200,hasDefaultPhoto:(null==(S=e.chat_settings.photo)?void 0:S.is_default_photo)||(null==(P=e.chat_settings.photo)?void 0:P.is_default_call_photo),canCall:e.chat_settings.acl.can_call};if(void 0!==e.message_request_data){const{status:t,inviter_id:n}=e.message_request_data;return"pending"===t&&void 0!==n?{convo:(0,o._)({},a,{kind:"MessageRequestChatConvo",inviterPeerId:i.resolveId(n),MRStatus:t}),peer:c}:null}return"business_notify"===e.special_service_type?{convo:(0,o._)({},a,{kind:"BusinessNotify"}),peer:c}:{convo:(0,o._)({},a,{kind:"ChatConvo"}),peer:c}}case"group":return i.isGroupPeerId(y)?{convo:(0,o._)({},b,{peerId:y,kind:"GroupConvo"})}:null;case"email":return null;case"contact":return i.isContactPeerId(y)?{convo:(0,o._)({},b,{peerId:y,kind:"ContactConvo"})}:null;default:e.peer.type;return null}var x,M}function m(e){const t=Number(e[1].disabled_until);switch(t){case 0:return{mode:"everything",disabledUntil:0};case-1:return{mode:"every-mention",disabledUntil:1/0};default:return{mode:"every-mention",disabledUntil:1e3*t}}}function h(e){let t={mode:"everything",disabledUntil:0};return e?(e.disabled_forever?t={mode:"every-mention",disabledUntil:1/0}:e.disabled_until&&(t={mode:"every-mention",disabledUntil:1e3*e.disabled_until}),"everything"!==t.mode&&(e.disabled_mass_mentions&&(t=(0,o._)({},t,{mode:"direct-mention"})),e.disabled_mentions&&(t=(0,o._)({},t,{mode:"nothing"}))),t):t}function _(e){var t,n;const o=e.can_write;return"chat"===e.peer.type&&"rejected"===(null==(t=e.message_request_data)?void 0:t.status)?{allowed:!1,reason:"mr_rejected"}:(null==(n=o)?void 0:n.allowed)?{allowed:!0}:{allowed:!1,reason:(null==(i=o)?void 0:i.reason)&&u[o.reason]||"unknown"};var i}function f(e){if(!e)return;return{participants:{list:(e.participants.list||[]).reduce(((e,t)=>{const n=i.resolveAnyId(t);return(i.isUserPeerId(n)||i.isGroupPeerId(n))&&e.push(n),e}),[]),count:e.participants.count||0},joinLink:e.join_link,canFinishCall:Boolean(e.can_finish_call),hasLink:Boolean(e.has_link)}}},171949:(e,t,n)=>{n.d(t,{fromApiFolder:()=>i});var o=n(999504);function i(e){return{id:o.resolveId(e.id),name:e.name,unreadCount:0,unreadUnmutedCount:0,all:{peerIds:new Set,boundaryMinorId:1/0,hasMore:!0},unread:{peerIds:new Set,boundaryMinorId:1/0,hasMore:!0}}}},481186:(e,t,n)=>{n.d(t,{fromApiMessage:()=>_,fromApiPinnedMessage:()=>y,fromEngineMessage:()=>f});var o=n(659397),i=n(877740),r=n(694788),a=n(777634),s=n(96190),d=n(197934),c=n(504698),l=n(651285),u=n(89131),p=n(233300),m=n(634263),h=n(858289);function _(e){var t;if(e.action)return{message:{kind:"Service",id:a.resolveId(e.id),action:k({apiAction:e.action,apiAttaches:e.attachments}),peerId:s.resolveId(e.peer_id),cmid:a.resolveCmid(e.conversation_message_id),authorId:s.resolveId(e.from_id),sentAt:1e3*e.date,isOut:1===e.out,isSilent:e.is_silent,deleteTTL:void 0!==e.ttl?1e3*e.ttl:void 0},mentions:{hasDirect:!1,hasMass:!1}};const n=s.resolveId(e.peer_id);if(e.is_expired)return{message:{kind:"Expired",id:a.resolveId(e.id),cmid:a.resolveCmid(e.conversation_message_id),peerId:s.resolveId(e.peer_id),authorId:s.resolveId(e.from_id),isOut:1===e.out,isSilent:e.is_silent,sentAt:1e3*e.date},mentions:{hasDirect:!1,hasMass:!1}};const o=e.keyboard&&(0,p.fromApiKeyboard)(e.keyboard);if("InputKeyboard"===(null==(t=o)?void 0:t.kind))throw new Error("Кажется из апи пришла не инлайн клавиатура для сообщения");const i=a.resolveCmid(e.conversation_message_id),u=(0,r.fromApiAttach)({apiAttaches:b(e),messageAccessKey:`mail${e.peer_id}-${e.conversation_message_id}`,attachPositionOffset:0}),_=d.count(u);return{message:{kind:"Normal",id:a.resolveId(e.id),randomId:a.resolveRandomId(e.random_id),cmid:i,peerId:n,authorId:s.resolveId(e.from_id),chunks:c.fromServerText(e.text),isOut:1===e.out,isSilent:e.is_silent,isImportant:!!e.important,isPlayed:!!e.was_played,sentAt:1e3*e.date,updatedAt:e.update_time&&1e3*e.update_time,attaches:u,keyboard:o,replyMessage:e.reply_message?v(e.reply_message,n,i,_):void 0,forwardedMessages:g(e.fwd_messages,n,i,_),expireTTL:e.expire_ttl?1e3*e.expire_ttl:void 0,deleteTTL:void 0!==e.ttl?1e3*e.ttl:void 0,pinnedAt:e.pinned_at&&1e3*e.pinned_at,template:e.template?(0,m.fromApiTemplate)(e.template,`mail${e.peer_id}-${e.conversation_message_id}`):void 0,reactions:e.reactions?(0,h.fromApiMessageReactions)(e.reactions):new Map,reactionId:e.reaction_id?l.resolveId(e.reaction_id):void 0},mentions:{hasDirect:!1,hasMass:!1}}}function f(e,t,n){var d;let l,m,h,_,f,v,g,b,y,I;switch(e[0]){case 4:[,l,m,,h,_,f,v,g,b,I]=e;break;case 10004:[,I,m,,h,_,f,v,g,b,l]=e;break;case 5:case 18:[,l,m,h,_,f,v,g,b,I,y]=e;break;case 10005:case 10018:[,I,m,h,_,f,v,g,b,l,y]=e;break;default:(0,u.exhaustivenessCheck)(e)}const w=s.resolveId(h),{isOut:C,isImportant:A,noPush:S,isPlayed:P}=a.convertFlags(m),x=C||s.isFavorites(w,t),M="1"===v.is_silent;let E;if(E=void 0!==v.from?s.resolveId(Number(v.from)):x?t:w,v.source_act)return{message:{kind:"Service",id:a.resolveId(l),cmid:a.resolveCmid(I),peerId:w,authorId:E,action:k({apiAction:{conversation_message_id:v.source_chat_local_id?Number(v.source_chat_local_id):void 0,message:v.source_message,type:v.source_act,member_id:v.source_mid?Number(v.source_mid):void 0,text:v.source_text,old_text:v.source_old_text,style:v.source_style}}),deleteTTL:void 0!==v.ttl?1e3*Number(v.ttl):void 0,sentAt:1e3*_,isOut:x,isSilent:M},mentions:{hasDirect:!1,hasMass:!1},noPush:S};if("1"===v.is_expired)return{message:{kind:"Expired",id:a.resolveId(l),cmid:a.resolveCmid(I),isOut:x,isSilent:M,peerId:w,authorId:E,sentAt:1e3*_},mentions:{hasDirect:!1,hasMass:!1},noPush:!0};const F={hasDirect:!1,hasMass:!1};for(const e of v.marked_users||[])if(e[0]===i.IEngine.MarkedType.Mention)switch(e[1]){case"all":F.hasMass=F.hasMass||E!==t;break;case"online":F.hasMass=F.hasMass||e[2].includes(t);break;default:F.hasDirect=e[1].includes(t)}let N,R={};if("sticker"!==g.attach1_type&&"audiomsg"!==g.attach1_kind||!g.attachments)void 0!==g.attach1_type&&(R={unknown:[{data:g,kind:"Unknown"}]});else{const e=JSON.parse(g.attachments);Array.isArray(e)&&(R=(0,r.fromApiAttach)({apiAttaches:e,messageAccessKey:`mail${w}-${I}`}))}if(void 0!==g.reply){const e=JSON.parse(g.reply),t=n(a.resolveCmid(e.conversation_message_id));t&&(N=a.toForeign({message:t,rootPeerId:w,rootCmid:a.resolveCmid(I)}))}const U=v.keyboard?(0,p.fromEngineKeyboard)(v.keyboard,E):void 0;let T,q;return"InlineKeyboard"===(null==(d=U)?void 0:d.kind)?T=U:q=U,{message:{kind:"Normal",id:a.resolveId(l),cmid:a.resolveCmid(I),randomId:a.resolveRandomId(b),peerId:w,authorId:E,chunks:c.fromServerText((0,o.unescape)(f)),isOut:x,isSilent:M,isImportant:A,isPlayed:P,sentAt:1e3*_,updatedAt:y?1e3*y:void 0,pinnedAt:v.pinned_at?1e3*Number(v.pinned_at):void 0,expireTTL:v.expire_ttl?1e3*Number(v.expire_ttl):void 0,deleteTTL:void 0!==v.ttl?1e3*Number(v.ttl):void 0,attaches:R,replyMessage:N,keyboard:T,reactions:new Map},mentions:F,noPush:S,keyboardEvent:q}}function v(e,t,n,o){let i;if(e.peer_id&&(i=s.resolveId(e.peer_id)),e.is_expired)return{kind:"ForeignExpired",peerId:i,rootPeerId:t,rootCmid:n,isUnavailable:!!e.is_unavailable,cmid:a.resolveCmid(e.conversation_message_id),authorId:s.resolveId(e.from_id),sentAt:1e3*e.date};const l=(0,r.fromApiAttach)({apiAttaches:b(e),messageAccessKey:e.peer_id?`mail${e.peer_id}-${e.conversation_message_id}`:void 0,attachPositionOffset:o}),u=o+d.count(l);return{kind:"Foreign",peerId:i,rootPeerId:t,rootCmid:n,isUnavailable:!!e.is_unavailable,cmid:a.resolveCmid(e.conversation_message_id),authorId:s.resolveId(e.from_id),chunks:c.fromServerText(e.text),sentAt:1e3*e.date,updatedAt:e.update_time&&1e3*e.update_time,attaches:l,replyMessage:e.reply_message?v(e.reply_message,t,n,u):void 0,forwardedMessages:g(e.fwd_messages,t,n,u)}}function g(e,t,n,o){if(!e||0===e.length)return;let i,r=o;for(const o of e){const e=v(o,t,n,r);if("ForeignExpired"!==e.kind&&(r+=a.getMessageAttachmentsCount(e)),"ForeignExpired"!==e.kind)i?i.push(e):i=[e];else if(u.isDev)throw new Error("Исчезающих сообщений не может быть в пересланных.")}return i}function k({apiAction:e,apiAttaches:t}){const n={type:"unknown"};switch(e.type){case"chat_create":return e.text?{type:e.type,title:e.text}:n;case"chat_title_update":return e.text&&e.old_text?{type:e.type,title:e.text,oldTitle:e.old_text}:n;case"chat_photo_remove":case"chat_screenshot":case"chat_group_call_started":case"chat_invite_user_by_link":case"chat_invite_user_by_call_join_link":case"chat_kick_don":case"call_transcription_failed":return{type:e.type};case"chat_pin_message":case"chat_unpin_message":return{type:e.type,cmid:a.resolveCmid(e.conversation_message_id),chunks:e.message?c.fromServerText(e.message):[]};case"chat_photo_update":var o,i;const d=null==(i=null==(o=t)?void 0:o.find((e=>"photo"===e.type)))?void 0:i.photo;let l;return d&&(l=(0,r.fromApiPhoto)({apiPhoto:d})),{type:e.type,photo:l};case"chat_invite_user":case"chat_kick_user":case"accepted_message_request":{if(!e.member_id)return n;const t=s.resolveId(e.member_id);return s.isUserPeerId(t)||s.isGroupPeerId(t)?{type:e.type,peerId:t}:n}case"chat_invite_user_by_message_request":case"chat_invite_user_by_call":case"chat_kick_user_call_block":{if(!e.member_id)return n;const t=s.resolveId(e.member_id);return s.isUserPeerId(t)?{type:e.type,peerId:t}:n}case"conversation_style_update":case"conversation_style_update_action":let u;switch(e.style){case"disco":case"twilight":case"sunset":case"lagoon":case"marine":case"retrowave":case"candy":case"crimson":case"emerald":case"halloween_orange":case"halloween_violet":case"unicorn":case"midnight":case"easter_egg":case"frost":case"new_year":case"valentine":case"warm_valentine":case"womens_day":case"mable":case void 0:u=e.style;break;default:u="unknown"}return{type:e.type,style:u};case"custom":return e.message?{type:e.type,chunks:c.fromServerText(e.message)}:n;default:e.type;return n}}function b({attachments:e=[],geo:t}){return t?[...e,{type:"geo",geo:t}]:e}function y(e){const t=s.resolveId(e.peer_id),n=a.resolveCmid(e.conversation_message_id),o=s.resolveId(e.from_id);let i;return e.id&&(i=a.resolveId(e.id)),{kind:"Pinned",id:i,cmid:n,peerId:t,authorId:o,isUnavailable:!!e.is_unavailable,chunks:c.fromServerText(e.text),sentAt:1e3*e.date,forwardedMessages:e.fwd_messages?g(e.fwd_messages,t,n,0):void 0,replyMessage:e.reply_message?v(e.reply_message,t,n,0):void 0,attaches:(0,r.fromApiAttach)({apiAttaches:e.attachments||[]})}}},858289:(e,t,n)=>{n.d(t,{fromApiMessageReactions:()=>r});var o=n(651285),i=n(96190);function r(e){return e.sort(((e,t)=>t.count-e.count)).reduce(((e,t)=>(e.set(o.resolveId(t.reaction_id),{reactionId:o.resolveId(t.reaction_id),count:t.count,peerIds:new Set(t.user_ids.map(i.resolveId))}),e)),new Map)}},882670:(e,t,n)=>{n.d(t,{convertPlatform:()=>l,fromApiAnonym:()=>c,fromApiContact:()=>d,fromApiGroup:()=>s,fromApiUser:()=>a});var o=n(96190);const i=[6482950,6481715,6146827],r={1:"mobile",2:"mobile",3:"mobile",4:"mobile",5:"mobile",6:"other",7:"other"};function a(e){var t,n,r,a,s,d;const c={0:"unfamiliar",1:"outgoingRequest",2:"incomingRequest",3:"friends"};let l="other";(null==(t=e.online_info)?void 0:t.is_mobile)&&(l="mobile"),i.includes((null==(n=e.online_info)?void 0:n.app_id)||0)&&(l="vkme");const u={isOnline:!!(null==(r=e.online_info)?void 0:r.is_online),at:(null==(a=e.online_info)?void 0:a.status)?null==(s=e.online_info)?void 0:s.status:(null==(d=e.online_info)?void 0:d.last_seen)?1e3*e.online_info.last_seen:"not_show",platform:l},p=o.resolveRealId("User",e.id),m=Boolean(e.blacklisted),[,h]=e.photo_id?e.photo_id.split("_"):[],_=h?parseInt(h):null;return{user:{kind:"User",id:p,firstName:e.first_name,firstNameGen:e.first_name_gen||e.first_name,firstNameAcc:e.first_name_acc||e.first_name,lastName:e.last_name,lastNameGen:e.last_name_gen||e.last_name,lastNameAcc:e.last_name_acc||e.last_name,screenName:e.screen_name,sex:void 0!==e.sex?{0:"unknown",1:"female",2:"male"}[e.sex]:"unknown",photoId:_&&!isNaN(_)?_:void 0,photo50:e.photo_50,photo100:e.photo_100,photo200:e.photo_200,isVerified:Boolean(e.verified),isBlacklisted:m,isBlacklistedByMe:Boolean(e.blacklisted_by_me),isDeactivated:Boolean(e.deactivated),deactivationReason:e.deactivated,canCall:Boolean(e.can_call),canChangeFriendship:1===e.can_send_friend_request,canInviteToChats:!!e.can_invite_to_chats,canMessage:1===e.can_write_private_message,hasDefaultPhoto:1!==e.has_photo,followersCount:e.followers_count||0,friendship:void 0!==e.friend_status?c[e.friend_status]:c[0],mutualFriends:m?{hint:[],count:0}:void 0,contactName:e.contact_name,occupation:e.occupation,bdate:e.bdate,city:e.city,phone:e.mobile_phone,employeeMark:e.employee_mark},lastSeen:u}}function s(e){var t;const n=o.resolveRealId("Group",e.id);if(!e.type)throw new Error(`fromApiGroup содержит некорректный тип ${e.type}`);const i={0:"notMember",1:"member",2:"unsure",3:"declined",4:"outgoingRequest",5:"incomingRequest"}[e.member_status||0];return{kind:"Group",id:n,type:e.type,name:e.name,screenName:e.screen_name,photo50:e.photo_50,photo100:e.photo_100,photo200:e.photo_200,activity:e.activity,memberCount:e.members_count||0,membership:i,isDeactivated:Boolean(e.deactivated),isVerified:1===e.verified,isClosed:Boolean(e.is_closed),canMessage:1===e.can_message,canChangeMembership:0!==(null==(t=e.ban_info)?void 0:t.end_date)&&(0===e.is_closed||"member"===i||"incomingRequest"===i),mutualFriends:2===e.is_closed&&"member"!==i?{hint:[],count:0}:void 0,isBlacklistedByMe:1===e.is_messages_blocked,site:e.site}}function d(e){const t=o.resolveRealId("Contact",e.id),n=o.resolveId(e.user_id);return{kind:"Contact",id:t,name:e.name,userId:n,phone:e.phone,canWrite:e.can_write,photo50:e.photo_50,lastSeen:e.last_seen_status}}function c(e){const t=o.resolveAnyId(e.id);if(o.isAnonymPeerId(t))return{id:t,kind:"Anonym",name:e.name,photo50:e.photo_50,photo100:e.photo_100,photo200:e.photo_200,photo400:e.photo_400}}function l(e,t){let n=r[e]||"other";return i.includes(t)&&(n="vkme"),n}},54965:(e,t,n)=>{n.d(t,{fromApiPost:()=>p});var o=n(434788),i=n(86144),r=n(504698),a=n(96190),s=n(839963),d=n(434425),c=n(694788),l=n(249690);const u={id:"reactions",items:[{id:0,title:"Нравится",asset:{animation_url:"https://vk.com/reaction/3-reactions-0?c_uniq_tag=83b2081a8e4adfc36ee536f5f1b4ad470174c89678369a4b9dc5547614a3955e",images:[{url:"https://vk.com/reaction/1-reactions-0-48?c_uniq_tag=e6bee176471af6e4f7ca0f57ac099847d57b8101bf07944e47b42b097a6d8455",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-0-72?c_uniq_tag=d6f55fe94c0add8f817b447cbd804768752eb996c06ef222b39eb3fd35834780",width:72,height:72}],title:{color:{foreground:{light:"FF3347",dark:"FF5C5C"},background:{light:"FFEDED",dark:"3E2526"}}},title_color:{light:"FF3347",dark:"FF5C5C"}}},{id:1,title:"Смешно",asset:{animation_url:"https://vk.com/reaction/3-reactions-1?c_uniq_tag=a47193579880c0f53dd597a15d3bd57d4827820687c73d6128df2720647b42b9",images:[{url:"https://vk.com/reaction/1-reactions-1-48?c_uniq_tag=8f5eb3a1d6a6ec81aceff211782af3c9e9a5d1c837f0bfade6965a6844786f8b",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-1-72?c_uniq_tag=c852fcad6e67059878dcf1905e3e416fd89fbc61222ead100935a6fcc1dab4c9",width:72,height:72}],title:{color:{foreground:{light:"FF8000",dark:"FFC233"},background:{light:"FFF2D6",dark:"352E23"}}},title_color:{light:"FF8000",dark:"FFC233"}}},{id:2,title:"Ого!",asset:{animation_url:"https://vk.com/reaction/3-reactions-2?c_uniq_tag=b946fcbe262642bc920331746b6eccd9f175bb17d8ef37e54d232fa35ca2c750",images:[{url:"https://vk.com/reaction/1-reactions-2-48?c_uniq_tag=2a6544dce8827d216db7ea91eafc726cd3a823f5d465ba00216901a6de2801ad",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-2-72?c_uniq_tag=5a0663f3d38dd6fbcf3e4973610d50641420631c9df30b6cf80eee0dd5c5efee",width:72,height:72}],title:{color:{foreground:{light:"FF8000",dark:"FFC233"},background:{light:"FFF2D6",dark:"352E23"}}},title_color:{light:"FF8000",dark:"FFC233"}}},{id:3,title:"Восторг",asset:{animation_url:"https://vk.com/reaction/3-reactions-3?c_uniq_tag=c6ed3add99e841dccda5479c8e21779954e61e0fba15f94a2ae16706df492123",images:[{url:"https://vk.com/reaction/1-reactions-3-48?c_uniq_tag=eda1a2c18d733b356babdeed5f52cdcc64dd59f1f69776a133fc34a5627eecee",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-3-72?c_uniq_tag=be09c5080773a9ba78984406588c7371e48073e80b842eb7c9a817f7b435379b",width:72,height:72}],title:{color:{foreground:{light:"FF8000",dark:"FFC233"},background:{light:"FFF2D6",dark:"352E23"}}},title_color:{light:"FF8000",dark:"FFC233"}}},{id:5,title:"Печаль",asset:{animation_url:"https://vk.com/reaction/3-reactions-5?c_uniq_tag=c61122c8c334154cb10ccf0e0687057bf1f0f40c2817198b2e1150df534c22c4",images:[{url:"https://vk.com/reaction/1-reactions-5-48?c_uniq_tag=31bcb230babad96120a62589c52af22811aaba54d4ed73a36cfd499d9d94102f",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-5-72?c_uniq_tag=a840d0eb581c133d97638ff5bf34f4b33f3fb8557b932cfe3516925b88e2f151",width:72,height:72}],title:{color:{foreground:{light:"4986CC",dark:"71AAEB"},background:{light:"EDF3FA",dark:"27303C"}}},title_color:{light:"4986CC",dark:"71AAEB"}}},{id:4,title:"&$#%!",asset:{animation_url:"https://vk.com/reaction/3-reactions-4?c_uniq_tag=063e6b2dd888bb5a9716cf6153f03bf9c0c9707713b857eed8fe1e4e09aea2b3",images:[{url:"https://vk.com/reaction/1-reactions-4-48?c_uniq_tag=c80e3224c299a73384c057ff065c9458dcd533d57a1458875eb98883c3a96783",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-4-72?c_uniq_tag=a0eddba1ec31f96adbb9afa2c6c14bec055b95f8d9f113bdf759fb5a9c9054f0",width:72,height:72}],title:{color:{foreground:{light:"EF5203",dark:"FA5300"},background:{light:"FDEBE8",dark:"3C2421"}}},title_color:{light:"EF5203",dark:"FA5300"}}}]};function p(e){var t,n,p,_,f,v,g,k,b,y,I,w,C,A,S,P,x,M,E,F,N,R,U,T,q,D,j,B,L,K;const G=(0,o._)({},null==(p=e)||null==(n=p.attachments)||null==(t=n[0])?void 0:t.wall,{attachments:h(e)}),O=null==(f=G)||null==(_=f.copy_history)?void 0:_[0];let H={};if(O){const e=(0,c.apiAttachWallOwnerId)(O),t="reply"===O.post_type;H=(0,o._)({},H,t?{wallReply:{kind:"WallReply",id:O.id||0,postId:O.reply_post_id||0,authorId:a.resolveId(O.from_id),ownerId:a.resolveId(e),parentsStack:O.parents_stack,date:1e3*(O.date||0),chunks:r.fromServerText(O.text||""),attaches:(0,c.fromApiWallAttach)(O)}}:{wall:{kind:"Wall",isAds:"post_ads"===O.post_type,id:O.id||0,authorId:a.resolveId(O.from_id),ownerId:a.resolveId(e),date:1e3*(O.date||0),chunks:r.fromServerText(O.text||""),attaches:(0,c.fromApiWallAttach)(O)}}),G.copy_history=void 0}(null==(v=G)?void 0:v.attachments)&&(H=(0,o._)({},H,(0,c.fromApiWallAttach)(G)));let V=[],W=[];return u.items.forEach((e=>{const t=(0,l.fromApiReaction)(e);t&&(V.push(t),W.push(t.id))})),{post:{topicId:G.topic_id,kind:"Normal",cmid:i.resolveCmid(e.cmid),chunks:(null==(g=G)?void 0:g.text)?r.fromServerText(G.text):[],views:(null==(b=G)||null==(k=b.views)?void 0:k.count)||0,sentAt:1e3*e.time,updatedAt:e.update_time&&1e3*e.update_time,channelId:s.resolveId(e.author_id),likes:{count:(null==(I=G)||null==(y=I.likes)?void 0:y.count)||0,reactionId:Boolean(null==(C=G)||null==(w=C.likes)?void 0:w.user_likes)?d.resolveId(null==(S=G)||null==(A=S.reactions)?void 0:A.user_reaction):void 0,availableReactionIds:W,peerIds:new Set},reposts:{count:(null==(x=G)||null==(P=x.reposts)?void 0:P.count)||0,isReposted:Boolean(null==(E=G)||null==(M=E.reposts)?void 0:M.user_reposted)},comments:{count:(null==(N=G)||null==(F=N.comments)?void 0:F.count)||0,oneLevelCount:0,canView:Boolean(null==(U=G)||null==(R=U.comments)?void 0:R.can_view),canPost:Boolean(null==(q=G)||null==(T=q.comments)?void 0:T.can_post),history:[],order:"interesting"},attaches:H,rights:{canDelete:1===G.can_delete,canEdit:1===G.can_edit},donut:{isDonut:null==(D=G.donut)?void 0:D.is_donut,placeholder:(null==(j=G.donut)?void 0:j.placeholder)?{text:null==(B=G.donut.placeholder)?void 0:B.text,button:null==(L=G.donut.placeholder)?void 0:L.button}:void 0,duration:m(null==(K=G.donut)?void 0:K.paid_duration)},signerId:G.signer_id?a.resolveId(G.signer_id):void 0,markedAsAds:Boolean(G.marked_as_ads)},reactions:V}}function m(e){return-1===e||void 0===e?-1:e/60/60/24}function h(e){var t,n,o,i,r;const a=null==(o=e)||null==(n=o.attachments)||null==(t=n[0])?void 0:t.wall,s=null==(i=a)?void 0:i.geo,d=(null==(r=a)?void 0:r.attachments)||[];return s?[...d,{type:"geo",geo:s}]:d}},249690:(e,t,n)=>{n.d(t,{fromApiReaction:()=>i});var o=n(434425);function i(e){var t,n,i,r,a,s;if(!e.asset.animation_url||!(null==(t=e.asset.title_color)?void 0:t.dark)||!(null==(n=e.asset.title_color)?void 0:n.light))return;const d=null==(i=e.asset.images.find((e=>48===e.height)))?void 0:i.url,c=null==(r=e.asset.images.find((e=>72===e.height)))?void 0:r.url;return d&&c?{id:o.resolveId(e.id),animation:e.asset.animation_url,title:e.title,image48:d,image72:c,color:{light:null==(a=e.asset.title_color)?void 0:a.light,dark:null==(s=e.asset.title_color)?void 0:s.dark}}:void 0}},986727:(e,t,n)=>{n.d(t,{fromApiSticker:()=>i,fromApiStickersKeywords:()=>r,fromApiUgcSticker:()=>a,fromContextSticker:()=>s});var o=n(71568);function i(e){return{id:o.resolveStickerId(e.sticker_id),kind:"Sticker",item:e}}function r(e){return e.dictionary.reduce(((e,t)=>{const n=(t.stickers||[]).map((e=>i(e).id));for(const o of t.words)e[o]=n;return e}),{})}const a=e=>({kind:"UgcSticker",id:e.id,item:e}),s=e=>e.isUGC?{id:e.id,kind:"UgcSticker",item:e.rawData}:{id:e.id,kind:"Sticker",item:e.rawData}},877740:(e,t,n)=>{var o;n.d(t,{IEngine:()=>o}),function(e){let t,n,o;!function(e){e[e.Mention=1]="Mention",e[e.ExpiringMessage=2]="ExpiringMessage"}(t=e.MarkedType||(e.MarkedType={})),function(e){e[e.CopyFlagChanged=0]="CopyFlagChanged",e[e.TitleChanged=1]="TitleChanged",e[e.AvatarChanged=2]="AvatarChanged",e[e.AdminGrated=3]="AdminGrated",e[e.FlagsChanged=4]="FlagsChanged",e[e.Pinned=5]="Pinned",e[e.UserJoined=6]="UserJoined",e[e.UserLeft=7]="UserLeft",e[e.UserKicked=8]="UserKicked",e[e.AdminKicked=9]="AdminKicked",e[e.BannerChanged=10]="BannerChanged",e[e.KeyboardChanged=11]="KeyboardChanged",e[e.MessageRequestChanged=12]="MessageRequestChanged",e[e.ContactConverted=13]="ContactConverted",e[e.BusinessNotifyDataChanged=14]="BusinessNotifyDataChanged",e[e.MessageRequestCanceled=15]="MessageRequestCanceled",e[e.MessageRequestRejected=16]="MessageRequestRejected",e[e.MessageRequestAccepted=17]="MessageRequestAccepted",e[e.ContactJoined=18]="ContactJoined",e[e.CallInProgressChanged=19]="CallInProgressChanged",e[e.DonSubscribed=20]="DonSubscribed",e[e.DonUnsubscribed=21]="DonUnsubscribed",e[e.IsNewChange=22]="IsNewChange",e[e.StyleChanged=23]="StyleChanged",e[e.DescriptionChanged=24]="DescriptionChanged",e[e.ShortPollReactionsChanged=25]="ShortPollReactionsChanged"}(n=e.ChatUpdateType||(e.ChatUpdateType={})),function(e){e[e.Deleted=0]="Deleted",e[e.Accepted=1]="Accepted",e[e.Rejected=2]="Rejected",e[e.New=3]="New"}(o=e.MRStatus||(e.MRStatus={})),e.isIncompleteUpdate=function(e){switch(e[0]){case 10004:{const t=12;return e.length<t}case 10005:{const t=11;return e.length<t}case 10018:{const t=11;return e.length<t}case 4:{const t=12;return e.length<t}case 5:{const t=11;return e.length<t}case 18:{const t=11;return e.length<t}default:return!1}}}(o||(o={}))},991792:(e,t,n)=>{n.d(t,{TypingVariants:()=>m,addConvosToFolder:()=>I,getConvosByIds:()=>w,getOwnerGroupId:()=>b,insertChannels:()=>k,insertContactItems:()=>f,insertContacts:()=>v,insertConvos:()=>h,insertFolders:()=>g,insertPeers:()=>_,removeConvosFromFolder:()=>y});var o=n(185327),i=n(96190),r=n(821551),a=n(839963),s=n(999504),d=n(954811),c=n(882670),l=n(171949),u=n(739361),p=n(54965);const m=["text","voice","photo","video","file","videomessage"];function h(e,t,{dangerouslyMerge:n}={}){const i=[];for(const r of t){var a;const t="conversation"in r?(0,d.fromApiConvo)(r.conversation,r.last_message):(0,d.fromApiConvo)(r);if(!t)continue;const{convo:s,peer:c}=t,l=e.convos.get(s.peerId);if(l&&!n){i.push(l);continue}const u=o.merge(s,l);e.convos.set(s.peerId,u),c&&e.peers.set(c.id,c),i.push(s),"ChatConvo"===u.kind&&e.hiddenPinnedMessages.get(u.peerId)!==(null==(a=u.pinnedMessage)?void 0:a.cmid)&&e.hiddenPinnedMessages.delete(u.peerId)}const s=i.filter((e=>!o.isMR(e)&&!o.isBusinessNotify(e)));return r.add(e.convosSearchIndex,s,(t=>{const n=e.peers.get(t.peerId);return{id:t.peerId,strings:n?r.peerWords(n):[]}})),i}function _(e,{apiUsers:t,apiGroups:n,apiContacts:o},{dangerouslyOverwrite:i}={}){const r=[];for(const n of t){var a;const{user:t,lastSeen:o}=(0,c.fromApiUser)(n);e.lastSeens.set(t.id,o);const s=e.peers.get(t.id);"User"!==(null==(a=s)?void 0:a.kind)||i?(e.peers.set(t.id,t),r.push(t)):r.push(s)}const s=[];for(const t of n){const n=(0,c.fromApiGroup)(t),o=e.peers.get(n.id);!o||"Group"!==o.kind||i?(e.peers.set(n.id,n),s.push(n)):s.push(o)}const d=[];for(const t of o){const n=(0,c.fromApiContact)(t),o=e.peers.get(n.id);!o||"Contact"!==o.kind||i?(e.peers.set(n.id,n),d.push(n)):d.push(o)}return{insertedUsers:r,insertedGroups:s,insertedContacts:d}}function f(e,t,n){const o=[];return _(e,{apiUsers:n,apiGroups:[],apiContacts:[]},{dangerouslyOverwrite:!0}),t.forEach((t=>{const n=i.resolveId(t);if(i.isUserPeerId(n)){var r;const t=e.peers.get(n);if("User"!==(null==(r=t)?void 0:r.kind))return;e.contacts.items.set(n,t),o.push(n)}})),o}function v(e,t){const n=[];t.sort(((e,t)=>e.name.localeCompare(t.name)));for(const o of t){const t=(0,c.fromApiContact)(o),i=t.userId?t.userId:t.id;e.contacts.contacts.set(i,t),n.push(t)}return n}function g(e,t){const n=[];for(const o of t){const t=(0,l.fromApiFolder)(o);e.organisers.folders.find((e=>e.id===t.id))?n.push(t):(e.organisers.folders.push(t),n.push(t))}return n}function k(e,{apiChannels:t,apiGroups:n,dangerouslyMerge:o}){const i=[];for(const s of t){var r;const t=n.find((e=>-e.id===s.channel.channel_id));if(!t)throw new Error("С бэка не приходит нужная группа для канала");const d=(0,u.fromApiChannel)(s,t);(s.last_message&&(0,p.fromApiPost)(s.last_message).reactions||[]).forEach((t=>{e.reactions.set(t.id,t)}));let c=e.channels.get(d.id);if("ChannelRestricted"===(null==(r=c)?void 0:r.kind)&&(c=void 0),c&&!o){i.push(c);continue}const l=c?a.merge(c,d):d;e.channels.set(l.id,l),i.push(l)}return i}function b(e){return i.isGroupPeerId(e)?i.toRealId(e):0}function y(e,t,n){const i=e.organisers.folders.find((e=>e.id===t));if(!i)return;var r;let a=null!=(r=i.unreadCount)?r:0;var d;let c=null!=(d=i.unreadUnmutedCount)?d:0;for(const i of n)o.isInFolder(i,t)&&(o.removeFolder(i,t),s.refresh(e.organisers.folders,i),i.unreadCount&&(o.isMuted(i)?a--:c--));s.setUnreadCounters(e.organisers.folders,t,a,c)}function I(e,t,n){const i=[],r=e.organisers.folders.find((e=>e.id===t));if(!r)return;var a;let d=null!=(a=r.unreadCount)?a:0;var c;let l=null!=(c=r.unreadUnmutedCount)?c:0;for(const e of n)o.isInFolder(e,t)||(o.addFolder(e,t),i.push(e),e.unreadCount&&(o.isMuted(e)?d++:l++));s.push(e.organisers.folders,t,"all",i,r.all.hasMore),s.push(e.organisers.folders,t,"unread",i.filter((e=>o.isUnread(e))),r.unread.hasMore),s.setUnreadCounters(e.organisers.folders,t,d,l)}function w(e,t){return t.reduce(((t,n)=>{const o=e.convos.get(i.resolveId(n));return o&&t.push(o),t}),[])}}}]);try{stManager.done("dist/8d0a62ab5c45600d60af72c18bc20c9c.0ca241f6da7fae414b42.js")}catch(e){}