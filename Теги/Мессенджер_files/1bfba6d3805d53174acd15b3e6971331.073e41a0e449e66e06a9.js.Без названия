"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[12636],{891047:(e,t,n)=>{function a(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function r(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=a(n);return(e,n)=>r.then((a=>n(a.transaction(t,e).objectStore(t))))}let s;function o(){return s||(s=r("keyval-store","keyval")),s}function d(e,t=o()){return t("readonly",(t=>a(t.get(e))))}function i(e,t,n=o()){return n("readwrite",(n=>(n.put(t,e),a(n.transaction))))}function l(e,t,n=o()){return n("readwrite",(n=>new Promise(((r,s)=>{n.get(e).onsuccess=function(){try{n.put(t(this.result),e),r(a(n.transaction))}catch(e){s(e)}}}))))}function c(e,t=o()){return t("readwrite",(t=>(t.delete(e),a(t.transaction))))}function g(e=o()){return e("readwrite",(e=>(e.clear(),a(e.transaction))))}n.d(t,{clear:()=>g,createStore:()=>r,del:()=>c,get:()=>d,set:()=>i,update:()=>l})},861184:(e,t,n)=>{n.d(t,{default:()=>a});const a={counter:"BadgeCounter-module__counter--ZG07d"}},430935:(e,t,n)=>{n.d(t,{default:()=>a});const a={root:"BadgeItem-module__root--ZnkG6",wrapper:"BadgeItem-module__wrapper--UDxg1"}},838455:(e,t,n)=>{n.d(t,{default:()=>a});const a={root:"BadgeItems-module__root--MdiCD"}},565293:(e,t,n)=>{n.d(t,{default:()=>a});const a={items:"BadgesOwnerBlockSkeleton-module__items--b27KV"}},259688:(e,t,n)=>{n.d(t,{default:()=>a});const a={card:"BadgesOwnerInfoCard-module__card--1VfEo",preview:"BadgesOwnerInfoCard-module__preview--xOjSA",title:"BadgesOwnerInfoCard-module__title--J0JB9",description:"BadgesOwnerInfoCard-module__description--jpXGI",users:"BadgesOwnerInfoCard-module__users--ylWIJ"}},368079:(e,t,n)=>{n.d(t,{default:()=>a});const a={items:"BadgesOwnerInfoModal-module__items--_C8HX",counter:"BadgesOwnerInfoModal-module__counter--dcVke",layout:"BadgesOwnerInfoModal-module__layout--H96gr",infinityScroll:"BadgesOwnerInfoModal-module__infinityScroll--UYZOg",body:"BadgesOwnerInfoModal-module__body--xEx7W",settings:"BadgesOwnerInfoModal-module__settings--Cxf6L",previewItems:"BadgesOwnerInfoModal-module__previewItems--wFB2n",previewItem:"BadgesOwnerInfoModal-module__previewItem--pGWtg",preview:"BadgesOwnerInfoModal-module__preview--gp4eL",previewImage:"BadgesOwnerInfoModal-module__previewImage--pynTV",previewTitle:"BadgesOwnerInfoModal-module__previewTitle--ABKH3",previewDescription:"BadgesOwnerInfoModal-module__previewDescription--ePYzt"}},478826:(e,t,n)=>{n.d(t,{getUserFullName:()=>a});const a=e=>{const{first_name:t,last_name:n}=e;return`${t} ${n}`}},678755:(e,t,n)=>{n.d(t,{BadgeCounter:()=>i});var a=n(434788),r=n(512796),s=n(785893),o=n(86894),d=n(861184);const i=e=>{var t=(0,a._)({},(0,r._)(e));return(0,s.jsx)(o.Counter,(0,a._)({className:d.default.counter,mode:"inherit"},t))}},719293:(e,t,n)=>{n.d(t,{BadgeSenderItem:()=>u});var a=n(434788),r=n(820224),s=n(785893),o=n(86894),d=n(448575),i=n(221780),l=n(82161),c=n(354082),g=n(478826);function u(e){var{entry:t,user:{id:n,first_name:u,last_name:_,domain:p,photo_100:h,photo_200:w}}=e,b=(0,r._)(e,["entry","user"]);const m=(0,g.getUserFullName)({first_name:u,last_name:_}),B=((0,l.isRetina)()?w:h)||h||"";let v=null;return t.object_description&&(v=(0,c.parseReactWikiLinks)(t.object_description,{target:"_blank"})),v=(0,s.jsxs)(s.Fragment,{children:[v,(0,s.jsx)("br",{}),t.is_private&&i.getLang("awards_private_text")]}),(0,s.jsx)(o.RichCell,(0,a._)({before:(0,s.jsx)(o.Avatar,{size:100,src:B,title:m}),caption:v,href:p?`/${p}`:void 0,target:"_blank",onClick:()=>{d.WebStatEvents.add({screen:"badge",type:"type_click",type_click:{type:"type_badges_screen_item",item:{type:"badges",id:n},type_badges_screen_item:{type_badges_event:{event_name:"open_sender"}}}})}},b,{children:m}))}},415796:(e,t,n)=>{n.d(t,{BadgeItem:()=>i,BadgeItemWrapper:()=>d});var a=n(785893),r=n(849776),s=n(678755),o=n(430935);const d=({children:e})=>(0,a.jsx)("div",{className:o.default.wrapper,children:e}),i=({badge:e,counter:t})=>{if(!e)return null;const n=(0,r.getBadgeImage)(e.image,128);return(0,a.jsx)(d,{children:(0,a.jsx)("div",{style:{backgroundImage:`url('${n}')`},className:o.default.root,children:(0,a.jsx)(s.BadgeCounter,{size:"s",children:t})})})}},726914:(e,t,n)=>{n.d(t,{BadgeItems:()=>i});var a=n(785893),r=n(667294),s=n(86894),o=n(415796),d=n(838455);const i=({counters:e,badges:t,onClick:n})=>{const i=(0,r.useMemo)((()=>{var n;return((null==(n=e)?void 0:n.filter((e=>"total"!==e.type)))||[]).map((({value:e,badge_id:n})=>{if(!n)return null;const r=t.find((({id:e})=>n===e));return(0,a.jsx)(o.BadgeItem,{counter:e,badge:r},n)}))}),[e,t]);return(0,a.jsx)(s.HorizontalScroll,{arrowSize:"m",children:(0,a.jsx)("div",{className:d.default.root,onClick:n,tabIndex:0,role:"button",children:i})})}},704919:(e,t,n)=>{n.d(t,{BadgesOwnerBlockSkeleton:()=>_});var a=n(434788),r=n(785893),s=n(667294),o=n(444972),d=n(513724),i=n(399639),l=n(659397),c=n(415796),g=n(565293);const u=(0,l.createArray)(4),_=e=>{const t=(0,s.useMemo)((()=>u.map(((e,t)=>(0,r.jsx)(c.BadgeItemWrapper,{children:(0,r.jsx)(o.Skeleton,{width:56,height:56,circle:!0})},t)))),[56,4]);return(0,r.jsx)(d.Group,(0,a._)({header:(0,r.jsx)(i.Header,{children:(0,r.jsx)(o.Skeleton,{width:192})})},e,{children:(0,r.jsx)("div",{className:g.default.items,children:t})}))}},518285:(e,t,n)=>{n.d(t,{BadgesOwnerInfoCard:()=>c});var a=n(785893),r=n(86894),s=n(360470),o=n(29271),d=n(849776),i=n(678755),l=n(259688);const c=({badge:e,counter:t,recentSenderUsers:n,sendersCount:c,onClick:g})=>{var u;const _=null==(u=n)?void 0:u.slice(0,3).map((({photo_200:e})=>String(e)));return(0,a.jsxs)(r.Tappable,{className:l.default.card,onClick:g,children:[(0,a.jsx)("div",{className:l.default.preview,"aria-label":e.title,style:{backgroundImage:`url('${(0,d.getBadgeImage)(e.image,128)}')`},children:(0,a.jsx)(i.BadgeCounter,{children:t})}),(0,a.jsx)(r.Title,{className:l.default.title,level:"2",weight:"1",children:e.title}),(0,a.jsx)(r.Text,{className:l.default.description,weight:"3",children:e.description}),Boolean(n.length)&&(0,a.jsx)("div",{className:l.default.users,children:(0,a.jsx)(s.UsersStack,{size:"l",photos:_,children:o.getLang("awards_senders_count",c).replace("{count}",String(c))})})]})}},55163:(e,t,n)=>{n.d(t,{BadgesOwnerInfoModal:()=>x});var a=n(434788),r=n(785893),s=n(667294),o=n(723062),d=n(212147),i=n(599809),l=n(448575),c=n(169447),g=n(784118),u=n(86894),_=n(400856),p=n(345658),h=n(385235),w=n(461629),b=n(816511),m=n(685371),B=n(518285),v=n(719293),f=n(460854),I=n(678755),S=n(254667),y=n(29271),O=n(849776),k=n(460033),j=n(368079);class x extends s.Component{componentDidMount(){l.WebStatEvents.add({screen:"badge",type:"type_navgo",type_navgo:{type:"type_badges_screen_item",subtype:"go",item:{type:"badges",owner_id:this.props.ownerId},type_badges_screen_item:{type_badges_event:{event_name:"open_badges_collection_all__"+(o.Ranges.isUserId(this.props.ownerId)?"u":"c")}}}}),this.fetchOwnerInfo()}componentWillUnmount(){window.removeEventListener("online",this.fetchOwnerInfo),window.removeEventListener("online",this.fetchOwnerEntries)}componentDidUpdate(){const{currentBadgeId:e}=this.state;e&&!this.getBadgeEntries(e)&&this.fetchOwnerEntries()}renderHeader(){const{isOwnerInfoLoaded:e,currentBadgeId:t,isAdmin:n}=this.state,{ownerId:a}=this.props;return(0,r.jsx)(_.ModalHeader,{closeAriaLabel:y.getLang("awards_back_button"),onClose:this.props.close,before:e&&t&&(0,r.jsxs)(p.ModalHeaderButton,{"aria-label":y.getLang("awards_back_button"),onClick:()=>this.selectBadge(null),children:[(0,r.jsx)(c.Icon20ChevronLeftOutline,{}),y.getLang("awards_back_button")]}),after:n&&(0,r.jsx)(h.Link,{className:j.default.settings,href:(()=>{const e=`${location.protocol}//${window.vk.host}`;let t;return o.Ranges.isGroupId(a)?(t=new URL(`public${Math.abs(a)}`,e),t.searchParams.set("act","sections")):(t=new URL("settings",e),t.searchParams.set("act","privacy"),t.searchParams.set("hl","badges")),t.toString()})(),target:"_blank",children:(0,r.jsx)(g.Icon20GearOutline,{})}),children:e&&!t?this.renderHeaderTitle():null})}renderHeaderTitle(){const{ownerId:e}=this.props,{totalCount:t}=this.state,n=t>0?(0,r.jsx)("span",{className:j.default.counter,children:t}):null;let a="";return a=e===window.vk.id?y.getLang("awards_my_badges"):o.Ranges.isGroupId(e)?y.getLang("awards_group_block_header"):y.getLang("awards_profile_block_header"),(0,r.jsxs)(r.Fragment,{children:[a," ",n]})}renderContent(){const{counters:e,currentBadgeId:t}=this.state;return t?this.renderBadgeInfo():(0,r.jsx)("div",{className:j.default.items,children:e.map((({badge_id:e,value:t,recent_sender_ids:n,senders_count:a},s)=>(0,r.jsx)(B.BadgesOwnerInfoCard,{badge:this.getBadgeById(e||0),counter:t,recentSenderUsers:this.getUsersById(n||[]),sendersCount:a||0,onClick:()=>this.selectBadge(e||null)},s)))})}renderBadgeInfo(){var e,t;const{currentBadgeId:n,counters:a}=this.state,s=this.getBadgeEntries(n||0),o=this.getBadgeById(n||0),d=(null==(e=a.find((e=>e.badge_id===n)))?void 0:e.value)||0;return s?(0,r.jsxs)(k.ReexportInfiniteScroll,{className:j.default.infinityScroll,hasMore:Boolean(s.next_query),loadMore:this.fetchOwnerEntries,children:[(0,r.jsxs)("div",{className:j.default.preview,children:[(0,r.jsx)("div",{className:j.default.previewImage,"aria-label":o.title,style:{backgroundImage:`url('${(0,O.getBadgeImage)(o.image,100)}')`},children:(0,r.jsx)(I.BadgeCounter,{children:d})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(u.Title,{className:j.default.previewTitle,level:"2",weight:"2",children:o.title}),(0,r.jsx)(u.Text,{className:j.default.previewDescription,weight:"3",children:o.description})]})]}),(0,r.jsx)(u.Spacing,{size:25}),(0,r.jsx)(w.Separator,{}),(0,r.jsx)(u.Spacing,{size:25}),(0,r.jsx)("div",{className:j.default.previewItems,children:null==(t=s.entries)?void 0:t.map(((e,t)=>{const n=e.sender_id;return n?(0,r.jsx)(v.BadgeSenderItem,{className:j.default.previewItem,entry:e,user:this.getUserById(n)},t):null}))})]}):(0,r.jsx)(u.Spinner,{})}getBadgeById(e){return this.state.badges[e]}getUserById(e){return this.state.users[e]}getUsersById(e){return e.map((e=>this.getUserById(e)))}getBadgeEntries(e){return this.state.loadedBadgeEntries[e]}static convertBadges(e){return e.reduce(((e,t)=>(0,a._)({},e,{[t.id]:t})),{})}static convertUsers(e){return e.reduce(((e,t)=>(0,a._)({},e,{[t.id]:t})),{})}render(){const{currentBadgeId:e}=this.state,{isOwnerInfoLoaded:t}=this.state;return(0,r.jsxs)(b.ModalBox,{children:[this.renderHeader(),(0,r.jsx)(f.WithCustomScrollView,{withCustomScrollView:!e,className:j.default.layout,autoHideScrollbar:!0,children:(0,r.jsx)(m.ModalBody,{insetLevel:2,className:j.default.body,children:t?this.renderContent():(0,r.jsx)(u.Spinner,{})})})]})}constructor(e){super(e),this.fetchOwnerInfo=()=>{window.removeEventListener("online",this.fetchOwnerInfo);const{ownerId:e}=this.props;(0,i.api)("badges.getOwnerInfo",{owner_id:e,with_senders:1,fields:"photo_100,photo_200,domain"}).then((({owner_info:e,badges:t,users:n})=>{var a,r,s;this.setState({isOwnerInfoLoaded:!0,totalCount:(null==(a=((null==(r=e)?void 0:r.counters)||[]).find((e=>"total"===e.type)))?void 0:a.value)||0,counters:((null==(s=e)?void 0:s.counters)||[]).filter((e=>"total"!==e.type)),badges:x.convertBadges(t||[]),users:x.convertUsers(n||[])})})).catch((e=>{var t,n;(0,S.topError)((null==(n=e)||null==(t=n.error)?void 0:t.error_msg)||y.getLang("global_unknown_error")),(0,d.isNetworkError)(e)?window.addEventListener("online",this.fetchOwnerInfo):this.props.close()}))},this.fetchOwnerEntries=()=>{var e;window.removeEventListener("online",this.fetchOwnerEntries);const{ownerId:t}=this.props,{loadedBadgeEntries:n,currentBadgeId:r}=this.state;if(!r)return Promise.resolve();const s=this.getBadgeEntries(r),o={fields:"photo_100,photo_200,domain"};return(null==(e=s)?void 0:e.next_query)?Object.assign(o,{query:s.next_query}):Object.assign(o,{owner_id:t,badge_id:r,count:100}),(0,i.api)("badges.getOwnerEntries",o).then((({entries:e,badges:t,next_query:o,users:d})=>{var i;this.setState({users:(0,a._)({},this.state.users,x.convertUsers(d||[])),badges:(0,a._)({},this.state.badges,x.convertBadges(t||[])),loadedBadgeEntries:(0,a._)({},n,{[r]:{entries:[...(null==(i=s)?void 0:i.entries)||[],...e||[]],next_query:o}})})})).catch((e=>{var t,n;(0,S.topError)((null==(n=e)||null==(t=n.error)?void 0:t.error_msg)||y.getLang("global_unknown_error")),(0,d.isNetworkError)(e)&&window.addEventListener("online",this.fetchOwnerEntries)}))},this.selectBadge=e=>{e&&l.WebStatEvents.add({screen:"badge",type:"type_navgo",type_navgo:{type:"type_badges_screen_item",subtype:"go",item:{type:"badges",id:e,owner_id:this.props.ownerId},type_badges_screen_item:{type_badges_event:{event_name:"open_badges_collection_badge__"+(o.Ranges.isUserId(this.props.ownerId)?"u":"c")}}}}),this.setState({currentBadgeId:e})};const{isAdmin:t=!1}=e;this.state={isOwnerInfoLoaded:!1,totalCount:0,counters:[],badges:{},users:{},currentBadgeId:null,loadedBadgeEntries:{},isAdmin:t}}}},452866:(e,t,n)=>{n.d(t,{GroupBadges:()=>b});var a=n(785893),r=n(667294),s=n(86894),o=n(869048),d=n(513724),i=n(399639),l=n(222285),c=n(599809),g=n(377974),u=n(29271),_=n(726914),p=n(680938),h=n(323141),w=n(316688);const b=(0,p.withErrorBoundary)((e=>{var t,n,p,b,m,B;const{ownerId:v,isAdmin:f}=e,[I,S]=(0,r.useState)(),[y,O]=(0,r.useState)(l.LoadingStatus.pending);if((0,r.useEffect)((()=>{O(l.LoadingStatus.pending),(0,c.api)("badges.getOwnerInfo",{fields:String(["photo_100","photo_200","domain"]),owner_id:v}).then(S).then((()=>{O(l.LoadingStatus.loaded)})).catch((e=>{O(l.LoadingStatus.failed),(0,w.badgesLogger)("Failed badges.getOwnerInfo in GroupBadges",e)}))}),[v]),y!==l.LoadingStatus.loaded&&y!==l.LoadingStatus.failed)return(0,a.jsx)(h.BadgesOwnerBlockSkeleton,{separator:"hide"});if(!(null==(n=I)||null==(t=n.badges)?void 0:t.length)||y===l.LoadingStatus.failed)return null;const{badges:k,owner_info:j}=I,x=(null==(m=j)||null==(b=m.counters)||null==(p=b.find((e=>"total"===e.type)))?void 0:p.value)||0,E=()=>{(0,g.initBadgesOwnerInfo)({ownerId:v,isAdmin:f})};return(0,a.jsx)(o.AppRootProvider,{viewWidth:s.ViewWidth.DESKTOP,children:(0,a.jsx)(d.Group,{header:(0,a.jsx)(i.Header,{indicator:x,onClick:E,children:u.getLang("awards_profile_block_header")}),separator:"hide",children:(0,a.jsx)(_.BadgeItems,{badges:k,counters:null==(B=j)?void 0:B.counters,onClick:E})})})}))},680938:(e,t,n)=>{n.d(t,{withErrorBoundary:()=>g});var a=n(434788),r=n(785893),s=n(667294),o=n(513724),d=n(635928),i=n(832550),l=n(29271),c=n(316688);function g(e){return t=>(0,r.jsx)(u,{children:(0,r.jsx)(e,(0,a._)({},t))})}class u extends s.Component{static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){(0,c.badgesLogger)("Rendering error has happened in component GroupBadges",e)}render(){return this.state.hasError?(0,r.jsx)(o.Group,{separator:"hide",children:(0,r.jsx)(d.Placeholder,{header:l.getLang("global_error"),action:(0,r.jsx)(i.Button,{mode:"tertiary",loading:this.state.isReloading,onClick:this.onClick,children:l.getLang("global_reload")}),children:l.getLang("awards_group_block_unknown_error")})}):this.props.children}constructor(...e){super(...e),this.state={hasError:!1,isReloading:!1},this.onClick=()=>{this.setState({isReloading:!0}),window.nav.reload({force:!0})}}}},460854:(e,t,n)=>{n.d(t,{WithCustomScrollView:()=>d});var a=n(434788),r=n(820224),s=n(785893),o=n(86894);const d=e=>{var{withCustomScrollView:t,children:n}=e,d=(0,r._)(e,["withCustomScrollView","children"]);return t?(0,s.jsx)(o.CustomScrollView,(0,a._)({},d,{children:n})):(0,s.jsx)(s.Fragment,{children:n})}},323141:(e,t,n)=>{n.r(t),n.d(t,{BadgesOwnerBlockSkeleton:()=>i.BadgesOwnerBlockSkeleton,BadgesOwnerInfo:()=>c,GroupBadges:()=>l.GroupBadges});var a=n(785893),r=n(55163),s=n(316688),o=n(359639),d=n(222285),i=n(704919),l=n(452866);const c={init(e,t){e?(0,o.showMessageBoxModal)((({onClose:n})=>(0,a.jsx)(r.BadgesOwnerInfoModal,{ownerId:e,isAdmin:t,close:n})),{width:d.BADGES_BOX_WIDTH}):(0,s.badgesLogger)(`Wrong arguments: ownerId=${e}`)}}},222285:(e,t,n)=>{n.d(t,{BADGES_BOX_WIDTH:()=>a,BADGE_COMMENT_SELECTOR:()=>i,BadgesEventRef:()=>o,BadgesObjectType:()=>d,DONUT_BADGE_ID:()=>g,DONUT_FORM_STATUSES:()=>c,ERRORS:()=>s,LINK_TO_HELP_FOR_AUTHORS:()=>r,LoadingStatus:()=>l});const a=640,r="/@authors-badges";var s,o,d;!function(e){e[e.ERROR_PARAM=100]="ERROR_PARAM",e[e.NEED_CONFIRMATION=24]="NEED_CONFIRMATION",e[e.BALANCE=504]="BALANCE"}(s||(s={})),function(e){e.TAB="tab",e.SENDER_LIST="sender_list",e.POST_BTN="post_btn"}(o||(o={})),function(e){e[e.WALL=11]="WALL"}(d||(d={}));const i="BadgeComment";var l;!function(e){e[e.pending=0]="pending",e[e.loaded=1]="loaded",e[e.failed=2]="failed"}(l||(l={}));const c={waiting:"waiting",initial:"initial",error:"error",waiting_timeout:"waiting_timeout",payment_cancel:"payment_cancel"},g=38},849776:(e,t,n)=>{n.d(t,{BADGES_RESTRICTED_CLASS_SELECTOR_FOR_POST:()=>l,buildBadgesStackHtml:()=>_,buildHtmlAttributesString:()=>g,getBadgeImage:()=>c,getBadgesPlacementInPostActionStatusBarToUpdate:()=>u,isBadgesDisabledForOwner:()=>h,openHelpPage:()=>w,updateNewPostHTMLForBadges:()=>p});var a=n(82161),r=n(316688),s=n(68003),o=n(29271),d=n(222285),i=n(216833);const l="post--badgesRestricted";function c(e,t,n=!1){const{base_url:r,version:s}=e,o=s?`?${s}`:"";return!n&&(0,a.isRetina)()&&(t*=2),`${r}/${t}.png${o}`}const g=e=>Object.entries(e).reduce(((e,[t,n])=>{if(n){e+=` ${t}="${(0,a.escapeAttr)(String(n))}"`}return e}),""),u=(e,t,n)=>{var a;const s={place:void 0},o=e.querySelector(`._like_wall${t}_${n}`);if(!o)return(0,r.badgesLogger)("Нет кнопки лайка"),s;const d=null==(a=o.parentNode)?void 0:a.querySelector(".PostActionStatusBar");if(!d)return(0,r.badgesLogger)("Нет .PostActionStatusBar"),s;const i=d.querySelector(".BadgesStatusBar__badgesSendButton"),l=d.querySelector(".BadgesStack");return i||l?i?(s.element=i,s.place="button",s):(s.element=l,s.place="stack",s):((0,r.badgesLogger)('Нет ни стака значков, ни кнопки "Подарить"'),s)},_=({counters:e,badges:t,tqAttributes:n,withContainer:r,withLabel:d})=>{let i=0,l=0,c="";const u=s.colorScheme.isDarkScheme();if((e||[]).forEach((({type:e,badge_id:n,value:r})=>{if("total"===e)i=r;else if("badge"===e&&n&&l<3){var s;l++;const e=null==(s=t)?void 0:s.find((e=>e.id===n));if(e){const{image:t}=e,n=(0,a.isRetina)()?"stack28_light_2x.png":"stack28_light.png",r=(0,a.isRetina)()?"stack28_dark_2x.png":"stack28_dark.png",s=t.version?`?${t.version}`:"",o=`${t.base_url}/${n}${s}`,d=`${t.base_url}/${r}${s}`,i=g({src:u?d:o,class:"BadgesStackItem BadgesStack__item",alt:e.alt_text||"","data-src-light":o,"data-src-dark":d});c+=`<img ${i}>`}}})),i>0&&c){let e=`\n      <div class="BadgesStack__inner" ${n}>\n        <div class="BadgesStack__items">${c}</div>\n        <span class="BadgesStack__counter">${d?o.getLang("awards_have_gifted_badges_total",i):o.getLang("awards_wkview_badges_total",i)}</span>\n      </div>\n    `;if(r){e=`\n        <div data-tooltip-container="true" id="badges_stack" class="BadgesStack" ${"data-exec='{\"BadgesStack/init\":[]}'"}>\n          ${e}\n        </div>\n      `}return e}return""},p=(e,t,n)=>{var a,r;const s=n[2],[o,l]=s.split("_"),c=null==(r=t)||null==(a=r.wallTpl)?void 0:a.send_badge,g={};return(0,i.isBadgesEnabled)()&&c&&(e.push(c),Object.assign(g,{badges_object_id:l,badges_object_owner_id:o,badges_object_type:d.BadgesObjectType.WALL,badges_event_ref:d.BadgesEventRef.POST_BTN})),g},h=e=>{const t=e[16];try{var n;if(""===t||(null==(n=JSON.parse(t))?void 0:n.is_disabled))return!0}catch(e){return(0,r.badgesLogger)("Event from queue about IS_DISABLED_FOR_OWNER is not json"),!1}return!1},w=()=>{window.open(d.LINK_TO_HELP_FOR_AUTHORS,"_blank")}},551709:(e,t,n)=>{n.d(t,{checkPostRestrictedToSendBadge:()=>o});var a=n(218662),r=n(316688),s=n(329268);const o=(e,t)=>{const n=(0,a.getPostById)(e,t);return n?!!n.classList.contains("post--badgesRestricted")&&((0,s.renderRestrictionModal)(),!0):((0,r.badgesLogger)("Не нашли пост для показа модалки ограничения бейджиков"),!0)}},218662:(e,t,n)=>{n.d(t,{getPostById:()=>a,getReplyById:()=>r});const a=(e,t)=>{const n=`${e}_${t}`;return document.querySelector(`[data-post-id="${n}"`)},r=(e,t,n)=>e.querySelector(`#post${t}_${n}`)},460033:(e,t,n)=>{n.d(t,{ReexportInfiniteScroll:()=>a});const a=n(758021).default},608773:(e,t,n)=>{n.d(t,{initBadgesTqInteractiveHandlers:()=>p,initGroupBadgesTq:()=>h,initOpenBadgesInfoModalTq:()=>_,initStartupBadgesCheckTq:()=>b,initStartupBadgesStackTq:()=>w,tqOpenBadgesObjectInfo:()=>u});var a=n(785893),r=n(283452),s=n(377974),o=n(973935),d=n(323141),i=n(216833),l=n(321850),c=n(68003),g=n(329268);const u=()=>{(0,r.tq)().setInteractiveHandler("Badges/openBadgesObjectInfo",(e=>{if(!e.payload.dataAttrs)return;const{badgeId:t,objectType:n,objectOwnerId:a,objectId:r}=e.payload.dataAttrs;if(!n||!a||!r)throw new Error("No required attributes in tq Badges/openBadgesObjectInfo");(0,s.initBadgesObjectInfo)({type:Number(n),ownerId:Number(a),id:Number(r)},Number(t))}))},_=()=>{(0,r.tq)().setInteractiveHandler("Badges/openBadgesInfoModal",(e=>{if(!e.payload.dataAttrs)return;const{modalType:t}=e.payload.dataAttrs;if("restriction"===t)(0,g.renderRestrictionModal)();else(0,g.renderBadgesNotAvailableModal)()}))},p=()=>{u(),(0,r.tq)().setInteractiveHandler("Badges/openBadgesCatalog",(e=>{if(!e.payload.dataAttrs)return;const{objectType:t,objectOwnerId:n,objectId:a,eventRef:r}=e.payload.dataAttrs;if(!t||!n||!a)throw new Error("No required attributes in tq Badges/openBadgesCatalog");(0,s.initBadgesCatalog)({objectId:{id:Number(a),type:Number(t),ownerId:Number(n)},ref:r})}))},h=()=>{(0,r.tq)().setStartupHandler("BadgesOwner/render_group_badges",(e=>{const{data:{owner_id:t,is_admin:n},target:r}=e.payload;r&&void 0!==t&&(0,i.isBadgesEnabled)()&&(o.render((0,a.jsx)(d.GroupBadges,{ownerId:Number(t),isAdmin:Boolean(n)}),r),(0,l.pushNavDestroy)((()=>o.unmountComponentAtNode(r))))}))},w=()=>{(0,r.tq)().setStartupHandler("BadgesStack/init",(e=>{const{target:t}=e.payload;t&&c.colorScheme.subscribe((()=>{t.querySelectorAll(".BadgesStackItem").forEach((e=>{let t=e.src;const{srcLight:n=t,srcDark:a=t}=e.dataset;t=c.colorScheme.isDarkScheme()?a:n,e.src=t}))}))})),(0,r.tq)().setStartupHandler("BadgesSendButton/init_tooltip",(e=>{const{target:t}=e.payload;t&&(0,s.loadBadgesStatusBarOnboarding)({element:t})}))},b=()=>{(0,r.tq)().setStartupHandler("BadgeComment/init",(({payload:{target:e,data:t}})=>{if(!e)return;const n=t.fallback_text;if(!(0,i.isBadgesRenderingEnabled)())return void((e,t)=>{const n=e.parentElement;n&&(n.innerHTML=t)})(e,n);e.classList.remove("BadgeComment--hidden");const{is_enabled_for_owner:a,badge_id:r,object_type:s,object_owner_id:o,object_id:d}=t;if(!s||!o||!d)return;const l=(0,i.isBadgesEnabled)();if(a&&l)return e.setAttribute("data-task-click","Badges/openBadgesObjectInfo"),e.setAttribute("data-object-type",s),e.setAttribute("data-object-owner-id",o),e.setAttribute("data-object-id",d),void e.setAttribute("data-badge-id",r);e.setAttribute("data-task-click","Badges/openBadgesInfoModal"),e.setAttribute("data-modal-type",l?"restriction":"not_available")}))}},377974:(e,t,n)=>{n.d(t,{initBadgesCatalog:()=>u,initBadgesObjectInfo:()=>_,initBadgesOwnerInfo:()=>p,initBadgesTqInteractiveHandlers:()=>g.initBadgesTqInteractiveHandlers,initOpenBadgesInfoModalTq:()=>g.initOpenBadgesInfoModalTq,initStartupBadgesCheckTq:()=>g.initStartupBadgesCheckTq,initStartupBadgesStackTq:()=>g.initStartupBadgesStackTq,loadBadgesStatusBarOnboarding:()=>h});var a=n(11010),r=n(316688),s=n(659397),o=n(216833),d=n(584356),i=n(179153),l=n(874695),c=n(551709),g=n(608773);const u=({objectId:e,ref:t,withCheckRestriction:a=!0})=>{(0,o.isBadgesEnabled)()&&(a&&(0,c.checkPostRestrictedToSendBadge)(e.ownerId,e.id)||((0,d.showBoxLoader)(),(window.BadgesCatalog?Promise.resolve():(0,s.asyncImportLoader)((()=>Promise.all([n.e(75514),n.e(98066),n.e(24509),n.e(76400),n.e(40885),n.e(68592),n.e(18669)]).then(n.bind(n,768327)))).then((({BadgesCatalog:e})=>{window.BadgesCatalog=e}))).then((()=>window.BadgesCatalog.init(e,t))).catch((e=>{(0,r.badgesLogger)("Error loading module BadgesCatalog",e)})).finally((()=>{(0,d.hideBoxLoader)()}))))},_=(e,t,a)=>{(0,o.isBadgesEnabled)()&&((0,d.showBoxLoader)(),(window.BadgesObjectInfo?Promise.resolve():(0,s.asyncImportLoader)((()=>Promise.all([n.e(98066),n.e(76400),n.e(76429),n.e(68592),n.e(83803)]).then(n.bind(n,978219)))).then((({BadgesObjectInfo:e})=>{window.BadgesObjectInfo=e}))).then((()=>window.BadgesObjectInfo.init(e,t,a))).catch((e=>{(0,r.badgesLogger)("Error loading module BadgesObjectInfo",e)})).finally((()=>{(0,d.hideBoxLoader)()})))},p=e=>{if(!(0,o.isBadgesEnabled)())return;(0,d.showBoxLoader)();const{ownerId:t,isAdmin:a}=e;(window.BadgesOwnerInfo?Promise.resolve():(0,s.asyncImportLoader)((()=>Promise.resolve().then(n.bind(n,323141)))).then((({BadgesOwnerInfo:e})=>{window.BadgesOwnerInfo=e}))).then((()=>window.BadgesOwnerInfo.init(t,a))).catch((e=>{(0,r.badgesLogger)("Error loading module BadgesOwnerInfo",e)})).finally((()=>{(0,d.hideBoxLoader)()}))},h=(0,a._)((function*({element:e}){if(!(0,o.isBadgesEnabled)())return;(yield i.HelpHints.get(l.HelpHintId.POSTING_POST_FEED_BADGES_UNSEEN))&&(0,s.asyncImportLoader)((()=>n.e(27772).then(n.bind(n,375396)))).then((({renderStatusBarOnboarding:t})=>{t({element:e})})).catch((e=>{(0,r.badgesLogger)("Error loading module badges_status_bar_onboarding_init",e)}))}))},316688:(e,t,n)=>{n.d(t,{badgesLogger:()=>r});var a=n(970978);const r=(e,t)=>{window.vk.dev&&console.log(t),(0,a.logError)(new Error(e),{environment:"badges"})}},329268:(e,t,n)=>{n.d(t,{renderBadgesNotAvailableModal:()=>c,renderRestrictionModal:()=>l,renderTaskModal:()=>g});var a=n(434788),r=n(785893),s=n(895145),o=n(359639),d=n(29271);const i=(0,s.asyncComponent)((()=>n.e(60456).then(n.bind(n,575263))),(({BadgesRestrictedModal:e})=>e)),l=()=>{(0,o.showMessageBoxModalSuspense)((e=>(0,r.jsx)(i,(0,a._)({title:d.getLang("awards_restricted_tittle"),subtitle:d.getLang("awards_restricted_subheader"),buttonText:d.getLang("awards_restricted_button")},e))))},c=()=>{(0,o.showMessageBoxModalSuspense)((e=>(0,r.jsx)(i,(0,a._)({title:d.getLang("awards_not_available_tittle"),subtitle:d.getLang("awards_not_available_subheader"),buttonText:d.getLang("awards_not_available_button")},e))))},g=e=>{const t=(0,s.asyncComponent)((()=>n.e(64369).then(n.bind(n,910885))),(({BadgesTaskModal:e})=>e));(0,o.showMessageBoxModalSuspense)((n=>(0,r.jsx)(t,(0,a._)({},n,e))))}},448575:(e,t,n)=>{n.d(t,{WebStatEvents:()=>d});var a=n(11010),r=n(599809),s=n(964548),o=n(515997);const d=new class{setAPI(e){this.api=e}setUserId(e){this.userId=e}add(e){var t=this;return(0,a._)((function*(){var n,a,r,d,i;(yield t.init(),null!=(a=e).id||(a.id=(0,s.getRandomId)()),null!=(r=e).prev_id||(r.prev_id=null==(n=t.previousEvent)?void 0:n.id),null!=(d=e).timestamp||(d.timestamp=String((0,o.nowMicroseconds)())),"undefined"!=typeof window)&&(null!=(i=e).url||(i.url=window.location.href));e.type_navgo&&t.previousNavigationEvent&&(e.type_navgo.prev_navgo_id=t.previousNavigationEvent.id,e.type_navgo.prev_navgo_timestamp=t.previousNavigationEvent.timestamp),t.previousEvent=e,e.type_navgo&&(t.previousNavigationEvent=e),t.queue.add(e),t.send()}))()}init(){var e=this;return(0,a._)((function*(){if(e.initialized)return;if(e.initialized=!0,e.api)return;const t=yield(0,r.login)("web_token").catch((()=>{}));if(!t)return void(e.initialized=!1);const{access_token:n}=t;e.api=new s.API({token:n}),e.api.onTokenRegenerate((0,a._)((function*(t){const n=yield(0,r.login)("web_token").catch((()=>{}));if(!n)return void(e.initialized=!1);const{access_token:a}=n;t(a)})))}))()}send(){this.api&&this.queue.size&&(this.api.statEvents.addWeb({events:JSON.stringify([...this.queue.values()]),user_id:this.userId}),this.queue.clear())}constructor(){var e;this.userId="undefined"!=typeof window&&(null==(e=window.vk)?void 0:e.id)||0,this.queue=new Set,this.initialized=!1}}},515997:(e,t,n)=>{n.d(t,{nowMicroseconds:()=>r});const a=performance.timeOrigin||performance.timing.navigationStart||Date.now();function r(){return Math.floor(1e3*(a+performance.now()))}},212147:(e,t,n)=>{n.d(t,{isNetworkError:()=>a});const a=e=>{var t;return"network_error"===(null==(t=e)?void 0:t.type)}},512796:(e,t,n)=>{function a(e){if(null==e)throw new TypeError("Cannot destructure "+e);return e}n.d(t,{_:()=>a})}}]);try{stManager.done("dist/1bfba6d3805d53174acd15b3e6971331.073e41a0e449e66e06a9.js")}catch(e){}